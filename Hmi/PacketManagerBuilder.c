#pragma diag_suppress=Go003

#include <intrinsics.h>
#include <string.h>
#include <math.h>

#include "IncludeList_Implementation.h"

#include "System/Interface/system.h"

#if(HOST_FRAMEWORK_VERSION < 0x020300)
#include "../../common/interface/common_type.h"
#include "../../common/interface/assert.h"
#else
#include "System/Interface/common_type.h"
#include "System/Interface/assert.h"
#endif
#include "RTOS/Interface/rtos.h"
#include "T_DATA_OBJ/Interface/simple_type.h"
#include "T_DATA_OBJ/Interface/t_data_obj.h"
#include "T_Unit/Interface/t_unit.h"
#include "Coordinator/Interface/subsystem_idx.h"

#include "Hmi/Interface/HMI_idx.h"
#include "Hmi/Interface/HMI.h"
#include "hmi_types.h"
#include "hmi_attributes.h"
#include "FrameTableDefinitions.h"
#include "FrameTable.h"
#include "keystateDefinitions.h"

#include "IncludeList_Frames_1.h"

#include "FixedIconDefinitions.h"

#include "Adjuster.h"
#include "writeProtect.h"

#ifdef AZ200_SPECIAL_FEATURES_HMI
#include "../../O2_Calibration/Interface/o2_calibration.h"
#include "../../O2_Calibration/Interface/o2_calibration_idx.h"
#include "../../O2_Calibration/Source/O2_Calibration_PerformanceLog.h"
#include "../../RelayOutput/Interface/RelayOutput.h"
#include "../../RelayOutput/Interface/RelayOutput_idx.h"
#include "../../nvinterface/Interface/NVinterface.h"
#include "../../nvinterface/Interface/NVinterface_idx.h"
#include "../../Measurement/Interface/Measurement.h"
#include "../../Measurement/Interface/Measurement_idx.h"
#include "../../OvenControl/Interface/OvenControl.h"
#include "../../OvenControl/Interface/OvenControl_idx.h"
#include "../../Digital_IO/Interface/Digital_IO.h"
#include "../../Digital_IO/Interface/Digital_IO_idx.h"
#include "../../Device/Interface/Device_idx.h"
#include "nvInitIndeces.h"
#endif

#if defined(HMI_SUPPORTS_GRAPH_VIEW) || defined(HMI_SUPPORTS_GRAPH_PARAM_FRAMES)
#include "TrendView.h"
#endif

#ifdef HMI_SUPPORTS_WAVEFORM_FRAMES
#include "wavefornFrameDefinitions.h"
#include "../../waveform/interface/waveform.h"
#endif

#ifdef HMI_SUPPORTS_MATRIX_FRAMES
#include "../../matrix/interface/matrix.h"
#endif

#ifdef TYPE_4_IMPLEMENTATION
#include "Low_Level\Implementation\Type_Macros\macros_type_4.h"
#elif defined (TYPE_5_IMPLEMENTATION)
#include "Low_Level\Implementation\Type_Macros\macros_type_5.h"
#endif

#include "PacketManager.h"
#include "PacketManagerLocalData.h"
#include "PacketManagerBuilder.h"
#include "PacketManagerBuilderServices.h"       // PacketManagerBuilderServices

#if ((HMIGEN_MAJOR_VERSION > 22) || ((HMIGEN_MAJOR_VERSION == 22) && (HMIGEN_MINOR_VERSION > 1)))
#define AUTOCAL_RENAME_AVAILABLE
#endif



#pragma diag_suppress=Pm071
#include "low_level\core\Driver.h"
#pragma diag_default=Pm071

extern PACKETMANAGER_LOCAL_TYPE  *pPacketManagerLocal;

//------------------------------------------------------------------------
// Operator Page Icons
//------------------------------------------------------------------------

static const TUSIGN8 Blank_Icon[24]                             = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
static const TUSIGN8 WriteProtectLock[10]                       = {0xF8,0xFE,0xF9,0x89,0xF9,0xFE,0xF8,0x00,0x00,0x00};
static const TUSIGN8 WriteProtectUnlock[10]                     = {0xF8,0xF8,0xF8,0x88,0xF8,0xFE,0xF9,0x01,0x01,0x0E};

static TUSIGN8 AutoControl[24]                                  = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3D,0x43,0x87,0x80,0x80,0x87,0x43,0x3D,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
static TUSIGN8 ManualControl[24]                                = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x50,0x8F,0x08,0x07,0x08,0x07,0xC8,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

#ifdef EDP300_SPECIAL_FEATURES_HMI
static const TUSIGN8 DIAG_Icon[24]                              = {0x00,0x00,0x00,0x00,0x00,0xFF,0x80,0xC0,0xA0,0x90,0x88,0x90,0xA0,0x90,0x88,0x84,0x82,0x80,0x80,0x00,0x00,0x00,0x00,0x00};
static const TUSIGN8 FAIL_Icon[24]                              = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC6,0xEE,0x7C,0x38,0x7C,0xEE,0xC6,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
static const TUSIGN8 UNIV_Icon[24]                              = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x82,0x82,0xC6,0xC6,0xAA,0xAA,0x92,0x92,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
static const TUSIGN8 SERV_Icon[24]                              = {0x00,0x00,0x00,0x00,0x24,0x66,0x66,0x7E,0x3C,0x18,0x18,0x18,0x18,0x18,0x3C,0x7E,0x66,0x66,0x24,0x00,0x00,0x00,0x00,0x00};
#else
#define DIAG_Icon                                               Blank_Icon
#define FAIL_Icon                                               Blank_Icon
#define UNIV_Icon                                               Blank_Icon
#define SERV_Icon                                               Blank_Icon
#endif

#ifdef AZ200_SPECIAL_FEATURES_HMI
static const TUSIGN8 O2Quality_0[24]                            = {0x7E,0x81,0x81,0x7E,0x24,0x24,0xFF,0x24,0x24,0x24,0x3C,0x3C,0x00,0xFF,0x81,0xFF,0x00,0xFF,0x81,0xFF,0x00,0xFF,0x81,0xFF};
static const TUSIGN8 O2Quality_1[24]                            = {0x7E,0x81,0x81,0x7E,0x24,0x24,0xFF,0x24,0x24,0x24,0x3C,0x3C,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0x81,0xFF,0x00,0xFF,0x81,0xFF};
static const TUSIGN8 O2Quality_2[24]                            = {0x7E,0x81,0x81,0x7E,0x24,0x24,0xFF,0x24,0x24,0x24,0x3C,0x3C,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0x81,0xFF};
static const TUSIGN8 O2Quality_3[24]                            = {0x7E,0x81,0x81,0x7E,0x24,0x24,0xFF,0x24,0x24,0x24,0x3C,0x3C,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF};
#else
#define O2Quality_0                                             Blank_Icon
#define O2Quality_1                                             Blank_Icon
#define O2Quality_2                                             Blank_Icon
#define O2Quality_3                                             Blank_Icon
#endif

static const TUSIGN8 Media_Fitted_Icon[24]                      = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0x55,0xD5,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00};
static const TUSIGN8 Media_Write_Icon[24]                       = {0x00,0x00,0x1C,0x1C,0x1C,0x1C,0x7F,0x3E,0x1C,0x08,0x00,0x00,0x3F,0x55,0xD5,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00};

#ifdef EDP300_SPECIAL_FEATURES_HMI
static const TUSIGN8 Reg_Check_Icon[24]                         = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x62,0xA1,0x99,0x99,0x81,0x42,0x3C};
static const TUSIGN8 Reg_UnCheck_Icon[24]                       = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x62,0xA1,0x81,0x81,0x81,0x42,0x3C};
static const TUSIGN8 MSP_Check_Icon[24]                         = {0x3C,0x50,0x8F,0x08,0x07,0x08,0x07,0xC8,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x62,0xA1,0x99,0x99,0x81,0x42,0x3C};
static const TUSIGN8 MSP_UnCheck_Icon[24]                       = {0x3C,0x50,0x8F,0x08,0x07,0x08,0x07,0xC8,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x62,0xA1,0x81,0x81,0x81,0x42,0x3C};
static const TUSIGN8 Manual_Icon[24]                            = {0x3C,0x50,0x8F,0x08,0x07,0x08,0x07,0xC8,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
static const TUSIGN8 HART_Check_Icon[24]                        = {0x08,0x00,0x18,0x20,0x48,0x48,0x20,0x1C,0x02,0x09,0x09,0x02,0x0C,0x00,0x08,0x00,0xE0,0x62,0xA1,0x99,0x99,0x81,0x42,0x3C};
static const TUSIGN8 HART_UnCheck_Icon[24]                      = {0x08,0x00,0x18,0x20,0x48,0x48,0x20,0x1C,0x02,0x09,0x09,0x02,0x0C,0x00,0x08,0x00,0xE0,0x62,0xA1,0x81,0x81,0x81,0x42,0x3C};
static const TUSIGN8 BIN_Check_Icon[24]                         = {0x00,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x7F,0x3E,0x1C,0x08,0x00,0x00,0xE0,0x62,0xA1,0x99,0x99,0x81,0x42,0x3C};
static const TUSIGN8 BIN_UnCheck_Icon[24]                       = {0x00,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x7F,0x3E,0x1C,0x08,0x00,0x00,0xE0,0x62,0xA1,0x81,0x81,0x81,0x42,0x3C};
#else
#define Reg_Check_Icon                                          Blank_Icon
#define Reg_UnCheck_Icon                                        Blank_Icon
#define MSP_Check_Icon                                          Blank_Icon
#define MSP_UnCheck_Icon                                        Blank_Icon
#define Manual_Icon                                             Blank_Icon
#define HART_Check_Icon                                         Blank_Icon
#define HART_UnCheck_Icon                                       Blank_Icon
#define BIN_Check_Icon                                          Blank_Icon
#define BIN_UnCheck_Icon                                        Blank_Icon
#endif

#ifdef EDP300_SPECIAL_FEATURES_HMI

static const TUSIGN8 EDP300_specialIcon_1[19]                   = {0x00,0x00,0x00,0x00,0x38,0x04,0x02,0x01,0x71,0x71,0x71,0x01,0x02,0x04,0xF8,0x00,0x00,0x00,0x00};
static const TUSIGN8 EDP300_specialIcon_2[19]                   = {0x00,0x00,0x00,0x00,0x00,0x07,0x03,0x05,0x04,0x04,0x04,0x04,0x02,0x01,0x00,0x00,0x00,0x00,0x00};
static const TUSIGN8 EDP300_specialIcon_3[19]                   = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
static const TUSIGN8 EDP300_specialIcon_4[19]                   = {0x00,0x00,0x00,0x00,0x38,0x04,0x02,0x01,0x01,0x01,0x01,0x01,0x02,0x04,0xF8,0x00,0x00,0x00,0x00};
static const TUSIGN8 EDP300_specialIcon_5[19]                   = {0x00,0x00,0x00,0x00,0x00,0x87,0xE3,0x15,0xE4,0x14,0xE4,0x14,0xE2,0x41,0x80,0x00,0x00,0x00,0x00};
static const TUSIGN8 EDP300_specialIcon_6[19]                   = {0x00,0x00,0x00,0x00,0x1F,0x20,0xC7,0x00,0x03,0x00,0x03,0x00,0x83,0x40,0x3F,0x00,0x00,0x00,0x00};
static const TUSIGN8 EDP300_specialIcon_7[19]                   = {0x00,0x00,0x00,0x00,0x00,0x80,0xE0,0x10,0xE0,0x10,0xE0,0x10,0xE0,0x40,0x80,0x00,0x00,0x00,0x00};
static const TUSIGN8 EDP300_specialIcon_8[19]                   = {0x00,0x00,0x00,0x00,0x00,0x07,0x03,0x05,0x04,0x04,0x04,0x84,0x82,0x81,0x80,0x00,0x00,0x00,0x00};
static const TUSIGN8 EDP300_specialIcon_9[19]                   = {0x08,0x00,0x38,0x40,0x88,0x88,0x88,0x88,0x40,0x3E,0x01,0x08,0x08,0x08,0x08,0x01,0x0E,0x00,0x08};
static const TUSIGN8 EDP300_specialIcon_10[19]                  = {0x00,0x00,0x00,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x7F,0x3E,0x1C,0x08,0x00,0x00,0x00};
static const TUSIGN8 EDP300_specialIcon_11[19]                  = {0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x40,0x00,0x00};
static const TUSIGN8 EDP300_specialIcon_12[19]                  = {0xFF,0x80,0xC0,0xA0,0x90,0x88,0x84,0x82,0x84,0x88,0x90,0x88,0x84,0x82,0x81,0x80,0x80,0x80,0x80};
static const TUSIGN8 EDP300_specialIcon_13[19]                  = {0x00,0x00,0x00,0x00,0x60,0xE0,0xC0,0x80,0x00,0x00,0x00,0x80,0xC0,0xE0,0x60,0x00,0x00,0x00,0x00};
static const TUSIGN8 EDP300_specialIcon_14[19]                  = {0x00,0x00,0x00,0x00,0xC0,0xE0,0x71,0x3B,0x1F,0x0E,0x1F,0x3B,0x71,0xE0,0xC0,0x00,0x00,0x00,0x00};
static const TUSIGN8 EDP300_specialIcon_15[19]                  = {0xE0,0x20,0x60,0x60,0x60,0xA0,0xA0,0xA0,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0xE0,0x00};
static const TUSIGN8 EDP300_specialIcon_16[19]                  = {0xFF,0x80,0xC0,0xC0,0xC0,0xA0,0xA0,0xA0,0x91,0x91,0x91,0x8A,0x8A,0x8A,0x84,0x84,0x84,0xFF,0x00};
static const TUSIGN8 EDP300_specialIcon_17[19]                  = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xF8,0xFC,0xFC,0xCC,0xC4,0xE0,0xF0};
static const TUSIGN8 EDP300_specialIcon_18[19]                  = {0x80,0xC0,0xC0,0xC0,0xE0,0xE0,0xF0,0xF8,0x7C,0x3E,0x1F,0x0F,0x07,0x03,0x03,0x01,0x01,0x01,0x00};
static const TUSIGN8 EDP300_specialIcon_19[19]                  = {0x07,0x03,0x11,0x19,0x1F,0x1F,0x0F,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

#endif

#ifdef HMI_USES_COMMONDIAGNOSTICS
static const TUSIGN8 InfoMessageIcon_T[18]                      = {0x00,0xFF,0x01,0xFD,0xFD,0xFD,0xFD,0x3D,0x25,0x25,0xFD,0xFD,0xFD,0xFD,0xFD,0x01,0xFF,0x00};
static const TUSIGN8 InfoMessageIcon_B[18]                      = {0x00,0xFF,0x80,0xBF,0xBF,0xBF,0xBF,0xBF,0xA0,0xA0,0xA7,0xBF,0xBF,0xBF,0xBF,0x80,0xFF,0x00};
#endif


#if (!defined(DISABLE_BACK_MOVE_SELECT) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)) || defined(HMI_SUPPORTS_LINEARIZER_FRAMES)
#define UP_DOWN_ICON_FIELD_WIDTH        9
static const TUSIGN8 DownKey[UP_DOWN_ICON_FIELD_WIDTH]          = {0x08,0x18,0x38,0x78,0xF8,0x78,0x38,0x18,0x08};
static const TUSIGN8 UpKey[UP_DOWN_ICON_FIELD_WIDTH]            = {0x80,0xC0,0xE0,0xF0,0xF8,0xF0,0xE0,0xC0,0x80};

const TUSIGN8 UP_DOWN_ICON_POS = (MAX_COMMON_HMI_WIDTH / 2) - 5;
#endif

#if defined(HMI_SUPPORTS_WAVEFORM_FRAMES) || defined(HMI_SUPPORTS_LINEARIZER_FRAMES)
#define KEY_FIELD_WIDTH                 8
const TUSIGN8 LeftKey_Next[KEY_FIELD_WIDTH]                     = {0x00, 0x24, 0x72, 0xFA, 0x22, 0x1C, 0x00, 0x00};
const TUSIGN8 RightKey_Back[KEY_FIELD_WIDTH]                    = {0x00, 0x20, 0x70, 0xF8, 0x20, 0x20, 0x20, 0x3E};
const TUSIGN8 RightKey_Edit[KEY_FIELD_WIDTH]                    = {0x00, 0x0E, 0x06, 0x0A, 0x10, 0xA0, 0xC0, 0xE0};
#endif

#if defined(EDP300_SPECIAL_FEATURES_HMI) || defined(HMI_SUPPORTS_MANUAL_VALVE_CAL)
static const TUSIGN8 FastIncAvailable_Icon[SMALL_ICON_WIDTH]    = {0x00,0x00,0x00,0x90,0xD8,0xA4,0x92,0x89,0x92,0xA4,0xD8,0x90};
static const TUSIGN8 FastIncActive_Icon[SMALL_ICON_WIDTH]       = {0x00,0x00,0x00,0x90,0xD8,0xEC,0xF6,0xFB,0xF6,0xEC,0xD8,0x90};
static const TUSIGN8 FastDecAvailable_Icon[SMALL_ICON_WIDTH]    = {0x00,0x00,0x00,0x09,0x1B,0x25,0x49,0x91,0x49,0x25,0x1B,0x09};
static const TUSIGN8 FastDecActive_Icon[SMALL_ICON_WIDTH]       = {0x00,0x00,0x00,0x09,0x1B,0x37,0x6F,0xDF,0x6F,0x37,0x1B,0x09};
#endif

const TUSIGN8 AutoscrollIcon[7]   = {0x1C,0x22,0x01,0x01,0x71,0x62,0x5C};

static const TUSIGN8 viewIcon[nVIEW_ICONS][SMALL_ICON_WIDTH]    = {{0x00,0x00,0x1F,0x11,0x11,0xF9,0xFF,0xF8,0xF8,0xF8,0x00,0x00}    // [0] Generic View Icon
//                                                                  #if (defined(SECOND_OPERATOR_PAGE) || defined(THIRD_OPERATOR_PAGE) || defined(FOURTH_OPERATOR_PAGE) || defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)) && !defined(DISABLE_OP_PAGE_ID)
#if nVIEW_ICONS > 1
                                                                  ,{0x00,0x3F,0x21,0x21,0xFD,0xFD,0xFD,0x07,0xFC,0xFC,0xFC,0x00}    // [1] View Icon for Page 1
                                                                  ,{0x00,0x3F,0x21,0x21,0xFD,0xFD,0x35,0x57,0x6C,0xFC,0xFC,0x00}    // [2] View Icon for Page 2
                                                                  ,{0x00,0x3F,0x21,0x21,0xFD,0xFD,0x75,0x57,0xAC,0xFC,0xFC,0x00}    // [3] View Icon for Page 3
                                                                  ,{0x00,0x3F,0x21,0x21,0xFD,0xFD,0xC5,0xDF,0x04,0xFC,0xFC,0x00}    // [4] View Icon for Page 4
//                                                                  #ifdef COMMON_TOP_WORKS_NEW_FEATURES
#endif
#if nVIEW_ICONS > 5
                                                                  ,{0x00,0x3F,0x21,0x21,0xFD,0xFD,0x45,0x57,0x14,0xFC,0xFC,0x00}    // [5] View Icon for Page 5
                                                                  ,{0x00,0x3F,0x21,0x21,0xFD,0xFD,0x0D,0x57,0x14,0xFC,0xFC,0x00}    // [6] View Icon for Page 6
//                                                                  #endif
//                                                                  #endif
#endif
                                                                  };



#ifdef LEFT_RIGHT_LOCKOUT
static const TUSIGN8 LR_Icon_NoKey[SMALL_ICON_WIDTH]            = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
static const TUSIGN8 LR_Icon_WrongKey[SMALL_ICON_WIDTH]         = {0x00,0x00,0x00,0x00,0x00,0xDF,0xDF,0x00,0x00,0x00,0x00,0x00};
static const TUSIGN8 menuIcon[SMALL_ICON_WIDTH]                 = {0x00,0x7E,0x7F,0x6B,0x7F,0x6B,0x6B,0x6B,0x6B,0x7F,0x7E,0x00};
#endif


typedef struct
{
    const TUSIGN8*  pIcon;
    TUSIGN8         size;
    TBOOL           valid_3;
    TBOOL           valid_5;
    TBOOL           valid_7;
} OPERATOR_ICON_INFO_TYPE;

OPERATOR_ICON_INFO_TYPE OperatorIconInfo[] =
{
  // pIcon,                 size,   valid_3 valid_5 valid_7    // Icon ID
    {Blank_Icon,            24,     eTRUE,  eFALSE, eTRUE   } //  0 = Blank
   ,{WriteProtectLock,      10,     eFALSE, eTRUE,  eFALSE  } //  1 = Write Protect (Locked)
   ,{WriteProtectUnlock,    10,     eFALSE, eTRUE,  eFALSE  } //  2 = Write Protect (Unlocked)
   ,{Blank_Icon,            10,     eFALSE, eTRUE,  eFALSE  } //  3 = Write Protect (Blank)
   ,{AutoControl,           24,     eFALSE, eFALSE, eTRUE   } //  4 = Auto Control
   ,{ManualControl,         24,     eFALSE, eFALSE, eTRUE   } //  5 = Manual Control
   ,{Blank_Icon,            24,     eFALSE, eFALSE, eFALSE  } //  6 = Spare
   ,{Blank_Icon,            24,     eFALSE, eFALSE, eFALSE  } //  7 = Spare
   ,{DIAG_Icon,             24,     eTRUE,  eFALSE, eTRUE   } //  8 = DIAG                      only supported with EDP300_SPECIAL_FEATURES_HMI
   ,{FAIL_Icon,             24,     eTRUE,  eFALSE, eTRUE   } //  9 = FAIL                      only supported with EDP300_SPECIAL_FEATURES_HMI
   ,{UNIV_Icon,             24,     eTRUE,  eFALSE, eTRUE   } // 10 = UNIV                      only supported with EDP300_SPECIAL_FEATURES_HMI
   ,{SERV_Icon,             24,     eTRUE,  eFALSE, eTRUE   } // 11 = Service Mode              only supported with EDP300_SPECIAL_FEATURES_HMI
   ,{O2Quality_0,           24,     eFALSE, eFALSE, eTRUE   } // 12 = Poor Meas. Quality        only supported with AZ200_SPECIAL_FEATURES_HMI
   ,{O2Quality_1,           24,     eFALSE, eFALSE, eTRUE   } // 13 = Avg Meas. Quality         only supported with AZ200_SPECIAL_FEATURES_HMI
   ,{O2Quality_2,           24,     eFALSE, eFALSE, eTRUE   } // 14 = Good Meas. Quality        only supported with AZ200_SPECIAL_FEATURES_HMI
   ,{O2Quality_3,           24,     eFALSE, eFALSE, eTRUE   } // 15 = Perfect Meas. Quality     only supported with AZ200_SPECIAL_FEATURES_HMI
   ,{Media_Fitted_Icon,     24,     eFALSE, eFALSE, eTRUE   } // 16 = Media Fitted
   ,{Media_Write_Icon,      24,     eFALSE, eFALSE, eTRUE   } // 17 = Writing to Media
   ,{Reg_Check_Icon,        24,     eFALSE, eFALSE, eTRUE   } // 18                             only supported with EDP300_SPECIAL_FEATURES_HMI
   ,{Reg_UnCheck_Icon,      24,     eFALSE, eFALSE, eTRUE   } // 19                             only supported with EDP300_SPECIAL_FEATURES_HMI
   ,{MSP_Check_Icon,        24,     eFALSE, eFALSE, eTRUE   } // 20                             only supported with EDP300_SPECIAL_FEATURES_HMI
   ,{MSP_UnCheck_Icon,      24,     eFALSE, eFALSE, eTRUE   } // 21                             only supported with EDP300_SPECIAL_FEATURES_HMI
   ,{Manual_Icon,           24,     eFALSE, eFALSE, eTRUE   } // 22                             only supported with EDP300_SPECIAL_FEATURES_HMI
   ,{HART_Check_Icon,       24,     eFALSE, eFALSE, eTRUE   } // 23                             only supported with EDP300_SPECIAL_FEATURES_HMI
   ,{HART_UnCheck_Icon,     24,     eFALSE, eFALSE, eTRUE   } // 24                             only supported with EDP300_SPECIAL_FEATURES_HMI
   ,{BIN_Check_Icon,        24,     eFALSE, eFALSE, eTRUE   } // 25                             only supported with EDP300_SPECIAL_FEATURES_HMI
   ,{BIN_UnCheck_Icon,      24,     eFALSE, eFALSE, eTRUE   } // 26                             only supported with EDP300_SPECIAL_FEATURES_HMI
};

#define MAX_OPERATOR_DEFINED_ICONS  26

#ifdef HMI_SUPPORTS_SECURITY_ACCESS
const TUSIGN8 SecurityIcon[12] = {0x18,0x3C,0x66,0x66,0x3C,0x18,0x18,0x18,0xF8,0x38,0xF8,0x18};
#endif

//------------------------------------------------------------------------
// Other Icons
//------------------------------------------------------------------------
#if defined (AZ200_SPECIAL_FEATURES_HMI) || defined (HMI_SUPPORTS_MANUAL_ADJUST_MODIFIER)

static const TUSIGN8 ValveClosedUpper[25] = {0x60,0x60,0x60,0x60,0x60,0x60,0x60,0x70,0x78,0x78,0xC0,0xC0,0xC0,0xC0,0xC0,0x78,0x78,0x70,0x60,0x60,0x60,0x60,0x60,0x60,0x60};
static const TUSIGN8 ValveClosedLower[25] = {0xC0,0xC4,0xC4,0xC4,0xC4,0xDF,0xCE,0xC4,0xC0,0xC0,0xFF,0xFF,0xFF,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0};
static const TUSIGN8 ValveOpenUpper[25]   = {0x60,0x60,0x60,0x60,0x60,0x60,0x60,0x70,0x78,0x78,0xFF,0xFF,0xFF,0xFF,0xFF,0x78,0x78,0x70,0x60,0x60,0x60,0x60,0x60,0x60,0x60};
static const TUSIGN8 ValveOpenLower[25]   = {0xC0,0xC4,0xC4,0xC4,0xC4,0xDF,0xCE,0xC4,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC4,0xC4,0xC4,0xC4,0xDF,0xCE,0xC4,0xC0};

static const TUSIGN8 RelayOnUpper[25]     = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
static const TUSIGN8 RelayOnLower[25]     = {0x30,0x30,0x78,0xFC,0xCC,0xCC,0xFC,0x78,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x78,0xFC,0xCC,0xCC,0xFC,0x78,0x30,0x30};
static const TUSIGN8 RelayOffUpper[25]    = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
static const TUSIGN8 RelayOffLower[25]    = {0x30,0x30,0x78,0xFC,0xCC,0xCC,0xFC,0x78,0x0C,0x0C,0x06,0x06,0x03,0x03,0x01,0x01,0x00,0x78,0xFC,0xCC,0xCC,0xFC,0x78,0x30,0x30};

static const TUSIGN8 DigoutHighUpper[25]  = {0x20,0x20,0x20,0xFC,0x08,0x18,0x10,0x30,0x60,0x40,0xC0,0x80,0x00,0x00,0x00,0x00,0x02,0x02,0x22,0x32,0xFA,0x32,0x22,0x02,0x02};
static const TUSIGN8 DigoutHighLower[25]  = {0x08,0x08,0x08,0x7F,0x20,0x30,0x18,0x08,0x0C,0x04,0x06,0x03,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00};
static const TUSIGN8 DigoutLowUpper[25]   = {0x20,0x20,0x20,0xFC,0x08,0x18,0x10,0x30,0x60,0x40,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
static const TUSIGN8 DigoutLowLower[25]   = {0x08,0x08,0x08,0x7F,0x20,0x30,0x18,0x08,0x0C,0x04,0x06,0x03,0x01,0x01,0x01,0x00,0x80,0x80,0x88,0x98,0xBF,0x98,0x88,0x80,0x80};

#endif

#if defined (AZ200_SPECIAL_FEATURES_HMI)

static const TUSIGN8 PLog_Top[18]         = {0xFF,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0xFF};
static const TUSIGN8 PLog_Blank[18]       = {0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF};
static const TUSIGN8 PLog_Bottom[18]      = {0x7F,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x7F};
static const TUSIGN8 PLog_ProbeHead[18]   = {0xFF,0x00,0x00,0x1E,0x3F,0x21,0xE1,0xE1,0x21,0x21,0x21,0xE1,0x21,0x21,0x1E,0x00,0x00,0xFF};
static const TUSIGN8 PLog_ProbeFlange[18] = {0xFF,0x00,0x70,0x70,0x50,0x50,0xDF,0xDF,0x50,0x50,0x50,0xDF,0x50,0x50,0x50,0x70,0x00,0xFF};
static const TUSIGN8 PLog_ProbeBody[18]   = {0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF};
static const TUSIGN8 PLog_ProbeSensor[18] = {0xFF,0x00,0x00,0x00,0x00,0x00,0x7D,0x7F,0x7D,0x7D,0x7F,0x7D,0x00,0x00,0x00,0x00,0x00,0xFF};
static const TUSIGN8 PLog_AccChkUpper[18] = {0xFF,0x00,0x00,0xF8,0x0C,0xAA,0xAF,0xA1,0xA9,0xA9,0xA9,0xA9,0xA9,0x01,0xFF,0x00,0x00,0xFF};
static const TUSIGN8 PLog_AccChkLower[18] = {0xFF,0x00,0x00,0x3F,0x20,0x2A,0x2A,0x2A,0x2A,0x2A,0x2A,0x2A,0x2A,0x20,0x3F,0x00,0x00,0xFF};
static const TUSIGN8 PLog_CalUpper[18]    = {0xFF,0x00,0xE0,0x18,0x14,0x22,0x02,0x0D,0x01,0x01,0x8D,0xC2,0xE2,0x64,0x18,0xE0,0x00,0xFF};
static const TUSIGN8 PLog_CalLower[18]    = {0xFF,0x00,0x01,0x06,0x08,0x10,0x10,0x2E,0x2A,0x2F,0x23,0x11,0x10,0x08,0x06,0x01,0x00,0xFF};
static const TUSIGN8 PLog_BadUpper[18]    = {0xFF,0x00,0x04,0x0E,0x1C,0x38,0x70,0xE0,0xC0,0xE0,0x70,0x38,0x1C,0x0E,0x04,0x00,0x00,0xFF};
static const TUSIGN8 PLog_BadLower[18]    = {0xFF,0x00,0x10,0x38,0x1C,0x0E,0x07,0x03,0x01,0x03,0x07,0x0E,0x1C,0x38,0x10,0x00,0x00,0xFF};
static const TUSIGN8 PLog_GoodUpper[18]   = {0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0x30,0x08,0x04,0x02,0x00,0x00,0xFF};
static const TUSIGN8 PLog_GoodLower[18]   = {0xFF,0x00,0x00,0x01,0x06,0x1C,0x78,0x1E,0x07,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF};

const TUSIGN8* PLog_invalid[5]     = {PLog_Blank,       PLog_Blank,       PLog_Blank,     PLog_Blank,     PLog_Blank};
const TUSIGN8* PLog_newProbe[5]    = {PLog_ProbeHead,   PLog_ProbeFlange, PLog_ProbeBody, PLog_ProbeBody, PLog_ProbeSensor};
const TUSIGN8* PLog_GoodAccChk[5]  = {PLog_AccChkUpper, PLog_AccChkLower, PLog_Blank,     PLog_GoodUpper, PLog_GoodLower};
const TUSIGN8* PLog_BadAccChk[5]   = {PLog_AccChkUpper, PLog_AccChkLower, PLog_Blank,     PLog_GoodUpper, PLog_GoodLower};

#ifndef EVALUATION_VERSION

static const TUSIGN8 ABB_logo_upperLeft[20]  = {0x00,0x00,0x00,0x70,0x7E,0x7F,0x7F,0x00,0x7F,0x7F,0x7E,0x70,0x00,0x00,0x00,0x00,0x7F,0x7F,0x7F,0x7F};
static const TUSIGN8 ABB_logo_upperRight[20] = {0x00,0x7F,0x7F,0x7F,0x3E,0x1C,0x00,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x7F,0x7F,0x7F,0x3E,0x1C,0x00,0x00};
static const TUSIGN8 ABB_logo_lowerLeft[20]  = {0x60,0x7C,0x7F,0x7F,0x0F,0x0F,0x0F,0x00,0x0F,0x0F,0x0F,0x7F,0x7F,0x7C,0x60,0x00,0x7F,0x7F,0x7F,0x7F};
static const TUSIGN8 ABB_logo_lowerRight[20] = {0x00,0x7F,0x7F,0x7F,0x3F,0x3F,0x0E,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x7F,0x7F,0x7F,0x3F,0x3F,0x0E,0x00};

#else

static const TUSIGN8 ABB_logo_upperLeft[20]  = {0x01,0x7D,0x55,0x45,0x01,0x3D,0x41,0x3D,0x01,0x7D,0x25,0x7D,0x01,0x7D,0x41,0x41,0x01,0x7D,0x41,0x7D};
static const TUSIGN8 ABB_logo_upperRight[20] = {0x01,0x7D,0x25,0x7D,0x01,0x05,0x7D,0x05,0x01,0x7D,0x01,0x7D,0x45,0x7D,0x01,0x7D,0x09,0x11,0x7D,0x01};
static const TUSIGN8 ABB_logo_lowerLeft[20]  = {0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x4F,0x50,0x4F,0x40,0x5F,0x55,0x51,0x40,0x5F,0x45,0x5B,0x40,0x57};
static const TUSIGN8 ABB_logo_lowerRight[20] = {0x55,0x5D,0x40,0x5F,0x40,0x5F,0x51,0x5F,0x40,0x5F,0x42,0x44,0x5F,0x40,0x40,0x40,0x40,0x40,0x40,0x40};

#endif




#endif


#ifdef EDP300_SPECIAL_FEATURES_HMI

static const TUSIGN8 Radio_Checked[10]       = {0x00,0x3E,0x41,0x5D,0x5D,0x5D,0x41,0x3E,0x00,0x00};
static const TUSIGN8 Radio_Unchecked[10]     = {0x00,0x3E,0x41,0x41,0x41,0x41,0x41,0x3E,0x00,0x00};

static const TUSIGN8 QuickAdjIcon_U[13]      = {0xE0,0x18,0x04,0xE2,0xA2,0xA1,0xE1,0xE1,0xE2,0xE2,0x04,0x18,0xE0};
static const TUSIGN8 QuickAdjIcon_L[13]      = {0x00,0x03,0x04,0x08,0x08,0x10,0x10,0x10,0x08,0x08,0x04,0x03,0x00};

static const TUSIGN8 QuickAdjIcon_UP_Key[9]  = {0x20,0x30,0x38,0x3C,0x3E,0x3C,0x38,0x30,0x20};
static const TUSIGN8 QuickAdjIcon_DN_Key[9]  = {0x02,0x06,0x0E,0x1E,0x3E,0x1E,0x0E,0x06,0x02};

#endif

#if defined(HMI_SUPPORTS_GRAPH_PARAM_FRAMES) && defined(HMI_SUPPORTS_ASIAN)
static const TUSIGN8 GraphViewIcon_Back[12] = {0x10,0x38,0x7C,0xFE,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x1E};
#endif

//------------------------------------------------------------------------
// Special Data for IP Address Frames
//------------------------------------------------------------------------
#ifdef HMI_SUPPORTS_IP_ADDRESS_FRAMES

typedef struct
{
    TUSIGN8 firstChar;
    TUSIGN8 justify;
    TUSIGN8 invert;
    TUSIGN8 invertChar;
    TUSIGN8 lastChar;
} IP_ADDRESS_EDIT_FIELD_DATA;

const IP_ADDRESS_EDIT_FIELD_DATA IPAddressEditFieldData[3][4] =
{
    {  // 1/3
    // cursor | firstChar |        justify              |    invert     | invertChar | lastChar
    /*   0   */{     0    , JUSTIFY_LEFT_WITH_INDENT_3  ,  CHAR_INVERT  ,      1     ,     2   },
    /*   1   */{     0    , JUSTIFY_LEFT_WITH_INDENT_3  ,  CHAR_INVERT  ,      5     ,     6   },
    /*   2   */{     0    , JUSTIFY_LEFT_WITH_INDENT_3  ,  CHAR_INVERT  ,      9     ,    10   },
    /*   3   */{     0    , JUSTIFY_LEFT_WITH_INDENT_3  ,  CHAR_INVERT  ,     13     ,    14   }
    },
    {  // 2/3
    // cursor | firstChar |        justify              |    invert     | invertChar | lastChar
    /*   0   */{     2    , JUSTIFY_LEFT_WITH_INDENT_5  , STRING_INVERT ,      0     ,     3   },
    /*   1   */{     6    , JUSTIFY_LEFT_WITH_INDENT_9  , STRING_INVERT ,      0     ,     7   },
    /*   2   */{    10    , JUSTIFY_LEFT_WITH_INDENT_13 , STRING_INVERT ,      0     ,    11   },
    /*   3   */{    14    , JUSTIFY_LEFT_WITH_INDENT_17 , STRING_INVERT ,      0     ,    15   }
    },
    {  // 3/3
    // cursor | firstChar |        justify              |    invert     | invertChar | lastChar
    /*   0   */{     3    , JUSTIFY_LEFT_WITH_INDENT_6  ,  CHAR_INVERT  ,      0     ,    17   },
    /*   1   */{     7    , JUSTIFY_LEFT_WITH_INDENT_10 ,  CHAR_INVERT  ,      0     ,    17   },
    /*   2   */{    11    , JUSTIFY_LEFT_WITH_INDENT_14 ,  CHAR_INVERT  ,      0     ,    17   },
    /*   3   */{    15    , JUSTIFY_LEFT_WITH_INDENT_18 ,  CHAR_INVERT  ,      0     ,    17   }
    }
};



#endif
//------------------------------------------------------------------------
// Special Data for Time & DateFrames
//------------------------------------------------------------------------
#ifdef HMI_SUPPORTS_TIME_DATE_PARAM_FRAMES

typedef struct
{
    TUSIGN8     field;
    TUSIGN8     xPosition;
    TUSIGN8     justify_2;
    TUSIGN8     firstChar_2;

} EDIT_FIELD_DATA;

#define INV__FIELD  (TUSIGN8)0
#define HOUR_FIELD  (TUSIGN8)1
#define MIN__FIELD  (TUSIGN8)2
#define SEC__FIELD  (TUSIGN8)3
#define DATE_FIELD  (TUSIGN8)4
#define MNTH_FIELD  (TUSIGN8)5
#define YEAR_FIELD  (TUSIGN8)6

#pragma diag_suppress=Pm022
const EDIT_FIELD_DATA EditFieldDataTable[3][4][7] =
{
    //    field       | xPosition |         justify_2           |firstChar_2|Cursor|Time & Date|  Format  |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
        DATE_FIELD,        29,      JUSTIFY_LEFT_WITH_INDENT_6,       2,  //|  0   | 0 - T&D   |DD/MM/YYYY|
        MNTH_FIELD,        47,      JUSTIFY_LEFT_WITH_INDENT_9,       5,  //|  1   |           |          |
        YEAR_FIELD,        65,      JUSTIFY_LEFT_WITH_INDENT_11,      7,  //|  2   |           |          |
        HOUR_FIELD,        35,      JUSTIFY_LEFT_WITH_INDENT_7,       2,  //|  3   |           |          |
        MIN__FIELD,        53,      JUSTIFY_LEFT_WITH_INDENT_10,      5,  //|  4   |           |          |
        SEC__FIELD,        71,      JUSTIFY_LEFT_WITH_INDENT_13,      8,  //|  5   |           |          |
        INV__FIELD,         0,                               0,       0,  //|  6   |           |          |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
        HOUR_FIELD,        35,      JUSTIFY_LEFT_WITH_INDENT_7,       2,  //|  0   | 1 - Time  |          |
        MIN__FIELD,        53,      JUSTIFY_LEFT_WITH_INDENT_10,      5,  //|  1   |           |          |
        SEC__FIELD,        71,      JUSTIFY_LEFT_WITH_INDENT_13,      8,  //|  2   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  3   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  4   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  5   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  6   |           |          |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
        DATE_FIELD,        29,      JUSTIFY_LEFT_WITH_INDENT_6,       2,  //|  0   | 2 - Date  |          |
        MNTH_FIELD,        47,      JUSTIFY_LEFT_WITH_INDENT_9,       5,  //|  1   |           |          |
        YEAR_FIELD,        65,      JUSTIFY_LEFT_WITH_INDENT_11,      7,  //|  2   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  3   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  4   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  5   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  6   |           |          |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
        HOUR_FIELD,        29,      JUSTIFY_LEFT_WITH_INDENT_7,       2,  //|  0   | 3 - Time  |          |
        MIN__FIELD,        53,      JUSTIFY_LEFT_WITH_INDENT_10,      5,  //|  1   | Duration  |          |
        SEC__FIELD,        71,      JUSTIFY_LEFT_WITH_INDENT_13,      8,  //|  2   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  3   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  4   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  5   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  6   |           |          |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
    //    field       | xPosition |         justify_2           |firstChar_2|Cursor|Time & Date|  Format  |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
        MNTH_FIELD,        29,      JUSTIFY_LEFT_WITH_INDENT_6,       2,  //|  0   | 0 - T&D   |MM/DD/YYYY|
        DATE_FIELD,        47,      JUSTIFY_LEFT_WITH_INDENT_9,       5,  //|  1   |           |          |
        YEAR_FIELD,        65,      JUSTIFY_LEFT_WITH_INDENT_11,      7,  //|  2   |           |          |
        HOUR_FIELD,        35,      JUSTIFY_LEFT_WITH_INDENT_7,       2,  //|  3   |           |          |
        MIN__FIELD,        53,      JUSTIFY_LEFT_WITH_INDENT_10,      5,  //|  4   |           |          |
        SEC__FIELD,        71,      JUSTIFY_LEFT_WITH_INDENT_13,      8,  //|  5   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  6   |           |          |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
        HOUR_FIELD,        35,      JUSTIFY_LEFT_WITH_INDENT_7,       2,  //|  0   | 1 - Time  |          |
        MIN__FIELD,        53,      JUSTIFY_LEFT_WITH_INDENT_10,      5,  //|  1   |           |          |
        SEC__FIELD,        71,      JUSTIFY_LEFT_WITH_INDENT_13,      8,  //|  2   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  3   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  4   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  5   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  6   |           |          |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
        MNTH_FIELD,        29,      JUSTIFY_LEFT_WITH_INDENT_6,       2,  //|  0   | 2 - Date  |          |
        DATE_FIELD,        47,      JUSTIFY_LEFT_WITH_INDENT_9,       5,  //|  1   |           |          |
        YEAR_FIELD,        65,      JUSTIFY_LEFT_WITH_INDENT_11,      7,  //|  2   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  3   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  4   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  5   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  6   |           |          |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
        HOUR_FIELD,        29,      JUSTIFY_LEFT_WITH_INDENT_7,       2,  //|  0   | 3 - Time  |          |
        MIN__FIELD,        53,      JUSTIFY_LEFT_WITH_INDENT_10,      5,  //|  1   | Duration  |          |
        SEC__FIELD,        71,      JUSTIFY_LEFT_WITH_INDENT_13,      8,  //|  2   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  3   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  4   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  5   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  6   |           |          |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
    //    field       | xPosition |         justify_2           |firstChar_2|Cursor|Time & Date|  Format  |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
        YEAR_FIELD,        29,      JUSTIFY_LEFT_WITH_INDENT_9,       5,  //|  0   | 0 - T&D   |YYYY-MM-DD|
        MNTH_FIELD,        59,      JUSTIFY_LEFT_WITH_INDENT_11,      7,  //|  1   |           |          |
        DATE_FIELD,        77,      JUSTIFY_LEFT_WITH_INDENT_14,     10,  //|  2   |           |          |
        HOUR_FIELD,        35,      JUSTIFY_LEFT_WITH_INDENT_7,       2,  //|  3   |           |          |
        MIN__FIELD,        53,      JUSTIFY_LEFT_WITH_INDENT_10,      5,  //|  4   |           |          |
        SEC__FIELD,        71,      JUSTIFY_LEFT_WITH_INDENT_13,      8,  //|  5   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  6   |           |          |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
        HOUR_FIELD,        35,      JUSTIFY_LEFT_WITH_INDENT_7,       2,  //|  0   | 1 - Time  |          |
        MIN__FIELD,        53,      JUSTIFY_LEFT_WITH_INDENT_10,      5,  //|  1   |           |          |
        SEC__FIELD,        71,      JUSTIFY_LEFT_WITH_INDENT_13,      8,  //|  2   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  3   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  4   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  5   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  6   |           |          |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
        YEAR_FIELD,        29,      JUSTIFY_LEFT_WITH_INDENT_9,       5,  //|  0   | 2 - Date  |          |
        MNTH_FIELD,        59,      JUSTIFY_LEFT_WITH_INDENT_11,      7,  //|  1   |           |          |
        DATE_FIELD,        77,      JUSTIFY_LEFT_WITH_INDENT_14,     10,  //|  2   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  3   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  4   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  5   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  6   |           |          |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
        HOUR_FIELD,        29,      JUSTIFY_LEFT_WITH_INDENT_7,       2,  //|  0   | 3 - Time  |          |
        MIN__FIELD,        53,      JUSTIFY_LEFT_WITH_INDENT_10,      5,  //|  1   | Duration  |          |
        SEC__FIELD,        71,      JUSTIFY_LEFT_WITH_INDENT_13,      8,  //|  2   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  3   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  4   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  5   |           |          |
        INV__FIELD,         0,                                0,      0,  //|  6   |           |          |
    //----------------|-----------|-----------------------------|-----------|------|-----------|----------|
};
#pragma diag_default=Pm022

#endif

const TUSIGN8 HighlightPattern[5][7][6] =
{
    {   // 2 Line Display
        //  cursor *          lineNumber
        //         *    1     2     3     4     5     6
        /*   0     */ {0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00},
        /*   1     */ {0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00},
        /*   2     */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        /*   3     */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        /*   4     */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        /*   5     */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        /* invalid */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}
    },
    {   // 3 Line Display
        //  cursor *          lineNumber
        //         *    1     2     3     4     5     6
        /*   0     */ {0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00},
        /*   1     */ {0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00},
        /*   2     */ {0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF},
        /*   3     */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        /*   4     */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        /*   5     */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        /* invalid */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}
    },
    {   // 4 Line Display
        //  cursor *          lineNumber
        //         *    1     2     3     4     5     6
        /*   0     */ {0x00, 0xFF, 0x00, 0x00, 0x00, 0x00},
        /*   1     */ {0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
        /*   2     */ {0x00, 0x00, 0x00, 0xFF, 0x00, 0x00},
        /*   3     */ {0x00, 0x00, 0x00, 0x00, 0xFF, 0x00},
        /*   4     */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        /*   5     */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        /* invalid */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}
    },
    {   // 5 Line Display
        //  cursor *          lineNumber
        //         *    1     2     3     4     5     6
        /*   0     */ {0x00, 0xFF, 0x00, 0x00, 0x00, 0x00},
        /*   1     */ {0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
        /*   2     */ {0x00, 0x00, 0x00, 0xFF, 0x00, 0x00},
        /*   3     */ {0x00, 0x00, 0x00, 0x00, 0xFF, 0x00},
        /*   4     */ {0x00, 0x00, 0x00, 0x00, 0x00, 0xFF},
        /*   5     */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        /* invalid */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}
    },
    {   // 6 Line Display
        //  cursor *          lineNumber
        //         *    1     2     3     4     5     6
        /*   0     */ {0xFF, 0x00, 0x00, 0x00, 0x00, 0x00},
        /*   1     */ {0x00, 0xFF, 0x00, 0x00, 0x00, 0x00},
        /*   2     */ {0x00, 0x00, 0xFF, 0x00, 0x00, 0x00},
        /*   3     */ {0x00, 0x00, 0x00, 0xFF, 0x00, 0x00},
        /*   4     */ {0x00, 0x00, 0x00, 0x00, 0xFF, 0x00},
        /*   5     */ {0x00, 0x00, 0x00, 0x00, 0x00, 0xFF},
        /* invalid */ {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}
    }
};

//------------------------------------------------------------------------
// EDP300 SPECIFIC DEFINITIONS
//------------------------------------------------------------------------
#ifdef EDP300_SPECIAL_FEATURES_HMI
    #define EDP300_MODE_FRAME_STR_LEN   15
    #define EDP300_SCOPE_STR_LEN        18
#endif

//------------------------------------------------------------------------
// GRAPH VIEW DEFINITIONS
//------------------------------------------------------------------------
#if defined(HMI_SUPPORTS_GRAPH_VIEW) || defined(HMI_SUPPORTS_GRAPH_PARAM_FRAMES)
#define Y_AXIS_XPOS 25
#endif

//------------------------------------------------------------------------
// Function Definitions
//------------------------------------------------------------------------
#ifdef HMI_SUPPORTS_OPERATOR_FRAMES
// this function not size optimized beyond medium
#ifdef OPTIMIZE_V3_4
#pragma optimize=size medium
#else
#pragma optimize=z 6
#endif
TUSIGN8 BuildAdvancedOperatorFrame(void)
{

    OPERATOR_PAGE_LINE_DATA lineData[3];

    #ifdef HMI_USES_COMMONDIAGNOSTICS
    static TUSIGN8 NAMURClassification[2];
    static TUSIGN8 NAMURCategory[2];
    static TUSIGN8 infoMessageID[2];

    #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
    static TUSIGN8 NAMUR_ActiveAlarm[2];
    #endif

    #endif

    static TBOOL   alarmActive[2];

#ifdef HMI_SUPPORTS_SERVICEPORT
    TUSIGN8        OpPageInstance = PacketManagerIsRemoteInstance() ? 1 : 0;
#else
    TUSIGN8        OpPageInstance = 0;
#endif

#ifdef EDP300_SPECIAL_FEATURES_HMI
    static const TUSIGN8* prev_Field_9_Icon_T[2] = {NULL,NULL};
    static const TUSIGN8* prev_Field_9_Icon_M[2] = {NULL,NULL};
    static const TUSIGN8* prev_Field_9_Icon_B[2] = {NULL,NULL};
#endif

    TUSIGN8 displayMode;

    TUSIGN8 signal[4];


    TUSIGN8 packetsBuilt = 0;

#ifdef HMI_SUPPORTS_OPERATOR_BARGRAPH
    TUSIGN8 lineNumber_BarID;
    TUSIGN8 lineNumber_BarV;
    TUSIGN8 Filled_T, Filled_B, Blank__T, Blank__B;
    TINT16 barEnd, barStart;
    ADJUST_DATA bargraphDataValue;
    TUSIGN8 bargraphDatatype;
#endif

    TUSIGN8 numberLength;

// 1. Copy specific data from Operator pages (1-4) to common stores (for processing)

    TUSIGN8 frameNumber = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.frameNumber;

    #if defined(SECOND_OPERATOR_PAGE) || defined(THIRD_OPERATOR_PAGE) || defined(FOURTH_OPERATOR_PAGE) || defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)

    TBOOL   frameNumberValid = eFALSE;

    while (frameNumberValid == eFALSE)
    {
        switch (frameNumber)
        {
        case 6:
            #if defined(SIXTH_OPERATOR_PAGE)
            displayMode = SFD_MULTI_OP.displayMode_6;
            #else
            frameNumber = 1;
            displayMode = SFD_SIMPLE.displayMode_1;
            #endif
            break;

        case 5:
            #if defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)
            displayMode = SFD_MULTI_OP.displayMode_5;
            #else
            frameNumber = 1;
            displayMode = SFD_SIMPLE.displayMode_1;
            #endif
            break;

        case 4:
            #if defined(FOURTH_OPERATOR_PAGE) || defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)
            displayMode = SFD_MULTI_OP.displayMode_4;
            #else
            frameNumber = 1;
            displayMode = SFD_SIMPLE.displayMode_1;
            #endif
            break;

        case 3:
            #if defined(THIRD_OPERATOR_PAGE) || defined(FOURTH_OPERATOR_PAGE) || defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)
            displayMode = SFD_MULTI_OP.displayMode_3;
            #else
            frameNumber = 1;
            displayMode = SFD_SIMPLE.displayMode_1;
            #endif
            break;

        case 2:
            #if defined(SECOND_OPERATOR_PAGE) || defined(THIRD_OPERATOR_PAGE) || defined(FOURTH_OPERATOR_PAGE) || defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)
            displayMode = SFD_MULTI_OP.displayMode_2;
            #else
            frameNumber = 1;
            displayMode = SFD_SIMPLE.displayMode_1;
            #endif
            break;

        case 1:
            displayMode = SFD_SIMPLE.displayMode_1;
            break;

        default:
            frameNumber = 1;
            displayMode = SFD_SIMPLE.displayMode_1;
            break;
        }

        if ((displayMode != HMI_DISPLAY_MODE_OFF) || (frameNumber == 1))
        {
            frameNumberValid = eTRUE;
        }
        else
        {
            frameNumber --;
        }
    }

    switch (frameNumber)
    {
    case 6:
        #ifdef SIXTH_OPERATOR_PAGE
        displayMode = SFD_MULTI_OP.displayMode_6;
        signal[_1ST_LINE] = SFD_MULTI_OP.mainOperatorView_6_1;
        signal[_2ND_LINE] = SFD_MULTI_OP.mainOperatorView_6_2;
        signal[_3RD_LINE] = SFD_MULTI_OP.mainOperatorView_6_3;
        signal[_BAR_LINE] = SFD_MULTI_OP.mainOperatorView_6_bargraph;
        break;
        #endif

    case 5:
        #ifdef FIFTH_OPERATOR_PAGE
        displayMode = SFD_MULTI_OP.displayMode_5;
        signal[_1ST_LINE] = SFD_MULTI_OP.mainOperatorView_5_1;
        signal[_2ND_LINE] = SFD_MULTI_OP.mainOperatorView_5_2;
        signal[_3RD_LINE] = SFD_MULTI_OP.mainOperatorView_5_3;
        signal[_BAR_LINE] = SFD_MULTI_OP.mainOperatorView_5_bargraph;
        break;
        #endif

    case 4:
        #ifdef FOURTH_OPERATOR_PAGE
        displayMode = SFD_MULTI_OP.displayMode_4;
        signal[_1ST_LINE] = SFD_MULTI_OP.mainOperatorView_4_1;
        signal[_2ND_LINE] = SFD_MULTI_OP.mainOperatorView_4_2;
        signal[_3RD_LINE] = SFD_MULTI_OP.mainOperatorView_4_3;
        signal[_BAR_LINE] = SFD_MULTI_OP.mainOperatorView_4_bargraph;
        break;
        #endif

    case 3:
        #ifdef THIRD_OPERATOR_PAGE
        displayMode = SFD_MULTI_OP.displayMode_3;
        signal[_1ST_LINE] = SFD_MULTI_OP.mainOperatorView_3_1;
        signal[_2ND_LINE] = SFD_MULTI_OP.mainOperatorView_3_2;
        signal[_3RD_LINE] = SFD_MULTI_OP.mainOperatorView_3_3;
        signal[_BAR_LINE] = SFD_MULTI_OP.mainOperatorView_3_bargraph;
        break;
        #endif

    case 2:
        #ifdef SECOND_OPERATOR_PAGE
        displayMode = SFD_MULTI_OP.displayMode_2;
        signal[_1ST_LINE] = SFD_MULTI_OP.mainOperatorView_2_1;
        signal[_2ND_LINE] = SFD_MULTI_OP.mainOperatorView_2_2;
        signal[_3RD_LINE] = SFD_MULTI_OP.mainOperatorView_2_3;
        signal[_BAR_LINE] = SFD_MULTI_OP.mainOperatorView_2_bargraph;
        break;
        #endif

    case 1:
    default:
        displayMode = SFD_SIMPLE.displayMode_1;
        signal[_1ST_LINE] = SFD_SIMPLE.mainOperatorView_1_1;
        signal[_2ND_LINE] = SFD_SIMPLE.mainOperatorView_1_2;
        signal[_3RD_LINE] = SFD_SIMPLE.mainOperatorView_1_3;
        signal[_BAR_LINE] = SFD_SIMPLE.mainOperatorView_1_bargraph;
        break;
    }

    #else

        displayMode = SFD_SIMPLE.displayMode_1;
        signal[_1ST_LINE] = SFD_SIMPLE.mainOperatorView_1_1;
        signal[_2ND_LINE] = SFD_SIMPLE.mainOperatorView_1_2;
        signal[_3RD_LINE] = SFD_SIMPLE.mainOperatorView_1_3;
        signal[_BAR_LINE] = SFD_SIMPLE.mainOperatorView_1_bargraph;

    #endif //#if defined(SECOND_OPERATOR_PAGE) || defined(THIRD_OPERATOR_PAGE) || defined(FOURTH_OPERATOR_PAGE) || defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)

// 2. DISPLAY_MODE_GRAPHIC not processed here
    if (displayMode == HMI_DISPLAY_MODE_GRAPHIC)
    {
        displayMode = HMI_DISPLAY_MODE_1x4;
    }

// 3. DISPLAY_MODE_1x6_BAR_A uses the same signal for bargraph as that for line 1
    if (displayMode == HMI_DISPLAY_MODE_1x6_BAR_A)
    {
        signal[_BAR_LINE] = signal[_1ST_LINE];
    }

// 4. If "displayMode" selects a bargraph and the signal assigned to bargraph has no bargraph limits applied (fixedUpperLower > = 3)
//    Then adjust display mode to remove bargraph.
    if ((displayMode == HMI_DISPLAY_MODE_1x6_BAR_A)
     || (displayMode == HMI_DISPLAY_MODE_1x6_BAR_B)
     || (displayMode == HMI_DISPLAY_MODE_1x9_BAR)
     || (displayMode == HMI_DISPLAY_MODE_2x9_BAR))
    {
        if (FrameTableGetSignal(signal[_BAR_LINE])->FixedUpperLower >= 3)
        {
            displayMode --;
            // HMI_DISPLAY_MODE_1x6_BAR_A goes to HMI_DISPLAY_MODE_1x6_A
            // HMI_DISPLAY_MODE_1x6_BAR_B goes to HMI_DISPLAY_MODE_1x6_B
            // HMI_DISPLAY_MODE_1x9_BAR   goes to HMI_DISPLAY_MODE_1x9
            // HMI_DISPLAY_MODE_2x9_BAR   goes to HMI_DISPLAY_MODE_2x9
        }
    }

typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_BLANK_AREA,     // Blank Area                              | - Start of Static Area
                                                //-----------------------------------------|
#if (HMI_DISPLAY_RATE_CYCLES < 7)
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_VIEW_ICON_STATIC,     // View Icon                               |
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_MENU_ICON_STATIC,     // Menu Icon                               |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_TAG,            // Tag                                     |1 - Start of Active Area
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_REMOVE_BARGRAPH,      // Remove bargraph                         |2
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_BARGRAPH_RHS_T,       // bargraph border RHS (Top)               |3
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_BARGRAPH_RHS_B,       // bargraph border RHS (Bottom)            |4
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_BARGRAPH_FILL_T,      // Bargraph filled area (top)              |5
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_BARGRAPH_FILL_B,      // Bargraph filled area (Bottom)           |6
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_BARGRAPH_BLANK_T,     // Bargraph blank area (top)               |7
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_BARGRAPH_BLANK_B,     // Bargraph blank area (Bottom)            |8
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_BARGRAPH_SIGNAL_ID,   // Bargraph Signal ID                      |9
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_BARGRAPH_TEXT,        // Bargraph level (value)(units)           |10
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_REDRAW_DIAGNOSTICS,   //                                         |11
                                                //-----------------------------------------|
#ifdef EDP300_SPECIAL_FEATURES_HMI
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_ICONFIELDS_1_4, // Blank                                   |
                                                //-----------------------------------------|
#else
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_1,    // Autoscroll Icon              [12]..[18] |12
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_2,    // Blank                        [19]..[29] |13
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_3,    // Control Icon                 [30]..[53] |14
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_4,    // Blank                        [54]..[58] |15
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_5,    // Write Protect icon           [59]..[65] |16
                                                //-----------------------------------------|
#ifdef EDP300_SPECIAL_FEATURES_HMI
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_ICONFIELDS_6_8, // Blank                                   |16
                                                //-----------------------------------------|
#else
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_6,    // Blank                        [66]..[70] |17
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_7,    // Mode icon                    [71]..[94] |18
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_8,    // Blank                        [95]..[113]|19
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_DUMMY_STAGE,    //                                         |
                                                //-----------------------------------------|
#ifdef EDP300_SPECIAL_FEATURES_HMI
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_9T,   //                                         |
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_9M,   //                                         |
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_9B,   //                                         |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_REMOVE_DIAGNOSTICS,   // Remove Diagnostics                      |20
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_DIAG_ICON_T,    // Diagnostics Classification Icon (Top)   |21
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_DIAG_ICON_B,    // Diagnostics Classification Icon (Bottom)|22
                                                //-----------------------------------------|
#ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_DIAG_MESSAGE_1_16,    //                                         |
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_DIAG_MESSAGE_17_32,   //                                         |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_STAGE_DIAG_CATEGORY,  // Diagnostics Category Text               |23
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_SIGNAL_ID_3,          // (3) Signal ID                           |24
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_VALUE_3,              // (3) Value                               |25
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_UOM_3,                // (3) Units of measure                    |26
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_UOM_3X,               // (3) Units of measure - blank upper line |27
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_SIGNAL_ID_2,          // (2) Signal ID                           |28
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_VALUE_2,              // (2) Value                               |29
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_UOM_2,                // (2) Units of measure                    |30
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_UOM_2X,               // (2) Units of measure - blank upper line |31
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_SIGNAL_ID_1,          // (1) Signal ID                           |32
                                                //-----------------------------------------|
#ifdef HMI_SUPPORTS_ASIAN
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_SIGNAL_ID_1X,         // (1) Signal ID - Remove Lower line       |33
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_VALUE_1,              // (1) Value                               |34
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_UOM_1,                // (1) Units of measure                    |35
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_UOM_1X,               // (1) Units of measure - blank upper line |36
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_VIEW_ICON,            // View Icon                               |37
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_MENU_ICON,            // Menu Icon                               |38
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_LAST_PACKET,          //                                         |39
                                                //-----------------------------------------|
    OPERATOR_FRAME_PACKET_READ_SWITCHES         //                                         |
                                                //-----------------------------------------| - There is no keypress area
}OPERATOR_FRAME_PACKET;


    if ((LOCAL_updateStaticArea != 0) || (displayMode != LOCAL_last_displayMode))
    {
        LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_BLANK_AREA;
        LOCAL_last_displayStyle = DISPLAYSTYLE_OFF_0;
        LOCAL_last_bargraphStyle = 0;

        #ifdef EDP300_SPECIAL_FEATURES_HMI
        prev_Field_9_Icon_T[OpPageInstance] = NULL;
        prev_Field_9_Icon_M[OpPageInstance] = NULL;
        prev_Field_9_Icon_B[OpPageInstance] = NULL;
        #endif
    }

    if ((LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_BLANK_AREA) || (LOCAL_packetStage == OPERATOR_FRAME_PACKET_READ_SWITCHES))
    {
    // Re-Calculate displayStyle (using "displayMode", "alarmActive"  & "asian"
    // Get Alarm info
        alarmActive[OpPageInstance] = eFALSE;

        #ifdef HMI_USES_COMMONDIAGNOSTICS

        #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
            NAMUR_ActiveAlarm[OpPageInstance] = AdjusterGetNAMURStatus(&NAMURClassification[OpPageInstance], &NAMURCategory[OpPageInstance]);
        #else
            (void)AdjusterGetNAMURStatus(&NAMURClassification[OpPageInstance], &NAMURCategory[OpPageInstance]);
        #endif

        #ifndef INFORMATION_MESSAGES_OFFSET
        infoMessageID[OpPageInstance] = 0;
        #else
        infoMessageID[OpPageInstance] = GetInfoMessageID((TBOOL)(NAMURClassification[OpPageInstance] == CLASSIFICATION_NONE));
        #endif

        if ((NAMURClassification[OpPageInstance] != CLASSIFICATION_NONE) || (infoMessageID[OpPageInstance] != 0))
        {
            alarmActive[OpPageInstance] = eTRUE;
        }
        #endif

    // Update displayStyle (using "displayMode", "alarmActive"  & "asian"
        LOCAL_last_displayMode = displayMode;
        LOCAL_last_displayStyle = LOCAL_displayStyle;
#pragma diag_suppress=Pm020
        LOCAL_displayStyle = (DISPLAYSTYLE)(displayMode * 4);
#pragma diag_default=Pm020

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            LOCAL_displayStyle += 2;
        }
        #endif

        if (alarmActive[OpPageInstance])
        {
            LOCAL_displayStyle ++;
        }

    // Get Lower Line Icon Info
        // Autoscroll Icon
        #if defined(SECOND_OPERATOR_PAGE) || defined(THIRD_OPERATOR_PAGE) || defined(FOURTH_OPERATOR_PAGE) || defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)
        LOCAL_displayAutoscrollIcon = FrameTableIsAutoscrollEnabled();
        #else
        LOCAL_displayAutoscrollIcon = eFALSE;
        #endif

        // Write Protect Icon
        #ifdef COMMON_TOP_WORKS_NEW_FEATURES
            TBOOL User_lock = WriteProtect_GetUserLock(eFALSE,0,0,0);
            TBOOL ARM_lock = eFALSE;

            #ifdef HMI_SUPPORTS_SECURITY_ACCESS
            if (AdjusterGetARMLevel() == ARM_ACCESS_READ_ONLY)
            {
                ARM_lock = eTRUE;
            }
            #endif

            if ((User_lock) || (ARM_lock))
            {
                LOCAL_displayWriteProtectIcon = eTRUE;
            }
            else
            {
                LOCAL_displayWriteProtectIcon = eFALSE;
            }
        #else
            TUSIGN8 HART_lock = WriteProtect_GetHARTLock();
            TUSIGN8 HMI_lock  = WriteProtect_GetHMILock();

            if (
                #ifdef HMI_SUPPORTS_SECURITY_ACCESS
                (AdjusterGetARMLevel() == ARM_ACCESS_READ_ONLY) ||
                #endif
                (HART_lock != HMI_LOCAL_OP_ENABLED) ||
                (HMI_lock  != HMI_LOCAL_OP_ENABLED))
            {
                LOCAL_displayWriteProtectIcon = eTRUE;
            }
            else
            {
                LOCAL_displayWriteProtectIcon = eFALSE;
            }
        #endif

    // Update Bargraph style
        LOCAL_last_bargraphStyle = LOCAL_bargraphStyle;

        #ifdef HMI_SUPPORTS_OPERATOR_BARGRAPH

        switch (LOCAL_displayStyle)
        {
        case EURO_1x6_BAR_A:                                    LOCAL_bargraphStyle = 1;    break;
        case EURO_1x6_BAR_A_DIAG:                               LOCAL_bargraphStyle = 2;    break;
        case ASIA_1x6_BAR_A:                                    LOCAL_bargraphStyle = 3;    break;
        case EURO_1x6_BAR_B:        case EURO_2x9_BAR:          LOCAL_bargraphStyle = 4;    break;
        case EURO_1x6_BAR_B_DIAG:   case EURO_2x9_BAR_DIAG:     LOCAL_bargraphStyle = 5;    break;
        case ASIA_2x9_BAR:          case ASIA_1x6_BAR_B:        LOCAL_bargraphStyle = 6;    break;
        case EURO_1x9_BAR:          case EURO_1x9_BAR_DIAG:     LOCAL_bargraphStyle = 7;    break;
        case ASIA_1x9_BAR:          case ASIA_1x9_BAR_DIAG:     LOCAL_bargraphStyle = 8;    break;
        default:                                                LOCAL_bargraphStyle = 0;    break;
        }

        #else
            LOCAL_bargraphStyle = 0;
        #endif

    // Reset Packet Stage according to display style changes
        // Complete display must be blanked & re-written when diagnostics chane on a 3x9 display
        if (((LOCAL_last_displayStyle == EURO_3x9     ) && (LOCAL_displayStyle == EURO_3x9_DIAG))
         || ((LOCAL_last_displayStyle == EURO_3x9_DIAG) && (LOCAL_displayStyle == EURO_3x9     ))
         || ((LOCAL_last_displayStyle == ASIA_3x9     ) && (LOCAL_displayStyle == ASIA_3x9_DIAG))
         || ((LOCAL_last_displayStyle == ASIA_3x9_DIAG) && (LOCAL_displayStyle == ASIA_3x9     )))
        {
            if (LOCAL_packetStage > OPERATOR_FRAME_PACKET_STAGE_BLANK_AREA)
            {
                LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_BLANK_AREA;
            }
        }
        // if previous style was euro without diagnostic display and new style is the same with diagnostic display
        // or previous style was euro with diagnostic display and new style is the same without diagnostic display
        if ((((LOCAL_last_displayStyle & 0x03) == 0x00) && (LOCAL_displayStyle == (LOCAL_last_displayStyle + 1)))
         || (((LOCAL_last_displayStyle & 0x01) == 0x01) && (LOCAL_displayStyle == (LOCAL_last_displayStyle - 1))))
        {
            // Update of diagnostic display area required, go back to diagnostics packet stages
            if (LOCAL_packetStage > OPERATOR_FRAME_PACKET_REDRAW_DIAGNOSTICS)
            {
                LOCAL_packetStage = OPERATOR_FRAME_PACKET_REDRAW_DIAGNOSTICS;
            }
        }
    // Reset Packet Stage according to bargraph style changes
        #ifdef HMI_SUPPORTS_OPERATOR_BARGRAPH
        if (LOCAL_bargraphStyle != LOCAL_last_bargraphStyle)
        {
            // bargraph must be redrawn, go back to bargraph packet stages
            if (LOCAL_packetStage > OPERATOR_FRAME_PACKET_REMOVE_BARGRAPH)
            {
                LOCAL_packetStage = OPERATOR_FRAME_PACKET_REMOVE_BARGRAPH;
            }
        }
        #endif
    }

    if ((LOCAL_updateActiveArea != 0) && (LOCAL_packetStage > OPERATOR_FRAME_PACKET_STAGE_TAG))
    {
        LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_TAG;
    }

    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_READ_SWITCHES)
    {
        #if defined(VALUE_1_FAST) && !defined(HMI_USES_DOUBLE)

        #ifdef EDP300_SPECIAL_FEATURES_HMI
        TBOOL ManualSensorModeActive = FrameTableGetManualSensorCheck();

        if (LOCAL_packetBufferUsed < (PACKETBUFFERSIZE - (12 + 17)))
        {
            TBOOL ManualSensorModeActive = FrameTableGetManualSensorCheck();

            if ((LOCAL_SwitchPressedCode == KEYSTATE_UP) && (ManualSensorModeActive == eTRUE))
            {
                packetsBuilt += BuildWriteArray(FastIncAvailable_Icon, SMALL_ICON_WIDTH, (TUSIGN8)((MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH)-1), 7, 0);
            }
            else if ((LOCAL_SwitchPressedCode == (KEYSTATE_UP | KEYSTATE_RIGHT)) && (ManualSensorModeActive == eTRUE))
            {
                packetsBuilt += BuildWriteArray(FastIncActive_Icon, SMALL_ICON_WIDTH, (TUSIGN8)((MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH)-1), 7, 0);
            }
            else if ((LOCAL_SwitchPressedCode == KEYSTATE_DOWN) && (ManualSensorModeActive == eTRUE))
            {
                packetsBuilt += BuildWriteArray(FastDecAvailable_Icon, SMALL_ICON_WIDTH, (TUSIGN8)((MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH)-1), 7, 0);
            }
            else if ((LOCAL_SwitchPressedCode == (KEYSTATE_DOWN | KEYSTATE_RIGHT)) && (ManualSensorModeActive == eTRUE))
            {
                packetsBuilt += BuildWriteArray(FastDecActive_Icon, SMALL_ICON_WIDTH, (TUSIGN8)((MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH)-1), 7, 0);
            }
            else
            {
                asm("nop");
            }
        }
        #endif

        // To provide a very fast display response to process value 1 the
        // OPERATOR_FRAME_PACKET_VALUE_1 is sent (with the "last packet" bit set)

        if ((FrameTableGetSignal(signal[_1ST_LINE])->dpPosn == 1)
         && ((displayMode == HMI_DISPLAY_MODE_1x6_A) || (displayMode == HMI_DISPLAY_MODE_1x6_B)))
        {
            ADJUST_DATA dataValue, HighLimit, LowLimit, Increment;
            TUSIGN8 dataType;
            //T_RANGE_E8 rangeE8;
            TBOOL rules;
            TINT32 value32;

            TUSIGN8 lineNumber;
            TUSIGN8 text[8];

            const SIGNAL_TABLE_TYPE *pSignalInTable = FrameTableGetSignal(signal[_1ST_LINE]);
            (void)AdjusterGetFloatValueAndLimits((TUSIGN16)pSignalInTable->value.ssIdx,
                                                 (TUSIGN16)pSignalInTable->value.objIdx,
                                                 pSignalInTable->value.attribIdx,
                                                 &dataValue,
                                                 &HighLimit,
                                                 &LowLimit,
                                                 &Increment,
                                                 &rules,
                                                 &dataType);

            TFLOAT testNAN = dataValue.data_F;



            if (((*((TUSIGN32 *) &testNAN) & 0x7f800000) == 0x7f800000)
             && ((*((TUSIGN32 *) &testNAN) & 0x007fffff) != 0))
            {
                TUSIGN8 countNaN;

                #ifdef EDP300_SPECIAL_FEATURES_HMI
                for (countNaN = 1; countNaN < 6; countNaN ++)
                #else
                for (countNaN = 0; countNaN < 6; countNaN ++)
                #endif
                {
                    text[countNaN] = '-';
                }
                text[countNaN] = 0x00;
            }
            else
            {
                if (dataValue.data_F >= 0.04)
                {
                    value32 = (TINT32)((dataValue.data_F + 0.05f) * 10.0f);
                    text[0] = ' ';
                }
                else if (dataValue.data_F <= -0.04)
                {
                    value32 = (TINT32)((dataValue.data_F - 0.05f) * -10.0f);
                    text[0] = '-';
                }
                else
                {
                    value32 = 0;
                    text[0] = ' ';
                }

                if (value32 < 100) // 9.9
                {
                    text[3] = text[0];
                    text[2] = ' ';
                    text[1] = ' ';
                    text[0] = ' ';

                    text[4] = (value32 / 10) + '0';

                    text[5] = '.';

                    value32 = (value32 % 10);
                    text[6] = (value32) + '0';
                }

                else if (value32 < 1000) // 99.9
                {
                    text[2] = text[0];
                    text[1] = ' ';
                    text[0] = ' ';

                    text[3] = (value32 / 100) + '0';    value32 = (value32 % 100);
                    text[4] = (value32 / 10) + '0';     value32 = (value32 % 10);
                    text[5] = '.';
                    text[6] = (value32) + '0';
                }
                else if (value32 < 10000)   // 999.9
                {
                    text[1] = text[0];
                    text[0] = ' ';

                    text[2] = (value32 / 1000) + '0';   value32 = (value32 % 1000);
                    text[3] = (value32 / 100) + '0';    value32 = (value32 % 100);
                    text[4] = (value32 / 10) + '0';     value32 = (value32 % 10);
                    text[5] = '.';
                    text[6] = (value32) + '0';
                }
                #ifdef EDP300_SPECIAL_FEATURES_HMI
                else
                {
                    text[2] = '9';
                    text[3] = '9';
                    text[4] = '9';
                    text[5] = '.';
                    text[6] = '9';
                }
                #else
                else if (value32 < 100000)  // 999.99
                {
                    text[1] = (value32 / 10000) + '0';  value32 = (value32 % 10000);
                    text[2] = (value32 / 1000) + '0';   value32 = (value32 % 1000);
                    text[3] = (value32 / 100) + '0';    value32 = (value32 % 100);
                    text[4] = (value32 / 10) + '0';     value32 = (value32 % 10);
                    text[5] = '.';
                    text[6] = (value32) + '0';
                }
                else
                {
                    text[1] = '9';
                    text[2] = '9';
                    text[3] = '9';
                    text[4] = '9';
                    text[5] = '.';
                    text[6] = '9';
                }
                #endif

                text[7] = 0x00;
            }
            switch (LOCAL_displayStyle)
            {
            case EURO_1x6_A:    case EURO_1x6_A_DIAG:   lineNumber = 1;     break;
            case ASIA_1x6_A:    case ASIA_1x6_A_DIAG:   lineNumber = 1;     break;

            case EURO_1x6_B:    case EURO_1x6_B_DIAG:   lineNumber = 2;     break;
            case ASIA_1x6_B:    case ASIA_1x6_B_DIAG:   lineNumber = 1;     break;

            default:                                    lineNumber = 1;     break;
            }

            #ifdef EDP300_SPECIAL_FEATURES_HMI
            packetsBuilt += BuildWriteString(&text[1], HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN, lineNumber, JUSTIFY_RIGHT, FONT_3, NO_INVERT, 0, 0, 6, 1);
            #else
            packetsBuilt += BuildWriteString(text, HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN, lineNumber, JUSTIFY_RIGHT, FONT_3, NO_INVERT, 0, 0, 7, 1);
            #endif
        }
        else
        #endif
        {
            packetsBuilt += BuildReadSwitches(1);
        }
        LOCAL_packetStage = OPERATOR_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_BLANK_AREA      // Blank Area                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_BLANK_AREA)
    {
        packetsBuilt += BuildBlankArea(0,7,0);
    }

#if (HMI_DISPLAY_RATE_CYCLES < 7)

//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_VIEW_ICON_STATIC      // View Icon                               |
// OPERATOR_FRAME_PACKET_MENU_ICON_STATIC      // Menu Icon                               |
//---------------------------------------------//-----------------------------------------|
#ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
    if ((PacketManagerBuilderServices_IndicatorOnly())
     && (LOCAL_packetStage >= OPERATOR_FRAME_PACKET_VIEW_ICON_STATIC)
     && (LOCAL_packetStage <= OPERATOR_FRAME_PACKET_MENU_ICON_STATIC))
    {
        LOCAL_packetStage = OPERATOR_FRAME_PACKET_MENU_ICON_STATIC + 1;
    }
#endif

//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_VIEW_ICON_STATIC      // View Icon                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_VIEW_ICON_STATIC)
    {
        const TUSIGN8 *pIcon = &viewIcon[PacketManagerBuilderServices_GetViewIcon(frameNumber)][0];

        #ifdef LEFT_RIGHT_LOCKOUT
        switch (FrameTableGetLeftRightLockoutState())
        {
        case WRONG_KEY_PRESSED:     pIcon = LR_Icon_WrongKey;   break;  // Exclamation mark
        case LEFT_RIGHT_ENABLED:    asm("nop");                 break;  // View Icon
        default:                    pIcon = LR_Icon_NoKey;      break;  // blank
        }
        #endif

        packetsBuilt += BuildWriteArray(pIcon, SMALL_ICON_WIDTH, 0, 7, 0);
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_MENU_ICON_STATIC      // Menu Icon                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_MENU_ICON_STATIC)
    {
        #ifdef LEFT_RIGHT_LOCKOUT
        const TUSIGN8 *pIcon;

        switch (FrameTableGetLeftRightLockoutState())
        {
        case WRONG_KEY_PRESSED:     pIcon = LR_Icon_WrongKey;   break;  // Exclamation mark
        case LEFT_RIGHT_ENABLED:    pIcon = menuIcon;           break;  // Menu Icon
        default:                    pIcon = LR_Icon_NoKey;      break;  // blank
        }

        packetsBuilt += BuildWriteArray(pIcon, SMALL_ICON_WIDTH, (TUSIGN8)(MAX_COMMON_HMI_WIDTH - SMALL_ICON_WIDTH - 1), 7, 0);

        #else

        packetsBuilt += BuildWriteIcon(ICON_MENU, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 7, 0);

        #endif
    }
#endif  //end of #if (HMI_DISPLAY_RATE_CYCLES < 7)

//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_TAG             // Tag                                     | - Start of Active Area
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_TAG)
    {
        // Tag not displayed in any of the following styles
        if ((LOCAL_displayStyle == ASIA_1x6_BAR_B)
         || (LOCAL_displayStyle == ASIA_1x6_BAR_B_DIAG)
         || (LOCAL_displayStyle == EURO_3x9_DIAG)
         || (LOCAL_displayStyle == ASIA_3x9_DIAG))
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_TAG + 1;
        }
        else
        {
            TUSIGN8 text[21];
            text[20] = 0x00;

            TUSIGN8 extendedCharacterPage = HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN;

            switch (LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.tag_type)
            {
            case 2:     // Packed Ascii format
                #ifdef HMI_SUPPORTS_PACKEDASCII
                {
                    // 20 unpacked characters = 15 packed characters
                    TUSIGN8 packedtext[16] = {0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,
                                              0x00};

                    // len (unpacked) cannot be more than 20 therefore len * 6 cannot be more than 120
                    TUSIGN16 ssIdx = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag.ssIdx;
                    TUSIGN16 obIdx = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag.objIdx;
                    TUSIGN8 len = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.tag_maxCharacters;
                    TUSIGN8 i;

                    if (len > FONT1_MAX_CHARS-1)	// MASH ??????
                    {
                        len = FONT1_MAX_CHARS-1;
                    }

                    i = len * 6;

                    len = i / 8;
                    if (i % 8)
                    {
                        len ++;
                    }

                    for (i = 0; i < len; i++)
                    {
                        // return value of "AdjusterGetAttribute()" ignored
                        AdjusterGetAttribute(ssIdx, obIdx, i, (void FAST *)&packedtext[i]);
                    }

                    AdjusterUnpackPASCII(packedtext, len, text);
                }
                #else
                text[0] = 0x00;
                VIP_ASSERT(0);
                #endif
                break;

            case 1:
                #ifdef HMI_SUPPORTS_STANDARDASCII
                {
                    TUSIGN16 ssIdx = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag.ssIdx;
                    TUSIGN16 obIdx = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag.objIdx;
                    TUSIGN8 len = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.tag_maxCharacters;
                    TUSIGN8 i;

                    if (len > FONT1_MAX_CHARS-1)	// MASH ?????????
                    {
                        len = FONT1_MAX_CHARS-1;
                    }

                    for (i = 0; i < len; i++)
                    {
                        AdjusterGetAttribute(ssIdx, obIdx, i, (void FAST *)&text[i]);
                    }

                    extendedCharacterPage = FrameTableGetStringObjectExtendedCharacterPage(LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag);
                }
                #else
                text[0] = 0x00;
                VIP_ASSERT(0);
                #endif
                break;

            default:
                text[0] = 0x00;
                break;
            }
            packetsBuilt += BuildWriteString(text,extendedCharacterPage,0,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS-1,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_REMOVE_BARGRAPH       // Remove bargraph                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_REMOVE_BARGRAPH)
    {
        #ifdef HMI_SUPPORTS_OPERATOR_BARGRAPH
        TBOOL   Remove5_6 = eFALSE;
        TBOOL   Remove5   = eFALSE;

        switch (LOCAL_displayStyle)
        {
        case EURO_1x6_BAR_A:
        case EURO_1x6_BAR_B:
        case ASIA_1x6_BAR_B:
        case EURO_2x9_BAR:
        case ASIA_2x9_BAR:
            if (LOCAL_last_displayStyle == (LOCAL_displayStyle + 1))
            {
                Remove5_6 = eTRUE;
            }
            break;

        case ASIA_1x6_BAR_A:
            if (LOCAL_last_displayStyle == (LOCAL_displayStyle + 1))
            {
                Remove5 = eTRUE;
            }
            break;

        case EURO_1x6_BAR_A_DIAG:
        case EURO_1x6_BAR_B_DIAG:
        case ASIA_1x6_BAR_B_DIAG:
        case EURO_2x9_BAR_DIAG:
        case ASIA_2x9_BAR_DIAG:
            if (LOCAL_last_displayStyle == (LOCAL_displayStyle - 1))
            {
                Remove5_6 = eTRUE;
            }
            break;

        case ASIA_1x6_BAR_A_DIAG:
            if (LOCAL_last_displayStyle == (LOCAL_displayStyle - 1))
            {
                Remove5 = eTRUE;
            }
            break;

        default:
            break;
        }

        if (Remove5_6)
        {
            packetsBuilt += BuildBlankArea(5,6,0);
        }
        else if (Remove5)
        {
            packetsBuilt += BuildBlankArea(5,5,0);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_REMOVE_BARGRAPH + 1;
        }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_TEXT + 1;
        #endif
    }

//  Prepare data for bargraph stages
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_BARGRAPH_RHS_T        // bargraph border RHS (Top)               |
// OPERATOR_FRAME_PACKET_BARGRAPH_RHS_B        // bargraph border RHS (Bottom)            |
// OPERATOR_FRAME_PACKET_BARGRAPH_FILL_T       // Bargraph filled area (top)              |
// OPERATOR_FRAME_PACKET_BARGRAPH_FILL_B       // Bargraph filled area (Bottom)           |
// OPERATOR_FRAME_PACKET_BARGRAPH_BLANK_T      // Bargraph blank area (top)               |
// OPERATOR_FRAME_PACKET_BARGRAPH_BLANK_B      // Bargraph blank area (Bottom)            |
// OPERATOR_FRAME_PACKET_BARGRAPH_SIGNAL_ID    // Bargraph Signal ID                      |
// OPERATOR_FRAME_PACKET_BARGRAPH_TEXT         // Bargraph level (value)(units)           |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= OPERATOR_FRAME_PACKET_BARGRAPH_RHS_T) && (LOCAL_packetStage <= OPERATOR_FRAME_PACKET_BARGRAPH_TEXT))
    {

        #ifdef HMI_SUPPORTS_OPERATOR_BARGRAPH
        if (LOCAL_bargraphStyle != 0)
        {
            // A bargraph is required - initialise bargraph variables
            const SIGNAL_TABLE_TYPE *pSignalInTable = FrameTableGetSignal(signal[_BAR_LINE]);
            (void)AdjusterGetFloatValue((TUSIGN16)pSignalInTable->value.ssIdx,
                                        (TUSIGN16)pSignalInTable->value.objIdx,
                                        pSignalInTable->value.attribIdx,
                                        &bargraphDataValue,
                                        &bargraphDatatype);

            switch (LOCAL_bargraphStyle)
            {
            case 1:     Filled_T = 0xF0; Blank__T = 0x10; Filled_B = 0x7F; Blank__B = 0x40; lineNumber_BarV = 5; barStart =  0; barEnd = 78; lineNumber_BarID = 6; break;
            case 2:     Filled_T = 0x7F; Blank__T = 0x41; Filled_B = 0x00; Blank__B = 0x00; lineNumber_BarV = 5; barStart =  0; barEnd = 78; lineNumber_BarID = 5; break;
            case 3:     Filled_T = 0x7F; Blank__T = 0x41; Filled_B = 0x00; Blank__B = 0x00; lineNumber_BarV = 6; barStart =  0; barEnd = 78; lineNumber_BarID = 6; break;
            case 4:     Filled_T = 0xF0; Blank__T = 0x10; Filled_B = 0x7F; Blank__B = 0x40; lineNumber_BarV = 5; barStart = 18; barEnd = 96; lineNumber_BarID = 6; break;
            case 5:     Filled_T = 0x7F; Blank__T = 0x41; Filled_B = 0x00; Blank__B = 0x00; lineNumber_BarV = 5; barStart = 18; barEnd = 96; lineNumber_BarID = 5; break;
            case 6:     Filled_T = 0xFC; Blank__T = 0x04; Filled_B = 0x3F; Blank__B = 0x20; lineNumber_BarV = 5; barStart = 26; barEnd = 96; lineNumber_BarID = 6; break;
            case 7:     Filled_T = 0xF0; Blank__T = 0x10; Filled_B = 0x7F; Blank__B = 0x40; lineNumber_BarV = 4; barStart = 18; barEnd = 96; lineNumber_BarID = 5; break;
            case 8:     Filled_T = 0xF3; Blank__T = 0x04; Filled_B = 0x3F; Blank__B = 0x20; lineNumber_BarV = 4; barStart = 26; barEnd = 96; lineNumber_BarID = 5; break;
            default:    asm("nop");                                                                                                                                break;
            }
        }
        else
        {
            // No bargraph required - set packet Stage after bargraph
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_TEXT + 1;
        }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_TEXT + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_BARGRAPH_RHS_T        // bargraph border RHS (Top)               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_BARGRAPH_RHS_T)
    {
        #ifdef HMI_SUPPORTS_OPERATOR_BARGRAPH
        packetsBuilt += BuildCustomCharacterString(&Filled_T, 1, (TUSIGN8)barEnd, lineNumber_BarV, 0, 0);
        #else
        LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_TEXT + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_BARGRAPH_RHS_B        // bargraph border RHS (Bottom)            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_BARGRAPH_RHS_B)
    {
        #ifdef HMI_SUPPORTS_OPERATOR_BARGRAPH
        if (Filled_B)
        {
            packetsBuilt += BuildCustomCharacterString(&Filled_B, 1, (TUSIGN8)barEnd, (TUSIGN8)(lineNumber_BarV + 1), 0, 0);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_RHS_B + 1;
        }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_TEXT + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_BARGRAPH_FILL_T       // Bargraph filled area (top)              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_BARGRAPH_FILL_T)
    {
        #ifdef HMI_SUPPORTS_OPERATOR_BARGRAPH

            #ifdef HMI_USES_DOUBLE
            TDOUBLE barHigh, barLow;
            #else
            TFLOAT barHigh, barLow;
            #endif

            const SIGNAL_TABLE_TYPE *pSignalInTable = FrameTableGetSignal(signal[_BAR_LINE]);

            switch (pSignalInTable->FixedUpperLower)
            {
            case 0:                 PacketManagerBuilderServices_GetBarRange(pSignalInTable,&barHigh,&barLow);   break;
            case 1:                 barHigh = 100.0F;       barLow = 0.0F;          break;
            default:                barHigh = 20.0F;        barLow = 4.0F;          break;
            }

            if (fabs((TDOUBLE)(barLow - barHigh)) == 0.0)
            {
                #ifdef HMI_USES_DOUBLE
                if (((bargraphDatatype == ST_DOUBLE) && (bargraphDataValue.data_D >= barHigh)) || ((bargraphDatatype != ST_DOUBLE) && (bargraphDataValue.data_F >= barHigh)))
                #else
                if (bargraphDataValue.data_F >= barHigh)
                #endif
                {
                    LOCAL_barPercent = 101;
                    LOCAL_barPosition = (barEnd - barStart) - 1;
                }
                else
                {
                    LOCAL_barPercent = -1;
                    LOCAL_barPosition = 0;
                }
            }
            else
            {
                #ifdef HMI_USES_DOUBLE
                TDOUBLE calc;
                if (bargraphDatatype == ST_DOUBLE)
                {
                    calc = ((bargraphDataValue.data_D - barLow)/(barHigh - barLow)) * 100;
                }
                else
                {
                    calc = ((bargraphDataValue.data_F - barLow)/(barHigh - barLow)) * 100;
                }
                #else
                TFLOAT calc = ((bargraphDataValue.data_F - barLow)/(barHigh - barLow)) * 100;
                #endif
                if (calc > 100)
                {
                    LOCAL_barPercent = 101;
                    LOCAL_barPosition = (barEnd - barStart) - 1;
                }
                else if (calc < 0)
                {
                    LOCAL_barPercent = -1;
                    LOCAL_barPosition = 0;
                }
                else
                {
                    #ifdef HMI_USES_DOUBLE
                    LOCAL_barPercent = (TUSIGN8)(calc + 0.5);
                    #else
                    LOCAL_barPercent = (TUSIGN8)(calc + 0.5F);
                    #endif

                    LOCAL_barPosition = ((((TUSIGN16)((barEnd - 1) - barStart) * (TUSIGN16)LOCAL_barPercent) + 50) / 100);
                }
            }

            packetsBuilt += BuildCustomCharacterString(&Filled_T, 1, (TUSIGN8)barStart, lineNumber_BarV, LOCAL_barPosition, 0);
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_TEXT + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_BARGRAPH_FILL_B       // Bargraph filled area (Bottom)           |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_BARGRAPH_FILL_B)
    {
        #ifdef HMI_SUPPORTS_OPERATOR_BARGRAPH
        if (Filled_B)
        {
            packetsBuilt += BuildCustomCharacterString(&Filled_B, 1, (TUSIGN8)barStart, (TUSIGN8)(lineNumber_BarV + 1), LOCAL_barPosition, 0);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_FILL_B + 1;
        }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_TEXT + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_BARGRAPH_BLANK_T      // Bargraph blank area (top)               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_BARGRAPH_BLANK_T)
    {
        #ifdef HMI_SUPPORTS_OPERATOR_BARGRAPH
        if (LOCAL_barPosition < ((barEnd - barStart) - 1))
        {
            packetsBuilt += BuildCustomCharacterString(&Blank__T, 1, (TUSIGN8)(LOCAL_barPosition+barStart+1), lineNumber_BarV, (TUSIGN8)((barEnd - 1) - (barStart + LOCAL_barPosition + 1)), 0);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_BLANK_T + 1;
        }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_TEXT + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_BARGRAPH_BLANK_B      // Bargraph blank area (Bottom)            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_BARGRAPH_BLANK_B)
    {
        #ifdef HMI_SUPPORTS_OPERATOR_BARGRAPH
        if ((LOCAL_barPosition < ((barEnd - barStart) - 1)) && (Blank__B != 0x00))
        {
            packetsBuilt += BuildCustomCharacterString(&Blank__B, 1,  (TUSIGN8)(LOCAL_barPosition+barStart+1), (TUSIGN8)(lineNumber_BarV+1), (TUSIGN8)((barEnd - 1) - (barStart + LOCAL_barPosition + 1)), 0);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_BLANK_B + 1;
        }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_TEXT + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_BARGRAPH_SIGNAL_ID    // Bargraph Signal ID                      |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_BARGRAPH_SIGNAL_ID)
    {
        #ifdef HMI_SUPPORTS_OPERATOR_BARGRAPH
        if ((LOCAL_bargraphStyle >= 1) && (LOCAL_bargraphStyle <= 3))
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_SIGNAL_ID + 1;
        }
        else
        {
            TUSIGN8 text[SIGNAL_ID_BUFFER_SIZE+1];
            memset((void*)text,0x00,SIGNAL_ID_BUFFER_SIZE+1);

            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(signal[_BAR_LINE])->short_identifier;
            strncpy((char *)text,(const char *)FrameTableGetString(LOCAL_stringtable_text_id),SIGNAL_ID_BUFFER_SIZE);

            #ifdef HMI_SUPPORTS_ASIAN

            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(text, (TUSIGN8)(lineNumber_BarID-1), JUSTIFY_LEFT,NO_INVERT,0,2,2,0);
            }
            else
            #endif
            {
                LimitTextLength(text,3);
                packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber_BarID,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,3,0);
            }
        }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_TEXT + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_BARGRAPH_TEXT         // Bargraph level (value)(units)           |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_BARGRAPH_TEXT)
    {
        #ifdef HMI_SUPPORTS_OPERATOR_BARGRAPH
        TUSIGN8 barText[6];
        TUSIGN8 len;

        if (LOCAL_barPercent < 0)
        {
            strcpy((char *)barText, "<0");
        }
        else if (LOCAL_barPercent > 100)
        {
            strcpy((char *)barText, ">100");
        }
        else
        {
            TUSIGN8 negNumber,within_over_under;
            TUSIGN8 *pStart;
            pStart = AdjusterBuildNumberString((float)LOCAL_barPercent,3,0, &negNumber, &within_over_under);

            while (*pStart == 0x20)
            {
                #pragma diag_suppress=Pm088
                pStart ++;
                #pragma diag_default=Pm088
            }

            barText[0] = negNumber ? '-' : ' ';
            barText[1] = 0x00;
            (void)strcat((char *)barText,(char *)pStart);
        }

        if (displayMode == HMI_DISPLAY_MODE_1x6_BAR_A)
        {
            (void)strcat((char *)barText," %");
            len = 6;
        }
        else
        {
            (void)strcat((char *)barText,"%");
            len = 5;
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString(barText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, (TUSIGN8)(lineNumber_BarID-1), JUSTIFY_RIGHT, FONT_1, NO_INVERT, 0, 0, len, 0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(barText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, lineNumber_BarID, JUSTIFY_RIGHT, FONT_0, NO_INVERT, 0, 0, len, 0);
        }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_BARGRAPH_TEXT + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_REDRAW_DIAGNOSTICS    //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_REDRAW_DIAGNOSTICS)
    {
        LOCAL_packetStage = OPERATOR_FRAME_PACKET_REDRAW_DIAGNOSTICS + 1;
    }

#ifdef EDP300_SPECIAL_FEATURES_HMI
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_ICONFIELDS_1_4, // Blank                                   |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_ICONFIELDS_1_4)
    {
        if ((LOCAL_displayStyle & 0x01) == 0)   // Even numbered display styles have no diagnostic message
        {
            TUSIGN8 customChar = 0x00;
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_1_START, 7, (ICONFIELD_5_START - ICONFIELD_1_START) - 1,0);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DUMMY_STAGE;
        }
    }
#else
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_1     // Autoscroll Icon              [12]..[18] |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_1)
    {
        if ((LOCAL_displayStyle & 0x01) == 0)   // Even numbered display styles have no diagnostic message
        {
            if (LOCAL_displayAutoscrollIcon)
            {
                // Display Autoscroll Icon
                packetsBuilt += BuildCustomCharacterString(AutoscrollIcon, sizeof(AutoscrollIcon), ICONFIELD_1_START, 7, 0,0);
            }
            else
            {
                // Blank Area
                TUSIGN8 customChar = 0x00;
                packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_1_START, 7, (ICONFIELD_2_START - ICONFIELD_1_START) - 1,0);
            }
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DUMMY_STAGE;
        }
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_2     // Blank                        [19]..[29] |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_2)
    {
        if ((LOCAL_displayStyle & 0x01) == 0)   // Even numbered display styles have no diagnostic message
        {
            TUSIGN8 customChar = 0x00;
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_2_START, 7, (ICONFIELD_3_START - ICONFIELD_2_START) - 1,0);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DUMMY_STAGE;
        }
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_3     // Control Icon                 [30]..[53] |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_3)
    {
        if ((LOCAL_displayStyle & 0x01) == 0)   // Even numbered display styles have no diagnostic message
        {
            TUSIGN8 temp_Field_3_Icon = LOCAL_Field_3_Icon;
            if (temp_Field_3_Icon > MAX_OPERATOR_DEFINED_ICONS)
            {
                temp_Field_3_Icon = 0;
            }

            if (OperatorIconInfo[temp_Field_3_Icon].valid_3 != eTRUE)
            {
                temp_Field_3_Icon = 0;
            }

            packetsBuilt += BuildWriteArray(OperatorIconInfo[temp_Field_3_Icon].pIcon, OperatorIconInfo[temp_Field_3_Icon].size, ICONFIELD_3_START, 7, 0);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DUMMY_STAGE;
        }
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_4     // Blank                        [54]..[58] |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_4)
    {
        if ((LOCAL_displayStyle & 0x01) == 0)   // Even numbered display styles have no diagnostic message
        {
            TUSIGN8 customChar = 0x00;
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_4_START, 7, (ICONFIELD_5_START - ICONFIELD_4_START) - 1,0);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DUMMY_STAGE;
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_5     // Write Protect icon           [59]..[65] |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_5)
    {
        if ((LOCAL_displayStyle & 0x01) == 0)   // Even numbered display styles have no diagnostic message
        {
            TUSIGN8 temp_Field_5_Icon = LOCAL_Field_5_Icon;
            if (temp_Field_5_Icon > MAX_OPERATOR_DEFINED_ICONS)
            {
                LOCAL_Field_5_Icon = 0;
            }

            if (LOCAL_displayWriteProtectIcon)
            {
                temp_Field_5_Icon = 1;
            }

            if (OperatorIconInfo[temp_Field_5_Icon].valid_5 != eTRUE)
            {
                temp_Field_5_Icon = 3;
            }
            packetsBuilt += BuildWriteArray(OperatorIconInfo[temp_Field_5_Icon].pIcon, OperatorIconInfo[temp_Field_5_Icon].size, ICONFIELD_5_START, 7, 0);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DUMMY_STAGE;
        }
   }
#ifdef EDP300_SPECIAL_FEATURES_HMI
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_ICONFIELDS_6_8, // Blank                                   |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_ICONFIELDS_6_8)
    {
        if ((LOCAL_displayStyle & 0x01) == 0)   // Even numbered display styles have no diagnostic message
        {
            TUSIGN8 customChar = 0x00;
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_6_START, 7, (ICONFIELD_END - ICONFIELD_6_START) - 1,0);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DUMMY_STAGE;
        }
    }
#else // else condition for #ifdef EDP300_SPECIAL_FEATURES_HMI

//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_6     // Blank                        [66]..[70] |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_6)
    {
        if ((LOCAL_displayStyle & 0x01) == 0)   // Even numbered display styles have no diagnostic message
        {
            TUSIGN8 customChar = 0x00;
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_6_START, 7, (ICONFIELD_7_START - ICONFIELD_6_START) - 1,0);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DUMMY_STAGE;
        }
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_7     // Mode icon                    [71]..[94] |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_7)
    {
        if ((LOCAL_displayStyle & 0x01) == 0)   // Even numbered display styles have no diagnostic message
        {
            TUSIGN8 temp_Field_7_Icon = LOCAL_Field_7_Icon;
            if (temp_Field_7_Icon > MAX_OPERATOR_DEFINED_ICONS)
            {
                temp_Field_7_Icon = 0;
            }

            if (OperatorIconInfo[temp_Field_7_Icon].valid_7 != eTRUE)
            {
                temp_Field_7_Icon = 0;
            }
            packetsBuilt += BuildWriteArray(OperatorIconInfo[temp_Field_7_Icon].pIcon, OperatorIconInfo[temp_Field_7_Icon].size, ICONFIELD_7_START, 7, 0);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DUMMY_STAGE;
        }
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_8     // Blank                        [95]..[113]|
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_8)
    {
        if ((LOCAL_displayStyle & 0x01) == 0)   // Even numbered display styles have no diagnostic message
        {
            TUSIGN8 customChar = 0x00;
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_8_START, 7, (ICONFIELD_END - ICONFIELD_8_START) - 1,0);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DUMMY_STAGE;
        }
    }
#endif  // end of else condition for #ifdef EDP300_SPECIAL_FEATURES_HMI

//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_DUMMY_STAGE,    //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_DUMMY_STAGE)
    {
        LOCAL_packetStage ++;
    }

#ifdef EDP300_SPECIAL_FEATURES_HMI
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_9T    //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_9T)
    {
        if ((displayMode != HMI_DISPLAY_MODE_1x6_A) && (displayMode != HMI_DISPLAY_MODE_1x6_B))
        {
            LOCAL_packetStage ++;
        }
        else
        {
            const TUSIGN8 *pIcon_9;

            switch (LOCAL_Field_9_Icon)
            {
            case 18:    pIcon_9 = EDP300_specialIcon_1;     break;  // Reg Check
            case 19:    pIcon_9 = EDP300_specialIcon_4;     break;  // Reg Uncheck
            case 20:    pIcon_9 = EDP300_specialIcon_1;     break;  // MSP Check
            case 21:    pIcon_9 = EDP300_specialIcon_4;     break;  // MSP Uncheck
            case 22:    pIcon_9 = EDP300_specialIcon_3;     break;  // Manual
            case 23:    pIcon_9 = EDP300_specialIcon_1;     break;  // HART Check
            case 24:    pIcon_9 = EDP300_specialIcon_4;     break;  // HART Uncheck
            case 25:    pIcon_9 = EDP300_specialIcon_1;     break;  // Bin Check
            case 26:    pIcon_9 = EDP300_specialIcon_4;     break;  // Bin Uncheck
            case 8:     pIcon_9 = EDP300_specialIcon_11;    break;  // DIAG
            case 9:     pIcon_9 = EDP300_specialIcon_13;    break;  // FAIL
            case 10:    pIcon_9 = EDP300_specialIcon_15;    break;  // UNIV
            case 11:    pIcon_9 = EDP300_specialIcon_17;    break;  // SERV
            default:    pIcon_9 = EDP300_specialIcon_3;     break;  // invalid
            }

            if (prev_Field_9_Icon_T[OpPageInstance] == pIcon_9)
            {
                LOCAL_packetStage ++;
            }
            else
            {
                TUSIGN8 lineNumber = 1;
                if ((LOCAL_displayStyle == EURO_1x6_B) || (LOCAL_displayStyle == EURO_1x6_B_DIAG))
                {
                    lineNumber ++;
                }
                packetsBuilt += BuildWriteArray(pIcon_9, 19, 0, lineNumber, 0);

                if (LOCAL_packetStage != OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_9T)
                {
                    prev_Field_9_Icon_T[OpPageInstance] = pIcon_9;
                }
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_9M    //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_9M)
    {
        if ((displayMode != HMI_DISPLAY_MODE_1x6_A) && (displayMode != HMI_DISPLAY_MODE_1x6_B))
        {
            LOCAL_packetStage ++;
        }
        else
        {
            const TUSIGN8 *pIcon_9;

            switch (LOCAL_Field_9_Icon)
            {
            case 18:    pIcon_9 = EDP300_specialIcon_2;     break;  // Reg Check
            case 19:    pIcon_9 = EDP300_specialIcon_2;     break;  // Reg Uncheck
            case 20:    pIcon_9 = EDP300_specialIcon_5;     break;  // MSP Check
            case 21:    pIcon_9 = EDP300_specialIcon_5;     break;  // MSP Uncheck
            case 22:    pIcon_9 = EDP300_specialIcon_7;     break;  // Manual
            case 23:    pIcon_9 = EDP300_specialIcon_8;     break;  // HART Check
            case 24:    pIcon_9 = EDP300_specialIcon_8;     break;  // HART Uncheck
            case 25:    pIcon_9 = EDP300_specialIcon_2;     break;  // Bin Check
            case 26:    pIcon_9 = EDP300_specialIcon_2;     break;  // Bin Uncheck
            case 8:     pIcon_9 = EDP300_specialIcon_12;    break;  // DIAG
            case 9:     pIcon_9 = EDP300_specialIcon_14;    break;  // FAIL
            case 10:    pIcon_9 = EDP300_specialIcon_16;    break;  // UNIV
            case 11:    pIcon_9 = EDP300_specialIcon_18;    break;  // SERV
            default:    pIcon_9 = EDP300_specialIcon_3;     break;  // Invalid
            }

            if (prev_Field_9_Icon_M[OpPageInstance] == pIcon_9)
            {
                LOCAL_packetStage ++;
            }
            else
            {
                TUSIGN8 lineNumber = 2;
                if ((LOCAL_displayStyle == EURO_1x6_B) || (LOCAL_displayStyle == EURO_1x6_B_DIAG))
                {
                    lineNumber ++;
                }
                packetsBuilt += BuildWriteArray(pIcon_9, 19, 0, lineNumber, 0);

                if (LOCAL_packetStage != OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_9M)
                {
                    prev_Field_9_Icon_M[OpPageInstance] = pIcon_9;
                }
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_9B    //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_9B)
    {
        if ((displayMode != HMI_DISPLAY_MODE_1x6_A) && (displayMode != HMI_DISPLAY_MODE_1x6_B))
        {
            LOCAL_packetStage ++;
        }
        else
        {
            const TUSIGN8 *pIcon_9;

            switch (LOCAL_Field_9_Icon)
            {
            case 18:    pIcon_9 = EDP300_specialIcon_3;     break;  // Reg Check
            case 19:    pIcon_9 = EDP300_specialIcon_3;     break;  // Reg Uncheck
            case 20:    pIcon_9 = EDP300_specialIcon_6;     break;  // MSP Check
            case 21:    pIcon_9 = EDP300_specialIcon_6;     break;  // MSP Uncheck
            case 22:    pIcon_9 = EDP300_specialIcon_6;     break;  // Manual
            case 23:    pIcon_9 = EDP300_specialIcon_9;     break;  // HART Check
            case 24:    pIcon_9 = EDP300_specialIcon_9;     break;  // HART Uncheck
            case 25:    pIcon_9 = EDP300_specialIcon_10;    break;  // Bin Check
            case 26:    pIcon_9 = EDP300_specialIcon_10;    break;  // Bin Uncheck
            case 8:     pIcon_9 = EDP300_specialIcon_3;     break;  // DIAG
            case 9:     pIcon_9 = EDP300_specialIcon_3;     break;  // FAIL
            case 10:    pIcon_9 = EDP300_specialIcon_3;     break;  // UNIV
            case 11:    pIcon_9 = EDP300_specialIcon_19;    break;  // SERV
            default:    pIcon_9 = EDP300_specialIcon_3;     break;  // Invalid
            }

            if (prev_Field_9_Icon_B[OpPageInstance] == pIcon_9)
            {
                LOCAL_packetStage ++;
            }
            else
            {
                TUSIGN8 lineNumber = 3;
                if ((LOCAL_displayStyle == EURO_1x6_B) || (LOCAL_displayStyle == EURO_1x6_B_DIAG))
                {
                    lineNumber ++;
                }
                packetsBuilt += BuildWriteArray(pIcon_9, 19, 0, lineNumber, 0);

                if (LOCAL_packetStage != OPERATOR_FRAME_PACKET_STAGE_ICONFIELD_9B)
                {
                    prev_Field_9_Icon_B[OpPageInstance] = pIcon_9;
                }
            }
        }
    }
#endif // end of #ifdef EDP300_SPECIAL_FEATURES_HMI

//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_REMOVE_DIAGNOSTICS    // Remove Diagnostics                      |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_REMOVE_DIAGNOSTICS)
    {
        if ((LOCAL_displayStyle == EURO_1x4)
         || (LOCAL_displayStyle == EURO_1x6_A)
         || (LOCAL_displayStyle == EURO_1x6_B)
         || (LOCAL_displayStyle == EURO_1x9)
         || (LOCAL_displayStyle == EURO_1x9_BAR)
         || (LOCAL_displayStyle == EURO_2x9)
         || (LOCAL_displayStyle == ASIA_1x6_A)
         || (LOCAL_displayStyle == ASIA_1x6_B)
         || (LOCAL_displayStyle == ASIA_1x9)
         || (LOCAL_displayStyle == ASIA_1x9_BAR)
         || (LOCAL_displayStyle == ASIA_2x9))
        {
            packetsBuilt += BuildBlankArea(6,6,0);
        }
        #ifdef HMI_SUPPORTS_ASIAN
        else if (LOCAL_displayStyle == ASIA_1x4)
        {
            TUSIGN8 customChar = 0x00;
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, 72, 6, 55,0);
        }
        #endif
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_REMOVE_DIAGNOSTICS + 1;
        }
    }
//  Prepare data for diagnostics display
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_DIAG_ICON_T     // Diagnostics Classification Icon (Top)   |
// OPERATOR_FRAME_PACKET_STAGE_DIAG_ICON_B     // Diagnostics Classification Icon (Bottom)|
// OPERATOR_FRAME_PACKET_STAGE_DIAG_CATEGORY   // Diagnostics Category Text               |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= OPERATOR_FRAME_PACKET_STAGE_DIAG_ICON_T) && (LOCAL_packetStage <= OPERATOR_FRAME_PACKET_STAGE_DIAG_CATEGORY))
    {
        #ifdef HMI_USES_COMMONDIAGNOSTICS
        if ((LOCAL_displayStyle & 0x01) != 0)   // Odd numbered display styles have diagnostic message
        {
            // Get Alarm info
            AdjusterGetNAMURStatus(&NAMURClassification[OpPageInstance], &NAMURCategory[OpPageInstance]);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DIAG_CATEGORY + 1;
        }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DIAG_CATEGORY + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_DIAG_ICON_T     // Diagnostics Classification Icon (Top)   |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_DIAG_ICON_T)
    {
        #ifdef HMI_USES_COMMONDIAGNOSTICS

            const TUSIGN8 *pIcon;

            if (infoMessageID[OpPageInstance] != 0)
            {
               pIcon = InfoMessageIcon_T;
            }
            else
            {
               pIcon = FrameTableGetDiagnosticIconAddress(NAMURClassification[OpPageInstance],0);
            }

            TUSIGN8 icon_xPos = 12;

            #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
            if (PacketManagerBuilderServices_IndicatorOnly())
            {
                icon_xPos = 1;
            }
            #endif

            packetsBuilt += BuildWriteArray(pIcon,18,icon_xPos,6,0);
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DIAG_CATEGORY + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_DIAG_ICON_B     // Diagnostics Classification Icon (Bottom)|
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_DIAG_ICON_B)
    {
        #ifdef HMI_USES_COMMONDIAGNOSTICS
            const TUSIGN8 *pIcon;

            if (infoMessageID[OpPageInstance] != 0)
            {
               pIcon = InfoMessageIcon_B;
            }
            else
            {
               pIcon = FrameTableGetDiagnosticIconAddress(NAMURClassification[OpPageInstance],1);
            }

            TUSIGN8 icon_xPos = 12;
            #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
            if (PacketManagerBuilderServices_IndicatorOnly())
            {
                icon_xPos = 1;
            }
            #endif

            packetsBuilt += BuildWriteArray(pIcon,18,icon_xPos,7,0);
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DIAG_CATEGORY + 1;
        #endif
    }

#ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_DIAG_MESSAGE_1_16     // Diagnostics Category Text               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_DIAG_MESSAGE_1_16)
    {
        #ifdef HMI_USES_COMMONDIAGNOSTICS
            if ((PacketManagerBuilderServices_IndicatorOnly())
             && (LOCAL_flashState)
             && (infoMessageID[OpPageInstance] == 0))
            {

                LOCAL_stringtable_text_id.attribIdx = FrameTableGetDiagnosticTableEntry(NAMUR_ActiveAlarm[OpPageInstance]).descriptionID;

                TUSIGN8 PartialDescription[17];

                // Asian Description 1..8 or European Description 1..16
                PacketManagerBuilderServices_GetPartialDiagnosticDescription(FrameTableGetString(LOCAL_stringtable_text_id), 1, 16, PartialDescription);

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildWriteString_w(PartialDescription,6,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,STRING_INVERT,0,9,9,0);
                }
                else
                #endif
                {
                    packetsBuilt += BuildWriteString(PartialDescription,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,STRING_INVERT,0,0,18,0);
                }
            }
            else
            {
                LOCAL_packetStage = OPERATOR_FRAME_PACKET_DIAG_MESSAGE_17_32 + 1;
            }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DIAG_CATEGORY + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_DIAG_MESSAGE_17_32    // Diagnostics Category Text               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_DIAG_MESSAGE_17_32)
    {
        #ifdef HMI_USES_COMMONDIAGNOSTICS
            if ((PacketManagerBuilderServices_IndicatorOnly())
             && (LOCAL_flashState)
             && (infoMessageID[OpPageInstance] == 0))
            {

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    LOCAL_packetStage ++;
                }
                else
                #endif
                {
                    LOCAL_stringtable_text_id.attribIdx = FrameTableGetDiagnosticTableEntry(NAMUR_ActiveAlarm[OpPageInstance]).descriptionID;

                    TUSIGN8 PartialDescription[17];

                    // European Description 1..16
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FrameTableGetString(LOCAL_stringtable_text_id), 17, 16, PartialDescription);
                    packetsBuilt += BuildWriteString(PartialDescription,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,STRING_INVERT,0,0,18,0);
                }
            }
            else
            {
                LOCAL_packetStage = OPERATOR_FRAME_PACKET_DIAG_MESSAGE_17_32 + 1;
            }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DIAG_CATEGORY + 1;
        #endif
        }
#endif
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_STAGE_DIAG_CATEGORY   // Diagnostics Category Text               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_STAGE_DIAG_CATEGORY)
    {
        #ifdef HMI_USES_COMMONDIAGNOSTICS

            #ifdef DISPLAY_SIZE_E
            TUSIGN8 CategoryStringLen = 13;
            #else
            TUSIGN8 CategoryStringLen = 14;
            #endif

            #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
            if (PacketManagerBuilderServices_IndicatorOnly())
            {
                CategoryStringLen = 18;
            }
            #endif

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                CategoryStringLen = (CategoryStringLen + 1) / 2;    // 13 => 7, 14 => 7, 18 => 9
            }
            #endif

            TUSIGN8 CategoryString[DIAG_CATEGORY_BUFFER_SIZE+1];
            memset((void*)CategoryString,0x00,DIAG_CATEGORY_BUFFER_SIZE+1);

            if (CategoryStringLen > DIAG_CATEGORY_BUFFER_SIZE)
            {
                CategoryStringLen = DIAG_CATEGORY_BUFFER_SIZE;
            }

            TUSIGN8 invert;
            TUSIGN8 font = FONT_1;

            if (infoMessageID[OpPageInstance] != 0)
            {
                invert = NO_INVERT;
                #ifndef INFORMATION_MESSAGES_OFFSET
                    LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
                #else
                    #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                        LOCAL_stringtable_text_id.attribIdx = FrameTableGetDiagnosticTableEntry((TUSIGN8)(infoMessageID[OpPageInstance] + INFORMATION_MESSAGES_OFFSET)).descriptionID;
                    #else
                        LOCAL_stringtable_text_id.attribIdx = FrameTableGetDiagnosticDescriptionStringID((TUSIGN8)(infoMessageID[OpPageInstance] + INFORMATION_MESSAGES_OFFSET));
                    #endif
                #endif
            }
            else
            {
                invert = STRING_INVERT;

                #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
                if ((PacketManagerBuilderServices_IndicatorOnly()) && (LOCAL_flashState))
                {
                    LOCAL_packetStage ++;
                }
                else
                #endif
                {
                    LOCAL_stringtable_text_id.attribIdx = FrameTableGetNAMURCategoryString(NAMURCategory[OpPageInstance]);
                }
            }

            if (LOCAL_packetStage  == OPERATOR_FRAME_PACKET_STAGE_DIAG_CATEGORY)
            {
                TUSIGN8 justify = JUSTIFY_LEFT_WITH_INDENT_30_PIXEL;

                #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
                if (PacketManagerBuilderServices_IndicatorOnly())
                {
                    justify = JUSTIFY_LEFT_WITH_INDENT_19_PIXEL;
                }
                #endif

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                   packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),6,justify,invert,0,CategoryStringLen,CategoryStringLen,0);
                }
                else
                #endif
                {
                    strncpy((char *)CategoryString,(const char *)FrameTableGetString(LOCAL_stringtable_text_id),(size_t)CategoryStringLen);
                    (void)LimitTextLength(CategoryString, CategoryStringLen);
                    packetsBuilt += BuildWriteString(CategoryString,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,justify,font,invert,0,0,CategoryStringLen,0);
                }
            }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_STAGE_DIAG_CATEGORY + 1;
        #endif
    }

// Calculate justification for values
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_SIGNAL_ID_3           // (3) Signal ID                           |
// OPERATOR_FRAME_PACKET_VALUE_3               // (3) Value                               |
// OPERATOR_FRAME_PACKET_UOM_3                 // (3) Units of measure                    |
// OPERATOR_FRAME_PACKET_UOM_3X                // (3) Units of measure - blank upper line |
// OPERATOR_FRAME_PACKET_SIGNAL_ID_2           // (2) Signal ID                           |
// OPERATOR_FRAME_PACKET_VALUE_2               // (2) Value                               |
// OPERATOR_FRAME_PACKET_UOM_2                 // (2) Units of measure                    |
// OPERATOR_FRAME_PACKET_UOM_2X                // (2) Units of measure - blank upper line |
// OPERATOR_FRAME_PACKET_SIGNAL_ID_1           // (1) Signal ID                           |
// OPERATOR_FRAME_PACKET_SIGNAL_ID_1X,         // (1) Signal ID - Remove Lower line       |
// OPERATOR_FRAME_PACKET_VALUE_1               // (1) Value                               |
// OPERATOR_FRAME_PACKET_UOM_1                 // (1) Units of measure                    |
// OPERATOR_FRAME_PACKET_UOM_1X                // (1) Units of measure - blank upper line |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= OPERATOR_FRAME_PACKET_SIGNAL_ID_3) && (LOCAL_packetStage <= OPERATOR_FRAME_PACKET_UOM_1X))
    {
        TUSIGN8 nValue = 0;

        #ifdef HMI_SUPPORTS_DISPLAY_MODE_3x9
        if ((displayMode == HMI_DISPLAY_MODE_3x9) && (nValue < 3))
        {
            nValue = 3;
        }
        #endif

        #if defined (HMI_SUPPORTS_DISPLAY_MODE_2x9) || defined(HMI_SUPPORTS_DISPLAY_MODE_2x9_BAR)
        if (((displayMode == HMI_DISPLAY_MODE_2x9) || (displayMode == HMI_DISPLAY_MODE_2x9_BAR)) && (nValue < 2))
        {
            nValue = 2;
        }
        #endif

        #if defined(HMI_SUPPORTS_DISPLAY_MODE_1x9_BAR) || defined(HMI_SUPPORTS_DISPLAY_MODE_1x9)
        if (((displayMode == HMI_DISPLAY_MODE_1x9_BAR) || (displayMode == HMI_DISPLAY_MODE_1x9)) && (nValue < 1))
        {
            nValue = 1;
        }
        #endif


        #ifdef HMI_SUPPORTS_DISPLAY_MODE_3x9
        if (displayMode == HMI_DISPLAY_MODE_3x9)
        {
            (void)PacketManagerBuilderServices_PrepareOperatorPageLineData(3, signal[_3RD_LINE], &lineData[_3RD_LINE], LOCAL_displayStyle);
        }
        #endif

        #if defined (HMI_SUPPORTS_DISPLAY_MODE_2x9) || defined(HMI_SUPPORTS_DISPLAY_MODE_2x9_BAR) || defined(HMI_SUPPORTS_DISPLAY_MODE_3x9)
        if ((displayMode == HMI_DISPLAY_MODE_2x9) || (displayMode == HMI_DISPLAY_MODE_2x9_BAR) || (displayMode == HMI_DISPLAY_MODE_3x9))
        {
            (void)PacketManagerBuilderServices_PrepareOperatorPageLineData(2, signal[_2ND_LINE], &lineData[_2ND_LINE], LOCAL_displayStyle);
        }
        #endif

       (void)PacketManagerBuilderServices_PrepareOperatorPageLineData(1, signal[_1ST_LINE], &lineData[_1ST_LINE], LOCAL_displayStyle);

        numberLength = 8;

        for ( ; nValue >0; nValue --)
        {
            TUSIGN8 j = nValue - 1;
            const SIGNAL_TABLE_TYPE *pSignalInTable = FrameTableGetSignal(signal[j]);
            TUSIGN8 res = pSignalInTable->dpPosn;
            TUSIGN8 tempNumberLength = 8;

            TFLOAT  tVal, limit_8chars, limit_9chars;

            // if resolution is USE_RANGE then recalculate
            PacketManagerBuilderServices_AdjustResolutionForRange(pSignalInTable, &res);

            // if resolution is a configuarable DP position then get the actual DP position
            AdjusterAdjustResolutionForCustomDP(&res);

            #ifdef HMI_USES_DOUBLE
            if (lineData[j].dataType == ST_DOUBLE)
            {
                tVal = (TFLOAT)lineData[j].dataValue.data_D;
            }
            else
            #endif
            {
                tVal = (TFLOAT)lineData[j].dataValue.data_F;
            }

            if (tVal < 0)
            {
                tVal *= -1.0F;
            }

            if (res == MAX_RESOLUTION)
            {
                res = 0;
            }

            switch (res)
            {
            case 0:     limit_9chars = 100000000;  limit_8chars = 10000000; break;
            case 1:     limit_9chars = 10000000;   limit_8chars = 1000000;  break;
            case 2:     limit_9chars = 1000000;    limit_8chars = 100000;   break;
            case 3:     limit_9chars = 100000;     limit_8chars = 10000;    break;
            case 4:     limit_9chars = 10000;      limit_8chars = 1000;     break;
            case 5:     limit_9chars = 1000;       limit_8chars = 100;      break;
            case 6:     limit_9chars = 100;        limit_8chars = 10;       break;
            case 7:     limit_9chars = 10;         limit_8chars = -1;       break;
            default:    limit_9chars = -1;         limit_8chars = -1;       break;
            }

            if (tVal < limit_8chars)
            {
                tempNumberLength = 8;
            }
            else if (tVal < limit_9chars)
            {
                tempNumberLength = 9;
            }
            else
            {
                tempNumberLength = 13;
            }

            if (tempNumberLength > numberLength)
            {
                numberLength = tempNumberLength;
            }
        }

        if (numberLength == 8)
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (!LOCAL_Asian)
            #endif
            {
                numberLength = 9;
            }

        }
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_SIGNAL_ID_3           // (3) Signal ID                           |
// OPERATOR_FRAME_PACKET_VALUE_3               // (3) Value                               |
// OPERATOR_FRAME_PACKET_UOM_3                 // (3) Units of measure                    |
// OPERATOR_FRAME_PACKET_UOM_3X                // (3) Units of measure - blank upper line |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= OPERATOR_FRAME_PACKET_SIGNAL_ID_3) && (LOCAL_packetStage <= OPERATOR_FRAME_PACKET_UOM_3X))
    {
        #ifdef HMI_SUPPORTS_DISPLAY_MODE_3x9
        if (displayMode != HMI_DISPLAY_MODE_3x9)
        #endif
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_UOM_3X + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_SIGNAL_ID_3           // (3) Signal ID                           |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_SIGNAL_ID_3)
    {
        #ifdef HMI_SUPPORTS_DISPLAY_MODE_3x9

            TUSIGN8 text[SIGNAL_ID_BUFFER_SIZE+1];
            memset((void*)text,0x00,SIGNAL_ID_BUFFER_SIZE+1);

            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(signal[_3RD_LINE])->short_identifier;
            strncpy((char *)text,(const char *)FrameTableGetString(LOCAL_stringtable_text_id),SIGNAL_ID_BUFFER_SIZE);

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(text,(TUSIGN8)(lineData[_3RD_LINE].lineNumber_ID-1),JUSTIFY_LEFT,NO_INVERT,0,2,2,0);
            }
            else
            #endif
            {
                LimitTextLength(text,3);
                packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineData[_3RD_LINE].lineNumber_ID,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,3,0);
            }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_UOM_3X + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_VALUE_3               // (3) Value                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_VALUE_3)
    {
        #ifdef HMI_SUPPORTS_DISPLAY_MODE_3x9

            TUSIGN8 text[14], negNumber;
            TUSIGN8 i;

            const SIGNAL_TABLE_TYPE *pSignalInTable = FrameTableGetSignal(signal[_3RD_LINE]);
            TUSIGN8 resolution = pSignalInTable->dpPosn;
            TUSIGN8 *pStart;
            TUSIGN8 within_over_under;

            PacketManagerBuilderServices_AdjustResolutionForRange(pSignalInTable, &resolution);

            #ifdef HMI_USES_DOUBLE
            if (lineData[_3RD_LINE].dataType == ST_DOUBLE)
            {
                pStart = AdjusterBuildNumberStringFromDouble(lineData[_3RD_LINE].dataValue.data_D, numberLength, resolution, &negNumber, &within_over_under);
            }
            else
            #endif
            {
                pStart = AdjusterBuildNumberString(lineData[_3RD_LINE].dataValue.data_F, numberLength, resolution, &negNumber, &within_over_under);
            }

            // Number too large to convert to string. Conversion routine builds "999999"
            // Flash between "999999" and up/down arrows by building a string of arrows if flash state not set
            if (((within_over_under == 1) || (within_over_under == 2)) && (!LOCAL_flashState))
            {
                for (i = 0; i < 14; i ++)
                {
                    text[i] = 0x05 + within_over_under;
                }

                text[13] = 0x00;
                text[numberLength] = 0x00;
            }
            // Number converted to string but is outside business rules)
            // Flash between "999999" and "      " by building a string of spaces if flash state not set
            else if ((lineData[_3RD_LINE].ruleViolation) && (!LOCAL_flashState))
            {
                for (i = 0; i < 14; i ++)
                {
                    text[i] = 0x20;
                }
                text[13] = 0x00;
                text[numberLength] = 0x00;
            }
            else
            {
                while (*pStart == 0x20)
                {
                    #pragma diag_suppress=Pm088
                    pStart ++;
                    #pragma diag_default=Pm088
                }

                text[0] = negNumber ? '-' : ' ';
                text[1] = 0x00;
                (void)strcat((char *)text,(char *)pStart);
            }


            if (numberLength == 8)
            {
                lineData[_3RD_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_8;
                lineData[_3RD_LINE].minLengthForValues = 9;
            }
            else if (numberLength == 9)
            {
                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    lineData[_3RD_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_7;
                }
                else
                #endif
                {
                    lineData[_3RD_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_8;
                }
                lineData[_3RD_LINE].minLengthForValues = 10;
            }
            else
            {
                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    lineData[_3RD_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_4;
                }
                else
                #endif
                {
                    lineData[_3RD_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_5;
                }
                lineData[_3RD_LINE].minLengthForValues = 13;
            }

            packetsBuilt += BuildWriteString(text,
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                             lineData[_3RD_LINE].lineNumber_V,
                                             lineData[_3RD_LINE].justifyForValues,
                                             lineData[_3RD_LINE].fontSize_V,
                                             NO_INVERT,
                                             0,
                                             0,
                                             lineData[_3RD_LINE].minLengthForValues,
                                             0);
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_UOM_3X + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_UOM_3                 // (3) Units of measure                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_UOM_3)
    {
        #ifdef HMI_SUPPORTS_DISPLAY_MODE_3x9
            TUSIGN8 units[15];
            TUSIGN8 maxLenForUnits;

            const SIGNAL_TABLE_TYPE *pSignalInTable = FrameTableGetSignal(signal[_3RD_LINE]);
            strcpy((char *)units,
                   (const char *)PacketManagerGetEngUnits((TUSIGN16)pSignalInTable->engUnits.ssIdx,
                                                          pSignalInTable->engUnits.objIdx,
                                                          pSignalInTable->engUnits.attribIdx,
                                                          pSignalInTable->engUnitsType));

            if (numberLength == 8)
            {
                maxLenForUnits = 8;
            }
            else
            {
                maxLenForUnits = numberLength == 9 ? 8 : 5;

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    maxLenForUnits --;
                }
                #endif
            }

            #ifdef HMI_SUPPORTS_CUSTOM_UNITS
            PacketManagerRemoveCustomfromUnits(units);
            #endif

            LimitTextLength(units,maxLenForUnits);
            packetsBuilt += BuildWriteString(units,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineData[_3RD_LINE].lineNumber_ID,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,maxLenForUnits,0);
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_UOM_3X + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_UOM_3X                // (3) Units of measure - blank upper line |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_UOM_3X)
    {
        #ifdef HMI_SUPPORTS_DISPLAY_MODE_3x9
            TUSIGN8 customChar = 0x00;
            TUSIGN8 len;

            if (numberLength == 8)
            {
                len = 8;
            }
            else
            {
                len = numberLength == 9 ? 8 : 5;

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    len --;
                }
                #endif
            }
            len *= FONT1_WIDTH;

            packetsBuilt += BuildCustomCharacterString(&customChar,1,(TUSIGN8)(MAX_COMMON_HMI_WIDTH - len),(TUSIGN8)(lineData[_3RD_LINE].lineNumber_ID - 1),(TUSIGN8)(len - 1),0);
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_UOM_3X + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_SIGNAL_ID_2           // (2) Signal ID                           |
// OPERATOR_FRAME_PACKET_VALUE_2               // (2) Value                               |
// OPERATOR_FRAME_PACKET_UOM_2                 // (2) Units of measure                    |
// OPERATOR_FRAME_PACKET_UOM_2X                // (2) Units of measure - blank upper line |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= OPERATOR_FRAME_PACKET_SIGNAL_ID_2) && (LOCAL_packetStage <= OPERATOR_FRAME_PACKET_UOM_2X))
    {
        #if defined (HMI_SUPPORTS_DISPLAY_MODE_2x9) || defined(HMI_SUPPORTS_DISPLAY_MODE_2x9_BAR) || defined (HMI_SUPPORTS_DISPLAY_MODE_3x9)
        if ((displayMode != HMI_DISPLAY_MODE_2x9) && (displayMode != HMI_DISPLAY_MODE_2x9_BAR) && (displayMode != HMI_DISPLAY_MODE_3x9))
        #endif
        {
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_UOM_2X + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_SIGNAL_ID_2           // (2) Signal ID                           |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_SIGNAL_ID_2)
    {
        #if defined (HMI_SUPPORTS_DISPLAY_MODE_2x9) || defined(HMI_SUPPORTS_DISPLAY_MODE_2x9_BAR) || defined(HMI_SUPPORTS_DISPLAY_MODE_3x9)

            TUSIGN8 text[SIGNAL_ID_BUFFER_SIZE+1];
            memset((void*)text,0x00,SIGNAL_ID_BUFFER_SIZE+1);

            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(signal[_2ND_LINE])->short_identifier;
            strncpy((char *)text,(const char *)FrameTableGetString(LOCAL_stringtable_text_id),SIGNAL_ID_BUFFER_SIZE);

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(text,(TUSIGN8)(lineData[_2ND_LINE].lineNumber_ID-1),JUSTIFY_LEFT,NO_INVERT,0,2,2,0);
            }
            else
            #endif
            {
                LimitTextLength(text,3);
                packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineData[_2ND_LINE].lineNumber_ID,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,3,0);
            }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_UOM_2X + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_VALUE_2               // (2) Value                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_VALUE_2)
    {
        #if defined (HMI_SUPPORTS_DISPLAY_MODE_2x9) || defined(HMI_SUPPORTS_DISPLAY_MODE_2x9_BAR) || defined(HMI_SUPPORTS_DISPLAY_MODE_3x9)

            TUSIGN8 text[14], negNumber;
            TUSIGN8 i;

            const SIGNAL_TABLE_TYPE *pSignalInTable = FrameTableGetSignal(signal[_2ND_LINE]);
            TUSIGN8 resolution = pSignalInTable->dpPosn;
            TUSIGN8 *pStart;
            TUSIGN8 within_over_under;

            PacketManagerBuilderServices_AdjustResolutionForRange(pSignalInTable, &resolution);

            #ifdef HMI_USES_DOUBLE
            if (lineData[_2ND_LINE].dataType == ST_DOUBLE)
            {
                pStart = AdjusterBuildNumberStringFromDouble(lineData[_2ND_LINE].dataValue.data_D, numberLength, resolution, &negNumber, &within_over_under);
            }
            else
            #endif
            {
                pStart = AdjusterBuildNumberString(lineData[_2ND_LINE].dataValue.data_F, numberLength, resolution, &negNumber, &within_over_under);
            }

            // Number too large to convert to string. Conversion routine builds "999999"
            // Flash between "999999" and up/down arrows by building a string of arrows if flash state not set
            if (((within_over_under == 1) || (within_over_under == 2)) && (!LOCAL_flashState))
            {
                for (i = 0; i < 14; i ++)
                {
                    text[i] = 0x05 + within_over_under;
                }
                text[13] = 0x00;
                text[numberLength] = 0x00;
            }
            // Number converted to string but is outside business rules)
            // Flash between "999999" and "      " by building a string of spaces if flash state not set
            else if ((lineData[_2ND_LINE].ruleViolation) && (!LOCAL_flashState))
            {
                for (i = 0; i < 14; i ++)
                {
                    text[i] = 0x20;
                }
                text[13] = 0x00;
                text[numberLength] = 0x00;
            }
            else
            {
                while (*pStart == 0x20)
                {
                    #pragma diag_suppress=Pm088
                    pStart ++;
                    #pragma diag_default=Pm088
                }
                text[0] = negNumber ? '-' : ' ';
                text[1] = 0x00;
                (void)strcat((char *)text,(char *)pStart);
            }

            if (numberLength == 8)
            {
                lineData[_2ND_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_8;
                lineData[_2ND_LINE].minLengthForValues = 9;
            }
            else if (numberLength == 9)
            {
                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    lineData[_2ND_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_7;
                }
                else
                #endif
                {
                    lineData[_2ND_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_8;
                }
                lineData[_2ND_LINE].minLengthForValues = 10;
            }
            else
            {
                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    lineData[_2ND_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_4;
                }
                else
                #endif
                {
                    lineData[_2ND_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_5;
                }
                lineData[_2ND_LINE].minLengthForValues = 13;
            }

            packetsBuilt += BuildWriteString(text,
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                             lineData[_2ND_LINE].lineNumber_V,
                                             lineData[_2ND_LINE].justifyForValues,
                                             lineData[_2ND_LINE].fontSize_V,
                                             NO_INVERT,
                                             0,
                                             0,
                                             lineData[_2ND_LINE].minLengthForValues,
                                             0);
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_UOM_2X + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_UOM_2                 // (2) Units of measure                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_UOM_2)
    {
        #if defined (HMI_SUPPORTS_DISPLAY_MODE_2x9) || defined(HMI_SUPPORTS_DISPLAY_MODE_2x9_BAR) || defined(HMI_SUPPORTS_DISPLAY_MODE_3x9)
            TUSIGN8 units[15];
            TUSIGN8 maxLenForUnits;

            const SIGNAL_TABLE_TYPE *pSignalInTable = FrameTableGetSignal(signal[_2ND_LINE]);
            strcpy((char *)units,
                   (const char *)PacketManagerGetEngUnits((TUSIGN16)pSignalInTable->engUnits.ssIdx,
                                                          pSignalInTable->engUnits.objIdx,
                                                          pSignalInTable->engUnits.attribIdx,
                                                          pSignalInTable->engUnitsType));

            if (numberLength == 8)
            {
                maxLenForUnits = 8;
            }
            else
            {
                maxLenForUnits = numberLength == 9 ? 8 : 5;

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    maxLenForUnits --;
                }
                #endif
            }

            #ifdef HMI_SUPPORTS_CUSTOM_UNITS
            PacketManagerRemoveCustomfromUnits(units);
            #endif

            LimitTextLength(units,maxLenForUnits);

            packetsBuilt += BuildWriteString(units,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineData[_2ND_LINE].lineNumber_ID,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,maxLenForUnits,0);

        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_UOM_2X + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_UOM_2X                // (2) Units of measure - blank upper line |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_UOM_2X)
    {
        #if defined (HMI_SUPPORTS_DISPLAY_MODE_2x9) || defined(HMI_SUPPORTS_DISPLAY_MODE_2x9_BAR) || defined(HMI_SUPPORTS_DISPLAY_MODE_3x9)
            TUSIGN8 customChar = 0x00;
            TUSIGN8 len;

            if (numberLength == 8)
            {
                len = 8;
            }
            else
            {
                len = numberLength == 9 ? 8 : 5;

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    len --;
                }
                #endif
            }
            len *= FONT1_WIDTH;

            packetsBuilt += BuildCustomCharacterString(&customChar,1,(TUSIGN8)(MAX_COMMON_HMI_WIDTH - len),(TUSIGN8)(lineData[_2ND_LINE].lineNumber_ID - 1),(TUSIGN8)(len - 1),0);
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_UOM_2X + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_SIGNAL_ID_1           // (1) Signal ID                           |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_SIGNAL_ID_1)
    {
        TUSIGN8 text[SIGNAL_ID_BUFFER_SIZE+1];
        memset((void*)text,0x00,SIGNAL_ID_BUFFER_SIZE+1);

        #if defined (HMI_SUPPORTS_ASIAN) && defined (HMI_USES_COMMONDIAGNOSTICS)

        if ((LOCAL_Asian) && (alarmActive[OpPageInstance]) && (displayMode == HMI_DISPLAY_MODE_1x4))
        {
            TUSIGN8 customChar = 0x00;
            packetsBuilt += BuildCustomCharacterString(&customChar,1,0,5,71,0);
        }
        else
        #endif
        {
            if ((displayMode == HMI_DISPLAY_MODE_1x4)
             || (displayMode == HMI_DISPLAY_MODE_1x6_A)
             || (displayMode == HMI_DISPLAY_MODE_1x6_B)
             || (displayMode == HMI_DISPLAY_MODE_1x6_BAR_A)
             || (displayMode == HMI_DISPLAY_MODE_1x6_BAR_B))
            {
                LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(signal[_1ST_LINE])->long_identifier;
                strncpy((char *)text,(const char *)FrameTableGetString(LOCAL_stringtable_text_id),SIGNAL_ID_BUFFER_SIZE);

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildWriteString_w(text,lineData[_1ST_LINE].lineNumber_ID,JUSTIFY_LEFT,NO_INVERT,0,6,6,0);
                }
                else
                #endif
                {
                    LimitTextLength(text,11);
                    packetsBuilt += BuildWriteString(text,
                                                     HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                                     lineData[_1ST_LINE].lineNumber_ID,
                                                     JUSTIFY_LEFT,
                                                     (TUSIGN8)(displayMode == HMI_DISPLAY_MODE_1x6_A ? FONT_1 : FONT_0),
                                                     NO_INVERT,
                                                     0,0,11,0);
                }
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(signal[_1ST_LINE])->short_identifier;
                strncpy((char *)text,(const char *)FrameTableGetString(LOCAL_stringtable_text_id),SIGNAL_ID_BUFFER_SIZE);

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildWriteString_w(text,(TUSIGN8)(lineData[_1ST_LINE].lineNumber_ID-1),JUSTIFY_LEFT,NO_INVERT,0,2,2,0);
                }
                else
                #endif
                {
                    LimitTextLength(text,3);
                    packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineData[_1ST_LINE].lineNumber_ID,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,3,0);
                }
            }
        }
    }
#ifdef HMI_SUPPORTS_ASIAN
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_SIGNAL_ID_1X,         // (1) Signal ID - Remove Lower line       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_SIGNAL_ID_1X)
    {
        if ((LOCAL_Asian) && (alarmActive[OpPageInstance]) && (displayMode == HMI_DISPLAY_MODE_1x4))
        {
            #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
            if (PacketManagerBuilderServices_IndicatorOnly())
            {
                LOCAL_packetStage ++;
            }
            else
            #endif
            {
                TUSIGN8 customChar = 0x00;
                packetsBuilt += BuildCustomCharacterString(&customChar,1,0,6,11,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_VALUE_1               // (1) Value                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_VALUE_1)
    {
        TUSIGN8 text[14], negNumber;
        TUSIGN8 i;

        const SIGNAL_TABLE_TYPE *pSignalInTable = FrameTableGetSignal(signal[_1ST_LINE]);
        TUSIGN8 resolution = pSignalInTable->dpPosn;
        TUSIGN8 *pStart;
        TUSIGN8 within_over_under;

        PacketManagerBuilderServices_AdjustResolutionForRange(pSignalInTable, &resolution);

        if ((displayMode != HMI_DISPLAY_MODE_1x9)
         && (displayMode != HMI_DISPLAY_MODE_1x9_BAR)
         && (displayMode != HMI_DISPLAY_MODE_2x9)
         && (displayMode != HMI_DISPLAY_MODE_2x9_BAR)
         && (displayMode != HMI_DISPLAY_MODE_3x9))
        {
            numberLength = lineData[_1ST_LINE].significantDigitsForValues;
        }

        #ifdef EDP300_SPECIAL_FEATURES_HMI
        if ((displayMode == HMI_DISPLAY_MODE_1x6_A)
         || (displayMode == HMI_DISPLAY_MODE_1x6_B))
        {
            numberLength = 5;
            lineData[_1ST_LINE].minLengthForValues = 6;
        }
        #endif

        #ifdef HMI_USES_DOUBLE
        if (lineData[_1ST_LINE].dataType == ST_DOUBLE)
        {
            pStart = AdjusterBuildNumberStringFromDouble(lineData[_1ST_LINE].dataValue.data_D, numberLength, resolution, &negNumber, &within_over_under);
        }
        else
        #endif
        {
            pStart = AdjusterBuildNumberString(lineData[_1ST_LINE].dataValue.data_F, numberLength, resolution, &negNumber, &within_over_under);
        }

        // Number too large to convert to string. Conversion routine builds "999999"
        // Flash between "999999" and up/down arrows by building a string of arrows if flash state not set
        if (((within_over_under == 1) || (within_over_under == 2)) && (!LOCAL_flashState))
        {
            for (i = 0; i < 14; i ++)
            {
                text[i] = 0x05 + within_over_under;
            }
            text[13] = 0x00;
            text[numberLength] = 0x00;
        }
        // Number converted to string but is outside business rules)
        // Flash between "999999" and "      " by building a string of spaces if flash state not set
        else if ((lineData[_1ST_LINE].ruleViolation) && (!LOCAL_flashState))
        {
            for (i = 0; i < 14; i ++)
            {
                text[i] = 0x20;
            }
            text[13] = 0x00;
            text[numberLength] = 0x00;
        }
        else
        {
            while (*pStart == 0x20)
            {
                #pragma diag_suppress=Pm088
                pStart ++;
                #pragma diag_default=Pm088
            }
            text[0] = negNumber ? '-' : ' ';
            text[1] = 0x00;
            (void)strcat((char *)text,(char *)pStart);
        }

        #if defined(HMI_SUPPORTS_DISPLAY_MODE_3x9) || defined(HMI_SUPPORTS_DISPLAY_MODE_2x9_BAR) || defined(HMI_SUPPORTS_DISPLAY_MODE_2x9) || defined(HMI_SUPPORTS_DISPLAY_MODE_1x9_BAR) || defined(HMI_SUPPORTS_DISPLAY_MODE_1x9)
        if ((displayMode == HMI_DISPLAY_MODE_3x9)
         || (displayMode == HMI_DISPLAY_MODE_2x9_BAR)
         || (displayMode == HMI_DISPLAY_MODE_2x9)
         || (displayMode == HMI_DISPLAY_MODE_1x9_BAR)
         || (displayMode == HMI_DISPLAY_MODE_1x9))
        {
            if (numberLength == 8)
            {
                lineData[_1ST_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_8;
                lineData[_1ST_LINE].minLengthForValues = 9;
            }
            else if (numberLength == 9)
            {
                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    lineData[_1ST_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_7;
                }
                else
                #endif
                {
                    lineData[_1ST_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_8;
                }
                lineData[_1ST_LINE].minLengthForValues = 10;
            }
            else
            {
                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    lineData[_1ST_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_4;
                }
                else
                #endif
                {
                    lineData[_1ST_LINE].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_5;
                }
                lineData[_1ST_LINE].minLengthForValues = 13;
            }
        }
        #endif
        packetsBuilt += BuildWriteString(text,
                                         HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                         lineData[_1ST_LINE].lineNumber_V,
                                         lineData[_1ST_LINE].justifyForValues,
                                         lineData[_1ST_LINE].fontSize_V,
                                         NO_INVERT,
                                         0,
                                         0,
                                         lineData[_1ST_LINE].minLengthForValues,
                                         0);
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_UOM_1                 // (1) Units of measure                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_UOM_1)
    {
        TUSIGN8 units[15];
        TUSIGN8 font = FONT_0;
        TUSIGN8 maxLenForUnits = 8;

        const SIGNAL_TABLE_TYPE *pSignalInTable = FrameTableGetSignal(signal[_1ST_LINE]);
        strcpy((char *)units,
               (const char *)PacketManagerGetEngUnits((TUSIGN16)pSignalInTable->engUnits.ssIdx,
                                                      pSignalInTable->engUnits.objIdx,
                                                      pSignalInTable->engUnits.attribIdx,
                                                      pSignalInTable->engUnitsType));

        #ifdef HMI_SUPPORTS_CUSTOM_UNITS
        PacketManagerRemoveCustomfromUnits(units);
        #endif

        #if defined(HMI_SUPPORTS_DISPLAY_MODE_3x9) || defined(HMI_SUPPORTS_DISPLAY_MODE_2x9_BAR) || defined(HMI_SUPPORTS_DISPLAY_MODE_2x9) || defined(HMI_SUPPORTS_DISPLAY_MODE_1x9_BAR) || defined(HMI_SUPPORTS_DISPLAY_MODE_1x9)
        if ((displayMode == HMI_DISPLAY_MODE_3x9)
         || (displayMode == HMI_DISPLAY_MODE_2x9_BAR)
         || (displayMode == HMI_DISPLAY_MODE_2x9)
         || (displayMode == HMI_DISPLAY_MODE_1x9_BAR)
         || (displayMode == HMI_DISPLAY_MODE_1x9))
        {
            if (numberLength == 8)
            {
                maxLenForUnits = 8;
            }
            else
            {
                maxLenForUnits = numberLength == 9 ? 8 : 5;

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    maxLenForUnits --;
                }
                #endif
            }
        }
        #endif
        LimitTextLength(units,maxLenForUnits);

        if (displayMode == HMI_DISPLAY_MODE_1x6_A)
        {
            font = FONT_1;
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if ((LOCAL_Asian) && ((displayMode == HMI_DISPLAY_MODE_1x6_BAR_A) || (displayMode == HMI_DISPLAY_MODE_1x6_B) || (displayMode == HMI_DISPLAY_MODE_1x6_BAR_B)))
        {
            font = FONT_1;
        }
        #endif
        packetsBuilt += BuildWriteString(units,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineData[_1ST_LINE].lineNumber_ID,JUSTIFY_RIGHT,font,NO_INVERT,0,0,maxLenForUnits,0);
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_UOM_1X                // (1) Units of measure - blank upper line |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_UOM_1X)
    {
        #if defined(HMI_SUPPORTS_DISPLAY_MODE_3x9) || defined(HMI_SUPPORTS_DISPLAY_MODE_2x9_BAR) || defined(HMI_SUPPORTS_DISPLAY_MODE_2x9) || defined(HMI_SUPPORTS_DISPLAY_MODE_1x9_BAR) || defined(HMI_SUPPORTS_DISPLAY_MODE_1x9)
            if ((displayMode == HMI_DISPLAY_MODE_3x9)
             || (displayMode == HMI_DISPLAY_MODE_2x9_BAR)
             || (displayMode == HMI_DISPLAY_MODE_2x9)
             || (displayMode == HMI_DISPLAY_MODE_1x9_BAR)
             || (displayMode == HMI_DISPLAY_MODE_1x9))
            {
                TUSIGN8 customChar = 0x00;
                TUSIGN8 len;

                if (numberLength == 8)
                {
                    len = 8;
                }
                else
                {
                    len = numberLength == 9 ? 8 : 5;

                    #ifdef HMI_SUPPORTS_ASIAN
                    if (LOCAL_Asian)
                    {
                        len --;
                    }
                    #endif
                }
                len *= FONT1_WIDTH;

                packetsBuilt += BuildCustomCharacterString(&customChar,1,(TUSIGN8)(MAX_COMMON_HMI_WIDTH - len),(TUSIGN8)(lineData[_1ST_LINE].lineNumber_ID - 1),(TUSIGN8)(len - 1),0);
            }
            else
            {
                LOCAL_packetStage = OPERATOR_FRAME_PACKET_UOM_1X + 1;
            }
        #else
            LOCAL_packetStage = OPERATOR_FRAME_PACKET_UOM_1X + 1;
        #endif
    }

//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_VIEW_ICON             // View Icon                               |
// OPERATOR_FRAME_PACKET_MENU_ICON             // Menu Icon                               |
//---------------------------------------------//-----------------------------------------|
#ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
    if ((PacketManagerBuilderServices_IndicatorOnly())
     && (LOCAL_packetStage >= OPERATOR_FRAME_PACKET_VIEW_ICON)
     && (LOCAL_packetStage <= OPERATOR_FRAME_PACKET_MENU_ICON))
    {
        LOCAL_packetStage = OPERATOR_FRAME_PACKET_MENU_ICON + 1;
    }
#endif

//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_VIEW_ICON             // View Icon                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_VIEW_ICON)
    {
        const TUSIGN8 *pIcon = &viewIcon[PacketManagerBuilderServices_GetViewIcon(frameNumber)][0];

        #ifdef LEFT_RIGHT_LOCKOUT
        switch (FrameTableGetLeftRightLockoutState())
        {
        case WRONG_KEY_PRESSED:     pIcon = LR_Icon_WrongKey;   break;  // Exclamation mark
        case LEFT_RIGHT_ENABLED:    asm("nop");                 break;  // View Icon
        default:                    pIcon = LR_Icon_NoKey;      break;  // blank
        }
        #endif

        packetsBuilt += BuildWriteArray(pIcon, SMALL_ICON_WIDTH, 0, 7, 0);
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_MENU_ICON             // Menu Icon                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_MENU_ICON)
    {
        #ifdef EDP300_SPECIAL_FEATURES_HMI
        TBOOL ManualSensorModeActive = FrameTableGetManualSensorCheck();

        if ((LOCAL_SwitchPressedCode == KEYSTATE_UP) && (ManualSensorModeActive == eTRUE))
        {
            packetsBuilt += BuildWriteArray(FastIncAvailable_Icon, SMALL_ICON_WIDTH, (TUSIGN8)((MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH)-1), 7, 0);
        }
        else if ((LOCAL_SwitchPressedCode == (KEYSTATE_UP | KEYSTATE_RIGHT)) && (ManualSensorModeActive == eTRUE))
        {
            packetsBuilt += BuildWriteArray(FastIncActive_Icon, SMALL_ICON_WIDTH, (TUSIGN8)((MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH)-1), 7, 0);
        }
        else if ((LOCAL_SwitchPressedCode == KEYSTATE_DOWN) && (ManualSensorModeActive == eTRUE))
        {
            packetsBuilt += BuildWriteArray(FastDecAvailable_Icon, SMALL_ICON_WIDTH, (TUSIGN8)((MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH)-1), 7, 0);
        }
        else if ((LOCAL_SwitchPressedCode == (KEYSTATE_DOWN | KEYSTATE_RIGHT)) && (ManualSensorModeActive == eTRUE))
        {
            packetsBuilt += BuildWriteArray(FastDecActive_Icon, SMALL_ICON_WIDTH, (TUSIGN8)((MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH)-1), 7, 0);
        }
        else
        #endif
        {
            #ifdef LEFT_RIGHT_LOCKOUT
            const TUSIGN8 *pIcon;

            switch (FrameTableGetLeftRightLockoutState())
            {
            case WRONG_KEY_PRESSED:     pIcon = LR_Icon_WrongKey;   break;  // Exclamation mark
            case LEFT_RIGHT_ENABLED:    pIcon = menuIcon;           break;  // Menu Icon
            default:                    pIcon = LR_Icon_NoKey;      break;  // blank
            }

            packetsBuilt += BuildWriteArray(pIcon, SMALL_ICON_WIDTH, (TUSIGN8)((MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH)-1), 7, 0);

            #else

            packetsBuilt += BuildWriteIcon(ICON_MENU, (TUSIGN8)((MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH)-1), 7, 0);

            #endif
        }
    }
//---------------------------------------------//-----------------------------------------|
// OPERATOR_FRAME_PACKET_LAST_PACKET           //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_PACKET_LAST_PACKET)
    {
        packetsBuilt += BuildReadSwitches(1);
    }
//---------------------------------------------//-----------------------------------------|

    return packetsBuilt;
}

#ifdef LOW_LEVEL_HMI_TEST

const TUSIGN8 l_off_3[24]  = {0x78,0xC8,0x08,0x08,0x08,0xC8,0xC8,0xC8,0xC8,0xC8,0xC8,0xC8,0xC8,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0xC8,0x68,0x38};
const TUSIGN8 l_off_4[24]  = {0x00,0x01,0x03,0x06,0x0C,0x18,0x31,0x63,0x47,0xC7,0x8F,0x1F,0x3F,0x7E,0xE0,0x80,0x00,0x00,0x00,0xFC,0xCF,0x01,0x00,0x00};
const TUSIGN8 l_off_5[24]  = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x03,0x06,0x04,0x0D,0x18,0x10,0x10,0x10,0x13,0x1E,0x00,0x00};

const TUSIGN8 l_on_3[24]   = {0x78,0xF8,0xF8,0xF8,0xF8,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0x78,0x38};
const TUSIGN8 l_on_4[24]   = {0x00,0x01,0x03,0x07,0x0F,0x1F,0x3E,0x7C,0x78,0xF8,0xF0,0xE0,0xC0,0x81,0x1F,0x7F,0xFF,0xFF,0xFF,0xFF,0xCF,0x01,0x00,0x00};
const TUSIGN8 l_on_5[24]   = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x03,0x07,0x07,0x0E,0x1F,0x1F,0x1F,0x1F,0x1F,0x1E,0x00,0x00};

const TUSIGN8 r_off_3[24]  = {0x38,0x68,0xC8,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0xC8,0xC8,0xC8,0xC8,0xC8,0xC8,0xC8,0xC8,0x08,0x08,0x08,0xC8,0x78};
const TUSIGN8 r_off_4[24]  = {0x00,0x00,0x01,0xCF,0xFC,0x00,0x00,0x00,0x80,0xE0,0x7E,0x3F,0x1F,0x8F,0xC7,0x47,0x63,0x31,0x18,0x0C,0x06,0x03,0x01,0x00};
const TUSIGN8 r_off_5[24]  = {0x00,0x00,0x1E,0x13,0x10,0x10,0x10,0x18,0x0D,0x04,0x06,0x03,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

const TUSIGN8 r_on_3[24]   = {0x38,0x78,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0xF8,0xF8,0xF8,0xF8,0x78};
const TUSIGN8 r_on_4[24]   = {0x00,0x00,0x01,0xCF,0xFF,0xFF,0xFF,0xFF,0x7F,0x1F,0x81,0xC0,0xE0,0xF0,0xF8,0x78,0x7C,0x3E,0x1F,0x0F,0x07,0x03,0x01,0x00};
const TUSIGN8 r_on_5[24]   = {0x00,0x00,0x1E,0x1F,0x1F,0x1F,0x1F,0x1F,0x0E,0x07,0x07,0x03,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

const TUSIGN8 u_off_3a[16] = {0x00,0x00,0x80,0xC0,0x60,0x30,0x10,0x18,0x08,0x0C,0x04,0x06,0x82,0xC2,0xE2,0xF2};
const TUSIGN8 u_off_3b[15] = {0xE2,0xC2,0x82,0x06,0x04,0x0C,0x08,0x18,0x10,0x30,0x60,0xC0,0x80,0x00,0x00};

const TUSIGN8 u_off_4a[16] = {0x18,0x1E,0x17,0x11,0x10,0x10,0x10,0x10,0x10,0x10,0x12,0x13,0x13,0x13,0x13,0x13};
const TUSIGN8 u_off_4b[15] = {0x13,0x13,0x13,0x13,0x12,0x10,0x10,0x10,0x10,0x10,0x10,0x11,0x17,0x1E,0x18};

const TUSIGN8 u_on_3a[16]  = {0x00,0x00,0x80,0xC0,0xE0,0xF0,0xF0,0xF8,0xF8,0xFC,0xFC,0xFE,0x7E,0x3E,0x1E,0x0E};
const TUSIGN8 u_on_3b[15]  = {0x1E,0x3E,0x7E,0xFE,0xFC,0xFC,0xF8,0xF8,0xF0,0xF0,0xE0,0xC0,0x80,0x00,0x00};

const TUSIGN8 u_on_4a[16]  = {0x18,0x1E,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1D,0x1C,0x1C,0x1C,0x1C,0x1C};
const TUSIGN8 u_on_4b[15]  = {0x1C,0x1C,0x1C,0x1C,0x1D,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1E,0x18};

const TUSIGN8 d_off_5a[16] = {0x03,0x0F,0x3D,0x71,0xC1,0x81,0x01,0x01,0x01,0x01,0x09,0x19,0x39,0x79,0xF9,0xF9};
const TUSIGN8 d_off_5b[15] = {0xF9,0x79,0x39,0x19,0x09,0x01,0x01,0x01,0x01,0x81,0xC1,0x71,0x3D,0x0F,0x03};

const TUSIGN8 d_off_6a[16] = {0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x03,0x02,0x06,0x04,0x0C,0x08,0x08,0x08,0x09};
const TUSIGN8 d_off_6b[15] = {0x08,0x08,0x08,0x0C,0x04,0x06,0x02,0x03,0x01,0x01,0x00,0x00,0x00,0x00,0x00};

const TUSIGN8 d_on_5a[16]  = {0x03,0x0F,0x3F,0x7F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF7,0xE7,0xC7,0x87,0x07,0x07};
const TUSIGN8 d_on_5b[15]  = {0x07,0x87,0xC7,0xE7,0xF7,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x7F,0x3F,0x0F,0x03};

const TUSIGN8 d_on_6a[16]  = {0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x03,0x03,0x07,0x07,0x0F,0x0F,0x0F,0x0F,0x0E};
const TUSIGN8 d_on_6b[15]  = {0x0F,0x0F,0x0F,0x0F,0x07,0x07,0x03,0x03,0x01,0x01,0x00,0x00,0x00,0x00,0x00};

TUSIGN8 BuildLowLevelHMITestFrame(void)
{
typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_BLANK,                 // Blank entire display                    | - Start of Static Area
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_PATTERN_1,             // 1st line of display test pattern        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_PATTERN_2,             // 2nd line of display test pattern        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_PATTERN_3,             // 3rd line of display test pattern        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_PATTERN_4,             // 4th line of display test pattern        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_PATTERN_5,             // 5th line of display test pattern        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_PATTERN_6,             // 6th line of display test pattern        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_PATTERN_7,             // 7th line of display test pattern        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_PATTERN_8,             // 8th line of display test pattern        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_L_KEY_3,               // Left Key pattern                        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_L_KEY_4,               // Left Key pattern                        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_L_KEY_5,               // Left Key pattern                        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_U_KEY_3A,              // Up Key pattern                          |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_U_KEY_3B,              // Up Key pattern                          |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_U_KEY_4A,              // Up Key pattern                          |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_U_KEY_4B,              // Up Key pattern                          |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_D_KEY_5A,              // Down Key pattern                        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_D_KEY_5B,              // Down Key pattern                        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_D_KEY_6A,              // Down Key pattern                        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_D_KEY_6B,              // Down Key pattern                        |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_R_KEY_3,               // Right Key pattern                       |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_R_KEY_4,               // Right Key pattern                       |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_R_KEY_5,               // Right Key pattern                       |
                                                //-----------------------------------------|
    LL_TEST_FRAME_PACKET_READ_SWITCHES,         //                                         |
                                                //-----------------------------------------|
}LL_TEST_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;

#ifdef DISPLAY_SIZE_E
    TUSIGN8 Checkerboard1[20] = {0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
    TUSIGN8 Checkerboard2[20] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF};
    const TUSIGN8	checkerboardLen = 20;
    const TUSIGN8	checkerboardRepeat = 5;
#else
    TUSIGN8 Checkerboard1[16] = {0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
    TUSIGN8 Checkerboard2[16] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF};
    const TUSIGN8	checkerboardLen = 16;
    const TUSIGN8	checkerboardRepeat = 7;
#endif

    TUSIGN8 KeyState = LOCAL_SwitchPressedCode;
    TBOOL   KeyTest  = KeyState != 0 ? eTRUE : eFALSE;

    static TUSIGN8 prvKeyState = 0xFF;
    static TBOOL   prvKeyTest  = eTRUE;

    static TUSIGN8 Timer = 0;

    if (((LOCAL_updateStaticArea) || (KeyTest != prvKeyTest)) && (LOCAL_packetStage > LL_TEST_FRAME_PACKET_BLANK))
    {
        LOCAL_packetStage = LL_TEST_FRAME_PACKET_BLANK;
        Timer = 0;
    }

    if (KeyTest)
    {
        Timer = 0;
        if (((LOCAL_updateActiveArea) || (KeyState != prvKeyState)) && (LOCAL_packetStage > LL_TEST_FRAME_PACKET_L_KEY_3))
        {
            LOCAL_packetStage = LL_TEST_FRAME_PACKET_L_KEY_3;
        }
    }
    else
    {
        if (LOCAL_updateActiveArea)
        {
            Timer += 0x01;
            Timer &= 0x03;
        }

        if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > LL_TEST_FRAME_PACKET_PATTERN_1))
        {
            LOCAL_packetStage = LL_TEST_FRAME_PACKET_PATTERN_1;
        }
    }

    if (LOCAL_packetStage == LL_TEST_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = LL_TEST_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// LL_TEST_FRAME_PACKET_BLANK,                 // Blank entire display                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LL_TEST_FRAME_PACKET_BLANK)
    {
        packetsBuilt += BuildBlankArea(0,7,0);
    }
//---------------------------------------------//-----------------------------------------|
// LL_TEST_FRAME_PACKET_PATTERN_1,             // 1st line of display test pattern        |
// LL_TEST_FRAME_PACKET_PATTERN_2,             // 2nd line of display test pattern        |
// LL_TEST_FRAME_PACKET_PATTERN_3,             // 3rd line of display test pattern        |
// LL_TEST_FRAME_PACKET_PATTERN_4,             // 4th line of display test pattern        |
// LL_TEST_FRAME_PACKET_PATTERN_5,             // 5th line of display test pattern        |
// LL_TEST_FRAME_PACKET_PATTERN_6,             // 6th line of display test pattern        |
// LL_TEST_FRAME_PACKET_PATTERN_7,             // 7th line of display test pattern        |
// LL_TEST_FRAME_PACKET_PATTERN_8,             // 8th line of display test pattern        |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= LL_TEST_FRAME_PACKET_PATTERN_1) && (LOCAL_packetStage <= LL_TEST_FRAME_PACKET_PATTERN_8))
    {
        if (KeyTest)
        {
            LOCAL_packetStage = LL_TEST_FRAME_PACKET_PATTERN_8 + 1;
        }
        else
        {
            TUSIGN8 startPacket;
            TUSIGN8 *pCCString;
            TUSIGN8 lineNumber;
            TUSIGN8 lastPacket;

            do
            {
                if (Timer > 0x01)
                {
                    pCCString = (LOCAL_packetStage % 2) ? Checkerboard1 : Checkerboard2;
                }
                else
                {
                    pCCString = (LOCAL_packetStage % 2) ? Checkerboard2 : Checkerboard1;
                }
                lineNumber = LOCAL_packetStage - LL_TEST_FRAME_PACKET_PATTERN_1;
                lastPacket = LOCAL_packetStage == LL_TEST_FRAME_PACKET_PATTERN_8 ? 1 : 0;
                startPacket = LOCAL_packetStage;

                packetsBuilt += BuildCustomCharacterString(pCCString,checkerboardLen,0,lineNumber,checkerboardRepeat,lastPacket);
            } while ((startPacket != LOCAL_packetStage) && (LOCAL_packetStage <= LL_TEST_FRAME_PACKET_PATTERN_8));
        }
    }
//---------------------------------------------//-----------------------------------------|
// LL_TEST_FRAME_PACKET_L_KEY_3,               // Left Key pattern                        |
// LL_TEST_FRAME_PACKET_L_KEY_4,               // Left Key pattern                        |
// LL_TEST_FRAME_PACKET_L_KEY_5,               // Left Key pattern                        |
// LL_TEST_FRAME_PACKET_U_KEY_3A,              // Up Key pattern                          |
// LL_TEST_FRAME_PACKET_U_KEY_3B,              // Up Key pattern                          |
// LL_TEST_FRAME_PACKET_U_KEY_4A,              // Up Key pattern                          |
// LL_TEST_FRAME_PACKET_U_KEY_4B,              // Up Key pattern                          |
// LL_TEST_FRAME_PACKET_D_KEY_5A,              // Down Key pattern                        |
// LL_TEST_FRAME_PACKET_D_KEY_5B,              // Down Key pattern                        |
// LL_TEST_FRAME_PACKET_D_KEY_6A,              // Down Key pattern                        |
// LL_TEST_FRAME_PACKET_D_KEY_6B,              // Down Key pattern                        |
// LL_TEST_FRAME_PACKET_R_KEY_3,               // Right Key pattern                       |
// LL_TEST_FRAME_PACKET_R_KEY_4,               // Right Key pattern                       |
// LL_TEST_FRAME_PACKET_R_KEY_5,               // Right Key pattern                       |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= LL_TEST_FRAME_PACKET_L_KEY_3) && (LOCAL_packetStage <= LL_TEST_FRAME_PACKET_R_KEY_5))
    {
        if (KeyTest)
        {
            TUSIGN8 const *pArray;
            TUSIGN8 arraySize, startPacket, xPos, yPos, lastPacket;

            TUSIGN8 kl = KeyState & KEYSTATE_LEFT;
            TUSIGN8 ku = KeyState & KEYSTATE_UP;
            TUSIGN8 kd = KeyState & KEYSTATE_DOWN;
            TUSIGN8 kr = KeyState & KEYSTATE_RIGHT;

            do
            {
                switch (LOCAL_packetStage)
                {
                case LL_TEST_FRAME_PACKET_L_KEY_3:  pArray = kl ? l_on_3  : l_off_3;   arraySize = 24;  xPos = 24;  yPos = 2;  break;
                case LL_TEST_FRAME_PACKET_L_KEY_4:  pArray = kl ? l_on_4  : l_off_4;   arraySize = 24;  xPos = 24;  yPos = 3;  break;
                case LL_TEST_FRAME_PACKET_L_KEY_5:  pArray = kl ? l_on_5  : l_off_5;   arraySize = 24;  xPos = 24;  yPos = 4;  break;

                case LL_TEST_FRAME_PACKET_U_KEY_3A: pArray = ku ? u_on_3a : u_off_3a;  arraySize = 16;  xPos = 48;  yPos = 2;  break;
                case LL_TEST_FRAME_PACKET_U_KEY_3B: pArray = ku ? u_on_3b : u_off_3b;  arraySize = 15;  xPos = 64;  yPos = 2;  break;
                case LL_TEST_FRAME_PACKET_U_KEY_4A: pArray = ku ? u_on_4a : u_off_4a;  arraySize = 16;  xPos = 48;  yPos = 3;  break;
                case LL_TEST_FRAME_PACKET_U_KEY_4B: pArray = ku ? u_on_4b : u_off_4b;  arraySize = 15;  xPos = 64;  yPos = 3;  break;

                case LL_TEST_FRAME_PACKET_D_KEY_5A: pArray = kd ? d_on_5a : d_off_5a;  arraySize = 16;  xPos = 48;  yPos = 4;  break;
                case LL_TEST_FRAME_PACKET_D_KEY_5B: pArray = kd ? d_on_5b : d_off_5b;  arraySize = 15;  xPos = 64;  yPos = 4;  break;
                case LL_TEST_FRAME_PACKET_D_KEY_6A: pArray = kd ? d_on_6a : d_off_6a;  arraySize = 16;  xPos = 48;  yPos = 5;  break;
                case LL_TEST_FRAME_PACKET_D_KEY_6B: pArray = kd ? d_on_6b : d_off_6b;  arraySize = 15;  xPos = 64;  yPos = 5;  break;

                case LL_TEST_FRAME_PACKET_R_KEY_3:  pArray = kr ? r_on_3  : r_off_3;   arraySize = 24;  xPos = 80;  yPos = 2;  break;
                case LL_TEST_FRAME_PACKET_R_KEY_4:  pArray = kr ? r_on_4  : r_off_4;   arraySize = 24;  xPos = 80;  yPos = 3;  break;
                case LL_TEST_FRAME_PACKET_R_KEY_5:  pArray = kr ? r_on_5  : r_off_5;   arraySize = 24;  xPos = 80;  yPos = 4;  break;
                default:                            VIP_ASSERT(0);                                                                 break;
                }

                lastPacket = LOCAL_packetStage == LL_TEST_FRAME_PACKET_R_KEY_5 ? 1 : 0;
                startPacket = LOCAL_packetStage;
                packetsBuilt += BuildWriteArray(pArray, arraySize, xPos, yPos, lastPacket);

            } while ((startPacket != LOCAL_packetStage) && (LOCAL_packetStage <= LL_TEST_FRAME_PACKET_R_KEY_5));
        }
        else
        {
            LOCAL_packetStage = LL_TEST_FRAME_PACKET_R_KEY_5 + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
    prvKeyState = KeyState;
    prvKeyTest  = KeyTest;
    return packetsBuilt;
}

#endif  // end of #ifdef LOW_LEVEL_HMI_TEST

#ifdef HMI_SUPPORTS_GRAPH_VIEW

TUSIGN8 BuildGraphicalOperatorFrame(TUSIGN8 frameNumber)
{
typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_BLANK_AREA,        // Blank Area                              | - Start of Static Area
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_TAG,               // Tag                                     | - Start of Active Area
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_ICONFIELD_1,       // Autoscroll Icon              [12]..[18] |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_ICONFIELD_2,       // Blank                        [19]..[29] |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_ICONFIELD_3,       // Control Icon                 [30]..[53] |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_ICONFIELD_4,       // Blank                        [54]..[58] |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_ICONFIELD_5,       // Write Protect icon           [59]..[65] |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_ICONFIELD_6,       // Blank                        [66]..[70] |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_ICONFIELD_7,       // Mode icon                    [71]..[94] |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_ICONFIELD_8,       // Blank                        [95]..[113]|
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_REMOVE_DIAGNOSTICS,// Remove Diagnostics                      |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_DIAG_ICON_T,       // Diagnostics Classification Icon (Top)   |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_DIAG_ICON_B,       // Diagnostics Classification Icon (Bottom)|
                                                //-----------------------------------------|
#ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_DIAG_MESSAGE_1_16, //                                         |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_DIAG_MESSAGE_17_32,//                                         |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_DIAG_CATEGORY,     // Diagnostics Category Text               |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_BLANK_GRAPH,       // Blank the graph area                    |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_0,      // y axis - bottom                         |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_1,      // y axis                                  |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_2,      // y axis                                  |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_3,      // y axis                                  |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_4,      // y axis - top                            |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_SIGNAL_ID,         // Signal Identifier                       |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_0,      // x axis - bottom                         |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_1,      // x axis                                  |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_2,      // x axis                                  |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_3,      // x axis                                  |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_4,      // x axis - top                            |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_0,      // Trace data - bottom                     |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_1,      // Trace data                              |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_2,      // Trace data                              |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_3,      // Trace data                              |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_4,      // Trace data - top                        |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_0,      // Trace data - bottom                     |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_1,      // Trace data                              |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_2,      // Trace data                              |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_3,      // Trace data                              |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_4,      // Trace data - top                        |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_VIEW_ICON,         // View Icon                               |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_MENU_ICON,         // Menu Icon                               |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_LAST_PACKET,       //                                         |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_READ_SWITCHES      //                                         |
                                                //-----------------------------------------| - There is no keypress area
}GRAPHICAL_OPERATOR_FRAME_PACKET;

    #ifdef HMI_USES_COMMONDIAGNOSTICS
    static TUSIGN8 NAMURClassification[2];
    static TUSIGN8 NAMURCategory[2];
    static TUSIGN8 infoMessageID[2];
    #endif

    #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
    static TUSIGN8 NAMUR_ActiveAlarm[2];
    #endif

    static TBOOL   alarmActive[2];

#ifdef HMI_SUPPORTS_SERVICEPORT
    TUSIGN8        OpPageInstance = PacketManagerIsRemoteInstance() ? 1 : 0;
#else
    TUSIGN8        OpPageInstance = 0;
#endif

    TUSIGN8 packetsBuilt = 0;

    SIGNAL_TABLE_TYPE const *pSignal = NULL;

        #if defined(SECOND_OPERATOR_PAGE) || defined(THIRD_OPERATOR_PAGE) || defined(FOURTH_OPERATOR_PAGE) || defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)
    FrameTableDisableAutoscroll();
    #endif

    #if defined(SIXTH_OPERATOR_PAGE)
    if (frameNumber == 6)
    {
        pSignal = FrameTableGetSignal(SFD_MULTI_OP.mainOperatorView_6_bargraph);
    }
    else
    #endif
    {
        #if defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)
        if (frameNumber == 5)
        {
            pSignal = FrameTableGetSignal(SFD_MULTI_OP.mainOperatorView_5_bargraph);
        }
        else
        #endif
        {
            #if defined(FOURTH_OPERATOR_PAGE) || defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)
            if (frameNumber == 4)
            {
                pSignal = FrameTableGetSignal(SFD_MULTI_OP.mainOperatorView_4_bargraph);
            }
            else
            #endif
            {
                #if defined(THIRD_OPERATOR_PAGE) || defined(FOURTH_OPERATOR_PAGE) || defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)
                if (frameNumber == 3)
                {
                    pSignal = FrameTableGetSignal(SFD_MULTI_OP.mainOperatorView_3_bargraph);
                }
                else
                #endif
                {
                    #if defined(SECOND_OPERATOR_PAGE) || defined(THIRD_OPERATOR_PAGE) || defined(FOURTH_OPERATOR_PAGE) || defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)
                    if (frameNumber == 2)
                    {
                        pSignal = FrameTableGetSignal(SFD_MULTI_OP.mainOperatorView_2_bargraph);
                    }
                    else
                    #endif
                    {
                        pSignal = FrameTableGetSignal(SFD_SIMPLE.mainOperatorView_1_bargraph);
                    }
                }
            }
        }
    }
    if (TrendViewGetStatus() == HMI_TRENDVIEW_STATUS_INACTIVE)
    {
        #ifdef HMI_USES_DOUBLE
        TDOUBLE tempTrendHigh, tempTrendLow;
        #else
        TFLOAT tempTrendHigh, tempTrendLow;
        #endif

        TFLOAT TrendHigh, TrendLow;

        switch (pSignal->FixedUpperLower)
        {
        case 0:
            PacketManagerBuilderServices_GetBarRange(pSignal,&tempTrendHigh,&tempTrendLow);
            TrendHigh = (TFLOAT)tempTrendHigh;
            TrendLow  = (TFLOAT)tempTrendLow;
            break;

        case 1:
            TrendHigh = 100.0F;
            TrendLow = 0.0F;
            break;

        case 2:
            TrendHigh = 20.0F;
            TrendLow = 4.0F;
            break;

        default:
            PacketManagerBuilderServices_GetTrendRange(pSignal,&TrendHigh,&TrendLow);
            break;

        }

        TrendViewStartSampling((TUSIGN8)frameNumber,                // frameNumber
                               (TFLOAT)TrendHigh,                   // TrendHigh
                               (TFLOAT)TrendLow,                    // TrendLow
                               (TUSIGN8)pSignal->value.ssIdx,       // TrendSignal_ss
                               (TUSIGN16)pSignal->value.objIdx,     // TrendSignal_ob
                               (TINT16)pSignal->value.attribIdx);   // TrendSignal_at
    }

    if (LOCAL_updateStaticArea != 0)
    {
        LOCAL_packetStage = GRAPHICAL_OPERATOR_FRAME_BLANK_AREA;
    }

    if ((LOCAL_updateActiveArea != 0) && (LOCAL_packetStage > GRAPHICAL_OPERATOR_FRAME_TAG))
    {
        LOCAL_packetStage = GRAPHICAL_OPERATOR_FRAME_TAG;
    }

    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = GRAPHICAL_OPERATOR_FRAME_READ_SWITCHES;
    }

    // Get Alarm info
    alarmActive[OpPageInstance] = eFALSE;

    #ifdef HMI_USES_COMMONDIAGNOSTICS

    #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
        NAMUR_ActiveAlarm[OpPageInstance] = AdjusterGetNAMURStatus(&NAMURClassification[OpPageInstance], &NAMURCategory[OpPageInstance]);
    #else
        AdjusterGetNAMURStatus(&NAMURClassification[OpPageInstance], &NAMURCategory[OpPageInstance]);
    #endif

    #ifndef INFORMATION_MESSAGES_OFFSET
    infoMessageID[OpPageInstance] = 0;
    #else
    infoMessageID[OpPageInstance] = GetInfoMessageID((TBOOL)(NAMURClassification[OpPageInstance] == CLASSIFICATION_NONE));
    #endif

    if ((NAMURClassification[OpPageInstance] != CLASSIFICATION_NONE) || (infoMessageID[OpPageInstance] != 0))
    {
        alarmActive[OpPageInstance] = eTRUE;
    }
    #endif

    // Autoscroll Icon
    #if defined(SECOND_OPERATOR_PAGE) || defined(THIRD_OPERATOR_PAGE) || defined(FOURTH_OPERATOR_PAGE) || defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)
    LOCAL_displayAutoscrollIcon = FrameTableIsAutoscrollEnabled();
    #else
    LOCAL_displayAutoscrollIcon = eFALSE;
    #endif

    // Write Protect Icon
    #ifdef COMMON_TOP_WORKS_NEW_FEATURES
    TBOOL User_lock = WriteProtect_GetUserLock(eFALSE,0,0,0);
    TBOOL ARM_lock = eFALSE;

    #ifdef HMI_SUPPORTS_SECURITY_ACCESS
        if (AdjusterGetARMLevel() == ARM_ACCESS_READ_ONLY)
        {
            ARM_lock = eTRUE;
        }
        #endif

        if ((User_lock) || (ARM_lock))
        {
            LOCAL_displayWriteProtectIcon = eTRUE;
        }
        else
        {
            LOCAL_displayWriteProtectIcon = eFALSE;
        }
    #else
        TUSIGN8 HART_lock = WriteProtect_GetHARTLock();
        TUSIGN8 HMI_lock  = WriteProtect_GetHMILock();

        if (
            #ifdef HMI_SUPPORTS_SECURITY_ACCESS
            (AdjusterGetARMLevel() == ARM_ACCESS_READ_ONLY) ||
            #endif
            (HART_lock != HMI_LOCAL_OP_ENABLED) ||
            (HMI_lock  != HMI_LOCAL_OP_ENABLED))
        {
            LOCAL_displayWriteProtectIcon = eTRUE;
        }
        else
        {
            LOCAL_displayWriteProtectIcon = eFALSE;
        }
    #endif
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_BLANK_AREA         // Blank Area                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_BLANK_AREA)
    {
        packetsBuilt += BuildBlankArea(0,7,0);
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_TAG,               // Tag                                     |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_TAG)
    {
        TUSIGN8 text[21];
        text[20] = 0x00;

        TUSIGN8 extendedCharacterPage = HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN;

        switch (LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.tag_type)
        {
        case 2:     // Packed Ascii format
            #ifdef HMI_SUPPORTS_PACKEDASCII
            {
                // 20 unpacked characters = 15 packed characters
                TUSIGN8 packedtext[16] = {0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,0x00};

                // len (unpacked) cannot be more than 20 therefore len * 6 cannot be more than 120
                TUSIGN16 ssIdx = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag.ssIdx;
                TUSIGN16 obIdx = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag.objIdx;
                TUSIGN8 len = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.tag_maxCharacters;
                TUSIGN8 i;

                if (len > FONT1_MAX_CHARS-1)	// MASH ??????
                {
                    len = FONT1_MAX_CHARS-1;
                }

                i = len * 6;

                len = i / 8;
                if (i % 8)
                {
                    len ++;
                }

                for (i = 0; i < len; i++)
                {
                    // return value of "AdjusterGetAttribute()" ignored
                    AdjusterGetAttribute(ssIdx, obIdx, i, (void FAST *)&packedtext[i]);
                }

                AdjusterUnpackPASCII(packedtext, len, text);
            }
            #else
            text[0] = 0x00;
            VIP_ASSERT(0);
            #endif
            break;

        case 1:
            #ifdef HMI_SUPPORTS_STANDARDASCII
            {
                TUSIGN16 ssIdx = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag.ssIdx;
                TUSIGN16 obIdx = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag.objIdx;
                TUSIGN8 len = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.tag_maxCharacters;
                TUSIGN8 i;

                if (len > FONT1_MAX_CHARS-1)	// MASH ?????????
                {
                    len = FONT1_MAX_CHARS-1;
                }

                for (i = 0; i < len; i++)
                {
                    AdjusterGetAttribute(ssIdx, obIdx, i, (void FAST *)&text[i]);
                }
                extendedCharacterPage = FrameTableGetStringObjectExtendedCharacterPage(LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag);
            }
            #else
            text[0] = 0x00;
            VIP_ASSERT(0);
            #endif
            break;

        default:
            text[0] = 0x00;
            break;
        }
        packetsBuilt += BuildWriteString(text,extendedCharacterPage,0,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS-1,0);
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_1,       // Autoscroll Icon              [12]..[18] |
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_2,       // Blank                        [19]..[29] |
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_3,       // Control Icon                 [30]..[53] |
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_4,       // Blank                        [54]..[58] |
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_5,       // Write Protect icon           [59]..[65] |
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_6,       // Blank                        [66]..[70] |
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_7,       // Mode icon                    [71]..[94] |
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_8,       // Blank                        [95]..[113]|
// GRAPHICAL_OPERATOR_FRAME_REMOVE_DIAGNOSTICS,// Remove Diagnostics                      |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= GRAPHICAL_OPERATOR_FRAME_ICONFIELD_1)
     && (LOCAL_packetStage <= GRAPHICAL_OPERATOR_FRAME_REMOVE_DIAGNOSTICS))
    {
        if (alarmActive[OpPageInstance])
        {
            LOCAL_packetStage = GRAPHICAL_OPERATOR_FRAME_REMOVE_DIAGNOSTICS + 1;
        }
    }

//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_1,       // Autoscroll Icon              [12]..[18] |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_ICONFIELD_1)
    {
        if (LOCAL_displayAutoscrollIcon)
        {
            // Display Autoscroll Icon
            packetsBuilt += BuildCustomCharacterString(AutoscrollIcon, sizeof(AutoscrollIcon), ICONFIELD_1_START, 7, 0,0);
        }
        else
        {
            // Blank Area
            TUSIGN8 customChar = 0x00;
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_1_START, 7, (ICONFIELD_2_START - ICONFIELD_1_START) - 1,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_2,       // Blank                        [19]..[29] |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_ICONFIELD_2)
    {
        TUSIGN8 customChar = 0x00;
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_2_START, 7, (ICONFIELD_3_START - ICONFIELD_2_START) - 1,0);
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_3,       // Control Icon                 [30]..[53] |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_ICONFIELD_3)
    {
        TUSIGN8 temp_Field_3_Icon = LOCAL_Field_3_Icon;
        if (temp_Field_3_Icon > MAX_OPERATOR_DEFINED_ICONS)
        {
            temp_Field_3_Icon = 0;
        }

        if (OperatorIconInfo[temp_Field_3_Icon].valid_3 != eTRUE)
        {
            temp_Field_3_Icon = 0;
        }

        packetsBuilt += BuildWriteArray(OperatorIconInfo[temp_Field_3_Icon].pIcon, OperatorIconInfo[temp_Field_3_Icon].size, ICONFIELD_3_START, 7, 0);
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_4,       // Blank                        [54]..[58] |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_ICONFIELD_4)
    {
        TUSIGN8 customChar = 0x00;
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_4_START, 7, (ICONFIELD_5_START - ICONFIELD_4_START) - 1,0);
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_5,       // Write Protect icon           [59]..[65] |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_ICONFIELD_5)
    {
        TUSIGN8 temp_Field_5_Icon = LOCAL_Field_5_Icon;
        if (temp_Field_5_Icon > MAX_OPERATOR_DEFINED_ICONS)
        {
            LOCAL_Field_5_Icon = 0;
        }

        if (LOCAL_displayWriteProtectIcon)
        {
            temp_Field_5_Icon = 1;
        }

        if (OperatorIconInfo[temp_Field_5_Icon].valid_5 != eTRUE)
        {
            temp_Field_5_Icon = 3;
        }
        packetsBuilt += BuildWriteArray(OperatorIconInfo[temp_Field_5_Icon].pIcon, OperatorIconInfo[temp_Field_5_Icon].size, ICONFIELD_5_START, 7, 0);
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_6,       // Blank                        [66]..[70] |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_ICONFIELD_6)
    {
        TUSIGN8 customChar = 0x00;
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_6_START, 7, (ICONFIELD_7_START - ICONFIELD_6_START) - 1,0);
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_7,       // Mode icon                    [71]..[94] |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_ICONFIELD_7)
    {
        TUSIGN8 temp_Field_7_Icon = LOCAL_Field_7_Icon;
        if (temp_Field_7_Icon > MAX_OPERATOR_DEFINED_ICONS)
        {
            temp_Field_7_Icon = 0;
        }

        if (OperatorIconInfo[temp_Field_7_Icon].valid_7 != eTRUE)
        {
            temp_Field_7_Icon = 0;
        }
        packetsBuilt += BuildWriteArray(OperatorIconInfo[temp_Field_7_Icon].pIcon, OperatorIconInfo[temp_Field_7_Icon].size, ICONFIELD_7_START, 7, 0);
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_ICONFIELD_8,       // Blank                        [95]..[113]|
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_ICONFIELD_8)
    {
        TUSIGN8 customChar = 0x00;
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_8_START, 7, (ICONFIELD_END - ICONFIELD_8_START) - 1,0);
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_REMOVE_DIAGNOSTICS,// Remove Diagnostics                      |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_REMOVE_DIAGNOSTICS)
    {
        packetsBuilt += BuildBlankArea(6,6,0);
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_DIAG_ICON_T,       // Diagnostics Classification Icon (Top)   |
// GRAPHICAL_OPERATOR_FRAME_DIAG_ICON_B,       // Diagnostics Classification Icon (Bottom)|
// GRAPHICAL_OPERATOR_FRAME_DIAG_CATEGORY,     // Diagnostics Category Text               |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= GRAPHICAL_OPERATOR_FRAME_DIAG_ICON_T)
     && (LOCAL_packetStage <= GRAPHICAL_OPERATOR_FRAME_DIAG_CATEGORY))
    {
        if (alarmActive[OpPageInstance] == eFALSE)
        {
            LOCAL_packetStage = GRAPHICAL_OPERATOR_FRAME_DIAG_CATEGORY + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_DIAG_ICON_T,       // Diagnostics Classification Icon (Top)   |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_DIAG_ICON_T)
    {
        #ifdef HMI_USES_COMMONDIAGNOSTICS

            const TUSIGN8 *pIcon;

            if (infoMessageID[OpPageInstance] != 0)
            {
               pIcon = InfoMessageIcon_T;
            }
            else
            {
               pIcon = FrameTableGetDiagnosticIconAddress(NAMURClassification[OpPageInstance],0);
            }

            packetsBuilt += BuildWriteArray(pIcon,18,12,6,0);
        #else
            LOCAL_packetStage = GRAPHICAL_OPERATOR_FRAME_DIAG_CATEGORY + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_DIAG_ICON_B,       // Diagnostics Classification Icon (Bottom)|
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_DIAG_ICON_B)
    {
        #ifdef HMI_USES_COMMONDIAGNOSTICS

            const TUSIGN8 *pIcon;

            if (infoMessageID[OpPageInstance] != 0)
            {
               pIcon = InfoMessageIcon_B;
            }
            else
            {
               pIcon = FrameTableGetDiagnosticIconAddress(NAMURClassification[OpPageInstance],1);
            }

            packetsBuilt += BuildWriteArray(pIcon,18,12,7,0);

        #else
            LOCAL_packetStage = GRAPHICAL_OPERATOR_FRAME_DIAG_CATEGORY + 1;
        #endif
    }

#ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_DIAG_MESSAGE_1_16  // Diagnostics Category Text               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_DIAG_MESSAGE_1_16)
    {
        if ((PacketManagerBuilderServices_IndicatorOnly())
         && (LOCAL_flashState)
         && (infoMessageID[OpPageInstance] == 0))
        {

            LOCAL_stringtable_text_id.attribIdx = FrameTableGetDiagnosticTableEntry(NAMUR_ActiveAlarm[OpPageInstance]).descriptionID;

            TUSIGN8 PartialDescription[17];

            // Asian Description 1..8 or European Description 1..16
            PacketManagerBuilderServices_GetPartialDiagnosticDescription(FrameTableGetString(LOCAL_stringtable_text_id), 1, 16, PartialDescription);

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(PartialDescription,6,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,STRING_INVERT,0,9,9,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(PartialDescription,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,STRING_INVERT,0,0,18,0);
            }
        }
        else
        {
            LOCAL_packetStage = GRAPHICAL_OPERATOR_FRAME_DIAG_MESSAGE_17_32 + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_DIAG_MESSAGE_17_32 // Diagnostics Category Text               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_DIAG_MESSAGE_17_32)
    {
        if ((PacketManagerBuilderServices_IndicatorOnly())
         && (LOCAL_flashState)
         && (infoMessageID[OpPageInstance] == 0))
        {

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                LOCAL_packetStage ++;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = FrameTableGetDiagnosticTableEntry(NAMUR_ActiveAlarm[OpPageInstance]).descriptionID;

                TUSIGN8 PartialDescription[17];

                // European Description 1..16
                PacketManagerBuilderServices_GetPartialDiagnosticDescription(FrameTableGetString(LOCAL_stringtable_text_id), 17, 16, PartialDescription);
                packetsBuilt += BuildWriteString(PartialDescription,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,STRING_INVERT,0,0,18,0);
            }
        }
        else
        {
            LOCAL_packetStage = GRAPHICAL_OPERATOR_FRAME_DIAG_MESSAGE_17_32 + 1;
        }
    }


#endif

//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_DIAG_CATEGORY,     // Diagnostics Category Text               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_DIAG_CATEGORY)
    {
        #ifdef HMI_USES_COMMONDIAGNOSTICS
            #ifdef DISPLAY_SIZE_E
            TUSIGN8 CategoryStringLen = 13;
            #else
            TUSIGN8 CategoryStringLen = 14;
            #endif

            #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
            if (PacketManagerBuilderServices_IndicatorOnly())
            {
                CategoryStringLen = 18;
            }
            #endif

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                CategoryStringLen = (CategoryStringLen + 1) / 2;    // 13 => 7, 14 => 7, 18 => 9
            }
            #endif

            TUSIGN8 CategoryString[DIAG_CATEGORY_BUFFER_SIZE+1];
            memset(CategoryString,0x00,DIAG_CATEGORY_BUFFER_SIZE+1);

            if (CategoryStringLen > DIAG_CATEGORY_BUFFER_SIZE)
            {
                CategoryStringLen = DIAG_CATEGORY_BUFFER_SIZE;
            }

            TUSIGN8 invert;
            TUSIGN8 font = FONT_1;

            if (infoMessageID[OpPageInstance] != 0)
            {
                invert = NO_INVERT;
                #ifndef INFORMATION_MESSAGES_OFFSET
                    LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
                #else
                    #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                        LOCAL_stringtable_text_id.attribIdx = FrameTableGetDiagnosticTableEntry((TUSIGN8)(infoMessageID[OpPageInstance] + INFORMATION_MESSAGES_OFFSET)).descriptionID;
                    #else
                        LOCAL_stringtable_text_id.attribIdx = FrameTableGetDiagnosticDescriptionStringID((TUSIGN8)(infoMessageID[OpPageInstance] + INFORMATION_MESSAGES_OFFSET));
                    #endif
                #endif
            }
            else
            {
                invert = STRING_INVERT;
                #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
                if ((PacketManagerBuilderServices_IndicatorOnly()) && (LOCAL_flashState))
                {
                    LOCAL_packetStage ++;
                }
                else
                #endif
                {
                    LOCAL_stringtable_text_id.attribIdx = FrameTableGetNAMURCategoryString(NAMURCategory[OpPageInstance]);
                }
            }

            if (LOCAL_packetStage  == GRAPHICAL_OPERATOR_FRAME_DIAG_CATEGORY)
            {
                TUSIGN8 justify = JUSTIFY_LEFT_WITH_INDENT_30_PIXEL;

                #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
                if (PacketManagerBuilderServices_IndicatorOnly())
                {
                    justify = JUSTIFY_LEFT_WITH_INDENT_19_PIXEL;
                }
                #endif

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),6,justify,invert,0,CategoryStringLen,CategoryStringLen,0);
                }
                else
                #endif
                {
                    strncpy((char *)CategoryString,(const char *)FrameTableGetString(LOCAL_stringtable_text_id),(size_t)CategoryStringLen);
                    (void)LimitTextLength(CategoryString, CategoryStringLen);
                    packetsBuilt += BuildWriteString(CategoryString,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,justify,font,invert,0,0,CategoryStringLen,0);
                }
            }
        #else
            LOCAL_packetStage = GRAPHICAL_OPERATOR_FRAME_DIAG_CATEGORY + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_BLANK_GRAPH,       // Blank the graph area                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_BLANK_GRAPH)
    {
        if (TrendViewGetStatus() != HMI_TRENDVIEW_STATUS_SAMPLING)
        {
            packetsBuilt += BuildBlankArea(1,5,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_0,      // y axis - bottom                         |
// GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_1,      // y axis                                  |
// GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_2,      // y axis                                  |
// GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_3,      // y axis                                  |
// GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_4,      // y axis - top                            |
// GRAPHICAL_OPERATOR_FRAME_SIGNAL_ID,         // Signal Identifier                       |
// GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_0,      // x axis - bottom                         |
// GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_1,      // x axis                                  |
// GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_2,      // x axis                                  |
// GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_3,      // x axis                                  |
// GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_4,      // x axis - top                            |
// GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_0,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_1,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_2,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_3,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_4,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_0,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_1,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_2,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_3,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_4,      // Trace data                              |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_0)
     && (LOCAL_packetStage <= GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_4))
    {
        if (TrendViewGetStatus() != HMI_TRENDVIEW_STATUS_SAMPLING)
        {
            LOCAL_packetStage = GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_4 + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_0,      // y axis - bottom                         |
// GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_1,      // y axis                                  |
// GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_2,      // y axis                                  |
// GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_3,      // y axis                                  |
// GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_4,      // y axis - top                            |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_0)
     && (LOCAL_packetStage <= GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_4))
    {
        TUSIGN8 arrayData[26];
        TUSIGN8 row;
        TUSIGN8 startPacket;
        TUSIGN8 arrayLength;

        do
        {
            startPacket = LOCAL_packetStage;

            row = LOCAL_packetStage - GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_0;

            arrayLength = TrendViewGetYaxis(row, arrayData);

            if (arrayLength)
            {
                packetsBuilt += BuildWriteArray(arrayData, arrayLength, (TUSIGN8)(Y_AXIS_XPOS - arrayLength), (TUSIGN8)(5 - row), 0);
            }
            else
            {
                LOCAL_packetStage ++;
            }

            if (LOCAL_packetStage != startPacket)
            {
                TrendViewAcknowledgeYaxis(row);
            }
        }
        while ((LOCAL_packetStage <= GRAPHICAL_OPERATOR_FRAME_Y_AXIS_ROW_4) && (LOCAL_packetStage != startPacket));
    }

//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_SIGNAL_ID,         // Signal Identifier                       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_SIGNAL_ID)
    {
        TUSIGN8 text[SIGNAL_ID_BUFFER_SIZE+1];
        memset(text,0x00,SIGNAL_ID_BUFFER_SIZE+1);

        LOCAL_stringtable_text_id.attribIdx = pSignal->short_identifier;
        strncpy((char *)text,(const char *)FrameTableGetString(LOCAL_stringtable_text_id),SIGNAL_ID_BUFFER_SIZE);

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(text,2,JUSTIFY_LEFT,NO_INVERT,0,2,2,0);
        }
        else
        #endif
        {
            LimitTextLength(text,3);
            packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,3,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,3,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_0,      // x axis - bottom                         |
// GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_1,      // x axis                                  |
// GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_2,      // x axis                                  |
// GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_3,      // x axis                                  |
// GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_4,      // x axis - top                            |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_0)
     && (LOCAL_packetStage <= GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_4))
    {
        TUSIGN8 arrayData[2];
        TUSIGN8 row;
        TUSIGN8 startPacket;
        TUSIGN8 arrayLength;

        do
        {
            startPacket = LOCAL_packetStage;

            row = LOCAL_packetStage - GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_0;

            arrayLength = TrendViewGetXaxis(row, arrayData);

            if (arrayLength)
            {
                packetsBuilt += BuildCustomCharacterString(arrayData, arrayLength, Y_AXIS_XPOS, (TUSIGN8)(5 - row), (TUSIGN8)((100-arrayLength) / arrayLength), 0);
            }
            else
            {
                LOCAL_packetStage ++;
            }

            if (LOCAL_packetStage != startPacket)
            {
               TrendViewAcknowledgeXaxis(row);
            }
        }
        while ((LOCAL_packetStage <= GRAPHICAL_OPERATOR_FRAME_X_AXIS_ROW_4) && (LOCAL_packetStage != startPacket));
    }

//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_0,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_1,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_2,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_3,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_4,      // Trace data                              |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_0)
     && (LOCAL_packetStage <= GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_4))
    {
        TUSIGN8 arrayData[4];
        TUSIGN8 row;
        TUSIGN8 startPacket;
        TUSIGN8 arrayLength;
        TUSIGN8 plotNumber;

        do
        {
            startPacket = LOCAL_packetStage;

            row = LOCAL_packetStage - GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_0;

            arrayLength = TrendViewGetPlot(row, arrayData, &plotNumber);

            if (arrayLength)
            {
                packetsBuilt += BuildWriteArray(arrayData, arrayLength, (TUSIGN8)((Y_AXIS_XPOS - 1) + plotNumber), (TUSIGN8)(5 - row), 0);
            }
            else
            {
                LOCAL_packetStage ++;
            }

            if (LOCAL_packetStage != startPacket)
            {
                TrendViewAcknowledgePlot(row);
            }
        }
        while ((LOCAL_packetStage <= GRAPHICAL_OPERATOR_FRAME_PLOT_1_ROW_4) && (LOCAL_packetStage != startPacket));
    }

//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_0,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_1,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_2,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_3,      // Trace data                              |
// GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_4,      // Trace data                              |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_0)
     && (LOCAL_packetStage <= GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_4))
    {
        TUSIGN8 arrayData[4];
        TUSIGN8 row;
        TUSIGN8 startPacket;
        TUSIGN8 arrayLength;
        TUSIGN8 plotNumber;

        do
        {
            startPacket = LOCAL_packetStage;

            row = LOCAL_packetStage - GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_0;

            arrayLength = TrendViewGetPlot(row, arrayData, &plotNumber);

            if (arrayLength)
            {
                packetsBuilt += BuildWriteArray(arrayData, arrayLength, (TUSIGN8)((Y_AXIS_XPOS - 1) + plotNumber), (TUSIGN8)(5 - row), 0);
            }
            else
            {
                LOCAL_packetStage ++;
            }

            if (LOCAL_packetStage != startPacket)
            {
                TrendViewAcknowledgePlot(row);
            }
        }
        while ((LOCAL_packetStage <= GRAPHICAL_OPERATOR_FRAME_PLOT_2_ROW_4) && (LOCAL_packetStage != startPacket));
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_VIEW_ICON          // View Icon                               |
// GRAPHICAL_OPERATOR_FRAME_MENU_ICON          // Menu Icon                               |
//---------------------------------------------//-----------------------------------------|
#ifdef COMMON_TOP_WORKS_NEW_FEATURES    //HMI_SUPPORTS_INDICATOR_ONLY
    if ((PacketManagerBuilderServices_IndicatorOnly())
     && (LOCAL_packetStage >= GRAPHICAL_OPERATOR_FRAME_VIEW_ICON)
     && (LOCAL_packetStage <= GRAPHICAL_OPERATOR_FRAME_MENU_ICON))
    {
        LOCAL_packetStage = GRAPHICAL_OPERATOR_FRAME_MENU_ICON + 1;
    }
#endif

//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_VIEW_ICON          // View Icon                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_VIEW_ICON)
    {
        const TUSIGN8 *pIcon = &viewIcon[PacketManagerBuilderServices_GetViewIcon(frameNumber)][0];

        #ifdef LEFT_RIGHT_LOCKOUT

        switch (FrameTableGetLeftRightLockoutState())
        {
        case WRONG_KEY_PRESSED:     pIcon = LR_Icon_WrongKey;   break;  // Exclamation mark
        case LEFT_RIGHT_ENABLED:    asm("nop");                 break;  // View Icon
        default:                    pIcon = LR_Icon_NoKey;      break;  // blank
        }
        #endif

        packetsBuilt += BuildWriteArray(pIcon, SMALL_ICON_WIDTH, 0, 7, 0);
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_MENU_ICON          // Menu Icon                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_MENU_ICON)
    {
        #ifdef LEFT_RIGHT_LOCKOUT
        const TUSIGN8 *pIcon;

        switch (FrameTableGetLeftRightLockoutState())
        {
        case WRONG_KEY_PRESSED:     pIcon = LR_Icon_WrongKey;   break;  // Exclamation mark
        case LEFT_RIGHT_ENABLED:    pIcon = menuIcon;           break;  // Menu Icon
        default:                    pIcon = LR_Icon_NoKey;      break;  // blank
        }

        packetsBuilt += BuildWriteArray(pIcon, SMALL_ICON_WIDTH, (TUSIGN8)(MAX_COMMON_HMI_WIDTH - SMALL_ICON_WIDTH - 1), 7, 0);

        #else

        packetsBuilt += BuildWriteIcon(ICON_MENU, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 7, 0);

        #endif
    }
//---------------------------------------------//-----------------------------------------|
// GRAPHICAL_OPERATOR_FRAME_LAST_PACKET        //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_LAST_PACKET)
    {
        packetsBuilt += BuildReadSwitches(1);
    }
//---------------------------------------------//-----------------------------------------|
    return packetsBuilt;
}
#endif // #ifdef HMI_SUPPORTS_GRAPH_VIEW

#ifdef HMI_SUPPORTS_DISPLAY_MODE_4x9
TUSIGN8 Build4x9OperatorFrame(TUSIGN8 frameNumber)
{
typedef enum
{                                                   // Packet                                  |
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_BLANK_AREA,     // Blank Area                              | 0 - Start of Static Area
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_TAG,            // Tag                                     | 1 - Start of Active Area
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_REDRAW_DIAGNOSTICS,   //                                         | 2
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_1,    // Autoscroll Icon              [12]..[18] | 3
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_2,    // Blank                        [19]..[29] | 4
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_3,    // Control Icon                 [30]..[53] | 5
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_4,    // Blank                        [54]..[58] | 6
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_5,    // Write Protect icon           [59]..[65] | 7
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_6,    // Blank                        [66]..[70] | 8
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_7,    // Mode icon                    [71]..[94] | 9
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_8,    // Blank                        [95]..[113]| 10
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONS_COMPLETE, //                                         | 11
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_REMOVE_DIAGNOSTICS,   // Remove Diagnostics                      | 12
                                                    //-----------------------------------------|
#ifdef HMI_USES_COMMONDIAGNOSTICS
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_ICON_T,    // Diagnostics Classification Icon (Top)   | 13
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_ICON_B,    // Diagnostics Classification Icon (Bottom)| 14
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_DIAG_MESSAGE_1_16,    //                                         | 15
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_DIAG_MESSAGE_17_32,   //                                         | 16
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_CATEGORY,  // Diagnostics Category Text               | 17
                                                    //-----------------------------------------|
#endif
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_COMPLETE,  //                                         | 18
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_ID_1,                 // (1) ID                                  | 19
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_ID_2,                 // (2) ID                                  | 20
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_ID_3,                 // (3) ID                                  | 21
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_ID_4,                 // (4) ID                                  | 22
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_VALUE_1,              // (1) Value                               | 23
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_VALUE_2,              // (2) Value                               | 24
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_VALUE_3,              // (3) Value                               | 25
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_VALUE_4,              // (4) Value                               | 26
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_UNITS_1,              // (1) Units                               | 27
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_UNITS_2,              // (2) Units                               | 28
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_UNITS_3,              // (3) Units                               | 29
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_UNITS_4,              // (4) Units                               | 30
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_VIEW_ICON,            // View Icon                               | 31
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_MENU_ICON,            // Menu Icon                               | 32
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_LAST_PACKET,          //                                         | 33
                                                    //-----------------------------------------|
    OPERATOR_FRAME_4x9_PACKET_READ_SWITCHES         //                                         | 34
                                                    //-----------------------------------------| - There is no keypress area
}OPERATOR_FRAME_4x9_PACKET;

    TUSIGN8 packetsBuilt = 0;

    static TBOOL   alarmActive[2];

    #ifdef HMI_USES_COMMONDIAGNOSTICS
    static TUSIGN8 NAMUR_ActiveAlarm[2];
    static TUSIGN8 NAMURClassification[2];
    static TUSIGN8 NAMURCategory[2];
    static TUSIGN8 infoMessageID[2];
    #endif

    #ifdef HMI_SUPPORTS_SERVICEPORT
    TUSIGN8        OpPageInstance = PacketManagerIsRemoteInstance() ? 1 : 0;
    #else
    TUSIGN8        OpPageInstance = 0;
    #endif

    TUSIGN8 SignalNumber[5] = {MAX_SIGNALS,MAX_SIGNALS,MAX_SIGNALS,MAX_SIGNALS,MAX_SIGNALS};
    OPERATOR_PAGE_LINE_DATA lineData[5];
    TUSIGN8 numberLength;

    if ((LOCAL_updateStaticArea != 0) || (LOCAL_last_displayMode != HMI_DISPLAY_MODE_4x9))
    {
        LOCAL_packetStage = OPERATOR_FRAME_4x9_PACKET_STAGE_BLANK_AREA;
        LOCAL_last_displayStyle = DISPLAYSTYLE_OFF_0;
        LOCAL_last_bargraphStyle = 0;
    }

    if ((LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_BLANK_AREA) || (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_READ_SWITCHES))
    {
        // Get Alarm info -------------------------------------------------------------------------------------------------------------------
        alarmActive[OpPageInstance] = eFALSE;

        #ifdef HMI_USES_COMMONDIAGNOSTICS
        NAMUR_ActiveAlarm[OpPageInstance] = AdjusterGetNAMURStatus(&NAMURClassification[OpPageInstance], &NAMURCategory[OpPageInstance]);
        #ifndef INFORMATION_MESSAGES_OFFSET
        infoMessageID[OpPageInstance] = 0;
        #else
        infoMessageID[OpPageInstance] = GetInfoMessageID((TBOOL)(NAMURClassification[OpPageInstance] == CLASSIFICATION_NONE));
        #endif

        if ((NAMURClassification[OpPageInstance] != CLASSIFICATION_NONE) || (infoMessageID[OpPageInstance] != 0))
        {
            alarmActive[OpPageInstance] = eTRUE;
        }
        #endif

        // Update displayStyle (using "displayMode", "alarmActive"  & "asian") --------------------------------------------------------------
        LOCAL_last_displayMode = HMI_DISPLAY_MODE_4x9;
        LOCAL_last_displayStyle = LOCAL_displayStyle;
#pragma diag_suppress=Pm020
        LOCAL_displayStyle = (DISPLAYSTYLE)(HMI_DISPLAY_MODE_4x9 * 4);
#pragma diag_default=Pm020

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            LOCAL_displayStyle += 2;
        }
        #endif

        if (alarmActive[OpPageInstance])
        {
            LOCAL_displayStyle ++;
        }

        // Get Lower Line Icon Info ---------------------------------------------------------------------------------------------------------
        // Autoscroll Icon
        #if defined(SECOND_OPERATOR_PAGE) || defined(THIRD_OPERATOR_PAGE) || defined(FOURTH_OPERATOR_PAGE) || defined(FIFTH_OPERATOR_PAGE) || defined(SIXTH_OPERATOR_PAGE)
        LOCAL_displayAutoscrollIcon = FrameTableIsAutoscrollEnabled();
        #else
        LOCAL_displayAutoscrollIcon = eFALSE;
        #endif

        // Write Protect Icon
        #ifdef COMMON_TOP_WORKS_NEW_FEATURES
            TBOOL User_lock = WriteProtect_GetUserLock(eFALSE,0,0,0);
            TBOOL ARM_lock = eFALSE;

            #ifdef HMI_SUPPORTS_SECURITY_ACCESS
            if (AdjusterGetARMLevel() == ARM_ACCESS_READ_ONLY)
            {
                ARM_lock = eTRUE;
            }
            #endif

            if ((User_lock) || (ARM_lock))
            {
                LOCAL_displayWriteProtectIcon = eTRUE;
            }
            else
            {
                LOCAL_displayWriteProtectIcon = eFALSE;
            }
        #else
            TUSIGN8 HART_lock = WriteProtect_GetHARTLock();
            TUSIGN8 HMI_lock  = WriteProtect_GetHMILock();

            if (
                #ifdef HMI_SUPPORTS_SECURITY_ACCESS
                (AdjusterGetARMLevel() == ARM_ACCESS_READ_ONLY) ||
                #endif
                (HART_lock != HMI_LOCAL_OP_ENABLED) ||
                (HMI_lock  != HMI_LOCAL_OP_ENABLED))
            {
                LOCAL_displayWriteProtectIcon = eTRUE;
            }
            else
            {
                LOCAL_displayWriteProtectIcon = eFALSE;
            }
        #endif

        // Update Bargraph style ------------------------------------------------------------------------------------------------------------
        LOCAL_last_bargraphStyle = LOCAL_bargraphStyle;
        LOCAL_bargraphStyle = 0;

        // Reset Packet Stage according to display style changes ----------------------------------------------------------------------------
        // if previous style was euro without diagnostic display and new style is the same with diagnostic display
        // or previous style was euro with diagnostic display and new style is the same without diagnostic display
        if ((((LOCAL_last_displayStyle & 0x03) == 0x00) && (LOCAL_displayStyle == (LOCAL_last_displayStyle + 1)))
         || (((LOCAL_last_displayStyle & 0x01) == 0x01) && (LOCAL_displayStyle == (LOCAL_last_displayStyle - 1))))
        {
            // Update of diagnostic display area required, go back to diagnostics packet stages
            if (LOCAL_packetStage > OPERATOR_FRAME_4x9_PACKET_REDRAW_DIAGNOSTICS)
            {
                LOCAL_packetStage = OPERATOR_FRAME_4x9_PACKET_REDRAW_DIAGNOSTICS;
            }
        }
    }

    if ((LOCAL_updateActiveArea != 0) && (LOCAL_packetStage > OPERATOR_FRAME_4x9_PACKET_STAGE_TAG))
    {
        LOCAL_packetStage = OPERATOR_FRAME_4x9_PACKET_STAGE_TAG;
    }

    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = OPERATOR_FRAME_4x9_PACKET_READ_SWITCHES;
    }


//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_BLANK_AREA,     // Blank Area                              |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_BLANK_AREA)
    {
        packetsBuilt += BuildBlankArea(0,7,0);
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_TAG,            // Tag                                     |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_TAG)
    {
        TUSIGN8 text[21];
        text[20] = 0x00;

        TUSIGN8 extendedCharacterPage = HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN;

        switch (LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.tag_type)
        {
        case 2:     // Packed Ascii format
            #ifdef HMI_SUPPORTS_PACKEDASCII
            {
                // 20 unpacked characters = 15 packed characters
                TUSIGN8 packedtext[16] = {0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,0x00};

                // len (unpacked) cannot be more than 20 therefore len * 6 cannot be more than 120
                TUSIGN16 ssIdx = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag.ssIdx;
                TUSIGN16 obIdx = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag.objIdx;
                TUSIGN8 len = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.tag_maxCharacters;
                TUSIGN8 i;

                if (len > FONT1_MAX_CHARS-1)	// MASH ??????
                {
                    len = FONT1_MAX_CHARS-1;
                }

                i = len * 6;

                len = i / 8;
                if (i % 8)
                {
                    len ++;
                }

                for (i = 0; i < len; i++)
                {
                    // return value of "AdjusterGetAttribute()" ignored
                    AdjusterGetAttribute(ssIdx, obIdx, i, (void FAST *)&packedtext[i]);
                }

                AdjusterUnpackPASCII(packedtext, len, text);
            }
            #else
            text[0] = 0x00;
            VIP_ASSERT(0);
            #endif
            break;

        case 1:
            #ifdef HMI_SUPPORTS_STANDARDASCII
            {
                TUSIGN16 ssIdx = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag.ssIdx;
                TUSIGN16 obIdx = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag.objIdx;
                TUSIGN8 len = LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.tag_maxCharacters;
                TUSIGN8 i;

                if (len > FONT1_MAX_CHARS-1)	// MASH ?????????
                {
                    len = FONT1_MAX_CHARS-1;
                }

                for (i = 0; i < len; i++)
                {
                    AdjusterGetAttribute(ssIdx, obIdx, i, (void FAST *)&text[i]);
                }

                extendedCharacterPage = FrameTableGetStringObjectExtendedCharacterPage(LOCAL_pCurrDisplayFrame->frameDefinition.operatorFrame.Tag);
            }
            #else
            text[0] = 0x00;
            VIP_ASSERT(0);
            #endif
            break;

        default:
            text[0] = 0x00;
            break;
        }
        packetsBuilt += BuildWriteString(text,extendedCharacterPage,0,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS-1,0);
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_REDRAW_DIAGNOSTICS,   //                                         |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_REDRAW_DIAGNOSTICS)
    {
        LOCAL_packetStage ++;
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_1,    // Autoscroll Icon              [12]..[18] |
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_2,    // Blank                        [19]..[29] |
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_3,    // Control Icon                 [30]..[53] |
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_4,    // Blank                        [54]..[58] |
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_5,    // Write Protect icon           [59]..[65] |
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_6,    // Blank                        [66]..[70] |
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_7,    // Mode icon                    [71]..[94] |
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_8,    // Blank                        [95]..[113]|
//----------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_1)
     && (LOCAL_packetStage <= OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_8)
     && ((LOCAL_displayStyle & 0x01) != 0))                                 // Odd numbered display styles have diagnostic message - so no icons displayed
    {
        LOCAL_packetStage = OPERATOR_FRAME_4x9_PACKET_STAGE_ICONS_COMPLETE;
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_1,    // Autoscroll Icon              [12]..[18] |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_1)
    {
        const TUSIGN8 *pIcon = LOCAL_displayAutoscrollIcon ? AutoscrollIcon : Blank_Icon;
        packetsBuilt += BuildWriteArray(pIcon, sizeof(AutoscrollIcon), ICONFIELD_1_START, 7, 0);
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_2,    // Blank                        [19]..[29] |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_2)
    {
        TUSIGN8 customChar = 0x00;
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_2_START, 7, (ICONFIELD_3_START - ICONFIELD_2_START) - 1,0);
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_3,    // Control Icon                 [30]..[53] |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_3)
    {
        TUSIGN8 temp_Field_3_Icon = LOCAL_Field_3_Icon;
        if (temp_Field_3_Icon > MAX_OPERATOR_DEFINED_ICONS)
        {
            temp_Field_3_Icon = 0;
        }
        if (OperatorIconInfo[temp_Field_3_Icon].valid_3 != eTRUE)
        {
            temp_Field_3_Icon = 0;
        }
        packetsBuilt += BuildWriteArray(OperatorIconInfo[temp_Field_3_Icon].pIcon, OperatorIconInfo[temp_Field_3_Icon].size, ICONFIELD_3_START, 7, 0);
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_4,    // Blank                        [54]..[58] |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_4)
    {
        TUSIGN8 customChar = 0x00;
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_4_START, 7, (ICONFIELD_5_START - ICONFIELD_4_START) - 1,0);
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_5,    // Write Protect icon           [59]..[65] |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_5)
    {
        TUSIGN8 temp_Field_5_Icon = LOCAL_Field_5_Icon;
        if (temp_Field_5_Icon > MAX_OPERATOR_DEFINED_ICONS)
        {
            LOCAL_Field_5_Icon = 0;
        }

        if (LOCAL_displayWriteProtectIcon)
        {
            temp_Field_5_Icon = 1;
        }

        if (OperatorIconInfo[temp_Field_5_Icon].valid_5 != eTRUE)
        {
            temp_Field_5_Icon = 3;
        }
        packetsBuilt += BuildWriteArray(OperatorIconInfo[temp_Field_5_Icon].pIcon, OperatorIconInfo[temp_Field_5_Icon].size, ICONFIELD_5_START, 7, 0);
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_6,    // Blank                        [66]..[70] |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_6)
    {
        TUSIGN8 customChar = 0x00;
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_6_START, 7, (ICONFIELD_7_START - ICONFIELD_6_START) - 1,0);
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_7,    // Mode icon                    [71]..[94] |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_7)
    {
        TUSIGN8 temp_Field_7_Icon = LOCAL_Field_7_Icon;
        if (temp_Field_7_Icon > MAX_OPERATOR_DEFINED_ICONS)
        {
            temp_Field_7_Icon = 0;
        }

        if (OperatorIconInfo[temp_Field_7_Icon].valid_7 != eTRUE)
        {
            temp_Field_7_Icon = 0;
        }
        packetsBuilt += BuildWriteArray(OperatorIconInfo[temp_Field_7_Icon].pIcon, OperatorIconInfo[temp_Field_7_Icon].size, ICONFIELD_7_START, 7, 0);
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_8,    // Blank                        [95]..[113]|
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_ICONFIELD_8)
    {
        TUSIGN8 customChar = 0x00;
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, ICONFIELD_8_START, 7, (ICONFIELD_END - ICONFIELD_8_START) - 1,0);
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_ICONS_COMPLETE, //                                         |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_ICONS_COMPLETE)
    {
        LOCAL_packetStage ++;
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_REMOVE_DIAGNOSTICS,   // Remove Diagnostics                      |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_REMOVE_DIAGNOSTICS)
    {
        if ((LOCAL_displayStyle == EURO_4x9)
         || (LOCAL_displayStyle == ASIA_4x9))
        {
            packetsBuilt += BuildBlankArea(6,6,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

#ifdef HMI_USES_COMMONDIAGNOSTICS
//  Prepare data for diagnostics display
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_ICON_T,    // Diagnostics Classification Icon (Top)   |
//    OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_ICON_B,    // Diagnostics Classification Icon (Bottom)|
//    OPERATOR_FRAME_4x9_PACKET_DIAG_MESSAGE_1_16,    //                                         |
//    OPERATOR_FRAME_4x9_PACKET_DIAG_MESSAGE_17_32,   //                                         |
//    OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_CATEGORY,  // Diagnostics Category Text               |
//----------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_ICON_T)
     && (LOCAL_packetStage <= OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_CATEGORY))
    {
        if ((LOCAL_displayStyle & 0x01) != 0)   // Odd numbered display styles have diagnostic message
        {
            // Get Alarm info
            AdjusterGetNAMURStatus(&NAMURClassification[OpPageInstance], &NAMURCategory[OpPageInstance]);
        }
        else
        {
            LOCAL_packetStage = OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_COMPLETE;
        }
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_ICON_T,    // Diagnostics Classification Icon (Top)   |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_ICON_T)
    {
        const TUSIGN8 *pIcon = infoMessageID[OpPageInstance] != 0 ? InfoMessageIcon_T : FrameTableGetDiagnosticIconAddress(NAMURClassification[OpPageInstance],0);
        TUSIGN8 icon_xPos = PacketManagerBuilderServices_IndicatorOnly() ? 1 : 12;

        packetsBuilt += BuildWriteArray(pIcon,18,icon_xPos,6,0);
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_ICON_B,    // Diagnostics Classification Icon (Bottom)|
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_ICON_B)
    {
        const TUSIGN8 *pIcon = infoMessageID[OpPageInstance] != 0 ? InfoMessageIcon_B : FrameTableGetDiagnosticIconAddress(NAMURClassification[OpPageInstance],1);
        TUSIGN8 icon_xPos = PacketManagerBuilderServices_IndicatorOnly() ? 1 : 12;
        packetsBuilt += BuildWriteArray(pIcon,18,icon_xPos,7,0);
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_DIAG_MESSAGE_1_16,    //                                         |
//    OPERATOR_FRAME_4x9_PACKET_DIAG_MESSAGE_17_32,   //                                         |
//----------------------------------------------------//-----------------------------------------|
    if (((!PacketManagerBuilderServices_IndicatorOnly()) || (!LOCAL_flashState) || (infoMessageID[OpPageInstance]))
     && (LOCAL_packetStage >= OPERATOR_FRAME_4x9_PACKET_DIAG_MESSAGE_1_16)
     && (LOCAL_packetStage <= OPERATOR_FRAME_4x9_PACKET_DIAG_MESSAGE_17_32))
    {
        LOCAL_packetStage = OPERATOR_FRAME_4x9_PACKET_DIAG_MESSAGE_17_32 + 1;
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_DIAG_MESSAGE_1_16,    //                                         |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_DIAG_MESSAGE_1_16)
    {
        LOCAL_stringtable_text_id.attribIdx = FrameTableGetDiagnosticTableEntry(NAMUR_ActiveAlarm[OpPageInstance]).descriptionID;

        TUSIGN8 PartialDescription[17];

        // Asian Description 1..8 or European Description 1..16
        PacketManagerBuilderServices_GetPartialDiagnosticDescription(FrameTableGetString(LOCAL_stringtable_text_id), 1, 16, PartialDescription);

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(PartialDescription,6,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,STRING_INVERT,0,9,9,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(PartialDescription,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,STRING_INVERT,0,0,18,0);
        }
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_DIAG_MESSAGE_17_32,   //                                         |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_DIAG_MESSAGE_17_32)
    {
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            LOCAL_packetStage ++;
        }
        else
        #endif
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableGetDiagnosticTableEntry(NAMUR_ActiveAlarm[OpPageInstance]).descriptionID;

            TUSIGN8 PartialDescription[17];

            // European Description 1..16
            PacketManagerBuilderServices_GetPartialDiagnosticDescription(FrameTableGetString(LOCAL_stringtable_text_id), 17, 16, PartialDescription);
            packetsBuilt += BuildWriteString(PartialDescription,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,STRING_INVERT,0,0,18,0);
        }
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_CATEGORY,  // Diagnostics Category Text               |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_CATEGORY)
    {
        #ifdef DISPLAY_SIZE_E
        TUSIGN8 CategoryStringLen = 13;
        #else
        TUSIGN8 CategoryStringLen = 14;
        #endif

        if (PacketManagerBuilderServices_IndicatorOnly())
        {
            CategoryStringLen = 18;
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            CategoryStringLen = (CategoryStringLen + 1) / 2;    // 13 => 7, 14 => 7, 18 => 9
        }
        #endif

        TUSIGN8 CategoryString[DIAG_CATEGORY_BUFFER_SIZE+1];
        memset((void*)CategoryString,0x00,DIAG_CATEGORY_BUFFER_SIZE+1);

        if (CategoryStringLen > DIAG_CATEGORY_BUFFER_SIZE)
        {
            CategoryStringLen = DIAG_CATEGORY_BUFFER_SIZE;
        }

        TUSIGN8 invert;
        TUSIGN8 font = FONT_1;

        if (infoMessageID[OpPageInstance] != 0)
        {
            invert = NO_INVERT;
            #ifndef INFORMATION_MESSAGES_OFFSET
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            #else
                LOCAL_stringtable_text_id.attribIdx = FrameTableGetDiagnosticTableEntry((TUSIGN8)(infoMessageID[OpPageInstance] + INFORMATION_MESSAGES_OFFSET)).descriptionID;
            #endif
        }
        else
        {
            invert = STRING_INVERT;

            if ((PacketManagerBuilderServices_IndicatorOnly()) && (LOCAL_flashState))
            {
                LOCAL_packetStage ++;
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = FrameTableGetNAMURCategoryString(NAMURCategory[OpPageInstance]);
            }
        }

        if (LOCAL_packetStage  == OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_CATEGORY)
        {
            TUSIGN8 justify = JUSTIFY_LEFT_WITH_INDENT_30_PIXEL;

            if (PacketManagerBuilderServices_IndicatorOnly())
            {
                justify = JUSTIFY_LEFT_WITH_INDENT_19_PIXEL;
            }

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),6,justify,invert,0,CategoryStringLen,CategoryStringLen,0);
            }
            else
            #endif
            {
                strncpy((char *)CategoryString,(const char *)FrameTableGetString(LOCAL_stringtable_text_id),(size_t)CategoryStringLen);
                (void)LimitTextLength(CategoryString, CategoryStringLen);
                packetsBuilt += BuildWriteString(CategoryString,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,justify,font,invert,0,0,CategoryStringLen,0);
            }
        }
    }
#endif //end of #ifdef HMI_USES_COMMONDIAGNOSTICS
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_COMPLETE,  //                                         |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_STAGE_DIAG_COMPLETE)
    {
        LOCAL_packetStage ++;
    }
//  Prepare data for values display
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_ID_1,                 // (1) ID                                  |
//    OPERATOR_FRAME_4x9_PACKET_ID_2,                 // (2) ID                                  |
//    OPERATOR_FRAME_4x9_PACKET_ID_4,                 // (4) ID                                  |
//    OPERATOR_FRAME_4x9_PACKET_ID_3,                 // (3) ID                                  |
//    OPERATOR_FRAME_4x9_PACKET_VALUE_1,              // (1) Value                               |
//    OPERATOR_FRAME_4x9_PACKET_VALUE_2,              // (2) Value                               |
//    OPERATOR_FRAME_4x9_PACKET_VALUE_3,              // (3) Value                               |
//    OPERATOR_FRAME_4x9_PACKET_VALUE_4,              // (4) Value                               |
//    OPERATOR_FRAME_4x9_PACKET_UNITS_1,              // (1) Units                               |
//    OPERATOR_FRAME_4x9_PACKET_UNITS_2,              // (2) Units                               |
//    OPERATOR_FRAME_4x9_PACKET_UNITS_3,              // (3) Units                               |
//    OPERATOR_FRAME_4x9_PACKET_UNITS_4,              // (4) Units                               |
//----------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= OPERATOR_FRAME_4x9_PACKET_ID_1)
     && (LOCAL_packetStage <= OPERATOR_FRAME_4x9_PACKET_UNITS_4))
    {
        memset((void *)SignalNumber,MAX_SIGNALS,sizeof(SignalNumber));

        //SignalNumber[5] = {MAX_SIGNALS,MAX_SIGNALS,MAX_SIGNALS,MAX_SIGNALS,MAX_SIGNALS};

        switch(frameNumber)
        {
        case 6:
            #if defined(SIXTH_OPERATOR_PAGE)
                SignalNumber[4] = SFD_MULTI_OP_CTW.mainOperatorView_6_4;
                SignalNumber[3] = SFD_MULTI_OP_CTW.mainOperatorView_6_3;
                SignalNumber[2] = SFD_MULTI_OP_CTW.mainOperatorView_6_2;
                SignalNumber[1] = SFD_MULTI_OP_CTW.mainOperatorView_6_1;
            #endif
            break;

        case 5:
            #if defined(FIFTH_OPERATOR_PAGE)
            SignalNumber[4] = SFD_MULTI_OP_CTW.mainOperatorView_5_4;
            SignalNumber[3] = SFD_MULTI_OP_CTW.mainOperatorView_5_3;
            SignalNumber[2] = SFD_MULTI_OP_CTW.mainOperatorView_5_2;
            SignalNumber[1] = SFD_MULTI_OP_CTW.mainOperatorView_5_1;
            #endif
            break;

        case 4:
            #if defined(FOURTH_OPERATOR_PAGE)
            SignalNumber[4] = SFD_MULTI_OP_CTW.mainOperatorView_4_4;
            SignalNumber[3] = SFD_MULTI_OP.mainOperatorView_4_3;
            SignalNumber[2] = SFD_MULTI_OP.mainOperatorView_4_2;
            SignalNumber[1] = SFD_MULTI_OP.mainOperatorView_4_1;
            #endif
            break;

        case 3:
            #if defined(THIRD_OPERATOR_PAGE)
            SignalNumber[4] = SFD_MULTI_OP_CTW.mainOperatorView_3_4;
            SignalNumber[3] = SFD_MULTI_OP.mainOperatorView_3_3;
            SignalNumber[2] = SFD_MULTI_OP.mainOperatorView_3_2;
            SignalNumber[1] = SFD_MULTI_OP.mainOperatorView_3_1;
            #endif
            break;

        case 2:
            #if defined(SECOND_OPERATOR_PAGE)
            SignalNumber[4] = SFD_MULTI_OP_CTW.mainOperatorView_2_4;
            SignalNumber[3] = SFD_MULTI_OP.mainOperatorView_2_3;
            SignalNumber[2] = SFD_MULTI_OP.mainOperatorView_2_2;
            SignalNumber[1] = SFD_MULTI_OP.mainOperatorView_2_1;
            #endif
            break;

        case 1:
            SignalNumber[4] = SFD_SIMPLE_CTW.mainOperatorView_1_4;
            SignalNumber[3] = SFD_SIMPLE.mainOperatorView_1_3;
            SignalNumber[2] = SFD_SIMPLE.mainOperatorView_1_2;
            SignalNumber[1] = SFD_SIMPLE.mainOperatorView_1_1;
            break;

        default:
            break;
        }

        TUSIGN8 nValue;
        for (nValue = 4; nValue > 0; nValue --)
        {

            PacketManagerBuilderServices_PrepareOperatorPageLineData(nValue, SignalNumber[nValue], &lineData[nValue], LOCAL_displayStyle);

            ADJUST_DATA dataValue, HighLimit, LowLimit, Increment;
            TUSIGN8 dataType;
            TBOOL rules;

            const SIGNAL_TABLE_TYPE *pSignalInTable = FrameTableGetSignal(SignalNumber[nValue]);

            (void)AdjusterGetFloatValueAndLimits((TUSIGN16)pSignalInTable->value.ssIdx,
                                                 (TUSIGN16)pSignalInTable->value.objIdx,
                                                 pSignalInTable->value.attribIdx,
                                                 &dataValue,
                                                 &HighLimit,
                                                 &LowLimit,
                                                 &Increment,
                                                 &rules,
                                                 &dataType);

            lineData[nValue].dataValue = dataValue;
            lineData[nValue].dataType = dataType;

            #ifdef DONT_FLASH_OVERRANGE_VALUES
            rules = eFALSE;
            #endif

            if (rules)
            {
                #ifdef HMI_USES_DOUBLE
                if (dataType == ST_DOUBLE)
                {
                    lineData[nValue].ruleViolation = ((dataValue.data_D > HighLimit.data_D) || (dataValue.data_D < LowLimit.data_D)) ? eTRUE : eFALSE;
                }
                else
                #endif
                {
                    lineData[nValue].ruleViolation = ((dataValue.data_F > HighLimit.data_F) || (dataValue.data_F < LowLimit.data_F)) ? eTRUE : eFALSE;
                }
            }
            else
            {
                lineData[nValue].ruleViolation = eFALSE;
            }

            lineData[nValue].lineNumber_V               = nValue == 1 ? 1 : nValue + 1;
            lineData[nValue].lineNumber_ID              = nValue + 1;
            lineData[nValue].fontSize_V                 = nValue == 1 ? FONT_1 : FONT_0;
            lineData[nValue].justifyForValues           = JUSTIFY_RIGHT_WITH_INDENT_8;
            lineData[nValue].minLengthForValues         = 13;
            lineData[nValue].significantDigitsForValues = 12;
        }

        numberLength = 8;

        for (nValue = 4; nValue > 0; nValue --)
        {
            const SIGNAL_TABLE_TYPE *pSignalInTable = FrameTableGetSignal(SignalNumber[nValue]);
            TUSIGN8 res = pSignalInTable->dpPosn;
            TUSIGN8 tempNumberLength = 8;

            TFLOAT  tVal, limit_8chars, limit_9chars;

            PacketManagerBuilderServices_AdjustResolutionForRange(pSignalInTable, &res);        // if resolution is USE_RANGE then recalculate
            AdjusterAdjustResolutionForCustomDP(&res);                                          // if resolution is a configuarable DP position then get the actual DP position

            #ifdef HMI_USES_DOUBLE
            if (lineData[nValue].dataType == ST_DOUBLE) {tVal = (TFLOAT)lineData[nValue].dataValue.data_D;}
            else                                        {tVal = (TFLOAT)lineData[nValue].dataValue.data_F;}
            #else
            tVal = (TFLOAT)lineData[nValue].dataValue.data_F;
            #endif

            if (tVal < 0)               {tVal *= -1.0F;}
            if (res == MAX_RESOLUTION)  {res = 0;}

            switch (res)
            {
            case 0:     limit_9chars = 100000000;  limit_8chars = 10000000; break;
            case 1:     limit_9chars = 10000000;   limit_8chars = 1000000;  break;
            case 2:     limit_9chars = 1000000;    limit_8chars = 100000;   break;
            case 3:     limit_9chars = 100000;     limit_8chars = 10000;    break;
            case 4:     limit_9chars = 10000;      limit_8chars = 1000;     break;
            case 5:     limit_9chars = 1000;       limit_8chars = 100;      break;
            case 6:     limit_9chars = 100;        limit_8chars = 10;       break;
            case 7:     limit_9chars = 10;         limit_8chars = -1;       break;
            default:    limit_9chars = -1;         limit_8chars = -1;       break;
            }

            if      (tVal < limit_8chars)           { tempNumberLength = 8; }
            else if (tVal < limit_9chars)           { tempNumberLength = 9; }
            else                                    { tempNumberLength = 13;}

            if (tempNumberLength > numberLength)    { numberLength = tempNumberLength; }
        }
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_ID_1,                 // (1) ID                                  |
//    OPERATOR_FRAME_4x9_PACKET_ID_2,                 // (2) ID                                  |
//    OPERATOR_FRAME_4x9_PACKET_ID_3,                 // (3) ID                                  |
//    OPERATOR_FRAME_4x9_PACKET_ID_4,                 // (4) ID                                  |
//----------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= OPERATOR_FRAME_4x9_PACKET_ID_1)
     && (LOCAL_packetStage <= OPERATOR_FRAME_4x9_PACKET_ID_4))
    {
        TUSIGN8 startPacket, n;
        TUSIGN8 text[SIGNAL_ID_BUFFER_SIZE+1];
        TUSIGN8 SpecificLanguage = SFD_SIMPLE.language;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            SpecificLanguage = HMI_LANGUAGE_ENGLISH;
        }
        #endif

        do
        {

            startPacket = LOCAL_packetStage;
            n = (LOCAL_packetStage - OPERATOR_FRAME_4x9_PACKET_ID_1) + 1;

            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(SignalNumber[n])->short_identifier;
            strncpy((char *)text,(const char *)FrameTableGetStringSpecificLanguage(LOCAL_stringtable_text_id, SpecificLanguage),3);
            text[3] = 0x00;

            packetsBuilt += BuildWriteString(text,                                      // TUSIGN8 *suppliedText
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,  // TUSIGN8 extendedCharacterPage
                                             lineData[n].lineNumber_ID,                 // TUSIGN8 line
                                             JUSTIFY_LEFT,                              // TUSIGN8 justify
                                             FONT_0,                                    // TUSIGN8 font
                                             NO_INVERT,                                 // TUSIGN8 invert
                                             0,                                         // TUSIGN8 invchar
                                             0,                                         // TUSIGN8 blank
                                             3,                                         // TUSIGN8 minLength
                                             0);                                        // TUSIGN8 lastPacket



        }
        while ((LOCAL_packetStage <= OPERATOR_FRAME_4x9_PACKET_ID_4) && (LOCAL_packetStage != startPacket));
    }

//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_VALUE_1,              // (1) Value                               |
//    OPERATOR_FRAME_4x9_PACKET_VALUE_2,              // (2) Value                               |
//    OPERATOR_FRAME_4x9_PACKET_VALUE_3,              // (3) Value                               |
//    OPERATOR_FRAME_4x9_PACKET_VALUE_4,              // (4) Value                               |
//----------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= OPERATOR_FRAME_4x9_PACKET_VALUE_1)
     && (LOCAL_packetStage <= OPERATOR_FRAME_4x9_PACKET_VALUE_4))
    {
        TUSIGN8 startPacket, n;

        TUSIGN8 text[14], negNumber;
        TUSIGN8 i;
        const SIGNAL_TABLE_TYPE *pSignalInTable;
        TUSIGN8 resolution;
        TUSIGN8 *pStart;
        TUSIGN8 within_over_under;

        do
        {
            startPacket = LOCAL_packetStage;
            n = (LOCAL_packetStage - OPERATOR_FRAME_4x9_PACKET_VALUE_1) + 1;

            pSignalInTable = FrameTableGetSignal(SignalNumber[n]);
            resolution = pSignalInTable->dpPosn;

            PacketManagerBuilderServices_AdjustResolutionForRange(pSignalInTable, &resolution);

            #ifdef HMI_USES_DOUBLE
            if (lineData[n].dataType == ST_DOUBLE)
            {
                pStart = AdjusterBuildNumberStringFromDouble(lineData[n].dataValue.data_D, numberLength, resolution, &negNumber, &within_over_under);
            }
            else
            #endif
            {
                pStart = AdjusterBuildNumberString(lineData[n].dataValue.data_F, numberLength, resolution, &negNumber, &within_over_under);
            }

            // Number too large to convert to string. Conversion routine builds "999999"
            // Flash between "999999" and up/down arrows by building a string of arrows if flash state not set
            if (((within_over_under == 1) || (within_over_under == 2)) && (!LOCAL_flashState))
            {
                for (i = 0; i < 14; i ++)
                {
                    text[i] = 0x05 + within_over_under;
                }

                text[13] = 0x00;
                text[numberLength] = 0x00;
            }
            // Number converted to string but is outside business rules)
            // Flash between "999999" and "      " by building a string of spaces if flash state not set
            else if ((lineData[n].ruleViolation) && (!LOCAL_flashState))
            {
                for (i = 0; i < 14; i ++)
                {
                    text[i] = 0x20;
                }
                text[13] = 0x00;
                text[numberLength] = 0x00;
            }
            else
            {
                while (*pStart == 0x20)
                {
                    #pragma diag_suppress=Pm088
                    pStart ++;
                    #pragma diag_default=Pm088
                }

                text[0] = negNumber ? '-' : ' ';
                text[1] = 0x00;
                (void)strcat((char *)text,(char *)pStart);
            }

            switch (numberLength)
            {
            case 8:     lineData[n].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_8;     lineData[n].minLengthForValues = 9;     break;
            case 9:     lineData[n].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_8;     lineData[n].minLengthForValues = 10;    break;
            default:    lineData[n].justifyForValues = JUSTIFY_RIGHT_WITH_INDENT_5;     lineData[n].minLengthForValues = 13;    break;
            }

            packetsBuilt += BuildWriteString(text,                                      // TUSIGN8 *suppliedText
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,  // TUSIGN8 extendedCharacterPage
                                             lineData[n].lineNumber_V,                  // TUSIGN8 line
                                             lineData[n].justifyForValues,              // TUSIGN8 justify
                                             lineData[n].fontSize_V,                    // TUSIGN8 font
                                             NO_INVERT,                                 // TUSIGN8 invert
                                             0,                                         // TUSIGN8 invchar
                                             0,                                         // TUSIGN8 blank
                                             lineData[n].minLengthForValues,            // TUSIGN8 minLength
                                             0);                                        // TUSIGN8 lastPacket
        }
        while ((LOCAL_packetStage <= OPERATOR_FRAME_4x9_PACKET_VALUE_4) && (LOCAL_packetStage != startPacket));
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_UNITS_1,              // (1) Units                               |
//    OPERATOR_FRAME_4x9_PACKET_UNITS_2,              // (2) Units                               |
//    OPERATOR_FRAME_4x9_PACKET_UNITS_3,              // (3) Units                               |
//    OPERATOR_FRAME_4x9_PACKET_UNITS_4,              // (4) Units                               |
//----------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= OPERATOR_FRAME_4x9_PACKET_UNITS_1)
     && (LOCAL_packetStage <= OPERATOR_FRAME_4x9_PACKET_UNITS_4))
    {
        TUSIGN8 units[15];
        TUSIGN8 maxLenForUnits;
        const SIGNAL_TABLE_TYPE *pSignalInTable;
        TUSIGN8 startPacket, n;

        do
        {
            startPacket = LOCAL_packetStage;
            n = (LOCAL_packetStage - OPERATOR_FRAME_4x9_PACKET_UNITS_1) + 1;

            pSignalInTable = FrameTableGetSignal(SignalNumber[n]);

            strcpy((char *)units,
                   (const char *)PacketManagerGetEngUnits((TUSIGN16)pSignalInTable->engUnits.ssIdx,
                                                          pSignalInTable->engUnits.objIdx,
                                                          pSignalInTable->engUnits.attribIdx,
                                                          pSignalInTable->engUnitsType));

            maxLenForUnits = ((numberLength == 8) || (numberLength == 9)) ? 8 : 5;

            #ifdef HMI_SUPPORTS_CUSTOM_UNITS
            PacketManagerRemoveCustomfromUnits(units);
            #endif

            LimitTextLength(units,maxLenForUnits);


            packetsBuilt += BuildWriteString(units,                                     // TUSIGN8 *suppliedText
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,  // TUSIGN8 extendedCharacterPage
                                             lineData[n].lineNumber_ID,                 // TUSIGN8 line
                                             JUSTIFY_RIGHT,                             // TUSIGN8 justify
                                             FONT_0,                                    // TUSIGN8 font
                                             NO_INVERT,                                 // TUSIGN8 invert
                                             0,                                         // TUSIGN8 invchar
                                             0,                                         // TUSIGN8 blank
                                             maxLenForUnits,                            // TUSIGN8 minLength
                                             0);                                        // TUSIGN8 lastPacket
        }
        while ((LOCAL_packetStage <= OPERATOR_FRAME_4x9_PACKET_UNITS_4) && (LOCAL_packetStage != startPacket));
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_VIEW_ICON,            // View Icon                               |
//    OPERATOR_FRAME_4x9_PACKET_MENU_ICON,            // Menu Icon                               |
//----------------------------------------------------//-----------------------------------------|
    if ((PacketManagerBuilderServices_IndicatorOnly())
     && (LOCAL_packetStage >= OPERATOR_FRAME_4x9_PACKET_VIEW_ICON)
     && (LOCAL_packetStage <= OPERATOR_FRAME_4x9_PACKET_MENU_ICON))
    {
        LOCAL_packetStage = OPERATOR_FRAME_4x9_PACKET_MENU_ICON + 1;
    }
//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_VIEW_ICON,            // View Icon                               |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_VIEW_ICON)
    {
        const TUSIGN8 *pIcon = &viewIcon[PacketManagerBuilderServices_GetViewIcon(frameNumber)][0];

        #ifdef LEFT_RIGHT_LOCKOUT
        switch (FrameTableGetLeftRightLockoutState())
        {
        case WRONG_KEY_PRESSED:     pIcon = LR_Icon_WrongKey;   break;  // Exclamation mark
        case LEFT_RIGHT_ENABLED:    asm("nop");                 break;  // View Icon
        default:                    pIcon = LR_Icon_NoKey;      break;  // blank
        }
        #endif

        packetsBuilt += BuildWriteArray(pIcon, SMALL_ICON_WIDTH, 0, 7, 0);
    }

//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_MENU_ICON,            // Menu Icon                               |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_MENU_ICON)
    {
        #ifdef LEFT_RIGHT_LOCKOUT
        const TUSIGN8 *pIcon;

        switch (FrameTableGetLeftRightLockoutState())
        {
        case WRONG_KEY_PRESSED:     pIcon = LR_Icon_WrongKey;   break;  // Exclamation mark
        case LEFT_RIGHT_ENABLED:    pIcon = menuIcon;           break;  // Menu Icon
        default:                    pIcon = LR_Icon_NoKey;      break;  // blank
        }

        packetsBuilt += BuildWriteArray(pIcon, SMALL_ICON_WIDTH, (TUSIGN8)((MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH)-1), 7, 0);

        #else

        packetsBuilt += BuildWriteIcon(ICON_MENU, (TUSIGN8)((MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH)-1), 7, 0);

        #endif
    }

//----------------------------------------------------//-----------------------------------------|
//    OPERATOR_FRAME_4x9_PACKET_LAST_PACKET,          //                                         |
//----------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == OPERATOR_FRAME_4x9_PACKET_LAST_PACKET)
    {
        packetsBuilt += BuildReadSwitches(1);
    }
//----------------------------------------------------//-----------------------------------------|
    return packetsBuilt;
}


#endif // end of "#if HMI_SUPPORTS_DISPLAY_MODE_4x9"

#endif // end of "#if HMI_SUPPORTS_OPERATOR_FRAMES"



#ifdef HMI_SUPPORTS_GRAPH_PARAM_FRAMES
TUSIGN8 BuildGraphViewFrame(TUSIGN8 style)
{
typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PACKET_TITLE_BAR,          // Parameter title                         | - Start of Static Area
                                                //-----------------------------------------|
#ifndef DISABLE_BACK_MOVE_SELECT
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PACKET_BMS_ICON,           // BACK_MOVE_SELECT (UP/Down) Icon         |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PACKET_LEFT_KEY,           // left function key  "Back"/"Next"        |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_BLANK_GRAPH,               // Blank the graph area                    |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_Y_AXIS_ROW_0,              // y axis - bottom                         |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_Y_AXIS_ROW_1,              // y axis                                  |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_Y_AXIS_ROW_2,              // y axis                                  |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_Y_AXIS_ROW_3,              // y axis                                  |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_Y_AXIS_ROW_4,              // y axis - top                            |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_0_TO_24_ROW_0,        // Trace data - bottom                     |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_0_TO_24_ROW_1,        // Trace data                              |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_0_TO_24_ROW_2,        // Trace data                              |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_0_TO_24_ROW_3,        // Trace data                              |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_0_TO_24_ROW_4,        // Trace data - top                        |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_25_TO_49_ROW_0,       // Trace data - bottom                     |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_25_TO_49_ROW_1,       // Trace data                              |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_25_TO_49_ROW_2,       // Trace data                              |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_25_TO_49_ROW_3,       // Trace data                              |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_25_TO_49_ROW_4,       // Trace data - top                        |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_50_TO_74_ROW_0,       // Trace data - bottom                     |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_50_TO_74_ROW_1,       // Trace data                              |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_50_TO_74_ROW_2,       // Trace data                              |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_50_TO_74_ROW_3,       // Trace data                              |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_50_TO_74_ROW_4,       // Trace data - top                        |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_75_TO_99_ROW_0,       // Trace data - bottom                     |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_75_TO_99_ROW_1,       // Trace data                              |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_75_TO_99_ROW_2,       // Trace data                              |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_75_TO_99_ROW_3,       // Trace data                              |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PLOT_75_TO_99_ROW_4,       // Trace data - top                        |
                                                //-----------------------------------------|
    GRAPH_VIEW_FRAME_PACKET_LEFT_KEY_REPEAT,    // left function key  "Back"/"Next"        |
                                                //-----------------------------------------|
    GRAPHICAL_OPERATOR_FRAME_READ_SWITCHES      //                                         |
                                                //-----------------------------------------| - There is no keypress area - There is no active area
}GRAPH_VIEW_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = GRAPH_VIEW_FRAME_PACKET_TITLE_BAR;
    }

    if (LOCAL_packetStage == GRAPHICAL_OPERATOR_FRAME_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = GRAPHICAL_OPERATOR_FRAME_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// GRAPH_VIEW_FRAME_PACKET_TITLE_BAR,          // Parameter title                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPH_VIEW_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.graphParamFrame.title_attribidx;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),MAX_ASIAN_TITLE_LEN,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }

#ifndef DISABLE_BACK_MOVE_SELECT
//---------------------------------------------//-----------------------------------------|
// GRAPH_VIEW_FRAME_PACKET_BMS_ICON,           // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPH_VIEW_FRAME_PACKET_BMS_ICON)
    {
        if (!FrameTableIsBackMoveSelectAvailable(LOCAL_pCurrDisplayFrame))
        {
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 customChar[9] = {0x00,0x00,0x24,0x66,0xE7,0x66,0x24,0x00,0x00};
            packetsBuilt += BuildCustomCharacterString(customChar, 9, UP_DOWN_ICON_POS, 7, 0, 0);
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// GRAPH_VIEW_FRAME_PACKET_LEFT_KEY,           // left function key  "Back"/"Next"        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPH_VIEW_FRAME_PACKET_LEFT_KEY)
    {
        #ifdef HMI_SUPPORTS_SEQUENCES
        if (FrameTableIsSequenceEnabled())
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_EASYSETUP
            if (LOCAL_pCurrDisplayFrame->frameDefinition.graphParamFrame.easySetupFlag != 0)
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
            }
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            TUSIGN8 text[9]
            if (LOCAL_stringtable_text_id.attribIdx == IDS_NEXT)
            {
                text[0] = 'N';
                text[1] = 'e';
                text[2] = 'x';
                text[3] = 't';
                text[4] = 0x00;
            }
            else if (LOCAL_stringtable_text_id.attribIdx == IDS_BACK)
            {
                text[0] = 'B';
                text[1] = 'a';
                text[2] = 'c';
                text[3] = 'k';
                text[4] = 0x00;
            }
            else
            {
                text[0] = 0x00;
            }
            packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// GRAPH_VIEW_FRAME_BLANK_GRAPH,               // Blank the graph area                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPH_VIEW_FRAME_BLANK_GRAPH)
    {
        switch (TrendViewGetStatus())
        {
        case HMI_TRENDVIEW_STATUS_INACTIVE:
            TrendViewStartArrayCalculation((TUSIGN8)LOCAL_pCurrDisplayFrame->frameDefinition.graphParamFrame.value.ssIdx,
                                           (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.graphParamFrame.value.objIdx);
            LOCAL_packetStage ++;
            break;

        case HMI_TRENDVIEW_STATUS_ARRAY_VIEW:
            LOCAL_packetStage ++;
            break;

        case HMI_TRENDVIEW_STATUS_SAMPLING:
        default:
            packetsBuilt += BuildBlankArea(2,6,0);
            break;
        }
    }

//---------------------------------------------//-----------------------------------------|
// GRAPH_VIEW_FRAME_Y_AXIS_ROW_0,              // y axis - bottom                         |
// GRAPH_VIEW_FRAME_Y_AXIS_ROW_1,              // y axis                                  |
// GRAPH_VIEW_FRAME_Y_AXIS_ROW_2,              // y axis                                  |
// GRAPH_VIEW_FRAME_Y_AXIS_ROW_3,              // y axis                                  |
// GRAPH_VIEW_FRAME_Y_AXIS_ROW_4,              // y axis - top                            |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= GRAPH_VIEW_FRAME_Y_AXIS_ROW_0)
     && (LOCAL_packetStage <= GRAPH_VIEW_FRAME_Y_AXIS_ROW_4))
    {
        if (TrendViewGetStatus() == HMI_TRENDVIEW_STATUS_ARRAY_VIEW)
        {
            TUSIGN8 arrayData[26];
            TUSIGN8 row;
            TUSIGN8 startPacket;
            TUSIGN8 arrayLength;

            do
            {
                startPacket = LOCAL_packetStage;

                row = LOCAL_packetStage - GRAPH_VIEW_FRAME_Y_AXIS_ROW_0;

                arrayLength = TrendViewGetYaxis(row, arrayData);
                if (arrayLength)
                {
                    packetsBuilt += BuildWriteArray(arrayData, arrayLength, (TUSIGN8)(Y_AXIS_XPOS - arrayLength), (TUSIGN8)(6 - row), 0);
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
            while ((LOCAL_packetStage <= GRAPH_VIEW_FRAME_Y_AXIS_ROW_4) && (LOCAL_packetStage != startPacket));
        }
        else
        {
            LOCAL_packetStage = GRAPH_VIEW_FRAME_Y_AXIS_ROW_4 + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// GRAPH_VIEW_FRAME_PLOT_0_TO_24_ROW_0,        // Trace data - bottom                     |
// GRAPH_VIEW_FRAME_PLOT_0_TO_24_ROW_1,        // Trace data                              |
// GRAPH_VIEW_FRAME_PLOT_0_TO_24_ROW_2,        // Trace data                              |
// GRAPH_VIEW_FRAME_PLOT_0_TO_24_ROW_3,        // Trace data                              |
// GRAPH_VIEW_FRAME_PLOT_0_TO_24_ROW_4,        // Trace data - top                        |
//                                                                                        |
// GRAPH_VIEW_FRAME_PLOT_25_TO_49_ROW_0,       // Trace data - bottom                     |
// GRAPH_VIEW_FRAME_PLOT_25_TO_49_ROW_1,       // Trace data                              |
// GRAPH_VIEW_FRAME_PLOT_25_TO_49_ROW_2,       // Trace data                              |
// GRAPH_VIEW_FRAME_PLOT_25_TO_49_ROW_3,       // Trace data                              |
// GRAPH_VIEW_FRAME_PLOT_25_TO_49_ROW_4,       // Trace data - top                        |
//                                                                                        |
// GRAPH_VIEW_FRAME_PLOT_50_TO_74_ROW_0,       // Trace data - bottom                     |
// GRAPH_VIEW_FRAME_PLOT_50_TO_74_ROW_1,       // Trace data                              |
// GRAPH_VIEW_FRAME_PLOT_50_TO_74_ROW_2,       // Trace data                              |
// GRAPH_VIEW_FRAME_PLOT_50_TO_74_ROW_3,       // Trace data                              |
// GRAPH_VIEW_FRAME_PLOT_50_TO_74_ROW_4,       // Trace data - top                        |
//                                                                                        |
// GRAPH_VIEW_FRAME_PLOT_75_TO_99_ROW_0,       // Trace data - bottom                     |
// GRAPH_VIEW_FRAME_PLOT_75_TO_99_ROW_1,       // Trace data                              |
// GRAPH_VIEW_FRAME_PLOT_75_TO_99_ROW_2,       // Trace data                              |
// GRAPH_VIEW_FRAME_PLOT_75_TO_99_ROW_3,       // Trace data                              |
// GRAPH_VIEW_FRAME_PLOT_75_TO_99_ROW_4,       // Trace data - top                        |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= GRAPH_VIEW_FRAME_PLOT_0_TO_24_ROW_0)
     && (LOCAL_packetStage <= GRAPH_VIEW_FRAME_PLOT_75_TO_99_ROW_4))
    {
        if (TrendViewGetStatus() == HMI_TRENDVIEW_STATUS_ARRAY_VIEW)
        {
            TUSIGN8 arrayData[26];
            TUSIGN8 row;
            TUSIGN8 firstPlot;
            TUSIGN8 startPacket;

            do
            {
                startPacket = LOCAL_packetStage;
                row = (LOCAL_packetStage - GRAPH_VIEW_FRAME_PLOT_0_TO_24_ROW_0) % 5;
                firstPlot = ((LOCAL_packetStage - GRAPH_VIEW_FRAME_PLOT_0_TO_24_ROW_0) / 5) * 25;

                if (TrendViewGet25plots(firstPlot, row, arrayData, style))
                {
                    packetsBuilt += BuildWriteArray(arrayData, 25, (TUSIGN8)(Y_AXIS_XPOS + firstPlot), (TUSIGN8)(6 - row), 0);
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
            while ((LOCAL_packetStage <= GRAPH_VIEW_FRAME_PLOT_75_TO_99_ROW_4) && (LOCAL_packetStage != startPacket));
        }
        else
        {
            LOCAL_packetStage = GRAPH_VIEW_FRAME_PLOT_75_TO_99_ROW_4 + 1;
        }
    }

//---------------------------------------------//-----------------------------------------|
// GRAPH_VIEW_FRAME_PACKET_LEFT_KEY_REPEAT,    // left function key  "Back"/"Next"        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == GRAPH_VIEW_FRAME_PACKET_LEFT_KEY_REPEAT)
    {
        #ifdef HMI_SUPPORTS_SEQUENCES
        if (FrameTableIsSequenceEnabled())
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_EASYSETUP
            if (LOCAL_pCurrDisplayFrame->frameDefinition.graphParamFrame.easySetupFlag != 0)
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
            }
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            TUSIGN8 text[9]
            if (LOCAL_stringtable_text_id.attribIdx == IDS_NEXT)
            {
                text[0] = 'N';
                text[1] = 'e';
                text[2] = 'x';
                text[3] = 't';
                text[2] = 0x00;
            }
            else if (LOCAL_stringtable_text_id.attribIdx == IDS_BACK)
            {
                text[0] = 'B';
                text[1] = 'a';
                text[2] = 'c';
                text[3] = 'k';
                text[2] = 0x00;
            }
            else
            {
                text[0] = 0x00;
            }
            packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,1);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,1);
        }
    }
//---------------------------------------------//-----------------------------------------|
    return packetsBuilt;
}
#endif  // end of #ifdef HMI_SUPPORTS_GRAPH_PARAM_FRAMES


#ifdef HMI_SUPPORTS_CONFIG_HEADER_FRAMES

const TUSIGN8 icon_xPos[6] =
{
    ((MAX_CONFIG_WIDTH)/2) - LARGE_ICON_SPLIT_WIDTH,  // Icon top left
    ((MAX_CONFIG_WIDTH)/2),                           // Icon top right
    ((MAX_CONFIG_WIDTH)/2) - LARGE_ICON_SPLIT_WIDTH,  // Icon middle left
    ((MAX_CONFIG_WIDTH)/2),                           // Icon middle right
    ((MAX_CONFIG_WIDTH)/2) - LARGE_ICON_SPLIT_WIDTH,  // Icon bottom left
    ((MAX_CONFIG_WIDTH)/2),                           // Icon bottom right
};

const TUSIGN8 icon_yPos[6] =
{
    3,  // Icon top left
    3,  // Icon top right
    4,  // Icon middle left
    4,  // Icon middle right
    5,  // Icon bottom left
    5,  // Icon bottom right
};

// No restriction on the optimization of this function
TUSIGN8 BuildConfigHeader(void)
{
typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    CFH_FRAME_PACKET_TITLE_BAR,                 // Title Bar                               | - Start of Static Area - Start of keypress area
                                                //-----------------------------------------|
    CFH_FRAME_PACKET_TITLE,                     // Config header name eg "Device"          |
                                                //-----------------------------------------|
    CFH_FRAME_PACKET_SLIDER_BAR,                // Slider bar                              |
                                                //-----------------------------------------|
    CFH_FRAME_RIGHT_KEY,                        // right function key "Select"             |
                                                //-----------------------------------------|
#ifdef COMMON_TOP_WORKS_NEW_FEATURES    //SHOW_LOGIN_LEVEL
  #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
                                                //-----------------------------------------|
    CFH_FRAME_LOGIN_LEVEL_6,                    // Login level Icon (on line 6)            |
                                                //-----------------------------------------|
  #endif
                                                //-----------------------------------------|
    CFH_FRAME_LOGIN_LEVEL_7,                    // Login level Icon (on Line 7)            |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    CFH_FRAME_ICON_TL,                          // Icon top left                           | - Start of Active Area
                                                //-----------------------------------------|
    CFH_FRAME_ICON_TR,                          // Icon top right                          |
                                                //-----------------------------------------|
    CFH_FRAME_ICON_CL,                          // Icon middle left                        |
                                                //-----------------------------------------|
    CFH_FRAME_ICON_CR,                          // Icon middle right                       |
                                                //-----------------------------------------|
    CFH_FRAME_ICON_BL,                          // Icon bottom left                        |
                                                //-----------------------------------------|
    CFH_FRAME_ICON_BR,                          // Icon bottom right                       |
                                                //-----------------------------------------|
    CFH_FRAME_LEFT_KEY,                         //left function key  "Exit"                |
                                                //-----------------------------------------|
    CFH_FRAME_READ_SWITCHES                     //                                         |
                                                //-----------------------------------------|
}CFH_FRAME_PACKET;

        TUSIGN8 startPacket;
        TUSIGN8 packetsBuilt = 0;


        if ((LOCAL_updateActiveArea) || (LOCAL_updateStaticArea))
        {
            if (LOCAL_packetStage > CFH_FRAME_ICON_TL)
            {
                LOCAL_packetStage = CFH_FRAME_ICON_TL;
            }

            LOCAL_iconStage ++;

            if ((LOCAL_iconStage >= 6) || (LOCAL_pCurrDisplayFrame->frameDefinition.configHeaderFrame.icon[LOCAL_iconStage] == 0))
            {
                LOCAL_iconStage = 0;
            }
        }

        if ((LOCAL_updateStaticArea) || (LOCAL_keypressProcessed))
        {
                LOCAL_packetStage = CFH_FRAME_PACKET_TITLE_BAR;
                LOCAL_iconStage = 0;
        }

        if (LOCAL_packetStage == CFH_FRAME_READ_SWITCHES)
        {
            packetsBuilt += BuildReadSwitches(1);
            LOCAL_packetStage = CFH_FRAME_READ_SWITCHES;
        }
//---------------------------------------------//-----------------------------------------|
// CFH_FRAME_PACKET_TITLE_BAR                  // Title Bar                               |
//---------------------------------------------//-----------------------------------------|
        if (LOCAL_packetStage == CFH_FRAME_PACKET_TITLE_BAR)
        {
#ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                #if defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION)
                LOCAL_stringtable_text_id.attribIdx = IDS_MENU;
                #else
                LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.configHeaderFrame.title_attribidx;
                #endif
                packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),8,0);
            }
            else
#endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_MENU;
                packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
            }
        }
//---------------------------------------------//-----------------------------------------|
// CFH_FRAME_PACKET_TITLE,                     // Config header name eg "Device"          |
//---------------------------------------------//-----------------------------------------|
        if (LOCAL_packetStage == CFH_FRAME_PACKET_TITLE)
        {
#ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                #if defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION)
                    LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.configHeaderFrame.title_attribidx;
                    #ifdef DISPLAY_SIZE_E
                        packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),1,JUSTIFY_CENTRE,NO_INVERT,1,ASIAN_MAX_CHARS,ASIAN_MAX_CHARS,0);
                    #else
                        packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_CENTRE,NO_INVERT,1,ASIAN_MAX_CHARS,ASIAN_MAX_CHARS,0);
                    #endif
                #else
                    LOCAL_packetStage ++;
                #endif
            }
            else
#endif
            {
                LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.configHeaderFrame.title_attribidx;
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,1,JUSTIFY_CENTRE,FONT_1,NO_INVERT,0,1,1,0);
            }
        }
//---------------------------------------------//-----------------------------------------|
// CFH_FRAME_PACKET_SLIDER_BAR,                // Slider bar                              |
//---------------------------------------------//-----------------------------------------|
        if (LOCAL_packetStage == CFH_FRAME_PACKET_SLIDER_BAR)
        {
            #pragma diag_suppress=Pm088
            packetsBuilt += BuildSliderBar((TINT16)(FrameTableGetConfigHeaderAddress(1) - FrameTableGetConfigHeaderAddress(0)),(TINT16)(LOCAL_pCurrDisplayFrame - FrameTableGetConfigHeaderAddress(0)),0);
            #pragma diag_default=Pm088

        }
//---------------------------------------------//-----------------------------------------|
// CFH_FRAME_RIGHT_KEY,                        // right function key "Select"             |
//---------------------------------------------//-----------------------------------------|
        if (LOCAL_packetStage == CFH_FRAME_RIGHT_KEY)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_SELECT;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,0);
            }
        }

//---------------------------------------------//-----------------------------------------|
// CFH_FRAME_LOGIN_LEVEL_6,                    // Login level Icon                        |
//---------------------------------------------//-----------------------------------------|
  #if defined (COMMON_TOP_WORKS_NEW_FEATURES) && defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)    //SHOW_LOGIN_LEVEL
    if (LOCAL_packetStage == CFH_FRAME_LOGIN_LEVEL_6)
    {
        if (LOCAL_Asian)
        {
            TUSIGN8 IconID = ARM_ACCESS_INVALID;

            #ifdef HMI_SUPPORTS_SECURITY_ACCESS
            IconID = AdjusterGetARMLevel();
            #endif

            packetsBuilt += PacketManagerBuilderServices_ShowLoginIcon(IconID,6,LOGIN_ICON_T);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// CFH_FRAME_LOGIN_LEVEL_7,                    // Login level Icon                        |
//---------------------------------------------//-----------------------------------------|
#ifdef COMMON_TOP_WORKS_NEW_FEATURES    //SHOW_LOGIN_LEVEL
    if (LOCAL_packetStage == CFH_FRAME_LOGIN_LEVEL_7)
    {
        #if defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION)
            TUSIGN8 iconID = ICON_ARM_LOGOUT;

            #ifdef HMI_SUPPORTS_SECURITY_ACCESS
            switch (AdjusterGetARMLevel())
            {
            case ARM_ACCESS_SERVICE:    iconID = ICON_ARM_SERVICE_LEVEL;    break;
            case ARM_ACCESS_ADVANCED:   iconID = ICON_ARM_ADVANCED_LEVEL;   break;
            case ARM_ACCESS_STANDARD:   iconID = ICON_ARM_STANDARD_LEVEL;   break;
            case ARM_ACCESS_READ_ONLY:  iconID = ICON_ARM_READONLY_LEVEL;   break;
            default:                    iconID = ICON_ARM_LOGOUT;           break;
            }
            #endif

            packetsBuilt += BuildWriteIcon(iconID, 0, 7, 0);
        #else

            TUSIGN8 IconID = ARM_ACCESS_INVALID;

            #ifdef HMI_SUPPORTS_SECURITY_ACCESS
            IconID = AdjusterGetARMLevel();
            #endif


            TUSIGN8 part = LOGIN_ICON;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                part = LOGIN_ICON_B;
            }
            #endif

            packetsBuilt += PacketManagerBuilderServices_ShowLoginIcon(IconID,7,part);
        #endif
    }
#endif
//---------------------------------------------//-----------------------------------------|
// CFH_FRAME_ICON_TL,                          // Icon top left                           | - Start of Active Area
// CFH_FRAME_ICON_TR,                          // Icon top right                          |
// CFH_FRAME_ICON_CL,                          // Icon middle left                        |
// CFH_FRAME_ICON_CR,                          // Icon middle right                       |
// CFH_FRAME_ICON_BL,                          // Icon bottom left                        |
// CFH_FRAME_ICON_BR,                          // Icon bottom right                       |
//---------------------------------------------//-----------------------------------------|
        if ((LOCAL_packetStage >= CFH_FRAME_ICON_TL) && (LOCAL_packetStage <= CFH_FRAME_ICON_BR))
        {
            #if !defined (TYPE_4_IMPLEMENTATION) && !defined (TYPE_5_IMPLEMENTATION)
            TUSIGN8 iconNum = LOCAL_pCurrDisplayFrame->frameDefinition.configHeaderFrame.icon[LOCAL_iconStage];
            TUSIGN8 iconPart;
            TUSIGN8 const *iconAddr;
            #endif

            TUSIGN8 iconLineOffset = LOCAL_Asian? 0 : 1;
            do
            {
                startPacket = LOCAL_packetStage;

                #if !defined (TYPE_4_IMPLEMENTATION) && !defined (TYPE_5_IMPLEMENTATION)

                iconPart = FrameTableGetConfigIconPart(iconNum,(TUSIGN8)(LOCAL_packetStage - CFH_FRAME_ICON_TL));
                iconAddr = FrameTableGetConfigIconAddress(&iconPart);

                if (iconAddr == NULL)
                {
                    // pre-defined icon
                    packetsBuilt += BuildWriteIcon(iconPart,
                                                   icon_xPos[LOCAL_packetStage - CFH_FRAME_ICON_TL],
                                                   (TUSIGN8)(icon_yPos[LOCAL_packetStage - CFH_FRAME_ICON_TL] + iconLineOffset),
                                                   0);
                }
                else
                {
                    // configurable icon
                    packetsBuilt += BuildWriteArray(iconAddr,
                                                    LARGE_ICON_SPLIT_WIDTH,
                                                    icon_xPos[LOCAL_packetStage - CFH_FRAME_ICON_TL],
                                                    (TUSIGN8)(icon_yPos[LOCAL_packetStage - CFH_FRAME_ICON_TL] + iconLineOffset),
                                                    0);
                }

                #else

                // Structure used for finding correct animation
                typedef const struct
                {
                    TUSIGN8 firstAnimationStage;        // First stage of animation for header
                    CONFIG_HEADER_TYPE configHeader;    // Configuration header
                }CONFIG_HEADER_INFO;

                CONFIG_HEADER_INFO configHeaderTable[MAX_CONFIG_HEADERS] =
                {
                    {ICON_PART_DEVICE_COLOUR_1,CFH_CONTROL_DEVICE_C},           // Device Setup
                    {ICON_PART_DISPLAY_COLOUR_1,CFH_DISPLAY_C},                 // Display
                    {ICON_PART_IO_COLOUR_1,CFH_IO_C},                           // Input/Output
                    {ICON_PART_CONTROL_COLOUR_1,CFH_CONTROL_C},                 // Control
                    {ICON_PART_ALARM_COLOUR_1,CFH_PROCESS_ALARM_C},             // Process Alarms
                    {ICON_PART_PROFILE_COLOUR_1,CFH_PROFILE_C},                 // Profile
                    {ICON_PART_TOTALIZER_COLOUR_1,CFH_TOTALIZER_C},             // Totalizer
                    {ICON_PART_FUNCTIONS_COLOUR_1,CFH_FUNCTIONS_C},             // Functions
                    {ICON_PART_COMMS_COLOUR_1,CFH_COMMUNICATION_C},             // Communication
                    {ICON_PART_DIAGNOSTICS_COLOUR_1,CFH_DIAGNOSTICS_C},         // Diagnostics
                    {ICON_PART_SERVICE_COLOUR_1,CFH_SERVICE_C},                 // Service
                    {ICON_PART_DEVICE_INFO_COLOUR_1,CFH_DEVICE_INFO_C},         // Device Info
                    {ICON_PART_BASIC_SETUP_COLOUR_1,CFH_BASIC_SETUP},           // Basic Setup
                    {ICON_PART_CALIBRATE_COLOUR_1,CFH_CALIBRATE_C},             // Calibrate
                    {ICON_PART_SENSOR_SETUP_COLOUR_1,CFH_FLOW_SENSOR_SETUP_C},  // Sensor Setup                      // TODO - CFH_FLOW_SENSOR_SETUP_C is temp
                    {ICON_PART_MEDIACARD_COLOUR_1,CFH_MEDIA_CARD},              // Media Card
                };

                // Match the current configuration header ID with the first stage animation
                const TUSIGN8 configHeader = LOCAL_pCurrDisplayFrame->frameDefinition.configHeaderFrame.iconID;
                TUSIGN8 header=0;
                for(; header < MAX_CONFIG_HEADERS; header++)
                {
                    if(configHeader == configHeaderTable[header].configHeader)
                    {
                        break;
                    }
                }

                VIP_ASSERT(header<MAX_CONFIG_HEADERS);

                if (header<MAX_CONFIG_HEADERS)
                {
                    // Write first stage icon (subsequent stages are handled in the driver)
                    packetsBuilt += BuildWriteIcon(configHeaderTable[header].firstAnimationStage,
                                                   icon_xPos[LOCAL_packetStage - CFH_FRAME_ICON_TL],
                                                   (TUSIGN8)(icon_yPos[LOCAL_packetStage - CFH_FRAME_ICON_TL] + iconLineOffset),
                                                   0);
                }
                else
                {
                    // Header ID has not been found - skip stage
                    LOCAL_packetStage ++;
                }
                #endif // #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)

            } while ((startPacket != LOCAL_packetStage) && (LOCAL_packetStage <= CFH_FRAME_ICON_BR));
        }
//---------------------------------------------//-----------------------------------------|
// CFH_FRAME_LEFT_KEY,                         //left function key  "Exit"                |
//---------------------------------------------//-----------------------------------------|
        if (LOCAL_packetStage == CFH_FRAME_LEFT_KEY)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_EXIT;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,1);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,1);
            }
        }
        return packetsBuilt;
}
// end of "#if HMI_SUPPORTS_CONFIG_HEADER_FRAMES"
#endif


#ifdef HMI_SUPPORTS_MENU_FRAMES
// No restriction on the optimization of this function
TUSIGN8 BuildMenuFrame(void)
{

typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_TITLE_BAR,                // Title Bar                               | - Start of Static Area
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_LEFT_KEY,                 // left function key  "Back"               |
                                                //-----------------------------------------|
#ifdef COMMON_TOP_WORKS_NEW_FEATURES    //SHOW_LOGIN_LEVEL
  #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_LOGIN_LEVEL_6,            // Login level Icon (on line 6)            |
                                                //-----------------------------------------|
  #endif
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_LOGIN_LEVEL_7,            // Login level Icon (on line 7)            |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_MENU_ITEM_1,              // Menu Item (1/3) (1/4) (1/5) (1/6)       | - Start of keypress area - Start of active area for Signals view menu
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_MENU_ITEM_2,              // Menu Item (2/3) (2/4) (2/5) (2/6)       |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_MENU_ITEM_3,              // Menu Item (3/3) (3/4) (3/5) (3/6)       |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_MENU_ITEM_4,              // Menu Item       (4/4) (4/5) (4/6)       |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_MENU_ITEM_5,              // Menu Item             (5/5) (5/6)       |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_MENU_ITEM_6,              // Menu Item                   (6/6)       |
                                                //-----------------------------------------|
#ifdef HMI_SUPPORTS_ASIAN
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_ASIAN_SIGVIEW_ID_1,       // Signal id of 1st signal displayed       |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_ASIAN_SIGVIEW_ID_2,       // Signal id of 2nd signal displayed       |
                                                //-----------------------------------------|
#endif

    MENU_FRAME_PACKET_HL_ON_1,                  // LHS of highlighted Item (ypos = 1)      |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_HL_ON_2,                  // LHS of highlighted Item (ypos = 2)      |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_HL_ON_3,                  // LHS of highlighted Item (ypos = 3)      |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_HL_ON_4,                  // LHS of highlighted Item (ypos = 4)      |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_HL_ON_5,                  // LHS of highlighted Item (ypos = 5)      |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_HL_ON_6,                  // LHS of highlighted Item (ypos = 6)      |
                                                //-----------------------------------------|
#ifdef COMMON_TOP_WORKS_NEW_FEATURES    //SHOW_LOGIN_LEVEL
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_LOGOUT_ICON_T,            // Logout Icon                             |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_LOGOUT_ICON_B,            // Logout Icon                             |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_READONLY_ICON_T,          // Read Only Icon                          |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_READONLY_ICON_B,          // Read Only Icon                          |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_STANDARD_ICON_T,          // Standard Icon                           |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_STANDARD_ICON_B,          // Standard Icon                           |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_ADVANCED_ICON_T,          // Advanced Icon                           |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_ADVANCED_ICON_B,          // Advanced Icon                           |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_SERVICE_ICON_T,           // Service Icon                            |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_SERVICE_ICON_B,           // Service Icon                            |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_SLIDER_OR_SECURITY,       // Slider bar or Security Icon             |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_RIGHT_KEY,                // Right function key  "Select"            |
                                                //-----------------------------------------|
    MENU_FRAME_PACKET_READ_SWITCHES,            //                                         |
                                                //-----------------------------------------| - There is no active area for standard menu frames
}MENU_FRAME_PACKET;

#pragma diag_suppress=Pm080
#define MAX_MENU_ITEMS 24
#pragma diag_default=Pm080

    TUSIGN8 packetsBuilt = 0;
    MENU_ITEM_TYPE const *pMenuItem;

    TINT16 *pDisplayedSelections;
    TUSIGN8 DisplayedSelectionsIndex;

    #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //SHOW_LOGIN_LEVEL
    static TUSIGN8 yPos_Logout[2];
    static TUSIGN8 yPos_ReadOnly[2];
    static TUSIGN8 yPos_Standard[2];
    static TUSIGN8 yPos_Advanced[2];
    static TUSIGN8 yPos_Service[2];
    #endif

    TUSIGN8 instance = 0;

    static TINT16 DisplayedSelections_LOCAL[6];
    #ifdef HMI_SUPPORTS_SERVICEPORT
    static TINT16 DisplayedSelections_REMOTE[6];

    if (PacketManagerIsRemoteInstance())
    {
        pDisplayedSelections = DisplayedSelections_REMOTE;
        instance = 1;
    }
    else
    #endif
    {
        pDisplayedSelections = DisplayedSelections_LOCAL;
    }

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = MENU_FRAME_PACKET_TITLE_BAR;

        for (DisplayedSelectionsIndex = 0; DisplayedSelectionsIndex < 6; DisplayedSelectionsIndex ++)
        {
            pDisplayedSelections[DisplayedSelectionsIndex] = -1;
        }
    }
    else if ((LOCAL_keypressProcessed) && (LOCAL_packetStage > MENU_FRAME_PACKET_MENU_ITEM_1))
    {
        LOCAL_packetStage = MENU_FRAME_PACKET_MENU_ITEM_1;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 2) && (LOCAL_packetStage > MENU_FRAME_PACKET_MENU_ITEM_1))
    {
        LOCAL_packetStage = MENU_FRAME_PACKET_MENU_ITEM_1;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == MENU_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = MENU_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// MENU_FRAME_PACKET_TITLE_BAR                 // Title Bar                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MENU_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.titleBar_attribidx;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),8,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// MENU_FRAME_PACKET_LEFT_KEY                  // left function key  "Back"               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MENU_FRAME_PACKET_LEFT_KEY)
    {
       LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// MENU_FRAME_PACKET_LOGIN_LEVEL_6,            // Login level Icon (on line 6)            |
//---------------------------------------------//-----------------------------------------|
  #if defined (COMMON_TOP_WORKS_NEW_FEATURES) && defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)    //SHOW_LOGIN_LEVEL
    if (LOCAL_packetStage == MENU_FRAME_PACKET_LOGIN_LEVEL_6)
    {
        if ((LOCAL_Asian)
         && ((LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 0)   // 0-std menu
          || (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 4))) // 4-ARM Access level Selection
        {
            TUSIGN8 IconID = ARM_ACCESS_INVALID;

            #ifdef HMI_SUPPORTS_SECURITY_ACCESS
            IconID = AdjusterGetARMLevel();
            #endif

            packetsBuilt += PacketManagerBuilderServices_ShowLoginIcon(IconID,6,LOGIN_ICON_T);
        }
        else
        {
            // 1-Operator Menu
            // 2-Signals view
            // 3-Diagnostics View
            // 5-Alarm History
            // 6-Secure Alarm History
            LOCAL_packetStage ++;
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// MENU_FRAME_PACKET_LOGIN_LEVEL_7,            // Login level Icon (on line 7)            |
//---------------------------------------------//-----------------------------------------|
#ifdef COMMON_TOP_WORKS_NEW_FEATURES    //SHOW_LOGIN_LEVEL
    if (LOCAL_packetStage == MENU_FRAME_PACKET_LOGIN_LEVEL_7)
    {
        if ((LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 0)   // 0-std menu
         || (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 4))  // 4-ARM Access level Selection
        {
            #if defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION)
                TUSIGN8 iconID = ICON_ARM_LOGOUT;

                #ifdef HMI_SUPPORTS_SECURITY_ACCESS
                switch (AdjusterGetARMLevel())
                {
                case ARM_ACCESS_SERVICE:    iconID = ICON_ARM_SERVICE_LEVEL;    break;
                case ARM_ACCESS_ADVANCED:   iconID = ICON_ARM_ADVANCED_LEVEL;   break;
                case ARM_ACCESS_STANDARD:   iconID = ICON_ARM_STANDARD_LEVEL;   break;
                case ARM_ACCESS_READ_ONLY:  iconID = ICON_ARM_READONLY_LEVEL;   break;
                default:                    iconID = ICON_ARM_LOGOUT;           break;
                }
                #endif
                packetsBuilt += BuildWriteIcon(iconID, 0, 7, 0);
            #else

                TUSIGN8 IconID = ARM_ACCESS_INVALID;
                #ifdef HMI_SUPPORTS_SECURITY_ACCESS
                IconID = AdjusterGetARMLevel();
                #endif

                TUSIGN8 part = LOGIN_ICON;
                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    part = LOGIN_ICON_B;
                }
                #endif
                packetsBuilt += PacketManagerBuilderServices_ShowLoginIcon(IconID,7,part);
            #endif
        }
        else
        {
            // 1-Operator Menu
            // 2-Signals view
            // 3-Diagnostics View
            // 5-Alarm History
            // 6-Secure Alarm History
            LOCAL_packetStage ++;
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// MENU_FRAME_PACKET_MENU_ITEM_1,              // Menu Item (1/3) (1/4) (1/5) (1/6)       |
// MENU_FRAME_PACKET_MENU_ITEM_2,              // Menu Item (2/3) (2/4) (2/5) (2/6)       |
// MENU_FRAME_PACKET_MENU_ITEM_3,              // Menu Item (3/3) (3/4) (3/5) (3/6)       |
// MENU_FRAME_PACKET_MENU_ITEM_4,              // Menu Item       (4/4) (4/5) (4/6)       |
// MENU_FRAME_PACKET_MENU_ITEM_5,              // Menu Item             (5/5) (5/6)       |
// MENU_FRAME_PACKET_MENU_ITEM_6,              // Menu Item                   (6/6)       |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= MENU_FRAME_PACKET_MENU_ITEM_1) && (LOCAL_packetStage <= MENU_FRAME_PACKET_MENU_ITEM_6))
    {
        TUSIGN8 menuSelection = FrameTableGetCursorPosition();
        TBOOL   menuSelectionShown;
        TBOOL   ShowCursor = eFALSE;
        TUSIGN8 startPacket;

        TUSIGN8  itemsPerMenu;
        if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 2)
        {
            itemsPerMenu = 3;
        }
        else
        {
            #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                switch (SFD_SIMPLE_CTW.MenuFormat)
                {
                case HMI_MENU_FORMAT_3_LINES:   itemsPerMenu = 3;   break;
                case HMI_MENU_FORMAT_4_LINES:   itemsPerMenu = 4;   break;
                case HMI_MENU_FORMAT_5_LINES:   itemsPerMenu = 5;   break;
                case HMI_MENU_FORMAT_6_LINES:   itemsPerMenu = 6;   break;
                default:                    itemsPerMenu = 4;   break;
                }
            #else
                itemsPerMenu = ITEMS_PER_MENU;
            #endif
        }

        TUSIGN16 firstItem = (TUSIGN16)(LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.firstItem_MSByte << 8) + (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.firstItem_LSByte;
        TUSIGN16 lastItem = (TUSIGN16)(LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.lastItem_MSByte << 8) + (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.lastItem_LSByte;


        #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
        if (LOCAL_Asian)
        {
            itemsPerMenu = 2;
        }
        #endif

        // Check if the current menu selection is being displayed
        menuSelectionShown = eFALSE;
        DisplayedSelectionsIndex = 0;

        //while ((menuSelectionShown == eFALSE) && (DisplayedSelectionsIndex < ITEMS_PER_MENU))
        while ((menuSelectionShown == eFALSE) && (DisplayedSelectionsIndex < itemsPerMenu))
        {
            if (pDisplayedSelections[DisplayedSelectionsIndex] == menuSelection)
            {
                menuSelectionShown = eTRUE;
            }
            else
            {
                DisplayedSelectionsIndex ++;
            }
        }

        if (menuSelectionShown)
        {
            // current menu selection is being displayed..just set the cursor position
            LOCAL_highlightCursor = DisplayedSelectionsIndex;
            ShowCursor = eTRUE;
        }
        else
        {
            // current menu selection is not being displayed
            // Get Details of what to display (Create an array of valid cursor values)

            TUSIGN8  numberOfItems = 0;
            TUSIGN8  rangeIndex = 0;
            TUSIGN16 menuItem;

            #if (MAX_SIGNALS > MAX_MENU_ITEMS)
            TUSIGN8  menuItemTab[MAX_SIGNALS] = {0};

            #else
            TUSIGN8  menuItemTab[MAX_MENU_ITEMS] = {0};
            #endif

            // Get Details of what to display (Create an array of valid cursor values)
            for(menuItem = firstItem, rangeIndex = 0; menuItem <= lastItem; menuItem++, rangeIndex ++)
            {
                if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 2)
                {
                    #ifdef HMI_SUPPORTS_SIGNALS_VALIDITY_TEST
                    if (ValidityTestCheck((TUSIGN16)FrameTableGetSignal(rangeIndex)->SignalsViewTest
#ifdef VALIDITY_TEST_CALLER
						, SIGNALS_TEST_NOT_APPLICABLE
#endif
					))
                    #else
                    if (FrameTableGetSignal(rangeIndex)->SignalsViewEnable)
                    #endif
                    {
                        menuItemTab[numberOfItems] = rangeIndex;
                        numberOfItems++;
                    }
                }
                else
                {
                    MENU_ITEM_TYPE const *pStdMenuItem = FrameTableGetMenuItem(menuItem);
                    TUSIGN8 itemValid = pStdMenuItem == NULL ? 0 : ValidityTestCheck((TUSIGN16)pStdMenuItem->validTest
#ifdef VALIDITY_TEST_CALLER
						, SIGNALS_TEST_NOT_APPLICABLE
#endif
					);

                    /* Hangzhou, 201805: check whether the service user menu is valid. This is for cyber security test*/
                	if ((LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 4)    //access level frame
						&& (menuItem == lastItem)) //service user access menu
					{
                        extern TUSIGN8 valid_if_service_account_is_allowed(void);
						itemValid = valid_if_service_account_is_allowed();	
					}

                    if (itemValid)
                    {
                        menuItemTab[numberOfItems] = rangeIndex;
                        numberOfItems++;
                    }
                }
            }

            VIP_ASSERT(numberOfItems);      // at least one item in the menu must be valid
            rangeIndex = 0;
            while ((menuSelection != menuItemTab[rangeIndex]) && (rangeIndex < numberOfItems))
            {
                rangeIndex ++;
            }

            if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag != 2)
            {
                LOCAL_sliderBarHigh = numberOfItems-1;
                LOCAL_sliderBarActual = rangeIndex;
            }

            if (LOCAL_updateStaticArea)
            {
                // update static area flag is set - build a new display from scratch
                if (rangeIndex >= numberOfItems)
                {
                    // (rangeIndex >= numberOfItems) - menu selection is not valid
                    LOCAL_highlightCursor = 0;                      // set the cursor to the first line
                    ShowCursor = eFALSE;                            // do not allow the cursor to be shown
                    rangeIndex = 0;                                 // set the first item to be displayed as the first menu item
                }
                else if (rangeIndex < itemsPerMenu)
                {
                    // (rangeIndex < itemsPerMenu) - menu selection is within the first few items
                    LOCAL_highlightCursor = rangeIndex;             // set the cursor to the selected value
                    ShowCursor = eTRUE;                             // allow the cursor to be shown
                    rangeIndex = 0;                                 // set the first item to be displayed as the first menu item
                }
                else
                {
                    // (rangeIndex >= itemsPerMenu) - current value is beyond the end of display (if displaying the first few enum values)
                    LOCAL_highlightCursor = (itemsPerMenu - 1);     // set the cursor to the last line
                    ShowCursor = eTRUE;                             // allow the cursor to be shown
                    rangeIndex = (rangeIndex - itemsPerMenu) + 1;   // set the first item to be displayed so that the last item to be displayed is the selected value
                }
            }
            else
            {
                // update static area flag is not set - build a new display based on what was previously displayed
                if (menuSelection < pDisplayedSelections[0])
                {
                    // new value is less than previous lowest displayed value - build a new display with selected value at top
                    LOCAL_highlightCursor = 0;                      // set the cursor to the first line
                    ShowCursor = eTRUE;                             // allow the cursor to be shown
                    rangeIndex = rangeIndex;                        // do not change range index so that the first item to be displayed is the selected value
                }
                else
                {
                    // new value must be more than previous highest displayed value - build a new display with selected value at bottom
                    LOCAL_highlightCursor = (itemsPerMenu - 1);     // set the cursor to the last line
                    ShowCursor = eTRUE;                             // allow the cursor to be shown
                    rangeIndex = (rangeIndex - itemsPerMenu) + 1;   // set the first item to be displayed so that the last item to be displayed is the selected value
                }
            }
            // Fill the displayed values array
            for (DisplayedSelectionsIndex = 0; DisplayedSelectionsIndex < itemsPerMenu; DisplayedSelectionsIndex++)
            {
                if (rangeIndex < numberOfItems)
                {
                    pDisplayedSelections[DisplayedSelectionsIndex] = menuItemTab[rangeIndex];
                }
                rangeIndex ++;
            }
        }

        do
        {
            startPacket = LOCAL_packetStage;
            TUSIGN8 lineNumber = LOCAL_packetStage - MENU_FRAME_PACKET_MENU_ITEM_1;

            #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //SHOW_LOGIN_LEVEL
            if ((LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag != 4) || (lineNumber == 0))
            {
                yPos_Logout[instance]  = 0;
                yPos_ReadOnly[instance] = 0;
                yPos_Standard[instance] = 0;
                yPos_Advanced[instance] = 0;
                yPos_Service[instance]  = 0;
            }
            #endif

            if ((pDisplayedSelections[lineNumber] < 0) || (lineNumber >= itemsPerMenu))
            {
                LOCAL_packetStage ++;
            }
            else
            {
                //TUSIGN16 enumItem;
                TUSIGN8  yPos = 0;
                TUSIGN8  font = FONT_0;
                TUSIGN8  lineText[FULLWIDTH_TEXT_BUFFER_SIZE + 1];
                memset((void*)lineText,0x00,FULLWIDTH_TEXT_BUFFER_SIZE+1);


                #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //SHOW_LOGIN_LEVEL
                TUSIGN8  EnglishText[FULLWIDTH_TEXT_BUFFER_SIZE + 1];
                memset((void*)EnglishText,0x00,FULLWIDTH_TEXT_BUFFER_SIZE+1);
                #endif

                TUSIGN8  maxChars;

                if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 2)
                {
                    PacketManagerBuilderServices_buildSignalText(lineText,(TUSIGN8)pDisplayedSelections[lineNumber],eTRUE);
                    maxChars = FONT1_MAX_CHARS;
                }
                else
                {
                    pMenuItem = FrameTableGetMenuItem((TUSIGN16)(pDisplayedSelections[lineNumber] + firstItem));
                    LOCAL_stringtable_text_id.attribIdx = pMenuItem == NULL ? IDS_BLANK : pMenuItem->text_attribIdx;
                    LOCAL_stringtable_text_id.objIdx = SS_HMI_OBJ_STRINGTABLE;
                    LOCAL_stringtable_text_id.ssIdx = HMI_IDX;
                    strncpy((char *)lineText,(const char *)(FrameTableGetString(LOCAL_stringtable_text_id)),FULLWIDTH_TEXT_BUFFER_SIZE);
                    maxChars = FONT1_MAX_CHARS-1;


                    #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //SHOW_LOGIN_LEVEL
                    if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 4)
                    {
                        strncpy((char *)EnglishText,(const char *)(FrameTableGetStringSpecificLanguage(LOCAL_stringtable_text_id,HMI_LANGUAGE_ENGLISH)),FULLWIDTH_TEXT_BUFFER_SIZE);
                    }
                    #endif
                }

                switch (itemsPerMenu)
                {
                case 2:     yPos = lineNumber + lineNumber + 2;     font = FONT_1;      break;
                case 3:     yPos = lineNumber + lineNumber + 1;     font = FONT_1;      break;
                case 4:     yPos = lineNumber + 2;                  font = FONT_0;      break;
                case 5:     yPos = lineNumber + 2;                  font = FONT_0;      break;
                case 6:     yPos = lineNumber + 1;                  font = FONT_0;      break;
                default:    VIP_ASSERT(0);                                                  break;
                }

                #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //SHOW_LOGIN_LEVEL
                if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 4)
                {
                    if (strcmp((char *)EnglishText,"Logout") == 0)
                    {
                        yPos_Logout[instance] = yPos;
                    }
                    if (strcmp((char *)EnglishText,"Read Only") == 0)
                    {
                        yPos_ReadOnly[instance] = yPos;
                    }
                    if (strcmp((char *)EnglishText,"Standard") == 0)
                    {
                        yPos_Standard[instance] = yPos;
                    }
                    if (strcmp((char *)EnglishText,"Basic") == 0)
                    {
                        yPos_Standard[instance] = yPos;
                    }
                    if (strcmp((char *)EnglishText,"Calibrate") == 0)
                    {
                        yPos_Standard[instance] = yPos;
                    }
                    if (strcmp((char *)EnglishText,"Advanced") == 0)
                    {
                        yPos_Advanced[instance] = yPos;
                    }
                    if (strcmp((char *)EnglishText,"Service") == 0)
                    {
                        yPos_Service[instance] = yPos;
                    }
                }
                #endif


                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 2)
                    {
                        packetsBuilt += BuildWriteString(&lineText[4],
                                                         HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                                         yPos,
                                                         JUSTIFY_LEFT_WITH_INDENT_25_PIXEL,
                                                         font,
                                                         (TUSIGN8)(ShowCursor && (lineNumber == LOCAL_highlightCursor) ? STRING_INVERT : NO_INVERT),
                                                         0,
                                                         0,
                                                         (TUSIGN8)(maxChars - 4),
                                                         0);
                    }
                    else
                    {

                        TUSIGN8 justify = JUSTIFY_LEFT_WITH_INDENT_1_PIXEL;
                        TUSIGN8 MinMaxLength = ASIAN_MAX_CHARS;

                        #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //SHOW_LOGIN_LEVEL
                        if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 4)
                        {
                            justify = JUSTIFY_LEFT_WITH_INDENT_19_PIXEL;
                            MinMaxLength = 8;
                        }
                        #endif

                        packetsBuilt += BuildWriteString_w(lineText,
                                                           yPos,
                                                           justify,
                                                           (TUSIGN8)(ShowCursor && (lineNumber == LOCAL_highlightCursor) ? STRING_INVERT : NO_INVERT),
                                                           0,
                                                           MinMaxLength,
                                                           MinMaxLength,
                                                           0);
                    }
                }
                else
                #endif
                {
                    TUSIGN8 justify = JUSTIFY_LEFT_WITH_INDENT_1_PIXEL;
                    #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //SHOW_LOGIN_LEVEL
                    if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 4)
                    {
                        justify = JUSTIFY_LEFT_WITH_INDENT_3;
                    }
                    #endif

                    packetsBuilt += BuildWriteString(lineText,
                                                     HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                                     yPos,
                                                     justify,
                                                     font,
                                                     (TUSIGN8)(ShowCursor && (lineNumber == LOCAL_highlightCursor) ? STRING_INVERT : NO_INVERT),
                                                     0,
                                                     0,
                                                     maxChars,
                                                     0);
                }
            }
        }
        while ((LOCAL_packetStage != startPacket) && (LOCAL_packetStage <= MENU_FRAME_PACKET_MENU_ITEM_6));
    }

#ifdef HMI_SUPPORTS_ASIAN
//---------------------------------------------//-----------------------------------------|
// MENU_FRAME_PACKET_ASIAN_SIGVIEW_ID_1        // Signal id of 1st signal displayed       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MENU_FRAME_PACKET_ASIAN_SIGVIEW_ID_1)
    {
        if ((LOCAL_Asian) && (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 2))
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal((TUSIGN8)pDisplayedSelections[0])->short_identifier;

            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),
                                               2,
                                               JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,
                                               (TUSIGN8)(LOCAL_highlightCursor == 0 ? STRING_INVERT : NO_INVERT),
                                               0,
                                               2,
                                               2,
                                               0);
        }
        else
        {
            LOCAL_packetStage = MENU_FRAME_PACKET_ASIAN_SIGVIEW_ID_2 + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// MENU_FRAME_PACKET_ASIAN_SIGVIEW_ID_2        // Signal id of 2nd signal displayed       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MENU_FRAME_PACKET_ASIAN_SIGVIEW_ID_2)
    {
        if ((LOCAL_Asian) && (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 2))
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal((TUSIGN8)pDisplayedSelections[1])->short_identifier;

            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),
                                               4,
                                               JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,
                                               (TUSIGN8)(LOCAL_highlightCursor == 1 ? STRING_INVERT : NO_INVERT),
                                               0,
                                               2,
                                               2,
                                               0);
        }
        else
        {
            LOCAL_packetStage = MENU_FRAME_PACKET_ASIAN_SIGVIEW_ID_2 + 1;
        }
    }
#endif

//---------------------------------------------//-----------------------------------------|
// MENU_FRAME_PACKET_HL_ON_1                   // LHS of highlighted Item (ypos = 1)      |
// MENU_FRAME_PACKET_HL_ON_2                   // LHS of highlighted Item (ypos = 2)      |
// MENU_FRAME_PACKET_HL_ON_3                   // LHS of highlighted Item (ypos = 3)      |
// MENU_FRAME_PACKET_HL_ON_4                   // LHS of highlighted Item (ypos = 4)      |
// MENU_FRAME_PACKET_HL_ON_5                   // LHS of highlighted Item (ypos = 5)      |
// MENU_FRAME_PACKET_HL_ON_6                   // LHS of highlighted Item (ypos = 6)      |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= MENU_FRAME_PACKET_HL_ON_1) && (LOCAL_packetStage <= MENU_FRAME_PACKET_HL_ON_6))
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage = MENU_FRAME_PACKET_HL_ON_6 + 1;  // additional highlight not required on TFT displays
        #else

            TUSIGN8 xPos = 0;

            #ifdef COMMON_TOP_WORKS_NEW_FEATURES    //SHOW_LOGIN_LEVEL
            if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 4)
            {
                xPos = 17;
                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    xPos = 18;
                }
                #endif
            }
            #endif

            TUSIGN8 customChar, startPacket, yPos;
            TUSIGN8 itemsPerMenuIndex,cursorIndex,lineNumberIndex;

            cursorIndex = LOCAL_highlightCursor >= 6 ? 6 : LOCAL_highlightCursor;

            if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 2)
            {
                itemsPerMenuIndex = 3;
            }
            else
            {

                #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                    switch (SFD_SIMPLE_CTW.MenuFormat)
                    {
                    case HMI_MENU_FORMAT_3_LINES:   itemsPerMenuIndex = 1;   break;
                    case HMI_MENU_FORMAT_4_LINES:   itemsPerMenuIndex = 2;   break;
                    case HMI_MENU_FORMAT_5_LINES:   itemsPerMenuIndex = 3;   break;
                    case HMI_MENU_FORMAT_6_LINES:   itemsPerMenuIndex = 4;   break;
                    default:                    itemsPerMenuIndex = 2;   break;
                    }
                #else
                    itemsPerMenuIndex = ITEMS_PER_MENU - 2;
                #endif

            }

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                itemsPerMenuIndex = 0;
            }
            #endif

            do
            {
                startPacket = LOCAL_packetStage;
                lineNumberIndex = LOCAL_packetStage - MENU_FRAME_PACKET_HL_ON_1;
                yPos = lineNumberIndex + 1;

                customChar = HighlightPattern[itemsPerMenuIndex][cursorIndex][lineNumberIndex];

                packetsBuilt += BuildCustomCharacterString(&customChar, 1, xPos, yPos, 0, 0);
            }
            while ((LOCAL_packetStage != startPacket) && (LOCAL_packetStage <= MENU_FRAME_PACKET_HL_ON_6));
        #endif
    }


#ifdef COMMON_TOP_WORKS_NEW_FEATURES    //SHOW_LOGIN_LEVEL
//---------------------------------------------//-----------------------------------------|
// MENU_FRAME_PACKET_LOGOUT_ICON_T,            // Logout Icon                             |
// MENU_FRAME_PACKET_LOGOUT_ICON_B,            // Logout Icon                             |
// MENU_FRAME_PACKET_READONLY_ICON_T,          // Read Only Icon                          |
// MENU_FRAME_PACKET_READONLY_ICON_B,          // Read Only Icon                          |
// MENU_FRAME_PACKET_STANDARD_ICON_T,          // Standard Icon                           |
// MENU_FRAME_PACKET_STANDARD_ICON_B,          // Standard Icon                           |
// MENU_FRAME_PACKET_ADVANCED_ICON_T,          // Advanced Icon                           |
// MENU_FRAME_PACKET_ADVANCED_ICON_B,          // Advanced Icon                           |
// MENU_FRAME_PACKET_SERVICE_ICON_T,           // Service Icon                            |
// MENU_FRAME_PACKET_SERVICE_ICON_B,           // Service Icon                            |
//---------------------------------------------//-----------------------------------------|

    if ((LOCAL_packetStage >= MENU_FRAME_PACKET_LOGOUT_ICON_T)
     && (LOCAL_packetStage <= MENU_FRAME_PACKET_SERVICE_ICON_B))
    {
        if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag != 4)
        {
            LOCAL_packetStage = MENU_FRAME_PACKET_SERVICE_ICON_B + 1;
        }
        else
        {
            //---------------------------------------------//-----------------------------------------|
            // MENU_FRAME_PACKET_LOGOUT_ICON_T,            // Logout Icon                             |
            //---------------------------------------------//-----------------------------------------|
            if (LOCAL_packetStage == MENU_FRAME_PACKET_LOGOUT_ICON_T)
            {
                if (yPos_Logout[instance])
                {
                    #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
                        packetsBuilt += BuildWriteIcon(ICON_ARM_LOGOUT, 0, yPos_Logout[instance], 0);
                    #else
                        TUSIGN8 part = LOGIN_ICON;
                        #ifdef HMI_SUPPORTS_ASIAN
                        if (LOCAL_Asian)
                        {
                            part = LOGIN_ICON_T;
                        }
                        #endif
                        packetsBuilt += PacketManagerBuilderServices_ShowLoginIcon(ARM_ACCESS_LOGOUT , yPos_Logout[instance], part);
                    #endif
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
            //---------------------------------------------//-----------------------------------------|
            // MENU_FRAME_PACKET_LOGOUT_ICON_B,            // Logout Icon                             |
            //---------------------------------------------//-----------------------------------------|
            if (LOCAL_packetStage == MENU_FRAME_PACKET_LOGOUT_ICON_B)
            {
                #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)

                if ((LOCAL_Asian) && (yPos_Logout[instance]))
                {
                    packetsBuilt += PacketManagerBuilderServices_ShowLoginIcon(ARM_ACCESS_LOGOUT , (TUSIGN8)(yPos_Logout[instance] + 1), LOGIN_ICON_B);
                }
                else
                #endif
                {
                    LOCAL_packetStage ++;
                }
            }
            //---------------------------------------------//-----------------------------------------|
            // MENU_FRAME_PACKET_READONLY_ICON_T           // Read Only Icon                          |
            //---------------------------------------------//-----------------------------------------|
            if (LOCAL_packetStage == MENU_FRAME_PACKET_READONLY_ICON_T)
            {
                if (yPos_ReadOnly[instance])
                {
                    #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
                        packetsBuilt += BuildWriteIcon(ICON_ARM_READONLY_LEVEL, 0, yPos_ReadOnly[instance], 0);
                    #else
                        TUSIGN8 part = LOGIN_ICON;
                        #ifdef HMI_SUPPORTS_ASIAN
                        if (LOCAL_Asian)
                        {
                            part = LOGIN_ICON_T;
                        }
                        #endif
                        packetsBuilt += PacketManagerBuilderServices_ShowLoginIcon(ARM_ACCESS_READ_ONLY , yPos_ReadOnly[instance], part);
                    #endif
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
            //---------------------------------------------//-----------------------------------------|
            // MENU_FRAME_PACKET_READONLY_ICON_B           // Read Only Icon                          |
            //---------------------------------------------//-----------------------------------------|
            if (LOCAL_packetStage == MENU_FRAME_PACKET_READONLY_ICON_B)
            {
                #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
                if ((LOCAL_Asian) && (yPos_ReadOnly[instance]))
                {
                    packetsBuilt += PacketManagerBuilderServices_ShowLoginIcon(ARM_ACCESS_READ_ONLY , (TUSIGN8)(yPos_ReadOnly[instance] + 1), LOGIN_ICON_B);
                }
                else
                #endif
                {
                    LOCAL_packetStage ++;
                }
            }
            //---------------------------------------------//-----------------------------------------|
            // MENU_FRAME_PACKET_STANDARD_ICON_T,          // Standard Icon                           |
            //---------------------------------------------//-----------------------------------------|
            if (LOCAL_packetStage == MENU_FRAME_PACKET_STANDARD_ICON_T)
            {
                if (yPos_Standard[instance])
                {
                    #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
                        packetsBuilt += BuildWriteIcon(ICON_ARM_STANDARD_LEVEL, 0, yPos_Standard[instance], 0);
                    #else
                        TUSIGN8 part = LOGIN_ICON;
                        #ifdef HMI_SUPPORTS_ASIAN
                        if (LOCAL_Asian)
                        {
                            part = LOGIN_ICON_T;
                        }
                        #endif
                        packetsBuilt += PacketManagerBuilderServices_ShowLoginIcon(ARM_ACCESS_STANDARD , yPos_Standard[instance], part);
                    #endif
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
            //---------------------------------------------//-----------------------------------------|
            // MENU_FRAME_PACKET_STANDARD_ICON_B,          // Standard Icon                           |
            //---------------------------------------------//-----------------------------------------|
            if (LOCAL_packetStage == MENU_FRAME_PACKET_STANDARD_ICON_B)
            {
                #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
                if ((LOCAL_Asian) && (yPos_Standard[instance]))
                {
                    packetsBuilt += PacketManagerBuilderServices_ShowLoginIcon(ARM_ACCESS_STANDARD , (TUSIGN8)(yPos_Standard[instance] + 1), LOGIN_ICON_B);
                }
                else
                #endif
                {
                    LOCAL_packetStage ++;
                }
            }
            //---------------------------------------------//-----------------------------------------|
            // MENU_FRAME_PACKET_ADVANCED_ICON_T,          // Advanced Icon                           |
            //---------------------------------------------//-----------------------------------------|
            if (LOCAL_packetStage == MENU_FRAME_PACKET_ADVANCED_ICON_T)
            {
                if (yPos_Advanced[instance])
                {
                    #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
                        packetsBuilt += BuildWriteIcon(ICON_ARM_ADVANCED_LEVEL, 0, yPos_Advanced[instance], 0);
                    #else
                        TUSIGN8 part = LOGIN_ICON;
                        #ifdef HMI_SUPPORTS_ASIAN
                        if (LOCAL_Asian)
                        {
                            part = LOGIN_ICON_T;
                        }
                        #endif
                        packetsBuilt += PacketManagerBuilderServices_ShowLoginIcon(ARM_ACCESS_ADVANCED , yPos_Advanced[instance], part);
                    #endif
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
            //---------------------------------------------//-----------------------------------------|
            // MENU_FRAME_PACKET_ADVANCED_ICON_B,          // Advanced Icon                           |
            //---------------------------------------------//-----------------------------------------|
            if (LOCAL_packetStage == MENU_FRAME_PACKET_ADVANCED_ICON_B)
            {
                #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
                if ((LOCAL_Asian) && (yPos_Advanced[instance]))
                {
                    packetsBuilt += PacketManagerBuilderServices_ShowLoginIcon(ARM_ACCESS_ADVANCED , (TUSIGN8)(yPos_Advanced[instance] + 1), LOGIN_ICON_B);
                }
                else
                #endif
                {
                    LOCAL_packetStage ++;
                }
            }
            //---------------------------------------------//-----------------------------------------|
            // MENU_FRAME_PACKET_SERVICE_ICON_T,           // Service Icon                            |
            //---------------------------------------------//-----------------------------------------|
            if (LOCAL_packetStage == MENU_FRAME_PACKET_SERVICE_ICON_T)
            {
                if (yPos_Service[instance])
                {
                    #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
                        packetsBuilt += BuildWriteIcon(ICON_ARM_SERVICE_LEVEL, 0, yPos_Service[instance], 0);
                    #else
                        TUSIGN8 part = LOGIN_ICON;
                        #ifdef HMI_SUPPORTS_ASIAN
                        if (LOCAL_Asian)
                        {
                            part = LOGIN_ICON_T;
                        }
                        #endif
                        packetsBuilt += PacketManagerBuilderServices_ShowLoginIcon(ARM_ACCESS_SERVICE , yPos_Service[instance], part);
                    #endif
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
            //---------------------------------------------//-----------------------------------------|
            // MENU_FRAME_PACKET_SERVICE_ICON_B,           // Service Icon                            |
            //---------------------------------------------//-----------------------------------------|
            if (LOCAL_packetStage == MENU_FRAME_PACKET_SERVICE_ICON_B)
            {
                #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
                if ((LOCAL_Asian) && (yPos_Service[instance]))
                {
                    packetsBuilt += PacketManagerBuilderServices_ShowLoginIcon(ARM_ACCESS_SERVICE , (TUSIGN8)(yPos_Service[instance] + 1), LOGIN_ICON_B);
                }
                else
                #endif
                {
                    LOCAL_packetStage ++;
                }
            }
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// MENU_FRAME_PACKET_SLIDER_OR_SECURITY        // Slider bar or Security Icon             |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MENU_FRAME_PACKET_SLIDER_OR_SECURITY)
    {
        if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 2)
        {
            // No Icon on signals view
            LOCAL_packetStage = MENU_FRAME_PACKET_SLIDER_OR_SECURITY + 1;
        }
        #ifdef HMI_SUPPORTS_SECURITY_ACCESS
        else if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 4)
        {
            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
                packetsBuilt += BuildWriteIcon(ICON_KEY, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
            #else
                packetsBuilt += BuildCustomCharacterString(&SecurityIcon[0], 12, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH, 0, 0, 0);
            #endif
        }
        #endif
        else
        {
            TUSIGN8 high,actual;

            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            FrameTableGetMenuPositionDetailsForTFT(&actual, &high);
            #else
            FrameTableAccessMenuPositionDetails(&actual, &high, eTRUE);
            #endif

            packetsBuilt += BuildSliderBar((TINT16)high,(TINT16)actual,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// MENU_FRAME_PACKET_RIGHT_KEY                 // Right function key  "Select"            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MENU_FRAME_PACKET_RIGHT_KEY)
    {
        if (LOCAL_pCurrDisplayFrame->frameDefinition.menuFrame.specialMenuFlag == 2)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_EXIT;
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_SELECT;
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,1);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,1);
        }
    }

    return packetsBuilt;
}

#ifdef HMI_USES_COMMONDIAGNOSTICS
// No restriction on the optimization of this function
TUSIGN8 BuidDiagnosticsMenu(TUSIGN8 specialMenuFlag)
{

typedef enum
{                                               // Packet                                       |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_BLANK_AREA,               // Blank Area                                   | - Start of Static Area
                                                //----------------------------------------------|
#if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_ICON_1,                   // Classification Icon                          | - Start of keypress area - Start of active area
                                                //----------------------------------------------|
#else
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_ICON_6,                   // Icon (line 6)                                |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_ICON_5,                   // Icon (line 5)                                |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_ICON_4,                   // Icon (line 4)                                |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_ICON_3,                   // Icon (line 3)                                |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_ICON_2,                   // Icon (line 2)                                |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_ICON_1,                   // Icon (line 1)                                | - Start of keypress area - Start of active area
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_ICON_0,                   // Icon (line 0)                                |
                                                //----------------------------------------------|
#endif
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_CATEGORY,                 // Alarm Category                               |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_CODE,                     // Alarm Code                                   |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_TEXT_ON_2,                // Alarm Text on line 2                         |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_TEXT_ON_3,                // Alarm Text on line 3                         |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_TEXT_ON_4,                // Alarm Text on line 4                         |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_TEXT_ON_5,                // Alarm Text on line 5                         |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_TEXT_ON_6,                // Alarm Text on line 6                         |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_COUNT,                    // Alarm Count                                  |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_TOTAL_TIME_ACTIVE,        // Total Time Active                            |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_TOTAL_TIME_ACTIVE_ID,     // ID for "Total Time Active"                   |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_ELAPSED_TIME,             // Time Elapsed since last activation           |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_ELAPSED_TIME_ID,          // ID for "Time Elapsed since last activation"  |
                                                //----------------------------------------------|
#ifdef DISPLAY_DIAGNOSIS_CONDITION_DETAILS
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_DETAILS_CLEAR_LINE2,      //                                              |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_DETAILS_CLEAR_LINE6,      //                                              |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_DETAILS_1,                //                                              |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_DETAILS_2,                //                                              |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_DETAILS_3,                //                                              |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE1,  //                                              |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE2,  //                                              |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE3,  //                                              |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE4,  //                                              |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE5,  //                                              |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE6,  //                                              |
                                                //----------------------------------------------|
#endif
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_SLIDER_BAR,               // Slider Bar                                   |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_SLIDER_BAR_OVERWRITE,     // Remove Slider bar Number                     |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_RIGHT_KEY,                // Right function key  "Exit"                   |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_LEFT_KEY,                 // Left function key  "Back"                    |
                                                //----------------------------------------------|
    DIAG_FRAME_PACKET_READ_SWITCHES,            //                                              |
                                                //----------------------------------------------|
}DIAG_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;

    TUSIGN8 AlarmSelection = FrameTableGetCursorPosition();
    #ifdef DISPLAY_DIAGNOSIS_CONDITION_DETAILS
    TUSIGN8 DetailsSelection = FrameTable_GetDiagDetailsCursor();
    #endif
    TUSIGN8 AlarmClassification = CLASSIFICATION_NONE;
    TUSIGN8 AlarmCategory = CATEGORY_UNSPECIFIED;
    TUSIGN8 AlarmPriority = 0;
    TUSIGN8 AlarmID;
    TBOOL   AlarmActive = eFALSE;
    TBOOL   BlankDisplay = eFALSE;

    TUSIGN16 AlarmCount;

    TUSIGN32 AlarmTime_msec;
    TUSIGN16 AlarmTime_day;
    TUSIGN32 AlarmMostRecent_msec;
    TUSIGN16 AlarmMostRecent_day;
    AlarmID = AlarmSelection;

    const TUSIGN8* FullDescription;
    #ifdef COMMON_TOP_WORKS_NEW_FEATURES
    const TUSIGN8* FullRecoveryAct;
    #endif


    if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
    {
        // Diagnostic History
        TINT16 alm = AdjusterFindFirstDiagHistoryEntry((TUSIGN8)(specialMenuFlag - 4));

        if (alm < 0)
        {
            // No diagnostic history data available (all alarms clear)
            BlankDisplay = eTRUE;
            LOCAL_prvBlankHistory = eTRUE;
        }
        else
        {
            // Diagnostic history data available for at least 1 diagnostic alarm
            if (LOCAL_prvBlankHistory)
            {
                AlarmSelection = (TUSIGN8)alm;
                FrameTableSetCursorPosition(AlarmSelection);
            }
            LOCAL_prvBlankHistory = eFALSE;

            (void)AdjusterGetAlarmHistoryDetails((TUSIGN8)(specialMenuFlag - 4), AlarmSelection, &AlarmClassification, &AlarmCategory, &AlarmPriority, &AlarmID, &AlarmCount, &AlarmTime_msec, &AlarmTime_day, &AlarmMostRecent_msec, &AlarmMostRecent_day);
            AlarmActive = eTRUE;
        }
    }
    else
    {
        // Diagnostic View
        TUSIGN8 NAMURClassification;
        TUSIGN8 NAMURCategory;
        TUSIGN8 nActiveAlarms = AdjusterGetNumberOfAlarmConditions(eTRUE);

        if (AlarmSelection >= nActiveAlarms)
        {
            AlarmSelection = nActiveAlarms - 1;
            FrameTableSetCursorPosition(AlarmSelection);
        }

        AlarmActive = AdjusterGetAlarmConditionDetails(AlarmSelection, &AlarmClassification, &AlarmCategory, &AlarmPriority, &AlarmID);
        AdjusterGetNAMURStatus(&NAMURClassification, &NAMURCategory);
        if (NAMURClassification == CLASSIFICATION_NONE)
        {
            BlankDisplay = eTRUE;
        }
    }

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = DIAG_FRAME_PACKET_BLANK_AREA;
    }
    else if (((LOCAL_updateActiveArea) ||
              (LOCAL_keypressProcessed) ||
              (AlarmActive != LOCAL_prvAlarmActive) ||
              (AlarmClassification != LOCAL_prvAlarmClassification) ||
              (AlarmCategory != LOCAL_prvAlarmCategory) ||
              (AlarmPriority != LOCAL_prvAlarmPriority) ||
              (AlarmID != LOCAL_prvAlarmID) ||
              (BlankDisplay != LOCAL_prvBlankDisplay)) &&
              (LOCAL_packetStage > DIAG_FRAME_PACKET_ICON_1))
    {
        LOCAL_packetStage = DIAG_FRAME_PACKET_ICON_1;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == DIAG_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = DIAG_FRAME_PACKET_READ_SWITCHES;
    }

    LOCAL_prvAlarmActive = AlarmActive;
    LOCAL_prvAlarmClassification = AlarmClassification;
    LOCAL_prvAlarmCategory = AlarmCategory;
    LOCAL_prvAlarmPriority = AlarmPriority;
    LOCAL_prvAlarmID = AlarmID;
    LOCAL_prvBlankDisplay = BlankDisplay;


//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_BLANK_AREA                // Blank Area                                   |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_BLANK_AREA)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)

            LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.titleBar_attribidx;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),8,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
            }
        #else
        packetsBuilt += BuildBlankArea(0,7,0);
        #endif
    }
#if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_ICON_1,                   // Icon (line 1)                                |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_ICON_1)
    {
        if (BlankDisplay)
        {
            LOCAL_packetStage ++;
        }
        else
        {
            packetsBuilt += BuildWriteIcon((TUSIGN8)(ICON_NEMUR_NONE+AlarmClassification), MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
        }
    }

#else

//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_ICON_6,                   // Icon (line 6)                                |
// DIAG_FRAME_PACKET_ICON_5,                   // Icon (line 5)                                |
// DIAG_FRAME_PACKET_ICON_4,                   // Icon (line 4)                                |
// DIAG_FRAME_PACKET_ICON_3,                   // Icon (line 3)                                |
// DIAG_FRAME_PACKET_ICON_2,                   // Icon (line 2)                                |
//---------------------------------------------//----------------------------------------------|
    if ((LOCAL_packetStage >= DIAG_FRAME_PACKET_ICON_6) && (LOCAL_packetStage <= DIAG_FRAME_PACKET_ICON_2))
    {
        TUSIGN8 CustomChar = 0xFF;
        TUSIGN8 startPacket = LOCAL_packetStage;

        #ifdef HMI_SUPPORTS_ASIAN
        if ((LOCAL_Asian) && (LOCAL_packetStage == DIAG_FRAME_PACKET_ICON_6))
        {
            LOCAL_packetStage ++;
        }
        #endif

        do
        {
            packetsBuilt += BuildCustomCharacterString(&CustomChar, 1, 0, (TUSIGN8)(DIAG_FRAME_PACKET_ICON_0-LOCAL_packetStage), 17, 0);
        }
        while ((LOCAL_packetStage < DIAG_FRAME_PACKET_ICON_1) && (LOCAL_packetStage != startPacket));
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_ICON_1,                   // Icon (line 1)                                |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_ICON_1)
    {
        if (BlankDisplay)
        {
            TUSIGN8 CustomChar = 0xFF;
            packetsBuilt += BuildCustomCharacterString(&CustomChar, 1, 0, 1, 17, 0);
        }
        else
        {
            packetsBuilt += BuildWriteArray(FrameTableGetDiagnosticIconAddress(AlarmClassification,1),18,0,1,0);
        }
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_ICON_0,                   // Icon (line 0)                                |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_ICON_0)
    {
        if (BlankDisplay)
        {
            TUSIGN8 CustomChar = 0xFF;
            packetsBuilt += BuildCustomCharacterString(&CustomChar, 1, 0, 0, 17, 0);
        }
        else
        {
            packetsBuilt += BuildWriteArray(FrameTableGetDiagnosticIconAddress(AlarmClassification,0),18,0,0,0);
        }
    }
#endif
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_CATEGORY,                 // Alarm Category                               |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_CATEGORY)
    {
        if (BlankDisplay)
        {
            if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_ALARM_HISTORY_CLEAR;
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_ALL_ALARMS_CLEAR;
            }
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableGetNAMURCategoryString(AlarmCategory);
        }

        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),0,JUSTIFY_LEFT_WITH_INDENT_12_PIXEL,NO_INVERT,0,8,8,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,0,JUSTIFY_LEFT_WITH_INDENT_2,FONT_0,NO_INVERT,0,0,17,0);
            }
        #else
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),0,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,NO_INVERT,0,8,8,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,0,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,17,0);
            }
        #endif
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_CODE,                     // Alarm Code                                   |
//---------------------------------------------//----------------------------------------------|
//
//  Alarm code is in the format:   XPPP.NNN
//                                 | |   |
//                Classification___| |   |
//                                   |   |
//                      priority_____|   |
//                                       |
//                      Alarm ID_________|
//
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_CODE)
    {

        TUSIGN8 codeStr[13] = {'-','-',' ','0','0','0','.','0','0','0','-','-',0x00}; // "-- 000.000--"
        TUSIGN8 lineNumber = 1;

        if (BlankDisplay)
        {
            TUSIGN8 i;
            for (i = 0; i < 12; i ++)
            {
                codeStr[i] = 0x20;
            }
        }
        else
        {
            switch (AlarmClassification)
            {
            case CLASSIFICATION_INFORMATIONONLY:    codeStr[2] = 'I';   break;
            case CLASSIFICATION_FAILURE:            codeStr[2] = 'F';   break;
            case CLASSIFICATION_MAINTENANCEREQD:    codeStr[2] = 'M';   break;
            case CLASSIFICATION_OFFSPEC:            codeStr[2] = 'S';   break;
            case CLASSIFICATION_CHECKFUNCTION:      codeStr[2] = 'C';   break;
            default:                                codeStr[2] = '_';   break;
            }

            codeStr[3] += (AlarmPriority / 100);
            codeStr[4] += ((AlarmPriority % 100) / 10);
            codeStr[5] += (AlarmPriority % 10);

            codeStr[7] += (AlarmID / 100);
            codeStr[8] += ((AlarmID % 100) / 10);
            codeStr[9] += (AlarmID % 10);
        }

        #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
        if (LOCAL_Asian)
        {
            lineNumber ++;
        }
        #endif

        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
        packetsBuilt += BuildWriteString(codeStr,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_LEFT_WITH_INDENT_1,FONT_0,NO_INVERT,0,0,12,0);
        #else
        packetsBuilt += BuildWriteString(codeStr,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_CENTRE,FONT_0,NO_INVERT,0,0,12,0);
        #endif
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_TEXT_ON_2,                // Alarm Text on line 2                         |
// DIAG_FRAME_PACKET_TEXT_ON_3,                // Alarm Text on line 3                         |
// DIAG_FRAME_PACKET_TEXT_ON_4,                // Alarm Text on line 4                         |
// DIAG_FRAME_PACKET_TEXT_ON_5,                // Alarm Text on line 5                         |
// DIAG_FRAME_PACKET_TEXT_ON_6,                // Alarm Text on line 6                         |
//---------------------------------------------//----------------------------------------------|
    if ((LOCAL_packetStage >= DIAG_FRAME_PACKET_TEXT_ON_2) && (LOCAL_packetStage <= DIAG_FRAME_PACKET_TEXT_ON_6))
    {
        #ifdef DISPLAY_DIAGNOSIS_CONDITION_DETAILS
        if (FrameTable_isDiagDetailsViewActive())
        {
            LOCAL_packetStage = DIAG_FRAME_PACKET_TEXT_ON_6 + 1;
        }
        else
        #endif
        {
            if (BlankDisplay)
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
                FullDescription = FrameTableGetString(LOCAL_stringtable_text_id);
                #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                FullRecoveryAct = FrameTableGetString(LOCAL_stringtable_text_id);
                #endif
            }
            else
            {
                #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                    LOCAL_stringtable_text_id.attribIdx = FrameTableGetDiagnosticTableEntry(AlarmID).descriptionID;
                    FullDescription = FrameTableGetString(LOCAL_stringtable_text_id);
                    LOCAL_stringtable_text_id.attribIdx = FrameTableGetDiagnosticTableEntry(AlarmID).RecoveryActID;
                    FullRecoveryAct = FrameTableGetString(LOCAL_stringtable_text_id);
                #else
                    LOCAL_stringtable_text_id.attribIdx = FrameTableGetDiagnosticDescriptionStringID(AlarmID);
                    FullDescription = FrameTableGetString(LOCAL_stringtable_text_id);
                #endif
            }
        }
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_TEXT_ON_2,                // Alarm Text on line 2                         |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_TEXT_ON_2)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5)) // Alarm History or Secure History)
                {
                    // Asian Description 1..8 / First line of Description
                    TUSIGN8 PartialDescription[17];
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 1, 16, PartialDescription);
                    packetsBuilt += BuildWriteString_w(PartialDescription,2,JUSTIFY_LEFT_WITH_INDENT_6_PIXEL,NO_INVERT,0,8,8,0);
                }
                else
                {
                    // Asian Description 1..8 / First line of Description
                    TUSIGN8 PartialDescription[17];
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 1, 16, PartialDescription);
                    packetsBuilt += BuildWriteString_w(PartialDescription,2,JUSTIFY_LEFT_WITH_INDENT_6_PIXEL,NO_INVERT,0,8,8,0);
                }
            }
            else
            #endif
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // European Description 1..16 / First line of Description
                    TUSIGN8 PartialDescription[17];
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 1, 16, PartialDescription);
                    packetsBuilt += BuildWriteString(PartialDescription,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT_WITH_INDENT_1,FONT_0,NO_INVERT,0,0,16,0);
                }
                else
                {
                    // European Description 1..16 / First line of Description
                    TUSIGN8 PartialDescription[17];
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 1, 16, PartialDescription);
                    packetsBuilt += BuildWriteString(PartialDescription,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT_WITH_INDENT_1,FONT_0,NO_INVERT,0,0,16,0);
                }
            }

        #else

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Skip this line (this line has been used for alarm code)
                    LOCAL_packetStage ++;
                }
                else
                {
                    // Skip this line (this line has been used for alarm code)
                    LOCAL_packetStage ++;
                }
            }
            else
            #endif
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // European Description 1..16 / First line of Description
                    TUSIGN8 PartialDescription[17];
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 1, 16, PartialDescription);
                    packetsBuilt += BuildWriteString(PartialDescription,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,16,0);
                }
                else
                {
                    // European Description 1..16 / First line of Description
                    TUSIGN8 PartialDescription[17];
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 1, 16, PartialDescription);
                    packetsBuilt += BuildWriteString(PartialDescription,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,16,0);
                }
            }
        #endif
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_TEXT_ON_3,                // Alarm Text on line 3                         |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_TEXT_ON_3)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Asian Description 9..16 / Second line of Description
                    TUSIGN8 PartialDescription[17];
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 17, 16, PartialDescription);
                    packetsBuilt += BuildWriteString_w(PartialDescription,3,JUSTIFY_LEFT_WITH_INDENT_6_PIXEL,NO_INVERT,0,8,8,0);
                }
                else
                {
                    // Asian Description 9..16 / Second line of Description
                    TUSIGN8 PartialDescription[17];
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 17, 16, PartialDescription);
                    packetsBuilt += BuildWriteString_w(PartialDescription,3,JUSTIFY_LEFT_WITH_INDENT_1,NO_INVERT,0,8,8,0);
                }
            }
            else
            #endif
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // European Description 17..32 / Second line of Description
                    TUSIGN8 PartialDescription[17];
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 17, 16, PartialDescription);
                    packetsBuilt += BuildWriteString(PartialDescription,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,3,JUSTIFY_LEFT_WITH_INDENT_1,FONT_0,NO_INVERT,0,0,16,0);
                }
                else
                {
                    // European Description 17..32 / Second line of Description
                    TUSIGN8 PartialDescription[17];
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 17, 16, PartialDescription);
                    packetsBuilt += BuildWriteString(PartialDescription,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,3,JUSTIFY_LEFT_WITH_INDENT_1,FONT_0,NO_INVERT,0,0,16,0);
                }
            }

        #else

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Skip this line (this line will be used for alarm count)
                    LOCAL_packetStage ++;
                }
                else
                {
                    // Asian Description 1..8 / First line of Description
                    TUSIGN8 PartialDescription[17];
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 1, 16, PartialDescription);
                    packetsBuilt += BuildWriteString_w(PartialDescription,3,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,NO_INVERT,0,8,8,0);
                }
            }
            else
            #endif
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // European Description 17..32 / Second line of Description
                    TUSIGN8 PartialDescription[17];
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 17, 16, PartialDescription);

                    #ifdef AZ200_SPECIAL_FEATURES_HMI
                        TUSIGN8 charCount = 0;
                        TBOOL lowercasefound = eFALSE;
                        while ((lowercasefound == eFALSE) && (charCount < 16))
                        {
                            if ((PartialDescription[charCount] >= 'a') && (PartialDescription[charCount] <= 'z'))
                            {
                                lowercasefound = eTRUE;
                                strcpy((char *)PartialDescription,"");
                            }
                            charCount ++;
                        }
                    #endif

                    packetsBuilt += BuildWriteString(PartialDescription,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,3,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,16,0);
                }
                else
                {
                    // European Description 17..32 / Second line of Description
                    TUSIGN8 PartialDescription[17];
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 17, 16, PartialDescription);
                    packetsBuilt += BuildWriteString(PartialDescription,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,3,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,16,0);
                }
            }
        #endif
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_TEXT_ON_4,                // Alarm Text on line 4                         |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_TEXT_ON_4)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Skip this line (this line will be used for alarm count)
                    LOCAL_packetStage ++;
                }
                else
                {

                    // Asian Description 17..24 / First line of recovery text
                    TUSIGN8 PartialRecoveryText[17];

                    #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullRecoveryAct, 1, 16, PartialRecoveryText);
                    #else
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 33, 16, PartialRecoveryText);
                    #endif

                    packetsBuilt += BuildWriteString_w(PartialRecoveryText,4,JUSTIFY_LEFT_WITH_INDENT_6_PIXEL,NO_INVERT,0,8,8,0);
                }
            }
            else
            #endif
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Skip this line (this line will be used for alarm count)
                    LOCAL_packetStage ++;
                }
                else
                {
                    // European Description 33..48 / First line of recovery text
                    TUSIGN8 PartialRecoveryText[17];
                    #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullRecoveryAct, 1, 16, PartialRecoveryText);
                    #else
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 33, 16, PartialRecoveryText);
                    #endif
                    packetsBuilt += BuildWriteString(PartialRecoveryText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_LEFT_WITH_INDENT_1,FONT_0,NO_INVERT,0,0,16,0);
                }
            }

        #else

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Skip this line (this line will be used for alarm total time active)
                    LOCAL_packetStage ++;
                }
                else
                {
                    // Skip this line (this line has been used for Asian Description 1..8)
                    LOCAL_packetStage ++;
                }
            }
            else
            #endif
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Skip this line (this line will be used for alarm count)
                    LOCAL_packetStage ++;
                }
                else
                {
                    // European Description 33..48 / First line of recovery text
                    TUSIGN8 PartialRecoveryText[17];
                    #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullRecoveryAct, 1, 16, PartialRecoveryText);
                    #else
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 33, 16, PartialRecoveryText);
                    #endif
                    packetsBuilt += BuildWriteString(PartialRecoveryText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,16,0);
                }
            }
        #endif
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_TEXT_ON_5,                // Alarm Text on line 5                         |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_TEXT_ON_5)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Skip this line (this line will be used for alarm total time active)
                    LOCAL_packetStage ++;
                }
                else
                {
                    // Asian Description 25..32 / Second line of recovery text
                    TUSIGN8 PartialRecoveryText[17];
                    #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullRecoveryAct, 17, 16, PartialRecoveryText);
                    #else
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 49, 16, PartialRecoveryText);
                    #endif
                    packetsBuilt += BuildWriteString_w(PartialRecoveryText,5,JUSTIFY_LEFT_WITH_INDENT_6_PIXEL,NO_INVERT,0,8,8,0);
                }
            }
            else
            #endif
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Skip this line (this line will be used for alarm total time active)
                    LOCAL_packetStage ++;
                }
                else
                {
                    // European Description 49..64 / Second line of recovery text
                    TUSIGN8 PartialRecoveryText[17];
                    #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullRecoveryAct, 17, 16, PartialRecoveryText);
                    #else
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 49, 16, PartialRecoveryText);
                    #endif
                    packetsBuilt += BuildWriteString(PartialRecoveryText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_LEFT_WITH_INDENT_1,FONT_0,NO_INVERT,0,0,16,0);
                }
            }

        #else

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Skip this line (this line will be used for alarm most recent activation)
                    LOCAL_packetStage ++;
                }
                else
                {
                    // Blank line
                    TUSIGN8 customchar = 0x00;
                    packetsBuilt += BuildCustomCharacterString(&customchar, 1, 18, 6, 100, 0);
                }
            }
            else
            #endif
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Skip this line (this line will be used for alarm total time active)
                    LOCAL_packetStage ++;
                }
                else
                {
                    // European Description 49..64 / Second line of recovery text
                    TUSIGN8 PartialRecoveryText[17];
                    #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullRecoveryAct, 17, 16, PartialRecoveryText);
                    #else
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 49, 16, PartialRecoveryText);
                    #endif
                    packetsBuilt += BuildWriteString(PartialRecoveryText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,16,0);
                }
            }
        #endif
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_TEXT_ON_6,                // Alarm Text on line 6                         |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_TEXT_ON_6)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Skip this line (this line will be used for alarm most recent activation)
                    LOCAL_packetStage ++;
                }
                else
                {
                    // Asian Description 33..40 / Third line of recovery text
                    TUSIGN8 PartialRecoveryText[17];
                    #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullRecoveryAct, 25, 16, PartialRecoveryText);
                    #else
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 65, 16, PartialRecoveryText);
                    #endif
                    packetsBuilt += BuildWriteString_w(PartialRecoveryText,6,JUSTIFY_LEFT_WITH_INDENT_6_PIXEL,NO_INVERT,0,8,8,0);
                }
            }
            else
            #endif
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Skip this line (this line will be used for alarm most recent activation)
                    LOCAL_packetStage ++;
                }
                else
                {
                    // European Description 65..80 / Third line of recovery text
                    TUSIGN8 PartialRecoveryText[17];
                    #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullRecoveryAct, 25, 16, PartialRecoveryText);
                    #else
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 65, 16, PartialRecoveryText);
                    #endif
                    packetsBuilt += BuildWriteString(PartialRecoveryText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_LEFT_WITH_INDENT_1,FONT_0,NO_INVERT,0,0,16,0);
                }
            }

        #else

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Skip this line (this line will be used for softkeys)
                    LOCAL_packetStage ++;
                }
                else
                {
                    // Skip this line (this line will be used for softkeys)
                    LOCAL_packetStage ++;
                }
            }
            else
            #endif
            {
                if ((specialMenuFlag == 6) || (specialMenuFlag == 5))
                {
                    // Skip this line (this line will be used for alarm most recent activation)
                    LOCAL_packetStage ++;
                }
                else
                {
                    // European Description 65..80 / Third line of recovery text
                    TUSIGN8 PartialRecoveryText[17];
                    #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullRecoveryAct, 25, 16, PartialRecoveryText);
                    #else
                    PacketManagerBuilderServices_GetPartialDiagnosticDescription(FullDescription, 65, 16, PartialRecoveryText);
                    #endif
                    packetsBuilt += BuildWriteString(PartialRecoveryText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,16,0);
                }
            }
        #endif
    }

#ifdef DISPLAY_DIAGNOSIS_CONDITION_DETAILS
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_COUNT,                    // Alarm Count                                  |
// DIAG_FRAME_PACKET_TOTAL_TIME_ACTIVE,        // Total Time Active                            |
// DIAG_FRAME_PACKET_TOTAL_TIME_ACTIVE_ID,     // ID for "Total Time Active"                   |
// DIAG_FRAME_PACKET_ELAPSED_TIME,             // Time Elapsed since last activation           |
// DIAG_FRAME_PACKET_ELAPSED_TIME_ID,          // ID for "Time Elapsed since last activation"  |
//---------------------------------------------//----------------------------------------------|
    if ((LOCAL_packetStage >= DIAG_FRAME_PACKET_COUNT)
     && (LOCAL_packetStage <= DIAG_FRAME_PACKET_ELAPSED_TIME_ID))
    {
        if (FrameTable_isDiagDetailsViewActive())
        {
            LOCAL_packetStage = DIAG_FRAME_PACKET_ELAPSED_TIME_ID + 1;
        }
    }
#endif
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_COUNT,                    // Alarm Count                                  |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_COUNT)
    {
        if ((specialMenuFlag != 6) && (specialMenuFlag != 5))
        {
            // Skip this line (this line has been used for part of the alarm description)
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 lineText[18];

            if (BlankDisplay)
            {
                strcpy((char*)lineText,"");
            }
            else
            {
                TUSIGN8 numberText[6];
                lineText[0] = 'n';
                lineText[1] = ' ';
                lineText[2] = ':';
                lineText[3] = 0x00;

                (void)PacketManagerConvertValue(AlarmCount, numberText, eFALSE);
                (void)strcat((char *)lineText,(char *)numberText);
            }

            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildWriteString(lineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_LEFT_WITH_INDENT_1,FONT_0,NO_INVERT,0,0,17,0);
                }
                else
                #endif
                {
                    packetsBuilt += BuildWriteString(lineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_LEFT_WITH_INDENT_1,FONT_0,NO_INVERT,0,0,17,0);
                }

            #else

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildWriteString(lineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,3,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,17,0);
                }
                else
                #endif
                {
                    packetsBuilt += BuildWriteString(lineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,17,0);
                }
            #endif
        }
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_TOTAL_TIME_ACTIVE,        // Total Time Active                            |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_TOTAL_TIME_ACTIVE)
    {
        if ((specialMenuFlag != 6) && (specialMenuFlag != 5))
        {
            // Skip this line (this line has been used for part of the alarm description)
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 lineText[16];

            if (BlankDisplay)
            {
                strcpy((char*)lineText,"");
            }
            else
            {
                TUSIGN8 numberText[6];

                TUSIGN16 seconds = (TUSIGN16)((AlarmTime_msec / 1000) % 60);
                TUSIGN16 minutes = (TUSIGN16)((AlarmTime_msec / 60000) % 60);
                TUSIGN16 hours   = (TUSIGN16)(AlarmTime_msec / 3600000);

                lineText[0] = ':';
                lineText[1] = 0x00;

                if (AlarmTime_day != 0)
                {
                    (void)PacketManagerConvertValue(AlarmTime_day, numberText, eFALSE);
                    (void)strcat((char *)lineText,(char *)numberText);
                    (void)strcat((char *)lineText,"d ");
                }

                (void)PacketManagerConvertValue(hours , numberText, eTRUE);
                (void)strcat((char *)lineText,(char *)numberText);
                (void)strcat((char *)lineText,"h ");

                (void)PacketManagerConvertValue(minutes , numberText, eTRUE);
                (void)strcat((char *)lineText,(char *)numberText);
                (void)strcat((char *)lineText,"m");

                if (AlarmTime_day < 10)
                {
                    (void)strcat((char *)lineText," ");

                    (void)PacketManagerConvertValue(seconds , numberText, eTRUE);
                    (void)strcat((char *)lineText,(char *)numberText);
                    (void)strcat((char *)lineText,"s");
                }
            }
            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildWriteString(lineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_LEFT_WITH_INDENT_3,FONT_0,NO_INVERT,0,0,15,0);
                }
                else
                #endif
                {
                    packetsBuilt += BuildWriteString(lineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_LEFT_WITH_INDENT_3,FONT_0,NO_INVERT,0,0,15,0);
                }

            #else

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildWriteString(lineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_LEFT_WITH_INDENT_31_PIXEL,FONT_0,NO_INVERT,0,0,15,0);
                }
                else
                #endif
                {
                    packetsBuilt += BuildWriteString(lineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_LEFT_WITH_INDENT_31_PIXEL,FONT_0,NO_INVERT,0,0,15,0);
                }
            #endif
        }
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_TOTAL_TIME_ACTIVE_ID,     // ID for "Total Time Active"                   |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_TOTAL_TIME_ACTIVE_ID)
    {
        if ((specialMenuFlag != 6) && (specialMenuFlag != 5))
        {
            // Skip this line (this line has been used for part of the alarm description)
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 customChar[11] = {0x63,0x55,0x49,0x41,0x41,0x00,0x04,0x3E,0x44,0x40,0x20};

            if (BlankDisplay)
            {
                TUSIGN8 i;
                for(i = 0; i < 11; i ++)
                {
                    customChar[1] = 0x00;
                }
            }
            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 5, 5, 0, 0);
                }
                else
                #endif
                {
                    packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 5, 5, 0, 0);
                }

            #else

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 19, 4, 0, 0);
                }
                else
                #endif
                {
                    packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 19, 5, 0, 0);
                }
            #endif
        }
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_ELAPSED_TIME,             // Time Elapsed since last activation           |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_ELAPSED_TIME)
    {
        if ((specialMenuFlag != 6) && (specialMenuFlag != 5))
        {
            // Skip this line (this line has been used for part of the alarm description)
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 lineText[16];

            if (BlankDisplay)
            {
                strcpy((char*)lineText,"");
            }
            else
            {
                TUSIGN8 numberText[6];

                TUSIGN16 seconds = (TUSIGN16)((AlarmMostRecent_msec / 1000) % 60);
                TUSIGN16 minutes = (TUSIGN16)((AlarmMostRecent_msec / 60000) % 60);
                TUSIGN16 hours   = (TUSIGN16)(AlarmMostRecent_msec / 3600000);

                lineText[0] = ':';
                lineText[1] = 0x00;

                if (AlarmMostRecent_day != 0)
                {
                    (void)PacketManagerConvertValue(AlarmMostRecent_day, numberText, eFALSE);
                    (void)strcat((char *)lineText,(char *)numberText);
                    (void)strcat((char *)lineText,"d ");
                }

                (void)PacketManagerConvertValue(hours , numberText, eTRUE);
                (void)strcat((char *)lineText,(char *)numberText);
                (void)strcat((char *)lineText,"h ");

                (void)PacketManagerConvertValue(minutes , numberText, eTRUE);
                (void)strcat((char *)lineText,(char *)numberText);
                (void)strcat((char *)lineText,"m");

                if (AlarmMostRecent_day < 10)
                {
                    (void)strcat((char *)lineText," ");
                    (void)PacketManagerConvertValue(seconds , numberText, eTRUE);
                    (void)strcat((char *)lineText,(char *)numberText);
                    (void)strcat((char *)lineText,"s");
                }
            }
            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildWriteString(lineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_LEFT_WITH_INDENT_3,FONT_0,NO_INVERT,0,0,15,0);
                }
                else
                #endif
                {
                    packetsBuilt += BuildWriteString(lineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_LEFT_WITH_INDENT_3,FONT_0,NO_INVERT,0,0,15,0);
                }

            #else

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildWriteString(lineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_LEFT_WITH_INDENT_31_PIXEL,FONT_0,NO_INVERT,0,0,15,0);
                }
                else
                #endif
                {
                    packetsBuilt += BuildWriteString(lineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_LEFT_WITH_INDENT_31_PIXEL,FONT_0,NO_INVERT,0,0,15,0);
                }
            #endif
        }
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_ELAPSED_TIME_ID,          // ID for "Time Elapsed since last activation"  |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_ELAPSED_TIME_ID)
    {
        if ((specialMenuFlag != 6) && (specialMenuFlag != 5))
        {
            // Skip this line (this line has been used for part of the alarm description)
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 customChar[11] = {0x02,0x1F,0x22,0x20,0x10,0x00,0x78,0x10,0x08,0x70,0x00};

            if (BlankDisplay)
            {
                TUSIGN8 i;
                for(i = 0; i < 11; i ++)
                {
                    customChar[1] = 0x00;
                }
            }
            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 5, 6, 0, 0);
                }
                else
                #endif
                {
                    packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 5, 6, 0, 0);
                }

            #else

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 19, 5, 0, 0);
                }
                else
                #endif
                {
                    packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 19, 6, 0, 0);
                }
            #endif
        }
    }

#ifdef DISPLAY_DIAGNOSIS_CONDITION_DETAILS
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_DETAILS_CLEAR_LINE2       //                                              |
// DIAG_FRAME_PACKET_DETAILS_CLEAR_LINE6       //                                              |
//---------------------------------------------//----------------------------------------------|
    if ((LOCAL_packetStage >= DIAG_FRAME_PACKET_DETAILS_CLEAR_LINE2)
     && (LOCAL_packetStage <= DIAG_FRAME_PACKET_DETAILS_CLEAR_LINE6))
    {
        TBOOL AsianDisplay = eFALSE;

        #ifdef HMI_SUPPORTS_ASIAN
        AsianDisplay = LOCAL_Asian
        #endif

        if ((FrameTable_isDiagDetailsViewActive() == eFALSE) || (AsianDisplay))
        {
            LOCAL_packetStage = DIAG_FRAME_PACKET_DETAILS_CLEAR_LINE6 + 1;
        }
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_DETAILS_CLEAR_LINE2       //                                              |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_DETAILS_CLEAR_LINE2)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,2,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,16,0);
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_DETAILS_CLEAR_LINE6       //                                              |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_DETAILS_CLEAR_LINE6)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,6,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,16,0);
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_DETAILS_1                 //                                              |
// DIAG_FRAME_PACKET_DETAILS_2                 //                                              |
// DIAG_FRAME_PACKET_DETAILS_3                 //                                              |
//---------------------------------------------//----------------------------------------------|
    if ((LOCAL_packetStage >= DIAG_FRAME_PACKET_DETAILS_1)
     && (LOCAL_packetStage <= DIAG_FRAME_PACKET_DETAILS_3))
    {
        if (FrameTable_isDiagDetailsViewActive() == eFALSE)
        {
            LOCAL_packetStage = DIAG_FRAME_PACKET_DETAILS_3 + 1;
        }
        else
        {
            TUSIGN8 startPacket, lineNumber, DetailsNumber;

            TUSIGN8 DiagDetails[17];
            TUSIGN8 subIdx,alarm;
            TUSIGN8 h,t,u;

            do
            {
                startPacket   = LOCAL_packetStage;
                DetailsNumber = (LOCAL_packetStage - DIAG_FRAME_PACKET_DETAILS_1) + DetailsSelection;
                lineNumber    = (LOCAL_packetStage - DIAG_FRAME_PACKET_DETAILS_1) + 3;

                if (DetailsNumber > Adjuster_GetDiagDetailsViewCursorMax())
                {
                    strcpy((char *)DiagDetails, "");
                }
                else
                {
                    DiagDetails[ 0] = ((DetailsNumber+1) / 10) + '0';
                    DiagDetails[ 1] = ((DetailsNumber+1) % 10) + '0';
                    DiagDetails[ 2] = ':';
                    DiagDetails[ 3] = 0x00;

                    if (Adjuster_GetDiagDetails(AlarmID, DetailsNumber, &subIdx, &alarm))
                    {
                        DiagDetails[ 3] = ' ';

                        h = subIdx / 100;
                        t = (subIdx % 100) / 10;
                        u = subIdx % 10;

                        DiagDetails[ 4] = subIdx > 99 ? h + '0' : ' ';
                        DiagDetails[ 5] = subIdx > 9  ? t + '0' : ' ';
                        DiagDetails[ 6] = u + '0';

                        DiagDetails[ 7] = '/';

                        h = alarm / 100;
                        t = (alarm % 100) / 10;
                        u = alarm % 10;

                        DiagDetails[ 8] = h + '0';
                        DiagDetails[ 9] = t + '0';
                        DiagDetails[10] = u + '0';

                        DiagDetails[11] = 0x00;
                    }
                }
                packetsBuilt += BuildWriteString(DiagDetails,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,lineNumber,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,16,0);
            }
            while ((LOCAL_packetStage <= DIAG_FRAME_PACKET_DETAILS_3) && (LOCAL_packetStage != startPacket));
        }
    }

//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE1   //                                              |
// DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE2   //                                              |
// DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE3   //                                              |
// DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE4   //                                              |
// DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE5   //                                              |
// DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE6   //                                              |
//---------------------------------------------//----------------------------------------------|
    if ((LOCAL_packetStage >= DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE1)
     && (LOCAL_packetStage <= DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE6))
    {
        if (FrameTable_isDiagDetailsViewActive() == eFALSE)
        {
            LOCAL_packetStage = DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE6 + 1;
        }
        else
        {
            TUSIGN8 y_pos, startPacket;
            do
            {
                #ifdef HMI_SUPPORTS_ASIAN
                if ((LOCAL_Asian) && (LOCAL_packetStage > DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE5))
                {
                    LOCAL_packetStage ++;
                }
                else
                #endif
                {
                    startPacket = LOCAL_packetStage;
                    y_pos  = (LOCAL_packetStage - DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE1) + 1;

                    packetsBuilt += BuildWriteArray(Blank_Icon, 3, MAX_COMMON_HMI_WIDTH - 3, y_pos, 0);
                }
            }
            while ((LOCAL_packetStage <= DIAG_FRAME_PACKET_REMOVE_SLIDER_BAR_lINE6) && (LOCAL_packetStage != startPacket));
        }
    }
#endif

//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_SLIDER_BAR,               // Slider Bar                                   |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_SLIDER_BAR)
    {
        #ifdef DISPLAY_DIAGNOSIS_CONDITION_DETAILS
        if (FrameTable_isDiagDetailsViewActive())
        {
            LOCAL_packetStage ++;
        }
        else
        #endif
        {
            if (BlankDisplay)
            {
                #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
                LOCAL_packetStage ++;
                #else
                packetsBuilt += BuildSliderBar(1,0,0);
                #endif
            }
            else
            {
                #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
                packetsBuilt += BuildWriteIcon(ICON_SCROLL_ARROWS, 0, 7, 0);
                #else
                packetsBuilt += BuildSliderBar((TINT16)(AdjusterGetNumberOfAlarmConditions((TBOOL)(specialMenuFlag == 3 ? eTRUE : eFALSE)) - 1),(TINT16)AlarmSelection, 0);
                #endif
            }
        }
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_SLIDER_BAR_OVERWRITE,     // Remove Slider bar Number                     |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_SLIDER_BAR_OVERWRITE)
    {
        TUSIGN8 CustomChar = 0x00;
        packetsBuilt += BuildCustomCharacterString(&CustomChar, 1, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 11, 0);
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_RIGHT_KEY,                // Right function key  "Exit"                   |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_RIGHT_KEY)
    {
        if ((specialMenuFlag == 5)  // 5-Alarm History,
         || (specialMenuFlag == 6)) // 6-Secure Alarm History
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
        }
        else
        {
            #ifdef DISPLAY_DIAGNOSIS_CONDITION_DETAILS
            if (FrameTable_isDiagDetailsViewActive())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            }
            else
            {
                #ifdef DISPLAY_DIAGNOSIS_CONDITION_DETAILS_OVERRIDE_ARM
                TUSIGN8 ARM_Level  = ARM_ACCESS_SERVICE;
                #else
                TUSIGN8 ARM_Level  = AdjusterGetARMLevel();
                #endif

                if (ARM_Level == ARM_ACCESS_SERVICE)
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_DETAILS;
                }
                else
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
                }
            }
            #else
            LOCAL_stringtable_text_id.attribIdx = IDS_EXIT;
            #endif
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }
//---------------------------------------------//----------------------------------------------|
// DIAG_FRAME_PACKET_LEFT_KEY,                 // Left function key  "Back"                    |
//---------------------------------------------//----------------------------------------------|
    if (LOCAL_packetStage == DIAG_FRAME_PACKET_LEFT_KEY)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_BACK;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,1);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,1);
        }
    }
    return packetsBuilt;
}

// end of "#ifdef HMI_USES_COMMONDIAGNOSTICS"
#endif

// end of "#if HMI_SUPPORTS_MENU_FRAMES"
#endif

#ifdef HMI_SUPPORTS_NUMERICAL_PARAM_FRAMES
// No restriction on the optimization of this function
TUSIGN8 BuildNumericalViewFrame(void)
{

typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    NUMERICAL_VIEW_FRAME_PACKET_TITLE_BAR,      // Title Bar "-------Device--------"       | - Start of Static Area
                                                //-----------------------------------------|
    NUMERICAL_VIEW_FRAME_PACKET_ID_2,           // Secondary Identifier                    |
                                                //-----------------------------------------|
    NUMERICAL_VIEW_FRAME_PACKET_TITLE,          // Parameter title                         |
                                                //-----------------------------------------|
    NUMERICAL_VIEW_FRAME_PACKET_LEFT_KEY,       // left function key  "Back"/"Next"        |
                                                //-----------------------------------------|
#ifndef DISABLE_BACK_MOVE_SELECT
                                                //-----------------------------------------|
    NUMERICAL_VIEW_FRAME_PACKET_BMS_ICON_6,     // BACK_MOVE_SELECT (UP/Down) Icon         |
                                                //-----------------------------------------|
    NUMERICAL_VIEW_FRAME_PACKET_BMS_ICON_7,     // BACK_MOVE_SELECT (UP/Down) Icon         |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    NUMERICAL_VIEW_FRAME_PACKET_VALUE,          // Parameter value & units                 | - Start of active area
                                                //-----------------------------------------|
    NUMERICAL_VIEW_FRAME_PACKET_SLIDER_BAR,     // Slider bar                              |
                                                //-----------------------------------------|
    NUMERICAL_VIEW_FRAME_PACKET_RIGHT_KEY,      // right function key "Edit"               |
                                                //-----------------------------------------|
    NUMERICAL_VIEW_FRAME_PACKET_READ_SWITCHES   //                                         |
                                                //-----------------------------------------| - There is no keypress area
}NUMERICAL_VIEW_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;

    #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
    TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
    TBOOL SecondaryIdentifierActive = FrameTableGetSecondaryIdentifier(SecondaryIdentifierText);
    #endif

    #ifdef HMI_SUPPORTS_INTEGER_FRAMES
    TBOOL   IntegerFrame = eFALSE;
    if ((LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_INTEGER_PARAM) || (LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_INTEGER_PARAM_NO_EDIT))
    {
        IntegerFrame = eTRUE;
    }
    #endif

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = NUMERICAL_VIEW_FRAME_PACKET_TITLE_BAR;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > NUMERICAL_VIEW_FRAME_PACKET_VALUE))
    {
        LOCAL_packetStage = NUMERICAL_VIEW_FRAME_PACKET_VALUE;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == NUMERICAL_VIEW_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = NUMERICAL_VIEW_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// NUMERICAL_VIEW_FRAME_PACKET_TITLE_BAR       // Title Bar "-------Device--------"       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_VIEW_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.titleBar_attribidx;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),MAX_ASIAN_TITLE_LEN,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// NUMERICAL_VIEW_FRAME_PACKET_ID_2            // Secondary Identifier                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_VIEW_FRAME_PACKET_ID_2)
    {
        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        if (SecondaryIdentifierActive)
        {
            packetsBuilt += BuildWriteString(SecondaryIdentifierText,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,1,JUSTIFY_AS_SECONDARY_IDENTIFER,FONT_0,NO_INVERT,0,0,SECONDARY_IDENTIFIER_LEN,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// NUMERICAL_VIEW_FRAME_PACKET_TITLE           // Parameter title                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_VIEW_FRAME_PACKET_TITLE)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.title_attribidx;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,1,ASIAN_MAX_CHARS,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT,FONT_1,NO_INVERT,0,0,1,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_VIEW_FRAME_PACKET_LEFT_KEY        // left function key  "Back"/"Next"        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_VIEW_FRAME_PACKET_LEFT_KEY)
    {
        #ifdef HMI_SUPPORTS_SEQUENCES
        if (FrameTableIsSequenceEnabled())
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_EASYSETUP
            if (LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.easySetupFlag != 0)
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
            }
        }

#ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
        }
        else
#endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }

#ifndef DISABLE_BACK_MOVE_SELECT
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_VIEW_FRAME_PACKET_BMS_ICON_6,     // BACK_MOVE_SELECT (UP/Down) Icon         |
// NUMERICAL_VIEW_FRAME_PACKET_BMS_ICON_7,     // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage == NUMERICAL_VIEW_FRAME_PACKET_BMS_ICON_6)
     || (LOCAL_packetStage == NUMERICAL_VIEW_FRAME_PACKET_BMS_ICON_7))
    {
        if (!FrameTableIsBackMoveSelectAvailable(LOCAL_pCurrDisplayFrame))
        {
            LOCAL_packetStage = NUMERICAL_VIEW_FRAME_PACKET_BMS_ICON_7 + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_VIEW_FRAME_PACKET_BMS_ICON_6,     // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_VIEW_FRAME_PACKET_BMS_ICON_6)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage ++;
        #else
            packetsBuilt += BuildCustomCharacterString(UpKey, UP_DOWN_ICON_FIELD_WIDTH, UP_DOWN_ICON_POS, 6, 0, 0);
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_VIEW_FRAME_PACKET_BMS_ICON_7,     // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_VIEW_FRAME_PACKET_BMS_ICON_7)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            packetsBuilt += BuildWriteIcon(ICON_SCROLL_ARROWS, 0, 7, 0);
        #else
            packetsBuilt += BuildCustomCharacterString(DownKey, UP_DOWN_ICON_FIELD_WIDTH, UP_DOWN_ICON_POS, 7, 0, 0);
        #endif
    }
#endif
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_VIEW_FRAME_PACKET_VALUE           // Parameter value & units                 |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_VIEW_FRAME_PACKET_VALUE)
    {
        ADJUST_DATA tVal, tHigh, tLow, tInc;
        TUSIGN8 tType;
        TUSIGN8 units[18] = "";
        TUSIGN8 value_and_units[22] = "";
        TUSIGN8 *pNumber;
        TUSIGN8 negNumber;
        TUSIGN8 within_over_under;

        ATTRIB_IDENTIFIER_TYPE valueID;
//        T_RANGE_E8 enumRange;
        TBOOL rulesAreActive;

        #ifdef HMI_SUPPORTS_INTEGER_FRAMES
        TUSIGN32 Value32 = 0;
        #endif

        TUSIGN16 GetValueResult;

        valueID = LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.value;

        #ifdef HMI_SUPPORTS_INTEGER_FRAMES
        if (IntegerFrame)
        {
            // Get Integer Value
            T_UNIT const SLOW *pSub = GetSubsystemPtr((T_SUBSYSTEM_IDX)valueID.ssIdx);
            GetValueResult = pSub->Get(pSub,(TUSIGN16)valueID.objIdx,(TINT16)valueID.attribIdx,(void FAST *)&Value32);
        }
        else
        #endif
        {
            GetValueResult = AdjusterGetFloatValueAndLimits((TUSIGN16)valueID.ssIdx,
                                                            (TUSIGN16)valueID.objIdx,
                                                            valueID.attribIdx,
                                                            &tVal,
                                                            &tHigh,
                                                            &tLow,
                                                            &tInc,
                                                            &rulesAreActive,
                                                            &tType);
        }

        if (GetValueResult == (TUSIGN16)OK)
        {
            (void)strncpy((char *)units,
                          (const char *)PacketManagerGetEngUnits((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.engUnits.ssIdx,
                                                                 LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.engUnits.objIdx,
                                                                 LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.engUnits.attribIdx,
                                                                 LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.engUnitsType),
                          17
                         );

            #ifdef HMI_SUPPORTS_CUSTOM_UNITS
            PacketManagerRemoveCustomfromUnits(units);
            #endif

            LimitTextLength(units,8);

            #ifdef HMI_SUPPORTS_INTEGER_FRAMES
            if (IntegerFrame)
            {
                pNumber = AdjusterBuildNumberStringFromUSIGN32(Value32,LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes,&within_over_under);
                negNumber = 0;
            }
            else
            #endif
            {
                #ifdef HMI_USES_DOUBLE
                if (tType == ST_DOUBLE)
                {
                    pNumber = AdjusterBuildNumberStringFromDouble(tVal.data_D,
                                                                  LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters,
                                                                  LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.characterSet_dpPosn,
                                                                  &negNumber,
                                                                  &within_over_under);
                }
                else
                #endif
                {
                    pNumber = AdjusterBuildNumberString(tVal.data_F,
                                                        LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters,
                                                        LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.characterSet_dpPosn,
                                                        &negNumber,
                                                        &within_over_under);
                }
            }

            if ((within_over_under == 1) || (within_over_under == 2))
            {
                // overrange or underrange
                TUSIGN8 i;
                value_and_units[0] = 0x20;
                LOCAL_overrangeValue_EditNotAllowed = eTRUE;

                for (i = 1; i <= LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters; )
                {
                    value_and_units[i] = 0x05 + within_over_under;
                    i++;
                    value_and_units[i] = 0x00;
                }
            }
            else
            {
                LOCAL_overrangeValue_EditNotAllowed = eFALSE;

                // value within range or a normal numerical frame with an edit
                while (*pNumber == 0x20)
                {
                    #pragma diag_suppress=Pm088
                    pNumber ++;
                    #pragma diag_default=Pm088
                }

                if (negNumber)
                {
                    value_and_units[0] = '-';
                    value_and_units[1] = 0x00;
                }
                (void)strcat((char *)value_and_units,(char *)pNumber);
            }
            (void)strcat((char *)value_and_units," ");
            (void)strcat((char *)value_and_units,(char *)units);
        }
        else
        {
            value_and_units[0] = 0x00;
        }
        packetsBuilt += BuildWriteString(value_and_units,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_RIGHT_WITH_INDENT_1,FONT_1,NO_INVERT,0,0,16,0);
    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_VIEW_FRAME_PACKET_SLIDER_BAR      // Slider bar                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_VIEW_FRAME_PACKET_SLIDER_BAR)
    {
        #ifdef HMI_SUPPORTS_EASYSETUP
        if (LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.easySetupFlag != 0)
        {
            TUSIGN8 lastStage, currentStage;
            FrameTableGetEasySetupStages(&lastStage, &currentStage);

            packetsBuilt += BuildSliderBar((TINT16)lastStage,(TINT16)currentStage,0);
        }
        else
        #endif
        {
            TUSIGN8 high,actual;
            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            FrameTableGetMenuPositionDetailsForTFT(&actual, &high);
            #else
            FrameTableAccessMenuPositionDetails(&actual, &high, eTRUE);
            #endif
            packetsBuilt += BuildSliderBar((TINT16)high,(TINT16)actual,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_VIEW_FRAME_PACKET_RIGHT_KEY       // right function key "Edit"               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_VIEW_FRAME_PACKET_RIGHT_KEY)
    {
        ATTRIB_IDENTIFIER_TYPE valueID = LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.value;

        if ((WriteProtect_HMICanAccess(valueID, (TUSIGN8)0))
         && (LOCAL_pCurrDisplayFrame->frameType != FRAME_TYPE_NUMERICAL_PARAM_NO_EDIT))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_EDIT;
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,1);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,1);
        }
    }
    return packetsBuilt;
}

// this function not size optimized beyond medium
#ifdef OPTIMIZE_V3_4
#pragma optimize=size medium
#else
#pragma optimize=z 6
#endif
TUSIGN8 BuildNumericalEditFrame(void)
{

typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    NUMERICAL_EDIT_FRAME_PACKET_TITLE_BAR,      // Parameter title                         | - Start of Static Area
                                                //-----------------------------------------|
    NUMERICAL_EDIT_FRAME_PACKET_ICON,           // Title Bar Icon                          |
                                                //-----------------------------------------|
    NUMERICAL_EDIT_FRAME_PACKET_ID_2,           // Secondary Identifier                    |
                                                //-----------------------------------------|
    NUMERICAL_EDIT_FRAME_PACKET_LEFT_KEY,       // left function key  "Next"               |
                                                //-----------------------------------------|
    NUMERICAL_EDIT_FRAME_PACKET_UNITS,          // Engineering Units                       | - Start of active area
                                                //-----------------------------------------|
    NUMERICAL_EDIT_FRAME_PACKET_MAX,            // High Limit                              | - Start of keypress area
                                                //-----------------------------------------|
    NUMERICAL_EDIT_FRAME_PACKET_MIN,            // Low Limit                               |
                                                //-----------------------------------------|
    NUMERICAL_EDIT_FRAME_PACKET_RIGHT_KEY,      // right function key "OK" / "Cancel"      |
                                                //-----------------------------------------|
    NUMERICAL_EDIT_FRAME_PACKET_MAX_ICON,       // High Limit icon or text                 |
                                                //-----------------------------------------|
    NUMERICAL_EDIT_FRAME_PACKET_MIN_ICON,       // Low Limit icon or text                  |
                                                //-----------------------------------------|
    NUMERICAL_EDIT_FRAME_PACKET_VALUE,          // Parameter value & units                 |
                                                //-----------------------------------------|
    NUMERICAL_EDIT_FRAME_PACKET_READ_SWITCHES   //                                         |
                                                //-----------------------------------------|
}NUMERICAL_EDIT_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;
    TUSIGN8 text[22];

    ADJUST_DATA tVal, tHigh, tLow, tInc;
    TUSIGN8 tType;
    TUSIGN8 LimitError = 0;
    TUSIGN16 errorCode;

    TBOOL rulesAreActive;

    tHigh.data_F = 0.0F;
    tLow.data_F = 0.0F;
    #ifdef HMI_USES_DOUBLE
    tHigh.data_D = 0.0;
    tLow.data_D = 0.0;
    #endif

    #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
    TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
    TBOOL SecondaryIdentifierActive = FrameTableGetSecondaryIdentifier(SecondaryIdentifierText);
    #endif

    #ifdef HMI_SUPPORTS_INTEGER_FRAMES
    TBOOL   IntegerFrame = eFALSE;
    if ((LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_INTEGER_PARAM) || (LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_INTEGER_PARAM_NO_EDIT))
    {
        IntegerFrame = eTRUE;
    }
    #endif

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = NUMERICAL_EDIT_FRAME_PACKET_TITLE_BAR;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > NUMERICAL_EDIT_FRAME_PACKET_UNITS))
    {
        LOCAL_packetStage = NUMERICAL_EDIT_FRAME_PACKET_UNITS;
    }
    else if ((LOCAL_keypressProcessed) && (LOCAL_packetStage > NUMERICAL_EDIT_FRAME_PACKET_MAX))
    {
        LOCAL_packetStage = NUMERICAL_EDIT_FRAME_PACKET_MAX;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == NUMERICAL_EDIT_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = NUMERICAL_EDIT_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// NUMERICAL_EDIT_FRAME_PACKET_TITLE_BAR       // Parameter title                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_EDIT_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.title_attribidx;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),MAX_ASIAN_TITLE_LEN,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_EDIT_FRAME_PACKET_ICON            // Title Bar Icon                          |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_EDIT_FRAME_PACKET_ICON)
    {
        packetsBuilt += BuildWriteIcon(ICON_NUMBER_EDIT, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_EDIT_FRAME_PACKET_ID_2            // Secondary Identifier                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_EDIT_FRAME_PACKET_ID_2)
    {
        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        if (SecondaryIdentifierActive)
        {
            packetsBuilt += BuildWriteString(SecondaryIdentifierText,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,1,JUSTIFY_AS_SECONDARY_IDENTIFER,FONT_0,NO_INVERT,0,0,SECONDARY_IDENTIFIER_LEN,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_EDIT_FRAME_PACKET_LEFT_KEY        // left function key  "Next"               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_EDIT_FRAME_PACKET_LEFT_KEY)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_EDIT_FRAME_PACKET_UNITS           // Engineering Units                       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_EDIT_FRAME_PACKET_UNITS)
    {
        TUSIGN8 lineNumber = 2;

        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
        if (FrameTableGetSecondaryIdentifier(SecondaryIdentifierText) == eTRUE)
        {
            lineNumber ++;
        }
        #endif

        // return value of "strcpy()" ignored
        //lint -e{534} Roger Arnold 2005-1-31
        strcpy((char *)text,
               (const char *)PacketManagerGetEngUnits((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.engUnits.ssIdx,
                                                      LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.engUnits.objIdx,
                                                      LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.engUnits.attribIdx,
                                                      LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.engUnitsType)
              );

        #ifdef HMI_SUPPORTS_CUSTOM_UNITS
        PacketManagerRemoveCustomfromUnits(text);
        #endif

        LimitTextLength(text,8);
        packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,8,0);
    }
//      Prepare data for stages NUMERICAL_EDIT_FRAME_PACKET_MAX..NUMERICAL_EDIT_FRAME_PACKET_MIN
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_EDIT_FRAME_PACKET_MAX             // High Limit                              |
// NUMERICAL_EDIT_FRAME_PACKET_MIN             // Low Limit                               |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= NUMERICAL_EDIT_FRAME_PACKET_MAX)
     && (LOCAL_packetStage <= NUMERICAL_EDIT_FRAME_PACKET_MIN))
    {
        #ifdef HMI_SUPPORTS_INTEGER_FRAMES
        if (IntegerFrame)
        {
            T_DO_ATTRIB_RANGE Range;

            T_UNIT const SLOW *pSub = GetSubsystemPtr((T_SUBSYSTEM_IDX)LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.value.ssIdx);
            (void)pSub->GetAttributeDescription(pSub,(TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.value.objIdx,(TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.value.attribIdx,(T_DO_ATTRIB_RANGE FAST*)&Range);
            tHigh.data_32 = Range.range.u32.max;
            tLow.data_32  = Range.range.u32.min;
            rulesAreActive = Range.rulesAreActive;
        }
        else
        #endif
        {
            (void)AdjusterGetFloatValueAndLimits((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.value.ssIdx,
                                                 (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.value.objIdx,
                                                 LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.value.attribIdx,
                                                 &tVal,
                                                 &tHigh,
                                                 &tLow,
                                                 &tInc,
                                                 &rulesAreActive,
                                                 &tType);
        }

        LimitError = AdjusterGetLimitError(&errorCode);
    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_EDIT_FRAME_PACKET_MAX             // High Limit                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_EDIT_FRAME_PACKET_MAX)
    {
        TUSIGN8 *pNumber;
        TUSIGN8 negNumber = 0;
        TUSIGN8 within_over_under = 0;
        TUSIGN8 i;

        text[0] = ' ';
        text[1] = 0x00;

        if (rulesAreActive)
        {
            #ifdef HMI_SUPPORTS_INTEGER_FRAMES
            if (IntegerFrame)
            {
                pNumber = AdjusterBuildNumberStringFromUSIGN32(tHigh.data_32,LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes,&within_over_under);
                negNumber = 0;
            }
            else
            #endif
            {
                #ifdef HMI_USES_DOUBLE
                if (tType == ST_DOUBLE)
                {
                    pNumber = AdjusterBuildNumberStringFromDouble(tHigh.data_D,
                                                                  LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters,
                                                                  LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.characterSet_dpPosn,
                                                                  &negNumber,
                                                                  &within_over_under);
                }
                else
                #endif
                {
                    pNumber = AdjusterBuildNumberString(tHigh.data_F,
                                                        LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters,
                                                        LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.characterSet_dpPosn,
                                                        &negNumber,
                                                        &within_over_under);
                }
            }

            switch (within_over_under)
            {
            case 1: // overrange
                for (i = 0; i <= LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters; i ++)
                {
                    (void)strcat((char *)text,"\x06");
                }
                break;

            case 2: // underrange
                for (i = 0; i <= LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters; i ++)
                {
                    (void)strcat((char *)text,"\x07");
                }
                break;

            default:
                text[0] = negNumber? '-' : ' ';
                text[1] = 0x00;
                while (*pNumber == ' ')
                {
                    #pragma diag_suppress=Pm088
                    pNumber ++;
                    #pragma diag_default=Pm088
                }
                (void)strcat((char *)text,(char *)pNumber);
                break;
            }
        }
        else
        {
            for (i = 0; i <= LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters; i ++)
            {
                (void)strcat((char *)text,"9");
            }
        }

        TUSIGN8 justify = JUSTIFY_LEFT_WITH_INDENT_6;
        #if defined(HMI_SUPPORTS_ASIAN) && (defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION))
        if (LOCAL_Asian)
        {
            justify = JUSTIFY_LEFT_WITH_INDENT_35_PIXEL;
        }
        #endif

        packetsBuilt += BuildWriteString(text,
                                         HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                         4,
                                         justify,
                                         FONT_0,
                                         (TUSIGN8)((LimitError & 0x02) != 0 ? STRING_INVERT:NO_INVERT),
                                         0,
                                         0,
                                         FONT1_MAX_CHARS - 6,
                                         0);

    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_EDIT_FRAME_PACKET_MIN             // Low Limit                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_EDIT_FRAME_PACKET_MIN)
    {
        TUSIGN8 *pNumber;
        TUSIGN8 negNumber = 0;
        TUSIGN8 within_over_under = 0;
        TUSIGN8 i;

        text[0] = ' ';
        text[1] = 0x00;

        if (rulesAreActive)
        {
            #ifdef HMI_SUPPORTS_INTEGER_FRAMES
            if (IntegerFrame)
            {
                pNumber = AdjusterBuildNumberStringFromUSIGN32(tLow.data_32,LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes,&within_over_under);
                negNumber = 0;
            }
            else
            #endif
            {
                #ifdef HMI_USES_DOUBLE
                if (tType == ST_DOUBLE)
                {
                    pNumber = AdjusterBuildNumberStringFromDouble(tLow.data_D,
                                                                  LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters,
                                                                  LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.characterSet_dpPosn,
                                                                  &negNumber,
                                                                  &within_over_under);
                }
                else
                #endif
                {
                    pNumber = AdjusterBuildNumberString(tLow.data_F,
                                                        LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters,
                                                        LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.characterSet_dpPosn,
                                                        &negNumber,
                                                        &within_over_under);
                }
            }
            switch (within_over_under)
            {
            case 1: // overrange
                for (i = 0; i <= LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters; i ++)
                {
                    (void)strcat((char *)text,"\x06");
                }
                break;

            case 2: // underrange
                for (i = 0; i <= LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters; i ++)
                {
                    (void)strcat((char *)text,"\x07");
                }
                break;

            default:
                text[0] = negNumber? '-' : ' ';
                text[1] = 0x00;
                while (*pNumber == ' ')
                {
                    #pragma diag_suppress=Pm088
                    pNumber ++;
                    #pragma diag_default=Pm088
                }
                (void)strcat((char *)text,(char *)pNumber);
                break;
            }
        }

        else
        {
            #ifdef HMI_SUPPORTS_INTEGER_FRAMES
            if ((tType == ST_U8) || (tType == ST_U16) || (tType == ST_U32) || (tType == ST_CHAR) || (tType == ST_WIDECHAR) || (IntegerFrame))
            #else
            if ((tType == ST_U8) || (tType == ST_U16) || (tType == ST_U32) || (tType == ST_CHAR) || (tType == ST_WIDECHAR))
            #endif
            {
                strcat((char *)text,"  0");
            }
            else
            {
                text[0] = negNumber? '-' : ' ';
                text[1] = 0x00;

                for (i = 0; i < LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters; i ++)
                {
                    (void)strcat((char *)text,"9");
                }
            }
        }

        TUSIGN8 justify = JUSTIFY_LEFT_WITH_INDENT_6;
        #if defined(HMI_SUPPORTS_ASIAN) && (defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION))
        if (LOCAL_Asian)
        {
            justify = JUSTIFY_LEFT_WITH_INDENT_35_PIXEL;
        }
        #endif

        packetsBuilt += BuildWriteString(text,
                                         HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                         5,
                                         justify,
                                         FONT_0,
                                         (TUSIGN8)((LimitError & 0x01) != 0 ? STRING_INVERT : NO_INVERT),
                                         0,
                                         0,
                                         FONT1_MAX_CHARS - 6,
                                         0);
    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_EDIT_FRAME_PACKET_RIGHT_KEY       // right function key "OK" / "Cancel"      |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_EDIT_FRAME_PACKET_RIGHT_KEY)
    {
        ATTRIB_IDENTIFIER_TYPE valueID = LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.value;

        TBOOL cursorAtLimit = FrameTableGetCursorPosition() == FrameTableGetCursorPositionLimit() ? eTRUE : eFALSE;

        if ((WriteProtect_HMICanAccess(valueID, (TUSIGN8)0)) && (cursorAtLimit == eFALSE))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_OK;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,0);
            }
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_CANCEL;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,STRING_INVERT,0,3,3,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,STRING_INVERT,0,0,0,0);
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_EDIT_FRAME_PACKET_MAX_ICON        // High Limit icon or text                 |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_EDIT_FRAME_PACKET_MAX_ICON)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_HIGH_LIMIT;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            #if defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION)
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),
                                                   4,
                                                   JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,
                                                   (TUSIGN8)((LimitError & 0x02) != 0 ? STRING_INVERT:NO_INVERT),
                                                   0,
                                                   3,
                                                   3,
                                                   0);
            #else
                TUSIGN8 customChar[11] = {0x00,0x00,0x00,0x09,0x0D,0x5F,0x0D,0x09,0x00,0x00,0x00,};
                packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 0, 4, 0, 0);
            #endif
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                             4,
                                             JUSTIFY_LEFT,
                                             FONT_0,
                                             (TUSIGN8)((LimitError & 0x02) != 0 ? STRING_INVERT:NO_INVERT),
                                             0,
                                             0,
                                             6,
                                             0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_EDIT_FRAME_PACKET_MIN_ICON        // Low Limit icon or text                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_EDIT_FRAME_PACKET_MIN_ICON)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_LOW_LIMIT;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            #if defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION)
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),
                                                   5,
                                                   JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,
                                                   (TUSIGN8)((LimitError & 0x01) != 0 ? STRING_INVERT : NO_INVERT),
                                                   0,
                                                   3,
                                                   3,
                                                   0);
            #else
                TUSIGN8 customChar[11] = {0x00,0x00,0x00,0x48,0x58,0x7D,0x58,0x48,0x00,0x00,0x00};
                packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 0, 5, 0, 0);
            #endif
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                             5,
                                             JUSTIFY_LEFT,
                                             FONT_0,
                                             (TUSIGN8)((LimitError & 0x01) != 0 ? STRING_INVERT : NO_INVERT),
                                             0,
                                             0,
                                             6,
                                             0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// NUMERICAL_EDIT_FRAME_PACKET_VALUE           // Parameter value & units                 |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == NUMERICAL_EDIT_FRAME_PACKET_VALUE)
    {
        TUSIGN8 lineNumber = 1;

        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
        if (FrameTableGetSecondaryIdentifier(SecondaryIdentifierText) == eTRUE)
        {
            lineNumber = 2;
        }
        #endif

        #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
        if (LOCAL_Asian)
        {
            lineNumber = 2;
        }
        #endif



        TUSIGN8 negValue;
        TUSIGN8 *pValue;
        // get parameter value from Adjuster
        pValue = AdjusterGetVariableAsString(&negValue);

        text[0] = negValue ? '-' : ' ';
        text[1] = 0x00;
        (void)strcat((char *)text,(char*)pValue);

        if (FrameTableGetCursorPosition() == FrameTableGetCursorPositionLimit())
        {
            packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_RIGHT_WITH_INDENT_8,FONT_1,NO_INVERT,0,0,1,1);
        }
        else
        {
            packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_RIGHT_WITH_INDENT_8,FONT_1,CHAR_INVERT,FrameTableGetCursorPosition(),0,1,1);
        }
    }
    return packetsBuilt;
}
// end of "#if HMI_SUPPORTS_NUMERICAL_PARAM_FRAMES"
#endif

#ifdef HMI_SUPPORTS_IP_ADDRESS_FRAMES
// No restriction on the optimization of this function
TUSIGN8 BuildIPAddressViewFrame(void)
{
typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    IP_ADDRESS_VIEW_FRAME_PACKET_TITLE_BAR,     // Title Bar "-------Device--------"       | - Start of Static Area
                                                //-----------------------------------------|
    IP_ADDRESS_VIEW_FRAME_PACKET_ID_2,          // Secondary Identifier                    |
                                                //-----------------------------------------|
    IP_ADDRESS_VIEW_FRAME_PACKET_TITLE,         // Parameter title                         |
                                                //-----------------------------------------|
#ifndef DISABLE_BACK_MOVE_SELECT
                                                //-----------------------------------------|
    IP_ADDRESS_VIEW_FRAME_PACKET_BMS_ICON_6,    // BACK_MOVE_SELECT (UP/Down) Icon         |
                                                //-----------------------------------------|
    IP_ADDRESS_VIEW_FRAME_PACKET_BMS_ICON_7,    // BACK_MOVE_SELECT (UP/Down) Icon         |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    IP_ADDRESS_VIEW_FRAME_PACKET_RIGHT_KEY,     // right function key "Edit"               | - Start of active area
                                                //-----------------------------------------|
    IP_ADDRESS_VIEW_FRAME_PACKET_VALUE,         // Parameter Value                         |
                                                //-----------------------------------------|
    IP_ADDRESS_VIEW_FRAME_PACKET_SLIDER_BAR,    // Slider bar                              |
                                                //-----------------------------------------|
    IP_ADDRESS_VIEW_FRAME_PACKET_LEFT_KEY,      // left function key  "Back"/"Next"        |
                                                //-----------------------------------------|
    IP_ADDRESS_VIEW_FRAME_PACKET_READ_SWITCHES  //                                         |
                                                //-----------------------------------------| - There is no keypress area
}IP_ADDRESS_VIEW_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;

    #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
    TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
    TBOOL SecondaryIdentifierActive = FrameTableGetSecondaryIdentifier(SecondaryIdentifierText);
    #endif

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = IP_ADDRESS_VIEW_FRAME_PACKET_TITLE_BAR;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > IP_ADDRESS_VIEW_FRAME_PACKET_RIGHT_KEY))
    {
        LOCAL_packetStage = IP_ADDRESS_VIEW_FRAME_PACKET_RIGHT_KEY;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == IP_ADDRESS_VIEW_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = IP_ADDRESS_VIEW_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_VIEW_FRAME_PACKET_TITLE_BAR,     // Title Bar "-------Device--------"       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_VIEW_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.titleBar_attribidx;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),MAX_ASIAN_TITLE_LEN,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_VIEW_FRAME_PACKET_ID_2,          // Secondary Identifier                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_VIEW_FRAME_PACKET_ID_2)
    {
        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        if (SecondaryIdentifierActive)
        {
            packetsBuilt += BuildWriteString(SecondaryIdentifierText,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,1,JUSTIFY_AS_SECONDARY_IDENTIFER,FONT_0,NO_INVERT,0,0,SECONDARY_IDENTIFIER_LEN,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_VIEW_FRAME_PACKET_TITLE,         // Parameter title                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_VIEW_FRAME_PACKET_TITLE)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.title_attribidx;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,1,ASIAN_MAX_CHARS,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT,FONT_1,NO_INVERT,0,0,1,0);
        }
    }

#ifndef DISABLE_BACK_MOVE_SELECT
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_VIEW_FRAME_PACKET_BMS_ICON_6,    // BACK_MOVE_SELECT (UP/Down) Icon         |
// IP_ADDRESS_VIEW_FRAME_PACKET_BMS_ICON_7,    // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage == IP_ADDRESS_VIEW_FRAME_PACKET_BMS_ICON_6)
     || (LOCAL_packetStage == IP_ADDRESS_VIEW_FRAME_PACKET_BMS_ICON_7))
    {
        if (!FrameTableIsBackMoveSelectAvailable(LOCAL_pCurrDisplayFrame))
        {
            LOCAL_packetStage = IP_ADDRESS_VIEW_FRAME_PACKET_BMS_ICON_7 + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_VIEW_FRAME_PACKET_BMS_ICON_6,    // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_VIEW_FRAME_PACKET_BMS_ICON_6)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage ++;
        #else
            packetsBuilt += BuildCustomCharacterString(UpKey, UP_DOWN_ICON_FIELD_WIDTH, UP_DOWN_ICON_POS, 6, 0, 0);
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_VIEW_FRAME_PACKET_BMS_ICON_7,    // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_VIEW_FRAME_PACKET_BMS_ICON_7)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            packetsBuilt += BuildWriteIcon(ICON_SCROLL_ARROWS, 0, 7, 0);
        #else
            packetsBuilt += BuildCustomCharacterString(DownKey, UP_DOWN_ICON_FIELD_WIDTH, UP_DOWN_ICON_POS, 7, 0, 0);
        #endif
    }
#endif
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_VIEW_FRAME_PACKET_RIGHT_KEY,     // right function key "Edit"               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_VIEW_FRAME_PACKET_RIGHT_KEY)
    {
        if (LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_TIME_AND_DATE_PARAM_NO_EDIT)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
        }
        else if (WriteProtect_HMICanAccess(LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.value, (TUSIGN8)0/*write*/))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_EDIT;
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_VIEW_FRAME_PACKET_VALUE,         // Parameter Value                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_VIEW_FRAME_PACKET_VALUE)
    {
        TUSIGN8 TextLine[16];

        TUSIGN32 IPAddress;
        IP_ADDRESS_HMI IP_Addr_union;

        (void)AdjusterGetAttribute((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.value.ssIdx,
                                   (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.value.objIdx,
                                   LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.value.attribIdx,
                                   (void FAST *)&IPAddress);
    #if defined(IP_ADDRESS_DATA_REVERSED) && (IP_ADDRESS_DATA_REVERSED == 1)
        IP_ADDRESS_HMI *pIPValue32 = (IP_ADDRESS_HMI*)&IPAddress;
        IP_ADDRESS_HMI *pReverseIPValue32 = (IP_ADDRESS_HMI*)&IP_Addr_union.networkAddress;
        pReverseIPValue32->dotted_IP[0] = pIPValue32->dotted_IP[3];
        pReverseIPValue32->dotted_IP[1] = pIPValue32->dotted_IP[2];
        pReverseIPValue32->dotted_IP[2] = pIPValue32->dotted_IP[1];
        pReverseIPValue32->dotted_IP[3] = pIPValue32->dotted_IP[0];
    #else
        IP_Addr_union.networkAddress = IPAddress;
    #endif

        TextLine[0] = '0';
        IPAddress = IP_Addr_union.dotted_IP[0];
        while (IPAddress >= 100)
        {
            IPAddress -= 100;
            TextLine[0] ++;
        }
        TextLine[1] = (IPAddress / 10) + 0x30;
        TextLine[2] = (IPAddress % 10) + 0x30;
        TextLine[3] = '.';

        TextLine[4] = '0';
        IPAddress = IP_Addr_union.dotted_IP[1];
        while (IPAddress >= 100)
        {
            IPAddress -= 100;
            TextLine[4] ++;
        }
        TextLine[5] = (IPAddress / 10) + 0x30;
        TextLine[6] = (IPAddress % 10) + 0x30;
        TextLine[7] = '.';

        TextLine[8] = '0';
        IPAddress = IP_Addr_union.dotted_IP[2];
        while (IPAddress >= 100)
        {
            IPAddress -= 100;
            TextLine[8] ++;
        }
        TextLine[9] = (IPAddress / 10) + 0x30;
        TextLine[10] = (IPAddress % 10) + 0x30;
        TextLine[11] = '.';

        TextLine[12] = '0';
        IPAddress = IP_Addr_union.dotted_IP[3];
        while (IPAddress >= 100)
        {
            IPAddress -= 100;
            TextLine[12] ++;
        }
        TextLine[13] = (IPAddress / 10) + 0x30;
        TextLine[14] = (IPAddress % 10) + 0x30;
        TextLine[15] = 0x00;

        packetsBuilt += BuildWriteString(TextLine, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 4, JUSTIFY_RIGHT_WITH_INDENT_1, FONT_1, NO_INVERT, 0,0,0,0);
    }

//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_VIEW_FRAME_PACKET_SLIDER_BAR,    // Slider bar                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_VIEW_FRAME_PACKET_SLIDER_BAR)
    {
        TUSIGN8 high,actual;

        #ifdef HMI_SUPPORTS_EASYSETUP
        if (LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.easySetupFlag != 0)
        {
            FrameTableGetEasySetupStages(&high, &actual);
        }
        else
        #endif
        {
            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            FrameTableGetMenuPositionDetailsForTFT(&actual, &high);
            #else
            FrameTableAccessMenuPositionDetails(&actual, &high, eTRUE);
            #endif
        }
        packetsBuilt += BuildSliderBar((TINT16)high,(TINT16)actual,0);
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_VIEW_FRAME_PACKET_LEFT_KEY,      // left function key  "Back"/"Next"        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_VIEW_FRAME_PACKET_LEFT_KEY)
    {
        #ifdef HMI_SUPPORTS_SEQUENCES
        if (FrameTableIsSequenceEnabled())
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_EASYSETUP
            if (LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.easySetupFlag != 0)
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
            }
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,1);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,1);
        }
    }

    return packetsBuilt;
}

// No restriction on the optimization of this function
TUSIGN8 BuildIPAddressEditFrame(void)
{

typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    IP_ADDRESS_EDIT_FRAME_PACKET_TITLE_BAR,     // Title Bar                               |
                                                //-----------------------------------------|
    IP_ADDRESS_EDIT_FRAME_PACKET_ID_2,          // Secondary Identifier                    |
                                                //-----------------------------------------|
    IP_ADDRESS_EDIT_FRAME_PACKET_LEFT_KEY,      // left function key  "Next"               |
                                                //-----------------------------------------|
    IP_ADDRESS_EDIT_FRAME_PACKET_ICON,          // Icon (Top)                              |
                                                //-----------------------------------------|
    IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_3,       // Parameter Value (3/3)                   | - Start of Keypress area
                                                //-----------------------------------------|
    IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_2,       // Parameter Value (2/3)                   |
                                                //-----------------------------------------|
    IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_1,       // Parameter Value (1/3)                   |
                                                //-----------------------------------------|
    IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_ALL,     // Parameter Value (All)                   |
                                                //-----------------------------------------|
    IP_ADDRESS_EDIT_FRAME_PACKET_HL_U,          // Highlight border on edit field (Top)    |
                                                //-----------------------------------------|
    IP_ADDRESS_EDIT_FRAME_PACKET_HL_L,          // Highlight border on edit field (Bottom) |
                                                //-----------------------------------------|
    IP_ADDRESS_EDIT_FRAME_PACKET_RIGHT_KEY,     // right function key "OK"/"Cancel"        |
                                                //-----------------------------------------|
    IP_ADDRESS_EDIT_FRAME_PACKET_READ_SWITCHES  //                                         |
                                                //-----------------------------------------| - There is no active area
}IP_ADDRESS_EDIT_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;
    TUSIGN8 IPAddressText[18]   = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

    #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
    TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
    TBOOL SecondaryIdentifierActive = FrameTableGetSecondaryIdentifier(SecondaryIdentifierText);
    #endif


    TUSIGN8 cursor = FrameTableGetCursorPosition();
    if (cursor > 4)
    {
        cursor = 4;
    }

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = IP_ADDRESS_EDIT_FRAME_PACKET_TITLE_BAR;
    }
    else if ((LOCAL_keypressProcessed) && (LOCAL_packetStage > IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_3))
    {
        LOCAL_packetStage = IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_3;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == IP_ADDRESS_EDIT_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = IP_ADDRESS_EDIT_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_EDIT_FRAME_PACKET_TITLE_BAR,     // Title Bar                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_EDIT_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.title_attribidx;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),MAX_ASIAN_TITLE_LEN,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_EDIT_FRAME_PACKET_ID_2,          // Secondary Identifier                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_EDIT_FRAME_PACKET_ID_2)
    {
        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        if (SecondaryIdentifierActive)
        {
            packetsBuilt += BuildWriteString(SecondaryIdentifierText,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,1,JUSTIFY_AS_SECONDARY_IDENTIFER,FONT_0,NO_INVERT,0,0,SECONDARY_IDENTIFIER_LEN,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_EDIT_FRAME_PACKET_LEFT_KEY,      // left function key  "Next"               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_EDIT_FRAME_PACKET_LEFT_KEY)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_EDIT_FRAME_PACKET_ICON,          // Icon (Top)                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_EDIT_FRAME_PACKET_ICON)
    {
        packetsBuilt += BuildWriteIcon(ICON_NUMBER_EDIT, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_3,       // Parameter Value (3/3)                   |
// IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_2,       // Parameter Value (2/3)                   |
// IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_1,       // Parameter Value (1/3)                   |
// IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_ALL,     // Parameter Value (All)                   |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_3)
     && (LOCAL_packetStage <= IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_ALL))
    {
        TUSIGN32 IPAddress = AdjusterGetTimeDateVariable();
        IP_ADDRESS_HMI IP_Addr_union;

        IP_Addr_union.networkAddress = IPAddress;

        IPAddressText[0] = ' ';

        IPAddressText[1] = '0';
        IPAddress = IP_Addr_union.dotted_IP[0];
        while (IPAddress >= 100)
        {
            IPAddress -= 100;
            IPAddressText[1] ++;
        }
        IPAddressText[2] = (IPAddress / 10) + 0x30;
        IPAddressText[3] = (IPAddress % 10) + 0x30;
        IPAddressText[4] = '.';

        IPAddressText[5] = '0';
        IPAddress = IP_Addr_union.dotted_IP[1];
        while (IPAddress >= 100)
        {
            IPAddress -= 100;
            IPAddressText[5] ++;
        }
        IPAddressText[6] = (IPAddress / 10) + 0x30;
        IPAddressText[7] = (IPAddress % 10) + 0x30;
        IPAddressText[8] = '.';

        IPAddressText[9] = '0';
        IPAddress = IP_Addr_union.dotted_IP[2];
        while (IPAddress >= 100)
        {
            IPAddress -= 100;
            IPAddressText[9] ++;
        }
        IPAddressText[10] = (IPAddress / 10) + 0x30;
        IPAddressText[11] = (IPAddress % 10) + 0x30;
        IPAddressText[12] = '.';

        IPAddressText[13] = '0';
        IPAddress = IP_Addr_union.dotted_IP[3];
        while (IPAddress >= 100)
        {
            IPAddress -= 100;
            IPAddressText[13] ++;
        }
        IPAddressText[14] = (IPAddress / 10) + 0x30;
        IPAddressText[15] = (IPAddress % 10) + 0x30;
        IPAddressText[16] = ' ';
        IPAddressText[17] = 0x00;

        if (cursor > 3)
        {
            LOCAL_packetStage = IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_ALL;
        }
    }

//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_3,       // Parameter Value (3/3)                   |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_3)
    {
        const IP_ADDRESS_EDIT_FIELD_DATA* pEditDataField = &IPAddressEditFieldData[2][cursor];

        IPAddressText[pEditDataField->lastChar] = 0x00;

        packetsBuilt += BuildWriteString(&IPAddressText[pEditDataField->firstChar],
                                         HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                         3,
                                         pEditDataField->justify,
                                         FONT_1,
                                         pEditDataField->invert,
                                         pEditDataField->invertChar,
                                         0,
                                         0,
                                         0);
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_2,       // Parameter Value (2/3)                   |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_2)
    {
        const IP_ADDRESS_EDIT_FIELD_DATA* pEditDataField = &IPAddressEditFieldData[1][cursor];

        IPAddressText[pEditDataField->lastChar] = 0x00;

        packetsBuilt += BuildWriteString(&IPAddressText[pEditDataField->firstChar],
                                         HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                         3,
                                         pEditDataField->justify,
                                         FONT_1,
                                         pEditDataField->invert,
                                         pEditDataField->invertChar,
                                         0,
                                         0,
                                         0);
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_1,       // Parameter Value (1/3)                   |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_1)
    {
        const IP_ADDRESS_EDIT_FIELD_DATA* pEditDataField = &IPAddressEditFieldData[0][cursor];

        IPAddressText[pEditDataField->lastChar] = 0x00;

        packetsBuilt += BuildWriteString(&IPAddressText[pEditDataField->firstChar],
                                         HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                         3,
                                         pEditDataField->justify,
                                         FONT_1,
                                         pEditDataField->invert,
                                         pEditDataField->invertChar,
                                         0,
                                         0,
                                         0);
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_ALL,     // Parameter Value (All)                   |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_EDIT_FRAME_PACKET_VALUE_ALL)
    {
        if (cursor <= 3)
        {
            LOCAL_packetStage ++;
        }
        else
        {
            packetsBuilt += BuildWriteString(IPAddressText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 3, JUSTIFY_LEFT_WITH_INDENT_3, FONT_1, NO_INVERT, 0, 0, 0, 0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_EDIT_FRAME_PACKET_HL_U,          // Highlight border on edit field (Top)    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_EDIT_FRAME_PACKET_HL_U)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage = IP_ADDRESS_EDIT_FRAME_PACKET_HL_L + 1;  // additional highlight not required on TFT displays
        #else
            if (cursor <= 3)
            {
                TUSIGN8 CustomChar = 0xFF;
                packetsBuilt += BuildCustomCharacterString(&CustomChar, 1, (TUSIGN8)(23 + (cursor * 24)), 3, 0, 0);
            }
            else
            {
                LOCAL_packetStage = IP_ADDRESS_EDIT_FRAME_PACKET_HL_L + 1;
            }
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_EDIT_FRAME_PACKET_HL_L,          // Highlight border on edit field (Bottom) |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_EDIT_FRAME_PACKET_HL_L)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage = IP_ADDRESS_EDIT_FRAME_PACKET_HL_L + 1;  // additional highlight not required on TFT displays
        #else
            if (cursor <= 3)
            {
                TUSIGN8 CustomChar = 0xFF;
                packetsBuilt += BuildCustomCharacterString(&CustomChar, 1, (TUSIGN8)(23 + (cursor * 24)), 4, 0, 0);
            }
            else
            {
                LOCAL_packetStage ++;
            }
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// IP_ADDRESS_EDIT_FRAME_PACKET_RIGHT_KEY,     // right function key "OK"/"Cancel"        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == IP_ADDRESS_EDIT_FRAME_PACKET_RIGHT_KEY)
    {
        TBOOL cursorAtLimit = FrameTableGetCursorPosition() == FrameTableGetCursorPositionLimit() ? eTRUE : eFALSE;

        if ((WriteProtect_HMICanAccess(LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.value, (TUSIGN8)0)) && (cursorAtLimit == eFALSE))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_OK;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,1);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,1);
            }
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_CANCEL;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,STRING_INVERT,0,3,3,1);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,STRING_INVERT,0,0,0,1);
            }
        }
    }
    return packetsBuilt;
}

#endif  // end of "#ifdef HMI_SUPPORTS_IP_ADDRESS_FRAMES"

#ifdef HMI_SUPPORTS_TIME_DATE_PARAM_FRAMES
// No restriction on the optimization of this function
TUSIGN8 BuildTimeDateViewFrame(void)
{
typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    TIME_DATE_VIEW_FRAME_PACKET_TITLE_BAR,      // Title Bar "-------Device--------"       | - Start of Static Area
                                                //-----------------------------------------|
    TIME_DATE_VIEW_FRAME_PACKET_ID_2,           // Secondary Identifier                    |
                                                //-----------------------------------------|
    TIME_DATE_VIEW_FRAME_PACKET_TITLE,          // Parameter title                         |
                                                //-----------------------------------------|
#ifndef DISABLE_BACK_MOVE_SELECT
                                                //-----------------------------------------|
    TIME_DATE_VIEW_FRAME_PACKET_BMS_ICON_6,     // BACK_MOVE_SELECT (UP/Down) Icon         |
                                                //-----------------------------------------|
    TIME_DATE_VIEW_FRAME_PACKET_BMS_ICON_7,     // BACK_MOVE_SELECT (UP/Down) Icon         |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    TIME_DATE_VIEW_FRAME_PACKET_RIGHT_KEY,      // right function key "Edit"               | - Start of active area
                                                //-----------------------------------------|
    TIME_DATE_VIEW_FRAME_PACKET_VALUE,          // Parameter Value (Time and/or date)      |
                                                //-----------------------------------------|
    TIME_DATE_VIEW_FRAME_PACKET_SLIDER_BAR,     // Slider bar                              |
                                                //-----------------------------------------|
    TIME_DATE_VIEW_FRAME_PACKET_LEFT_KEY,       // left function key  "Back"/"Next"        |
                                                //-----------------------------------------|
    TIME_DATE_VIEW_FRAME_PACKET_READ_SWITCHES   //                                         |
                                                //-----------------------------------------| - There is no keypress area
}TIME_DATE_VIEW_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;
    TIMEANDDATE convertedTimeDate;

    #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
    TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
    TBOOL SecondaryIdentifierActive = FrameTableGetSecondaryIdentifier(SecondaryIdentifierText);
    #endif

    if (LOCAL_updateStaticArea)
    {
            LOCAL_packetStage = TIME_DATE_VIEW_FRAME_PACKET_TITLE_BAR;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > TIME_DATE_VIEW_FRAME_PACKET_RIGHT_KEY))
    {
        LOCAL_packetStage = TIME_DATE_VIEW_FRAME_PACKET_RIGHT_KEY;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == TIME_DATE_VIEW_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = TIME_DATE_VIEW_FRAME_PACKET_READ_SWITCHES;
    }
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_VIEW_FRAME_PACKET_TITLE_BAR       // Title Bar "-------Device--------"       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_VIEW_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.titleBar_attribidx;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),MAX_ASIAN_TITLE_LEN,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_VIEW_FRAME_PACKET_ID_2            // Secondary Identifier                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_VIEW_FRAME_PACKET_ID_2)
    {
        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        if (SecondaryIdentifierActive)
        {
            packetsBuilt += BuildWriteString(SecondaryIdentifierText,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,1,JUSTIFY_AS_SECONDARY_IDENTIFER,FONT_0,NO_INVERT,0,0,SECONDARY_IDENTIFIER_LEN,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_VIEW_FRAME_PACKET_TITLE           // Parameter title                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_VIEW_FRAME_PACKET_TITLE)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.title_attribidx;
#ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,1,ASIAN_MAX_CHARS,0);
        }
        else
#endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT,FONT_1,NO_INVERT,0,0,1,0);
        }
    }

#ifndef DISABLE_BACK_MOVE_SELECT
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_VIEW_FRAME_PACKET_BMS_ICON_6,     // BACK_MOVE_SELECT (UP/Down) Icon         |
// TIME_DATE_VIEW_FRAME_PACKET_BMS_ICON_7,     // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage == TIME_DATE_VIEW_FRAME_PACKET_BMS_ICON_6)
     || (LOCAL_packetStage == TIME_DATE_VIEW_FRAME_PACKET_BMS_ICON_7))
    {
        if (!FrameTableIsBackMoveSelectAvailable(LOCAL_pCurrDisplayFrame))
        {
            LOCAL_packetStage = TIME_DATE_VIEW_FRAME_PACKET_BMS_ICON_7 + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_VIEW_FRAME_PACKET_BMS_ICON_6,     // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_VIEW_FRAME_PACKET_BMS_ICON_6)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage ++;
        #else
            packetsBuilt += BuildCustomCharacterString(UpKey, UP_DOWN_ICON_FIELD_WIDTH, UP_DOWN_ICON_POS, 6, 0, 0);
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_VIEW_FRAME_PACKET_BMS_ICON_7,     // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_VIEW_FRAME_PACKET_BMS_ICON_7)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            packetsBuilt += BuildWriteIcon(ICON_SCROLL_ARROWS, 0, 7, 0);
        #else
            packetsBuilt += BuildCustomCharacterString(DownKey, UP_DOWN_ICON_FIELD_WIDTH, UP_DOWN_ICON_POS, 7, 0, 0);
        #endif
    }
#endif
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_VIEW_FRAME_PACKET_RIGHT_KEY       // right function key "Edit"               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_VIEW_FRAME_PACKET_RIGHT_KEY)
    {
        if (LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_TIME_AND_DATE_PARAM_NO_EDIT)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
        }
        else if (WriteProtect_HMICanAccess(LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.value, (TUSIGN8)0/*write*/))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_EDIT;
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_VIEW_FRAME_PACKET_VALUE           // Parameter Value (Time and/or date)      |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_VIEW_FRAME_PACKET_VALUE)
    {
        TUSIGN32 TimeDateValue;
        TUSIGN8 TextLine[21];
        TUSIGN8 TimeAndOrDate = LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.TimeAndOrDate;
        TUSIGN8 TextLineIndex = 0;

        // Get the time / date value
        (void)AdjusterGetAttribute((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.value.ssIdx,
                                   (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.value.objIdx,
                                   LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.value.attribIdx,
                                   (void FAST *)&TimeDateValue);

        if (TimeAndOrDate < 3)
        {
            (void)AdjusterConvertSecondsToDate(TimeDateValue, &convertedTimeDate);
        }
        else
        {
            convertedTimeDate.year = 0;
            convertedTimeDate.month = 0;
            convertedTimeDate.date = 0;

            if (TimeDateValue >= FrameTableGetTimeDurationLimit())
            {
                convertedTimeDate.hour = (TUSIGN8)((FrameTableGetTimeDurationLimit() - 3600) / 3600);
                convertedTimeDate.minute = 59;
                convertedTimeDate.second = 59;
            }
            else
            {
                convertedTimeDate.hour = (TUSIGN8)(TimeDateValue / (TUSIGN32)3600);
                TimeDateValue = TimeDateValue - (convertedTimeDate.hour * (TUSIGN32)3600);
                convertedTimeDate.minute = (TUSIGN8)(TimeDateValue / (TUSIGN32)60);
                TimeDateValue = TimeDateValue - (convertedTimeDate.minute * (TUSIGN32)60);
                convertedTimeDate.second = (TUSIGN8)(TimeDateValue);
            }
        }

        // Build the text line
        if ((TimeAndOrDate == 0)    // Date & Time
         || (TimeAndOrDate == 2))   // Date Only
        {
            // Add Date to TextLine
            TUSIGN8 y_th = ((TUSIGN8)(convertedTimeDate.year / 1000)) + 0x30;
            TUSIGN8 y_h  = ((TUSIGN8)((convertedTimeDate.year / 100) % 10)) + 0x30;
            TUSIGN8 y_t  = ((TUSIGN8)((convertedTimeDate.year / 10) % 10)) + 0x30;
            TUSIGN8 y_u  = ((TUSIGN8)(convertedTimeDate.year % 10)) + 0x30;

            TUSIGN8 m_t  = (convertedTimeDate.month / 10) + 0x30;
            TUSIGN8 m_u  = (convertedTimeDate.month % 10) + 0x30;

            TUSIGN8 d_t  = (convertedTimeDate.date / 10) + 0x30;
            TUSIGN8 d_u  = (convertedTimeDate.date % 10) + 0x30;

            switch (SFD_SIMPLE.DateFormat)
            {
            case HMI_DATE_FORMAT_DD_MM_YYYY:
                TextLine[TextLineIndex++] = d_t;
                TextLine[TextLineIndex++] = d_u;
                TextLine[TextLineIndex++] = '-';
                TextLine[TextLineIndex++] = m_t;
                TextLine[TextLineIndex++] = m_u;
                TextLine[TextLineIndex++] = '-';
                TextLine[TextLineIndex++] = y_th;
                TextLine[TextLineIndex++] = y_h;
                TextLine[TextLineIndex++] = y_t;
                TextLine[TextLineIndex++] = y_u;
                break;
            case HMI_DATE_FORMAT_MM_DD_YYYY:
                TextLine[TextLineIndex++] = m_t;
                TextLine[TextLineIndex++] = m_u;
                TextLine[TextLineIndex++] = '-';
                TextLine[TextLineIndex++] = d_t;
                TextLine[TextLineIndex++] = d_u;
                TextLine[TextLineIndex++] = '-';
                TextLine[TextLineIndex++] = y_th;
                TextLine[TextLineIndex++] = y_h;
                TextLine[TextLineIndex++] = y_t;
                TextLine[TextLineIndex++] = y_u;
                break;
            default: // HMI_DATE_FORMAT_YYYY_MM_DD
                TextLine[TextLineIndex++] = y_th;
                TextLine[TextLineIndex++] = y_h;
                TextLine[TextLineIndex++] = y_t;
                TextLine[TextLineIndex++] = y_u;
                TextLine[TextLineIndex++] = '-';
                TextLine[TextLineIndex++] = m_t;
                TextLine[TextLineIndex++] = m_u;
                TextLine[TextLineIndex++] = '-';
                TextLine[TextLineIndex++] = d_t;
                TextLine[TextLineIndex++] = d_u;
                break;
            }
        }

        if (TimeAndOrDate == 0)     // Date & Time
        {
            // Add Space (separator) to TextLine
            TextLine[TextLineIndex++] = ' ';
        }

        if ((TimeAndOrDate == 0)    // Date & Time
         || (TimeAndOrDate == 1)    // Time only
         || (TimeAndOrDate == 3))   // Time Duration

        {
            // Add Time to TextLine
            if (TimeAndOrDate == 3)
            {
                TUSIGN8 hundreds = convertedTimeDate.hour / 100;

                if (hundreds > 9)
                {
                    hundreds = 0;
                }

                TextLine[TextLineIndex++] = 0x30 + hundreds;
                TextLine[TextLineIndex++] = ((convertedTimeDate.hour - (hundreds * 100)) / 10) + 0x30;

//                if (convertedTimeDate.hour > 99)
//                {
//                    TextLine[TextLineIndex++] = '1';
//                    TextLine[TextLineIndex++] = ((convertedTimeDate.hour - 100) / 10) + 0x30;
//                }
//                else
//                {
//                    TextLine[TextLineIndex++] = '0';
//                    TextLine[TextLineIndex++] = (convertedTimeDate.hour / 10) + 0x30;
//                }
            }
            else
            {
                TextLine[TextLineIndex++] = (convertedTimeDate.hour / 10) + 0x30;
            }

            TextLine[TextLineIndex++] = (convertedTimeDate.hour % 10) + 0x30;
            TextLine[TextLineIndex++] = ':';
            TextLine[TextLineIndex++] = (convertedTimeDate.minute / 10) + 0x30;
            TextLine[TextLineIndex++] = (convertedTimeDate.minute % 10) + 0x30;
            TextLine[TextLineIndex++] = ':';
            TextLine[TextLineIndex++] = (convertedTimeDate.second / 10) + 0x30;
            TextLine[TextLineIndex++] = (convertedTimeDate.second % 10) + 0x30;
        }

        // Terminate TextLine
        TextLine[TextLineIndex] = 0x00;
        TextLine[20] = 0x00;

        packetsBuilt += BuildWriteString(TextLine, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 4, JUSTIFY_CENTRE, FONT_1, NO_INVERT, 0,0,0,0);
    }
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_VIEW_FRAME_PACKET_SLIDER_BAR      // Slider bar                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_VIEW_FRAME_PACKET_SLIDER_BAR)
    {
        #ifdef HMI_SUPPORTS_EASYSETUP
        if (LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.easySetupFlag != 0)
        {
            TUSIGN8 lastStage, currentStage;
            FrameTableGetEasySetupStages(&lastStage, &currentStage);

            packetsBuilt += BuildSliderBar((TINT16)lastStage,(TINT16)currentStage,0);
        }
        else
        #endif
        {
            TUSIGN8 high,actual;
            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            FrameTableGetMenuPositionDetailsForTFT(&actual, &high);
            #else
            FrameTableAccessMenuPositionDetails(&actual, &high, eTRUE);
            #endif
            packetsBuilt += BuildSliderBar((TINT16)high,(TINT16)actual,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_VIEW_FRAME_PACKET_LEFT_KEY        // left function key  "Back"/"Next"        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_VIEW_FRAME_PACKET_LEFT_KEY)
    {
        #ifdef HMI_SUPPORTS_SEQUENCES
        if (FrameTableIsSequenceEnabled())
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_EASYSETUP
            if (LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.easySetupFlag != 0)
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
            }
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,1);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,1);
        }
    }
    return packetsBuilt;
}

// No restriction on the optimization of this function
TUSIGN8 BuildTimeDateEditFrame(void)
{

typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_TITLE_BAR,      // Title Bar                               |
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_ID_2,           // Secondary Identifier                    |
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_LEFT_KEY,       // left function key  "Next"               |
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_ICON_U,         // Icon (Top)                              |
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_ICON_L,         // Icon (Bottom)                           |
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_TIME_1,         // Parameter Value (Time - 1/2)            | - Start of Keypress area
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_TIME_2,         // Parameter Value (Time - 2/2)            |
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_DATE_1,         // Parameter value (Date - 1/2)            |
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_DATE_2,         // Parameter value (Date - 2/2)            |
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_HL_U,           // Highlight border on edit field (Top)    |
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_HL_L,           // Highlight border on edit field (Bottom) |
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_REMOVE_HL_U,    // Highlight border on edit field (Top)    |
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_REMOVE_HL_L,    // Highlight border on edit field (Bottom) |
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_RIGHT_KEY,      // right function key "OK"/"Cancel"        |
                                                //-----------------------------------------|
    TIME_DATE_EDIT_FRAME_PACKET_READ_SWITCHES   //                                         |
                                                //-----------------------------------------| - There is no active area
}TIME_DATE_EDIT_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;
    TIMEANDDATE TimeAndDate;
    TUSIGN8 TimeDateText[12] = {0,0,0,0,0,0,0,0,0,0,0,0};

    TUSIGN8 time_y, date_y;

    EDIT_FIELD_DATA EditFieldData;
    TUSIGN8 cursor = FrameTableGetCursorPosition();
    TUSIGN8 format = SFD_SIMPLE.DateFormat;

    #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
    TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
    TBOOL SecondaryIdentifierActive = FrameTableGetSecondaryIdentifier(SecondaryIdentifierText);
    #endif

    if (cursor > 6)
    {
        cursor = 6;
    }

    if (format > HMI_DATE_FORMAT_YYYY_MM_DD)
    {
        format = HMI_DATE_FORMAT_YYYY_MM_DD;
    }

    EditFieldData = EditFieldDataTable[format][LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.TimeAndOrDate][cursor];
    switch (LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.TimeAndOrDate)
    {
    case 3:     /* Time Duration */     time_y = 3;     date_y = 0;     break;
    case 2:     /* Date only     */     time_y = 0;     date_y = 3;     break;
    case 1:     /* Time only     */     time_y = 3;     date_y = 0;     break;
    default:    /* Time and Date */     time_y = 4;     date_y = 2;     break;
    }

    if (LOCAL_updateStaticArea)
    {
            LOCAL_packetStage = TIME_DATE_EDIT_FRAME_PACKET_TITLE_BAR;
    }
    else if ((LOCAL_keypressProcessed) && (LOCAL_packetStage > TIME_DATE_EDIT_FRAME_PACKET_TIME_1))
    {
        LOCAL_packetStage = TIME_DATE_EDIT_FRAME_PACKET_TIME_1;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = TIME_DATE_EDIT_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_TITLE_BAR       // Title Bar                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.title_attribidx;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),MAX_ASIAN_TITLE_LEN,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_ID_2            // Secondary Identifier                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_ID_2)
    {
        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        if (SecondaryIdentifierActive)
        {
            packetsBuilt += BuildWriteString(SecondaryIdentifierText,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,1,JUSTIFY_AS_SECONDARY_IDENTIFER,FONT_0,NO_INVERT,0,0,SECONDARY_IDENTIFIER_LEN,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_LEFT_KEY        // left function key  "Next"               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_LEFT_KEY)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_ICON_U          // Icon (Top)                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_ICON_U)
    {
        if (LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.TimeAndOrDate < 3)
        {
            // Show clock icon
            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            packetsBuilt += BuildWriteIcon(ICON_CLOCK, 0, 0, 0);
            #else
            TUSIGN8 customChar[13] = {0xE0, 0x18, 0x04, 0x02, 0x01, 0x01, 0x7D, 0x81, 0x01, 0x02, 0x04, 0x18, 0xE0};
            packetsBuilt += BuildCustomCharacterString(customChar, 13, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0, 0);
            #endif
        }
        else
        {
            // Show Hourglass icon
            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            packetsBuilt += BuildWriteIcon(ICON_HOURGLASS, 0, 0, 0);
            #else
            TUSIGN8 customChar[13] = {0x00, 0x00, 0x01, 0x0F, 0x93, 0x63, 0x0B, 0x63, 0x93, 0x0F, 0x01, 0x00, 0x00};

            packetsBuilt += BuildCustomCharacterString(customChar, 13, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0, 0);
            #endif
        }
    }


//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_ICON_L          // Icon (Bottom)                           |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_ICON_L)
    {
#if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
        LOCAL_packetStage ++;
#else
        if (LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.TimeAndOrDate < 3)
        {
            // Show clock icon
            TUSIGN8 customChar[13] = {0x00, 0x03, 0x04, 0x08, 0x10, 0x10, 0x10, 0x10, 0x11, 0x08, 0x04, 0x03, 0x00};
            packetsBuilt += BuildCustomCharacterString(customChar, 13, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 1, 0, 0);
        }
        else
        {
            // Show Hourglass icon
            TUSIGN8 customChar[13] = {0x00, 0x00, 0x08, 0x0F, 0x0C, 0x0E, 0x0F, 0x0E, 0x0C, 0x0F, 0x08, 0x00, 0x00};

            packetsBuilt += BuildCustomCharacterString(customChar, 13, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 1, 0, 0);
        }
#endif
    }
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_TIME_1          // Parameter Value (Time - 1/2)            |
// TIME_DATE_EDIT_FRAME_PACKET_TIME_2          // Parameter Value (Time - 2/2)            |
// TIME_DATE_EDIT_FRAME_PACKET_DATE_1          // Parameter value (Date - 1/2)            |
// TIME_DATE_EDIT_FRAME_PACKET_DATE_2          // Parameter value (Date - 2/2)            |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= TIME_DATE_EDIT_FRAME_PACKET_TIME_1)
     && (LOCAL_packetStage <= TIME_DATE_EDIT_FRAME_PACKET_DATE_2))
    {

        TUSIGN32 TimeDateValue = AdjusterGetTimeDateVariable();

        if (LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.TimeAndOrDate < 3)
        {
            (void)AdjusterConvertSecondsToDate(TimeDateValue, &TimeAndDate);
        }
        else
        {
            TimeAndDate.year = 0;
            TimeAndDate.month = 0;
            TimeAndDate.date = 0;

            if (TimeDateValue >= FrameTableGetTimeDurationLimit())
            {
                TimeAndDate.hour = (TUSIGN8)((FrameTableGetTimeDurationLimit() - 3600) / 3600);;
                TimeAndDate.minute = 59;
                TimeAndDate.second = 59;
            }
            else
            {
                TimeAndDate.hour = (TUSIGN8)(TimeDateValue / (TUSIGN32)3600);
                TimeDateValue = TimeDateValue - (TimeAndDate.hour * (TUSIGN32)3600);
                TimeAndDate.minute = (TUSIGN8)(TimeDateValue / (TUSIGN32)60);
                TimeDateValue = TimeDateValue - (TimeAndDate.minute * (TUSIGN32)60);
                TimeAndDate.second = (TUSIGN8)(TimeDateValue);
            }
        }
    }

//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_TIME_1          // Parameter Value (Time - 1/2)            |
// TIME_DATE_EDIT_FRAME_PACKET_TIME_2          // Parameter Value (Time - 2/2)            |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= TIME_DATE_EDIT_FRAME_PACKET_TIME_1)
     && (LOCAL_packetStage <= TIME_DATE_EDIT_FRAME_PACKET_TIME_2))

    {
        if (time_y == 0)
        {
            // Date Only
            LOCAL_packetStage = TIME_DATE_EDIT_FRAME_PACKET_TIME_2 + 1;
        }
        else
        {
            if (LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.TimeAndOrDate == 3)
            {
                TUSIGN8 hundreds = TimeAndDate.hour / 100;

                if (hundreds > 9)
                {
                    hundreds = 0;
                }

                TimeDateText[0] = 0x30 + hundreds;
                TimeDateText[1] = ((TimeAndDate.hour - (hundreds * 100)) / 10) + 0x30;


//                if (TimeAndDate.hour > 99)
//                {
//                    TimeDateText[0] = '1';
//                    TimeDateText[1] = ((TimeAndDate.hour - 100) / 10) + 0x30;
//                }
//                else
//                {
//                    TimeDateText[0] = '0';
//                    TimeDateText[1] = (TimeAndDate.hour / 10) + 0x30;
//                }
            }
            else
            {
                TimeDateText[0] = ' ';
                TimeDateText[1] = (TimeAndDate.hour / 10) + 0x30;
            }

            TimeDateText[2] = (TimeAndDate.hour % 10) + 0x30;
            TimeDateText[3] = ':';
            TimeDateText[4] = (TimeAndDate.minute / 10) + 0x30;
            TimeDateText[5] = (TimeAndDate.minute % 10) + 0x30;
            TimeDateText[6] = ':';
            TimeDateText[7] = (TimeAndDate.second / 10) + 0x30;
            TimeDateText[8] = (TimeAndDate.second % 10) + 0x30;
            TimeDateText[9] = 0x00;
        }
    }

//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_TIME_1          // Parameter Value (Time - 1/2)            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_TIME_1)
    {
        if ((EditFieldData.field != HOUR_FIELD)
         && (EditFieldData.field != MIN__FIELD)
         && (EditFieldData.field != SEC__FIELD))
        {
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 TextLine[12] = {0,0,0,0,0,0,0,0,0,0,0,0};
            TUSIGN8 invert_1 = CHAR_INVERT;

            if ((LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.TimeAndOrDate == 3) && (EditFieldData.field == HOUR_FIELD))
            {
                invert_1 = STRING_INVERT;
            }
            strncpy((char *)TextLine, (const char *)TimeDateText, (size_t)EditFieldData.firstChar_2);
            TextLine[11] = 0;
            packetsBuilt += BuildWriteString(TextLine,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, time_y, JUSTIFY_LEFT_WITH_INDENT_5, FONT_1, invert_1, (TUSIGN8)(EditFieldData.firstChar_2 - 1), 0, 0, 0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_TIME_2          // Parameter Value (Time - 2/2)            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_TIME_2)
    {
        TUSIGN8 TextLine[12] = {0,0,0,0,0,0,0,0,0,0,0,0};
        TUSIGN8 invert_2;
        TUSIGN8 justify_2;

        if ((EditFieldData.field != HOUR_FIELD)
         && (EditFieldData.field != MIN__FIELD)
         && (EditFieldData.field != SEC__FIELD))
        {
            invert_2 = NO_INVERT;
            justify_2 = JUSTIFY_LEFT_WITH_INDENT_5;
            strcpy((char *)TextLine, (const char *)TimeDateText);
        }
        else
        {
            invert_2 = CHAR_INVERT;
            justify_2 = EditFieldData.justify_2;
            strcpy((char *)TextLine, (const char *)&TimeDateText[EditFieldData.firstChar_2]);
        }
        packetsBuilt += BuildWriteString(TextLine, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, time_y, justify_2, FONT_1, invert_2, 0, 0, 0, 0);
    }

//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_DATE_1          // Parameter value (Date - 1/2)            |
// TIME_DATE_EDIT_FRAME_PACKET_DATE_2          // Parameter value (Date - 2/2)            |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= TIME_DATE_EDIT_FRAME_PACKET_DATE_1)
     && (LOCAL_packetStage <= TIME_DATE_EDIT_FRAME_PACKET_DATE_2))
    {
        if (date_y == 0)
        {
            // Time Only
            LOCAL_packetStage = TIME_DATE_EDIT_FRAME_PACKET_DATE_2 + 1;
        }
        else
        {
            TUSIGN8 y_th = ((TUSIGN8)(TimeAndDate.year / 1000)) + 0x30;
            TUSIGN8 y_h  = ((TUSIGN8)(TimeAndDate.year / 100) % 10) + 0x30;
            TUSIGN8 y_t  = ((TUSIGN8)(TimeAndDate.year / 10) % 10) + 0x30;
            TUSIGN8 y_u  = ((TUSIGN8)(TimeAndDate.year % 10)) + 0x30;

            TUSIGN8 m_t  = (TimeAndDate.month / 10) + 0x30;
            TUSIGN8 m_u  = (TimeAndDate.month % 10) + 0x30;

            TUSIGN8 d_t  = (TimeAndDate.date / 10) + 0x30;
            TUSIGN8 d_u  = (TimeAndDate.date % 10) + 0x30;

            switch (format)
            {
            case HMI_DATE_FORMAT_DD_MM_YYYY:
                TimeDateText[0]  = ' ';
                TimeDateText[1]  = d_t;
                TimeDateText[2]  = d_u;
                TimeDateText[3]  = '-';
                TimeDateText[4]  = m_t;
                TimeDateText[5]  = m_u;
                TimeDateText[6]  = '-';
                TimeDateText[7]  = y_th;
                TimeDateText[8]  = y_h;
                TimeDateText[9]  = y_t;
                TimeDateText[10] = y_u;
                TimeDateText[11] = 0x00;
                break;
            case HMI_DATE_FORMAT_MM_DD_YYYY:
                TimeDateText[0]  = ' ';
                TimeDateText[1]  = m_t;
                TimeDateText[2]  = m_u;
                TimeDateText[3]  = '-';
                TimeDateText[4]  = d_t;
                TimeDateText[5]  = d_u;
                TimeDateText[6]  = '-';
                TimeDateText[7]  = y_th;
                TimeDateText[8]  = y_h;
                TimeDateText[9]  = y_t;
                TimeDateText[10] = y_u;
                TimeDateText[11] = 0x00;
                break;
            default: // HMI_DATE_FORMAT_YYYY_MM_DD
                TimeDateText[0]  = ' ';
                TimeDateText[1]  = y_th;
                TimeDateText[2]  = y_h;
                TimeDateText[3]  = y_t;
                TimeDateText[4]  = y_u;
                TimeDateText[5]  = '-';
                TimeDateText[6]  = m_t;
                TimeDateText[7]  = m_u;
                TimeDateText[8]  = '-';
                TimeDateText[9]  = d_t;
                TimeDateText[10] = d_u;
                TimeDateText[11] = 0x00;
                break;
            }
        }
    }

//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_DATE_1          // Parameter value (Date - 1/2)            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_DATE_1)
    {
        if ((EditFieldData.field != DATE_FIELD)
         && (EditFieldData.field != MNTH_FIELD)
         && (EditFieldData.field != YEAR_FIELD))
        {
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 TextLine[12] = {0,0,0,0,0,0,0,0,0,0,0,0};

            TUSIGN8 invert_1, justify_1;

            if (EditFieldData.field == YEAR_FIELD)
            {
                if (format == HMI_DATE_FORMAT_YYYY_MM_DD)
                {
                    invert_1 = STRING_INVERT;
                    justify_1 = JUSTIFY_LEFT_WITH_INDENT_5;
                    strncpy((char *)TextLine, (const char *)&TimeDateText[1], (size_t)(EditFieldData.firstChar_2 - 1));
                }
                else
                {
                    invert_1 = NO_INVERT;
                    justify_1 = JUSTIFY_LEFT_WITH_INDENT_4;
                    strncpy((char *)TextLine, (const char *)TimeDateText, (size_t)EditFieldData.firstChar_2);
                }
            }
            else
            {
                invert_1 = CHAR_INVERT;
                justify_1 = JUSTIFY_LEFT_WITH_INDENT_4;
                strncpy((char *)TextLine, (const char *)TimeDateText, (size_t)EditFieldData.firstChar_2);
            }
            TextLine[11] = 0;
            packetsBuilt += BuildWriteString(TextLine, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, date_y, justify_1, FONT_1, invert_1, (TUSIGN8)(EditFieldData.firstChar_2 - 1), 0, 0, 0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_DATE_2          // Parameter value (Date - 2/2)            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_DATE_2)
    {
        TUSIGN8 TextLine[12] = {0,0,0,0,0,0,0,0,0,0,0,0};
        TUSIGN8 invert_2 = CHAR_INVERT;
        TUSIGN8 justify_2;

        if ((EditFieldData.field != DATE_FIELD)
         && (EditFieldData.field != MNTH_FIELD)
         && (EditFieldData.field != YEAR_FIELD))
        {
            invert_2 = NO_INVERT;
            justify_2 = JUSTIFY_LEFT_WITH_INDENT_4;
            strcpy((char *)TextLine, (const char *)TimeDateText);
        }
        else
        {
            if (EditFieldData.field == YEAR_FIELD)
            {
                if (format == HMI_DATE_FORMAT_YYYY_MM_DD)
                {
                    invert_2 = NO_INVERT;
                }
                else
                {
                    invert_2 = STRING_INVERT;
                }
            }
            justify_2 = EditFieldData.justify_2;
            strcpy((char *)TextLine, (const char *)&TimeDateText[EditFieldData.firstChar_2]);
        }

        packetsBuilt += BuildWriteString(TextLine, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, date_y, justify_2, FONT_1, invert_2, 0, 0, 0, 0);
    }

//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_HL_U            // Highlight border on edit field (Top)    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_HL_U)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage ++;   // Additional Highlight not required on TFT displays
        #else
            if (EditFieldData.field)
            {
                TUSIGN8 customChar = 0xFF;
                TUSIGN8 EditField_y = 3;
                if (LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.TimeAndOrDate == 0)
                {
                    EditField_y = FrameTableGetCursorPosition() <= 2 ? 2 : 4;
                }

                packetsBuilt += BuildCustomCharacterString(&customChar, 1, EditFieldData.xPosition, EditField_y, 0, 0);
            }
            else
            {
                LOCAL_packetStage ++;
            }
        #endif
    }

//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_HL_L            // Highlight border on edit field (Bottom) |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_HL_L)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage ++;   // Additional Highlight not required on TFT displays
        #else
            if (EditFieldData.field)
            {
                TUSIGN8 customChar = 0xFF;

                TUSIGN8 EditField_y = 4;
                if (LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.TimeAndOrDate == 0)
                {
                    EditField_y = FrameTableGetCursorPosition() <= 2 ? 3 : 5;
                }
                packetsBuilt += BuildCustomCharacterString(&customChar, 1, EditFieldData.xPosition, EditField_y, 0, 0);
            }
            else
            {
                LOCAL_packetStage ++;
            }
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_REMOVE_HL_U,    // Highlight border on edit field (Top)    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_REMOVE_HL_U)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage ++;   // Additional Highlight not required on TFT displays
        #else
            if ((LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.TimeAndOrDate == 3) && (EditFieldData.field != HOUR_FIELD))
            {
                TUSIGN8 customChar = 0x00;
                packetsBuilt += BuildCustomCharacterString(&customChar, 1, 29, 3, 0, 0);
            }
            else
            {
                LOCAL_packetStage ++;
            }
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_REMOVE_HL_L,    // Highlight border on edit field (Bottom) |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_REMOVE_HL_L)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage ++;   // Additional Highlight not required on TFT displays
        #else
            if ((LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.TimeAndOrDate == 3) && (EditFieldData.field != HOUR_FIELD))
            {
                TUSIGN8 customChar = 0x00;
                packetsBuilt += BuildCustomCharacterString(&customChar, 1, 29, 4, 0, 0);
            }
            else
            {
                LOCAL_packetStage ++;
            }
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// TIME_DATE_EDIT_FRAME_PACKET_RIGHT_KEY       // right function key "OK"/"Cancel"        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == TIME_DATE_EDIT_FRAME_PACKET_RIGHT_KEY)
    {
        TBOOL cursorAtLimit = FrameTableGetCursorPosition() == FrameTableGetCursorPositionLimit() ? eTRUE : eFALSE;

        if ((WriteProtect_HMICanAccess(LOCAL_pCurrDisplayFrame->frameDefinition.timeDateFrame.value, (TUSIGN8)0)) && (cursorAtLimit == eFALSE))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_OK;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,1);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,1);
            }
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_CANCEL;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,STRING_INVERT,0,3,3,1);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,STRING_INVERT,0,0,0,1);
            }
        }
    }

    return packetsBuilt;
}
#endif


#if defined (HMI_SUPPORTS_STANDARDASCII) || defined(HMI_SUPPORTS_PACKEDASCII)
// No restriction on the optimization of this function
TUSIGN8 BuildStringViewFrame(void)
{

typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    STRING_VIEW_FRAME_PACKET_TITLE_BAR,         // Title Bar "-------Device--------"       | - Start of Static Area
                                                //-----------------------------------------|
    STRING_VIEW_FRAME_PACKET_ID_2,              // Secondary Identifier                    |
                                                //-----------------------------------------|
    STRING_VIEW_FRAME_PACKET_TITLE,             // Parameter title                         |
                                                //-----------------------------------------|
    STRING_VIEW_FRAME_PACKET_LEFT_KEY,          // left function key  "Back"/"Next"        |
                                                //-----------------------------------------|
#ifndef DISABLE_BACK_MOVE_SELECT
                                                //-----------------------------------------|
    STRING_VIEW_FRAME_PACKET_BMS_ICON_6,        // BACK_MOVE_SELECT (UP/Down) Icon         |
                                                //-----------------------------------------|
    STRING_VIEW_FRAME_PACKET_BMS_ICON_7,        // BACK_MOVE_SELECT (UP/Down) Icon         |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    STRING_VIEW_FRAME_PACKET_SLIDER_BAR,        // Slider bar                              | - Start of active area
                                                //-----------------------------------------|
    STRING_VIEW_FRAME_PACKET_RIGHT_KEY,         // right function key "Edit"               |
                                                //-----------------------------------------|
    STRING_VIEW_FRAME_PACKET_VALUE_2,           // Parameter value & units                 |
                                                //-----------------------------------------|
    STRING_VIEW_FRAME_PACKET_VALUE_1,           // Parameter value & units                 |
                                                //-----------------------------------------|
    STRING_VIEW_FRAME_PACKET_READ_SWITCHES      //                                         |
                                                //-----------------------------------------| - There is no keypress area
}STRING_VIEW_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;
    TEXT_IDENTIFIER_TYPE text_id;

    #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
    TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
    TBOOL SecondaryIdentifierActive = FrameTableGetSecondaryIdentifier(SecondaryIdentifierText);
    #endif

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = STRING_VIEW_FRAME_PACKET_TITLE_BAR;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > STRING_VIEW_FRAME_PACKET_SLIDER_BAR))
    {
        LOCAL_packetStage = STRING_VIEW_FRAME_PACKET_SLIDER_BAR;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == STRING_VIEW_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = STRING_VIEW_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// STRING_VIEW_FRAME_PACKET_TITLE_BAR          // Title Bar "-------Device--------"       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_VIEW_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.titleBar_attribidx;

#ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),MAX_ASIAN_TITLE_LEN,0);
        }
        else
#endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// STRING_VIEW_FRAME_PACKET_ID_2               // Secondary Identifier                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_VIEW_FRAME_PACKET_ID_2)
    {
        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        if (SecondaryIdentifierActive)
        {
            packetsBuilt += BuildWriteString(SecondaryIdentifierText,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,1,JUSTIFY_AS_SECONDARY_IDENTIFER,FONT_0,NO_INVERT,0,0,SECONDARY_IDENTIFIER_LEN,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// STRING_VIEW_FRAME_PACKET_TITLE              // Parameter title                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_VIEW_FRAME_PACKET_TITLE)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.title_attribidx;
#ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,1,ASIAN_MAX_CHARS,0);
        }
        else
#endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT,FONT_1,NO_INVERT,0,0,1,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// STRING_VIEW_FRAME_PACKET_LEFT_KEY           // left function key  "Back"/"Next"        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_VIEW_FRAME_PACKET_LEFT_KEY)
    {
        #ifdef HMI_SUPPORTS_SEQUENCES
        if (FrameTableIsSequenceEnabled())
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_EASYSETUP
            if (LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.easySetupFlag != 0)
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
            }
        }

#ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
        }
        else
#endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }

#ifndef DISABLE_BACK_MOVE_SELECT
//---------------------------------------------//-----------------------------------------|
// STRING_VIEW_FRAME_PACKET_BMS_ICON_6,        // BACK_MOVE_SELECT (UP/Down) Icon         |
// STRING_VIEW_FRAME_PACKET_BMS_ICON_7,        // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage == STRING_VIEW_FRAME_PACKET_BMS_ICON_6)
     || (LOCAL_packetStage == STRING_VIEW_FRAME_PACKET_BMS_ICON_7))
    {
        if (!FrameTableIsBackMoveSelectAvailable(LOCAL_pCurrDisplayFrame))
        {
            LOCAL_packetStage = STRING_VIEW_FRAME_PACKET_BMS_ICON_7 + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// STRING_VIEW_FRAME_PACKET_BMS_ICON_6,        // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_VIEW_FRAME_PACKET_BMS_ICON_6)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage ++;
        #else
            packetsBuilt += BuildCustomCharacterString(UpKey, UP_DOWN_ICON_FIELD_WIDTH, UP_DOWN_ICON_POS, 6, 0, 0);
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// STRING_VIEW_FRAME_PACKET_BMS_ICON_7,        // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_VIEW_FRAME_PACKET_BMS_ICON_7)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            packetsBuilt += BuildWriteIcon(ICON_SCROLL_ARROWS, 0, 7, 0);
        #else
            packetsBuilt += BuildCustomCharacterString(DownKey, UP_DOWN_ICON_FIELD_WIDTH, UP_DOWN_ICON_POS, 7, 0, 0);
        #endif
    }
#endif
//---------------------------------------------//-----------------------------------------|
// STRING_VIEW_FRAME_PACKET_SLIDER_BAR         // Slider bar                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_VIEW_FRAME_PACKET_SLIDER_BAR)
    {
        #ifdef HMI_SUPPORTS_EASYSETUP
        if (LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.easySetupFlag != 0)
        {
            TUSIGN8 lastStage, currentStage;
            FrameTableGetEasySetupStages(&lastStage, &currentStage);

            packetsBuilt += BuildSliderBar((TINT16)lastStage,(TINT16)currentStage,0);
        }
        else
        #endif
        {
            TUSIGN8 high,actual;
            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            FrameTableGetMenuPositionDetailsForTFT(&actual, &high);
            #else
            FrameTableAccessMenuPositionDetails(&actual, &high, eTRUE);
            #endif
            packetsBuilt += BuildSliderBar((TINT16)high,(TINT16)actual,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// STRING_VIEW_FRAME_PACKET_RIGHT_KEY          // right function key "Edit"               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_VIEW_FRAME_PACKET_RIGHT_KEY)
    {
        if ((LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_STRING_PARAM_NO_EDIT) || (LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_STRING_PARAM_PACKED_NO_EDIT))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
        }
        else if (WriteProtect_HMICanAccess(LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.stringText, (TUSIGN8)0/*write*/))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_EDIT;
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// STRING_VIEW_FRAME_PACKET_VALUE_2            // Parameter value (2nd line)              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_VIEW_FRAME_PACKET_VALUE_2)
    {
#if defined(HMI_SUPPORTS_STRINGS_OVER_20_CHARS) || (defined(HMI_SUPPORTS_STRINGS_OVER_19_CHARS) && defined(DISPLAY_SIZE_E))
        TUSIGN8 text[41];
        TUSIGN8 len;
        TUSIGN8 i;
        text[0] = 0x00;
        text_id.ssIdx = LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.stringText.ssIdx;
        text_id.objIdx = LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.stringText.objIdx;
        text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.stringText.attribIdx;

        len = LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.attributes.maxCharacters;

#ifdef HMI_SUPPORTS_PACKEDASCII
        if ((LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_STRING_PARAM_PACKED) || (LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_STRING_PARAM_PACKED_NO_EDIT))
        {
            // 40 unpacked characters = 30 packed characters
            TUSIGN8 packedtext[31] = {0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,0x82,
            0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,
            0x20,0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,
            0x00};

            // len (unpacked) cannot be more than 40 therefore len * 6 cannot be more than 240
            //lint -e{734} Roger Arnold 2005-1-31
            i =  len * 6;
            len = i / 8;
            if (i % 8)
            {
                len ++;
            }

            for (i = 0; i < len; i++)
            {
                // Return value of "AdjusterGetAttribute()" ignored
                //lint -e{534} Roger Arnold 2005-1-31
                AdjusterGetAttribute((TUSIGN16)text_id.ssIdx, (TUSIGN16)text_id.objIdx, i, (void FAST *)&packedtext[i]);
            }

            AdjusterUnpackPASCII(packedtext,len,text);
        }
#endif

#ifdef HMI_SUPPORTS_STANDARDASCII
        if ((LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_STRING_PARAM) || (LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_STRING_PARAM_NO_EDIT))
        {
            for (i = 0; i < len; i++)
            {
                AdjusterGetAttribute((TUSIGN16)text_id.ssIdx, (TUSIGN16)text_id.objIdx, i, (void FAST *)&text[i]);
            }
            text[len] = 0x00;
        }
#endif

        if (strlen((char *)text) > FONT1_MAX_CHARS-1)
        {
            TUSIGN8 extendedCharacterPage = FrameTableGetExtendedCharacterPage(LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.attributes.characterSet_dpPosn);
            packetsBuilt += BuildWriteString(&text[FONT1_MAX_CHARS-1],extendedCharacterPage,5,JUSTIFY_RIGHT_WITH_INDENT_1,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS-1,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
#else
        LOCAL_packetStage ++;
#endif
    }

//---------------------------------------------//-----------------------------------------|
// STRING_VIEW_FRAME_PACKET_VALUE_1            // Parameter value (1st line)              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_VIEW_FRAME_PACKET_VALUE_1)
    {
        TUSIGN8 text[41];
        TUSIGN8 len;
        TUSIGN8 i;
        text[0] = 0x00;
        text_id.ssIdx = LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.stringText.ssIdx;
        text_id.objIdx = LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.stringText.objIdx;
        text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.stringText.attribIdx;

        len = LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.attributes.maxCharacters;
        TUSIGN8 extendedCharacterPage = FrameTableGetExtendedCharacterPage(LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.attributes.characterSet_dpPosn);

#ifdef HMI_SUPPORTS_PACKEDASCII
        if ((LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_STRING_PARAM_PACKED) || (LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_STRING_PARAM_PACKED_NO_EDIT))
        {
            // 40 unpacked characters = 30 packed characters
            TUSIGN8 packedtext[31] = {0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,0x82,
            0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,
            0x20,0x82,0x08,0x20,0x82,0x08,0x20,0x82,0x08,0x20,
            0x00};

            // len (unpacked) cannot be more than 40 therefore len * 6 cannot be more than 240
            //lint -e{734} Roger Arnold 2005-1-31
            i =  len * 6;
            len = i / 8;
            if (i % 8)
            {
                len ++;
            }

            for (i = 0; i < len; i++)
            {
                // Return value of "AdjusterGetAttribute()" ignored
                //lint -e{534} Roger Arnold 2005-1-31
                AdjusterGetAttribute((TUSIGN16)text_id.ssIdx, (TUSIGN16)text_id.objIdx, i, (void FAST *)&packedtext[i]);
            }

            AdjusterUnpackPASCII(packedtext,len,text);
        }
#endif

#ifdef HMI_SUPPORTS_STANDARDASCII
        if ((LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_STRING_PARAM) || (LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_STRING_PARAM_NO_EDIT))
        {
#if defined(HMI_SUPPORTS_SECURITY_ACCESS) && defined(DISGUISE_PASSWORDS)
            if ((text_id.ssIdx == HMI_IDX) && ((text_id.objIdx == HMI_IDX_SetPassword_StandardLevel)
                                               || (text_id.objIdx == HMI_IDX_SetPassword_AdvancedLevel)
                                                   || (text_id.objIdx == HMI_IDX_SetPassword_ServiceLevel)
                                                       || (text_id.objIdx == HMI_IDX_SetPassword_StandardLevelDefault)
                                                           || (text_id.objIdx == HMI_IDX_SetPassword_AdvancedLevelDefault)
                                                               || (text_id.objIdx == HMI_IDX_SetPassword_ServiceLevelDefault)))
            {
                for (i = 0; i < PASSWORD_LENGTH; i++)
                {
                    text[i] = 0x2A;
                }
                text[PASSWORD_LENGTH] = 0x00;
            }
            else
#endif
            {
                for (i = 0; i < len; i++)
                {
                    AdjusterGetAttribute((TUSIGN16)text_id.ssIdx, (TUSIGN16)text_id.objIdx, i, (void FAST *)&text[i]);
                }
                text[len] = 0x00;
            }
        }
#endif

#if defined(HMI_SUPPORTS_STRINGS_OVER_20_CHARS) || (defined(HMI_SUPPORTS_STRINGS_OVER_19_CHARS) && defined(DISPLAY_SIZE_E))
        if (strlen((char *)text) > FONT1_MAX_CHARS-1)
        {
            text[FONT1_MAX_CHARS-1] = 0x00;
            packetsBuilt += BuildWriteString(text,extendedCharacterPage,4,JUSTIFY_RIGHT_WITH_INDENT_1,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS-1,1);
        }
        else
#endif
        {
            i = strlen((char *)text) - 1;
            while ((i > 0) && (text[i] == ' '))
            {
                text[i] = 0x00;
                i --;
            }

            packetsBuilt += BuildWriteString(text,extendedCharacterPage,4,JUSTIFY_RIGHT_WITH_INDENT_1,FONT_1,NO_INVERT,0,0,FONT1_MAX_CHARS-1,1);
        }
    }

    return packetsBuilt;
}

// No restriction on the optimization of this function
TUSIGN8 BuildStringEditFrame(void)
{

typedef enum
{                                               // Packet                                  |
    STRING_EDIT_FRAME_PACKET_TITLE_BAR,         // Parameter title                         | - Start of Static Area
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_ID_2,              // Secondary Identifier                    |
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_ICON,              // Title Bar Icon                          |
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_BORDER_T,          // Character Set Top Border                |
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_BORDER_B,          // Character Set Bottom Border             |
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_BORDER_T_C,        // Character Set Top Border at cursor      |
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_BORDER_B_C,        // Character Set Bottom Border at cursor   |
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_LEFT_KEY,          // left function key  "Next"               |
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_ID_PROMPT,         // Prompt "ID"            (for #code Entry)|
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_PIN_PROMPT,        // Prompt "Pin"           (for #code Entry)|
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_PASSWORD_PROMPT,   // Prompt "Password"      (for #code Entry)|
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_ID,                // ID                     (for #code Entry)|
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_PIN,               // PIN                    (for #code Entry)|
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_VALUE,             // String value                            | - Start of keypress Area
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_CHARSET,           // Character Set                           |
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_HIGHLIGHT,         // LHS of highlight (selected char)        |
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_RIGHT_KEY,         // right function key                      | - Start of Active Area
                                                //-----------------------------------------|
    STRING_EDIT_FRAME_PACKET_READ_SWITCHES      //                                         |
                                                //-----------------------------------------|
}STRING_EDIT_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;
    TUSIGN8 customChar[2];
    TUSIGN8 characterSetline = 5;

    #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
    TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
    TBOOL SecondaryIdentifierActive = FrameTableGetSecondaryIdentifier(SecondaryIdentifierText);
    #endif

    #ifdef HMI_SUPPORTS_SECURITY_ACCESS

typedef enum
    {
    STRING_MODE_STANDARD,
    STRING_MODE_PASSWORD,
    STRING_MODE_SERVICE,
    STRING_MODE_SET_PASSWORD,
    }_STRING_MODE;

    _STRING_MODE StringMode = STRING_MODE_STANDARD;

    if (LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.specialStringFlag != 0)
    {
        TBOOL   ARM_highSecurityState = AdjusterGetARMhighSecurityState();
        TBOOL   ARM_serviceRequested  = FrameTableGetRequestedARMLevel() == ARM_ACCESS_SERVICE ? eTRUE : eFALSE;

        StringMode = STRING_MODE_PASSWORD;

        if ((ARM_serviceRequested) && (ARM_highSecurityState))
        {
            StringMode = STRING_MODE_SERVICE;
        }
    }
    else
    {
        TUSIGN8 stringSI = LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.stringText.ssIdx;
        TUSIGN8 stringOI = LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.stringText.objIdx;
        if ((stringSI == HMI_IDX) && ((stringOI == HMI_IDX_SetPassword_StandardLevel)
                                   || (stringOI == HMI_IDX_SetPassword_AdvancedLevel)
                                   || (stringOI == HMI_IDX_SetPassword_ServiceLevel)
                                   || (stringOI == HMI_IDX_SetPassword_StandardLevelDefault)
                                   || (stringOI == HMI_IDX_SetPassword_AdvancedLevelDefault)
                                   || (stringOI == HMI_IDX_SetPassword_ServiceLevelDefault)))
        {
            StringMode = STRING_MODE_SET_PASSWORD;
        }
    }
    #endif

    #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
    if (LOCAL_Asian)
    {
        characterSetline --;
    }
    #endif

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = STRING_EDIT_FRAME_PACKET_TITLE_BAR;
    }
    else if ((LOCAL_keypressProcessed) && (LOCAL_packetStage > STRING_EDIT_FRAME_PACKET_VALUE))
    {
        LOCAL_packetStage = STRING_EDIT_FRAME_PACKET_VALUE;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > STRING_EDIT_FRAME_PACKET_RIGHT_KEY))
    {
        LOCAL_packetStage = STRING_EDIT_FRAME_PACKET_RIGHT_KEY;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = STRING_EDIT_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_TITLE_BAR          // Parameter title                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.title_attribidx;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),MAX_ASIAN_TITLE_LEN,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_ID_2               // Secondary Identifier                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_ID_2)
    {
        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        if (SecondaryIdentifierActive)
        {
            packetsBuilt += BuildWriteString(SecondaryIdentifierText,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,1,JUSTIFY_AS_SECONDARY_IDENTIFER,FONT_0,NO_INVERT,0,0,SECONDARY_IDENTIFIER_LEN,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_ICON               // Title Bar Icon                          |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_ICON)
    {
        #ifdef HMI_SUPPORTS_SECURITY_ACCESS
        if (StringMode == STRING_MODE_PASSWORD)
        {
            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
                LOCAL_packetStage ++;   // Security Icon not displayed on TFT displays
            #else
                packetsBuilt += BuildCustomCharacterString(&SecurityIcon[0], 12, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH, 0, 0, 0);
            #endif
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteIcon(ICON_STRING_EDIT, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_BORDER_T           // Character Set Top Border                |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_BORDER_T)
    {
        TUSIGN8 nRepeats = (((FONT1_MAX_CHARS) * FONT1_WIDTH) - 2) / 2;
        customChar[0] = 0x50;
        customChar[1] = 0x10;
        packetsBuilt += BuildCustomCharacterString(&customChar[0], 2, 0, (TUSIGN8)(characterSetline - 1), nRepeats,0);
    }
//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_BORDER_B           // Character Set Bottom Border             |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_BORDER_B)
    {
        TUSIGN8 nRepeats = (((FONT1_MAX_CHARS) * FONT1_WIDTH) - 2) / 2;
        customChar[0] = 0x05;
        customChar[1] = 0x04;
        packetsBuilt += BuildCustomCharacterString(&customChar[0], 2, 0, (TUSIGN8)(characterSetline + 1), nRepeats,0);
    }
//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_BORDER_T_C         // Character Set Top Border at cursor      |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_BORDER_T_C)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
        customChar[0] = 0x10;
        #else
        customChar[0] = 0x90;
        #endif
        packetsBuilt += BuildCustomCharacterString(&customChar[0], 1, 59, (TUSIGN8)(characterSetline - 1), 6, 0);
    }
//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_BORDER_B_C         // Character Set Bottom Border at cursor   |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_BORDER_B_C)
    {
        customChar[0] = 0x04;
        packetsBuilt += BuildCustomCharacterString(&customChar[0], 1, 60, (TUSIGN8)(characterSetline + 1), 5, 0);
    }
//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_LEFT_KEY           // left function key  "Next"               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_LEFT_KEY)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }
//  Prepare data for stages STRING_EDIT_FRAME_PACKET_ID_PROMPT..STRING_EDIT_FRAME_PACKET_PIN (Additional info for service level hashcode entry)
//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_ID_PROMPT          // Prompt "ID"            (for #code Entry)|
// STRING_EDIT_FRAME_PACKET_PIN_PROMPT         // Prompt "Pin"           (for #code Entry)|
// STRING_EDIT_FRAME_PACKET_PASSWORD_PROMPT    // Prompt "Password"      (for #code Entry)|
// STRING_EDIT_FRAME_PACKET_ID                 // ID                     (for #code Entry)|
// STRING_EDIT_FRAME_PACKET_PIN                // PIN                    (for #code Entry)|
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= STRING_EDIT_FRAME_PACKET_ID_PROMPT) && (LOCAL_packetStage <= STRING_EDIT_FRAME_PACKET_PIN))
    {
        #if defined(HMI_SUPPORTS_SECURITY_ACCESS) && defined(HMI_SUPPORTS_ARM_SERVICE)
        if (StringMode != STRING_MODE_SERVICE)
        #endif
        {
            LOCAL_packetStage = STRING_EDIT_FRAME_PACKET_PIN + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_ID_PROMPT          // Prompt "ID"            (for #code Entry)|
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_ID_PROMPT)
    {
        #if defined(HMI_SUPPORTS_SECURITY_ACCESS) && defined(HMI_SUPPORTS_ARM_SERVICE)
        LOCAL_stringtable_text_id.attribIdx = IDS_ID_PROMPT;
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,1,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,10,0);
        #else
        LOCAL_packetStage = STRING_EDIT_FRAME_PACKET_PIN + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_PIN_PROMPT         // Prompt "Pin"           (for #code Entry)|
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_PIN_PROMPT)
    {
        #if defined(HMI_SUPPORTS_SECURITY_ACCESS) && defined(HMI_SUPPORTS_ARM_SERVICE)
        LOCAL_stringtable_text_id.attribIdx = IDS_PIN_PROMPT;
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,10,0);
        #else
        LOCAL_packetStage = STRING_EDIT_FRAME_PACKET_PIN + 1;
        #endif
    }

//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_PASSWORD_PROMPT    // Prompt "Password"      (for #code Entry)|
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_PASSWORD_PROMPT)
    {
        #if defined(HMI_SUPPORTS_SECURITY_ACCESS) && defined(HMI_SUPPORTS_ARM_SERVICE)
        LOCAL_stringtable_text_id.attribIdx = IDS_PASSWORD_PROMPT;
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,3,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,10,0);
        #else
        LOCAL_packetStage = STRING_EDIT_FRAME_PACKET_PIN + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_ID                 // ID                     (for #code Entry)|
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_ID)
    {
        #if defined(HMI_SUPPORTS_SECURITY_ACCESS) && defined(HMI_SUPPORTS_ARM_SERVICE)

        TUSIGN8 IDText[9];
        AdjusterGetArmID(IDText, 8);
        IDText[8] = 0x00;
        packetsBuilt += BuildWriteString(IDText,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,1,JUSTIFY_LEFT_WITH_INDENT_12,FONT_0,NO_INVERT,0,0,8,0);
        #else
        LOCAL_packetStage = STRING_EDIT_FRAME_PACKET_PIN + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_PIN                // PIN                    (for #code Entry)|
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_PIN)
    {
        #if defined(HMI_SUPPORTS_SECURITY_ACCESS) && defined(HMI_SUPPORTS_ARM_SERVICE)
        TUSIGN8     pinText[6];
        TUSIGN16    pin = (TUSIGN16)AdjusterGetARMpin();

        pinText[0] = ((TUSIGN8)(pin / 10000)) + 0x30;
        pin = pin % 10000;
        pinText[1] = ((TUSIGN8)(pin / 1000)) + 0x30;
        pin = pin % 1000;
        pinText[2] = ((TUSIGN8)(pin / 100)) + 0x30;
        pin = pin % 100;
        pinText[3] = ((TUSIGN8)(pin / 10)) + 0x30;
        pin = pin % 10;
        pinText[4] = ((TUSIGN8)(pin)) + 0x30;
        pinText[5] = 0x00;

        packetsBuilt += BuildWriteString(&pinText[0],HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,2,JUSTIFY_LEFT_WITH_INDENT_12,FONT_0,NO_INVERT,0,0,1,0);
        #else
        LOCAL_packetStage = STRING_EDIT_FRAME_PACKET_PIN + 1;
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_VALUE              // String value                            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_VALUE)
    {
        TUSIGN8 maxChars;
        #if defined(HMI_SUPPORTS_STRINGS_OVER_19_CHARS) || defined(HMI_SUPPORTS_STRINGS_OVER_20_CHARS)
        TUSIGN8 text[41];
        #else
        TUSIGN8 text[22];
        #endif
        TUSIGN8 i;
        TUSIGN8 cursor = FrameTableGetCursorPosition();
        TUSIGN8 extendedCharacterPage = FrameTableGetExtendedCharacterPage(LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.attributes.characterSet_dpPosn);

        // Return value of "strcpy()" ignored
        //lint -e{534} Roger Arnold 2005-1-31
        strcpy((char *)text,(char *)AdjusterGetVariableAsString(&i));
        // get max available length from frame table
        maxChars = LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.attributes.maxCharacters;

        // make string as long as it can be by adding special character (0x09)
        for (i = (TUSIGN8)strlen((char *)text); i < maxChars; i++)
        {
            text[i] = 0x09;
        }

        #if defined (HMI_SUPPORTS_SECURITY_ACCESS) && defined(DISGUISE_PASSWORDS)
        if (StringMode != STRING_MODE_STANDARD)
        {
            for (i = 0; i < maxChars; i++)
            {
                if (i != cursor)
                {
                    text[i] = 0x2A;
                }
            }
        }
        #endif

        text[maxChars] = 0x00;

        if (cursor >= sizeof(text) - 1)
        {
            // corrupt cursor - skip stage
            LOCAL_packetStage ++;
        }
        else
        {
            if (cursor != FrameTableGetCursorPositionLimit())
            {
                if (text[cursor] == 0x09)           // if the cursor is beyond the end of the valid string then
                {
                    text[cursor] = 0x08;            // put the special character (0x08) at the cursor position
                }

                if (cursor <= 19)
                {
                    text[20] = 0x00;
                    #if defined(HMI_SUPPORTS_SECURITY_ACCESS) && defined(HMI_SUPPORTS_ARM_SERVICE)
                    if (StringMode == STRING_MODE_SERVICE)
                    {
                        packetsBuilt += BuildWriteString(&text[0],HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,3,JUSTIFY_LEFT_WITH_INDENT_12,FONT_0,CHAR_INVERT,cursor,0,1,0);
                    }
                    else
                    #endif
                    {
                        packetsBuilt += BuildWriteString(&text[0],extendedCharacterPage,2,JUSTIFY_LEFT,FONT_0,CHAR_INVERT,cursor,0,1,0);
                    }
                }
                else
                {
                    cursor +=1;
                    text[cursor] = 0x00;
                    cursor -= 20;

                    #if defined(HMI_SUPPORTS_SECURITY_ACCESS) && defined(HMI_SUPPORTS_ARM_SERVICE)
                    if (StringMode == STRING_MODE_SERVICE)
                    {
                        packetsBuilt += BuildWriteString(&text[cursor],HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,3,JUSTIFY_LEFT_WITH_INDENT_12,FONT_0,CHAR_INVERT,19,0,1,0);
                    }
                    else
                    #endif
                    {
                        packetsBuilt += BuildWriteString(&text[cursor],extendedCharacterPage,2,JUSTIFY_LEFT,FONT_0,CHAR_INVERT,19,0,1,0);
                    }
                }
            }
            else
            {
                text[20] = 0x00;
                #if defined(HMI_SUPPORTS_SECURITY_ACCESS) && defined(HMI_SUPPORTS_ARM_SERVICE)
                if (StringMode == STRING_MODE_SERVICE)
                {
                    packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,3,JUSTIFY_LEFT_WITH_INDENT_12,FONT_0,NO_INVERT,0,0,1,0);
                }
                else
                #endif
                {
                    packetsBuilt += BuildWriteString(text,extendedCharacterPage,2,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,1,0);
                }
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_CHARSET            // Character Set                           |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_CHARSET)
    {
        TUSIGN8 LimitedNumericCharacterSet[13];
//        TBOOL   LimitedNumericCharacterSetInUse = eFALSE;

        TUSIGN8 const *characterSet = FrameTableGetCharacterSet(LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.attributes.characterSet_dpPosn);
        TUSIGN8 extendedCharacterPage = FrameTableGetExtendedCharacterPage(LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.attributes.characterSet_dpPosn);

        if (LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.attributes.characterSet_dpPosn == CHARACTER_SET_NUMERIC)
        {

            TBOOL   AllowSpace;
            TUSIGN8 MinValid, MaxValid;
            FrameTableGetNumericCharacterSetRestrictions(&AllowSpace, &MinValid, &MaxValid);

            if ((!AllowSpace) || (MinValid != 0) || (MaxValid != 9))
            {
                memset((void *)LimitedNumericCharacterSet, 0x00, 13);
                TUSIGN8 ii,jj;

                ii = 0;
                LimitedNumericCharacterSet[ii ++] = 0x08;   //Terminator
                if (AllowSpace)
                {
                    LimitedNumericCharacterSet[ii ++] = 0x20;   //Space
                }

                for (jj = MinValid; jj <= MaxValid; jj++)
                {
                    LimitedNumericCharacterSet[ii ++] = jj + 0x30;
                }
                characterSet = LimitedNumericCharacterSet;
//                LimitedNumericCharacterSetInUse = eTRUE;
            }
        }

        if (!characterSet)
        {
            // Do not display character set if no character set found
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 len = (TUSIGN8)strlen((const char *)characterSet);
            TUSIGN8 selectedChar,i;
            #if defined(HMI_SUPPORTS_STRINGS_OVER_19_CHARS) || defined(HMI_SUPPORTS_STRINGS_OVER_20_CHARS)
            TUSIGN8 text[41];
            #else
            TUSIGN8 text[22];
            #endif
            TINT16 cursor = (TINT16)FrameTableGetCursorPosition();

            // Return value of "strcpy()" ignored
            //lint -e{534} Roger Arnold 2005-1-31
            strcpy((char *)text,(char *)AdjusterGetVariableAsString(&i));

            // find selected character
            if (cursor > strlen((char *)text))
            {
                selectedChar = characterSet[0];
            }
            else
            {
                selectedChar = text[cursor];
            }

            // set cursor so that it defines the offset to the selected character in character set
            cursor = 0;
            while ((characterSet[cursor] != selectedChar) && (cursor < len))
            {
                cursor++;
            }
            if (cursor >= len)
            {
                cursor = 0;
            }

            // move cursor 10 characters back
            cursor -= 10;

            if (len > 10)
            {
                while (cursor < 0)
                {
                   cursor += len;
                }
            }

            // copy maximum number of characters from character set to "text"
            for (i = 0; i < (TUSIGN8)(FONT1_MAX_CHARS); i++)
            {
                if ((cursor < 0) || (cursor >= len))
                {
                    text[i] = ' ';
                }
                else
                {
                    text[i] = characterSet[cursor];
                }

                cursor ++;


                if (len > 10)
                {
                    if (cursor > (len-1))
                    {
                        cursor = 0;
                    }
                }
            }
            text[(TUSIGN8)(FONT1_MAX_CHARS)] = 0;

            packetsBuilt += BuildWriteString(text,extendedCharacterPage,characterSetline,JUSTIFY_LEFT,FONT_0,CHAR_INVERT,10,0,1,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// STRING_EDIT_FRAME_PACKET_HIGHLIGHT          // LHS of highlight (selected char)        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_HIGHLIGHT)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage ++;   // Additional Highlight not required on TFT displays
        #else
            customChar[0] = 0xFF;
            packetsBuilt += BuildCustomCharacterString(&customChar[0], 1, 59, characterSetline, 0, 0);
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// STRING_VIEW_FRAME_PACKET_RIGHT_KEY          // right function key                      |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == STRING_EDIT_FRAME_PACKET_RIGHT_KEY)
    {
        TBOOL cursorAtLimit = FrameTableGetCursorPosition() == FrameTableGetCursorPositionLimit() ? eTRUE : eFALSE;

        if ((WriteProtect_HMICanAccess(LOCAL_pCurrDisplayFrame->frameDefinition.stringParamFrame.stringText, (TUSIGN8)0)) && (cursorAtLimit == eFALSE))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_OK;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,1);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,1);
            }
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_CANCEL;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,STRING_INVERT,0,3,3,1);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,STRING_INVERT,0,0,0,1);
            }
        }
    }

    return packetsBuilt;

}
#endif

#ifdef HMI_SUPPORTS_ENUM_PARAM_FRAMES
// No restriction on the optimization of this function
TUSIGN8 BuildEnumViewFrame(void)
{

typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    ENUM_VIEW_FRAME_PACKET_TITLE_BAR,           // Title Bar "-------Device--------"       | - Start of Static Area
                                                //-----------------------------------------|
    ENUM_VIEW_FRAME_PACKET_ID_2,                // Secondary Identifier                    |
                                                //-----------------------------------------|
    ENUM_VIEW_FRAME_PACKET_TITLE,               // Parameter title                         |
                                                //-----------------------------------------|
    ENUM_VIEW_FRAME_PACKET_LEFT_KEY,            // left function key  "Back"/"Next"        |
                                                //-----------------------------------------|
#ifndef DISABLE_BACK_MOVE_SELECT
                                                //-----------------------------------------|
    ENUM_VIEW_FRAME_PACKET_BMS_ICON_6,          // BACK_MOVE_SELECT (UP/Down) Icon         |
                                                //-----------------------------------------|
    ENUM_VIEW_FRAME_PACKET_BMS_ICON_7,          // BACK_MOVE_SELECT (UP/Down) Icon         |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    ENUM_VIEW_FRAME_PACKET_SLIDER_BAR,          // Slider bar                              |
                                                //-----------------------------------------|
    ENUM_VIEW_FRAME_PACKET_RIGHT_KEY,           // right function key "Edit"               | - Start of active area
                                                //-----------------------------------------|
    ENUM_VIEW_FRAME_PACKET_VALUE,               // Parameter value & units                 |
                                                //-----------------------------------------|
    ENUM_VIEW_FRAME_PACKET_READ_SWITCHES        //                                         |
                                                //-----------------------------------------| - There is no keypress area
}ENUM_VIEW_FRAME_PACKET;


    TUSIGN8 packetsBuilt = 0;

    #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
    TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
    TBOOL SecondaryIdentifierActive = FrameTableGetSecondaryIdentifier(SecondaryIdentifierText);
    #endif

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = ENUM_VIEW_FRAME_PACKET_TITLE_BAR;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > ENUM_VIEW_FRAME_PACKET_RIGHT_KEY))
    {
        LOCAL_packetStage = ENUM_VIEW_FRAME_PACKET_RIGHT_KEY;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == ENUM_VIEW_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = ENUM_VIEW_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// ENUM_VIEW_FRAME_PACKET_TITLE_BAR            // Title Bar "-------Device--------"       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_VIEW_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.titleBar_attribidx;

#ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),MAX_ASIAN_TITLE_LEN,0);
        }
        else
#endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// ENUM_VIEW_FRAME_PACKET_ID_2                 // Secondary Identifier                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_VIEW_FRAME_PACKET_ID_2)
    {
        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        if (SecondaryIdentifierActive)
        {
            packetsBuilt += BuildWriteString(SecondaryIdentifierText,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,1,JUSTIFY_AS_SECONDARY_IDENTIFER,FONT_0,NO_INVERT,0,0,SECONDARY_IDENTIFIER_LEN,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// ENUM_VIEW_FRAME_PACKET_TITLE                // Parameter title                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_VIEW_FRAME_PACKET_TITLE)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.title_attribidx;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,1,ASIAN_MAX_CHARS,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT,FONT_1,NO_INVERT,0,0,1,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// ENUM_VIEW_FRAME_PACKET_LEFT_KEY             // left function key  "Back"/"Next"        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_VIEW_FRAME_PACKET_LEFT_KEY)
    {
        #ifdef HMI_SUPPORTS_SEQUENCES
        if (FrameTableIsSequenceEnabled())
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_EASYSETUP
            if (LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.easySetupFlag != 0)
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
            }
        }

#ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
        }
        else
#endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }

#ifndef DISABLE_BACK_MOVE_SELECT
//---------------------------------------------//-----------------------------------------|
// ENUM_VIEW_FRAME_PACKET_BMS_ICON_6,          // BACK_MOVE_SELECT (UP/Down) Icon         |
// ENUM_VIEW_FRAME_PACKET_BMS_ICON_7,          // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage == ENUM_VIEW_FRAME_PACKET_BMS_ICON_6)
     || (LOCAL_packetStage == ENUM_VIEW_FRAME_PACKET_BMS_ICON_7))
    {
        if (!FrameTableIsBackMoveSelectAvailable(LOCAL_pCurrDisplayFrame))
        {
            LOCAL_packetStage = ENUM_VIEW_FRAME_PACKET_BMS_ICON_7 + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// ENUM_VIEW_FRAME_PACKET_BMS_ICON_6,          // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_VIEW_FRAME_PACKET_BMS_ICON_6)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage ++;
        #else
            packetsBuilt += BuildCustomCharacterString(UpKey, UP_DOWN_ICON_FIELD_WIDTH, UP_DOWN_ICON_POS, 6, 0, 0);
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// ENUM_VIEW_FRAME_PACKET_BMS_ICON_7,          // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_VIEW_FRAME_PACKET_BMS_ICON_7)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            packetsBuilt += BuildWriteIcon(ICON_SCROLL_ARROWS, 0, 7, 0);
        #else
            packetsBuilt += BuildCustomCharacterString(DownKey, UP_DOWN_ICON_FIELD_WIDTH, UP_DOWN_ICON_POS, 7, 0, 0);
        #endif
    }
#endif
//---------------------------------------------//-----------------------------------------|
// ENUM_VIEW_FRAME_PACKET_SLIDER_BAR           // Slider bar                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_VIEW_FRAME_PACKET_SLIDER_BAR)
    {
        #ifdef HMI_SUPPORTS_EASYSETUP
        if (LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.easySetupFlag != 0)
        {
            TUSIGN8 lastStage, currentStage;
            FrameTableGetEasySetupStages(&lastStage, &currentStage);

            packetsBuilt += BuildSliderBar((TINT16)lastStage,(TINT16)currentStage,0);
        }
        else
        #endif
        {
            TUSIGN8 high,actual;
            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            FrameTableGetMenuPositionDetailsForTFT(&actual, &high);
            #else
            FrameTableAccessMenuPositionDetails(&actual, &high, eTRUE);
            #endif
            packetsBuilt += BuildSliderBar((TINT16)high,(TINT16)actual,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// ENUM_VIEW_FRAME_PACKET_RIGHT_KEY            // right function key "Edit"               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_VIEW_FRAME_PACKET_RIGHT_KEY)
    {
        if (LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_ENUMERATED_PARAM_NO_EDIT)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
        }
        else
        {
            if (WriteProtect_HMICanAccess(LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value, 0))
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_EDIT;
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            }
        }
#ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,0);
        }
        else
#endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// ENUM_VIEW_FRAME_PACKET_VALUE                // Parameter value & units                 |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_VIEW_FRAME_PACKET_VALUE)
    {
        TUSIGN16 OK_val;

        ADJUST_DATA tVal;
        TUSIGN8 tType;
        T_RANGE_E8 enum8Range;
        #ifdef HMI_SUPPORTS_16BIT_ENUMS
        T_RANGE_E16 enum16Range;
        #endif

        TBOOL rulesAreActive;


        if (LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.engUnitsFlag != UOM_NOT_APPLICABLE)
        {
            packetsBuilt += BuildWriteString(PacketManagerGetEngUnits((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.ssIdx,
                                                                      LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.objIdx,
                                                                      LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.attribIdx,
                                                                      LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.engUnitsFlag),
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                             4,
                                             JUSTIFY_RIGHT_WITH_INDENT_1,
                                             FONT_1,
                                             NO_INVERT,
                                             0,
                                             0,
                                             FONT1_MAX_CHARS-1,
                                             1);
        }
        else
        {
            OK_val = AdjusterGetEnumValueAndRange((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.ssIdx,
                                                  (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.objIdx,
                                                  LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.attribIdx,
                                                  &tVal,
                                                  &enum8Range,
                                                  #ifdef HMI_SUPPORTS_16BIT_ENUMS
                                                  &enum16Range,
                                                  #endif
                                                  &rulesAreActive,
                                                  &tType);

			if (OK_val == OK)
			{
                TUSIGN16 tableOffset = ((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.firstItem_MSByte << 8)
                                     + LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.firstItem_LSByte
                                     + tVal.data_8;

                LOCAL_stringtable_text_id.attribIdx = FrameTableGetEnumItem(tableOffset);
            }
			else
			{
				LOCAL_stringtable_text_id.attribIdx = 0;
			}
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_RIGHT_WITH_INDENT_1,NO_INVERT,0,ASIAN_MAX_CHARS,ASIAN_MAX_CHARS,1);
            }
            else
            #endif
            {
				packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_RIGHT_WITH_INDENT_1,FONT_1,NO_INVERT,0,0,FONT1_MAX_CHARS-1,1);
            }
        }
    }
    return packetsBuilt;
}

// No restriction on the optimization of this function

TUSIGN8 BuildEnumEditFrame(void)
{

typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_TITLE_BAR,                // Parameter title                         | - Start of Static Area
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_ID_2,                     // Secondary Identifier                    |
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_TITLE_BAR_ICON,           // Title Bar Icon                          |
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_TEXT_1,                   // Enum text (1/3) (1/4) (1/5) (1/6)       | - Start of keypress area
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_TEXT_2,                   // Enum text (2/3) (2/4) (2/5) (2/6)       |
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_TEXT_3,                   // Enum text (3/3) (3/4) (3/5) (3/6)       |
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_TEXT_4,                   // Enum text       (4/4) (4/5) (4/6)       |
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_TEXT_5,                   // Enum text             (5/5) (5/6)       |
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_TEXT_6,                   // Enum text                   (6/6)       |
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_HL_ON_1,                  // LHS of highlighted Item (ypos = 1)      |
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_HL_ON_2,                  // LHS of highlighted Item (ypos = 2)      |
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_HL_ON_3,                  // LHS of highlighted Item (ypos = 3)      |
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_HL_ON_4,                  // LHS of highlighted Item (ypos = 4)      |
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_HL_ON_5,                  // LHS of highlighted Item (ypos = 5)      |
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_HL_ON_6,                  // LHS of highlighted Item (ypos = 6)      |
                                                //-----------------------------------------|
#if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_SLIDER_BAR,               // Slider Bar                              |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_LEFT_KEY,                 // Left function key  "Cancel"             |
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_RIGHT_KEY,                // Right function key  "OK"                | - Start of active area
                                                //-----------------------------------------|
    ENUM_FRAME_PACKET_READ_SWITCHES             //                                         |
                                                //-----------------------------------------|
}ENUM_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;

    TINT16 *pDisplayedValues;
    TUSIGN8 DisplayedValuesIndex;

    #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
    static TUSIGN16 EnumSliderMax_LOCAL;
    static TUSIGN16 EnumSliderAct_LOCAL;
    #ifdef HMI_SUPPORTS_SERVICEPORT
    static TUSIGN16 EnumSliderMax_REMOTE;
    static TUSIGN16 EnumSliderAct_REMOTE;
    #endif  // #ifdef HMI_SUPPORTS_SERVICEPORT
    #endif  // #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)

    #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
    TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
    TBOOL SecondaryIdentifierActive = FrameTableGetSecondaryIdentifier(SecondaryIdentifierText);
    #endif

    static TINT16 DisplayedValues_LOCAL[6];
    #ifdef HMI_SUPPORTS_SERVICEPORT
    static TINT16 DisplayedValues_REMOTE[6];

    if (PacketManagerIsRemoteInstance())
    {
        pDisplayedValues = DisplayedValues_REMOTE;
    }
    else
    #endif
    {
        pDisplayedValues = DisplayedValues_LOCAL;
    }

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = ENUM_FRAME_PACKET_TITLE_BAR;

        for (DisplayedValuesIndex = 0; DisplayedValuesIndex < 6; DisplayedValuesIndex++)
        {
            pDisplayedValues[DisplayedValuesIndex] = -1;
        }
    }

    else if ((LOCAL_keypressProcessed) && (LOCAL_packetStage > ENUM_FRAME_PACKET_TEXT_1))
    {
        LOCAL_packetStage = ENUM_FRAME_PACKET_TEXT_1;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > ENUM_FRAME_PACKET_RIGHT_KEY))
    {
        LOCAL_packetStage = ENUM_FRAME_PACKET_RIGHT_KEY;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == ENUM_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = ENUM_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// ENUM_FRAME_PACKET_TITLE_BAR                 // Parameter title                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.title_attribidx;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),MAX_ASIAN_TITLE_LEN,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// ENUM_FRAME_PACKET_ID_2                      // Secondary Identifier                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_FRAME_PACKET_ID_2)
    {

        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        if (SecondaryIdentifierActive)
        {
            packetsBuilt += BuildWriteString(SecondaryIdentifierText,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,1,JUSTIFY_AS_SECONDARY_IDENTIFER,FONT_0,NO_INVERT,0,0,SECONDARY_IDENTIFIER_LEN,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// ENUM_FRAME_PACKET_TITLE_BAR_ICON            // Title Bar Icon                          |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_FRAME_PACKET_TITLE_BAR_ICON)
    {
        packetsBuilt += BuildWriteIcon(ICON_ENUM_EDIT, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
    }
//---------------------------------------------//-----------------------------------------|
// ENUM_FRAME_PACKET_TEXT_1,                   // Enum text (1/3) (1/4) (1/5) (1/6)       |
// ENUM_FRAME_PACKET_TEXT_2,                   // Enum text (2/3) (2/4) (2/5) (2/6)       |
// ENUM_FRAME_PACKET_TEXT_3,                   // Enum text (3/3) (3/4) (3/5) (3/6)       |
// ENUM_FRAME_PACKET_TEXT_4,                   // Enum text       (4/4) (4/5) (4/6)       |
// ENUM_FRAME_PACKET_TEXT_5,                   // Enum text             (5/5) (5/6)       |
// ENUM_FRAME_PACKET_TEXT_6,                   // Enum text                   (6/6)       |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= ENUM_FRAME_PACKET_TEXT_1) && (LOCAL_packetStage <= ENUM_FRAME_PACKET_TEXT_6))
    {
        TUSIGN8 EngUnitsFlag = LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.engUnitsFlag;


        #if (!defined(DISABLE_NATIVE_LANGUAGE) && defined(MULTIPLELANGUAGES)) || (defined(HMI_SUPPORTS_ASIAN))
        TBOOL   LanguageEdit = eFALSE;
        #endif

        #if !defined(DISABLE_NATIVE_LANGUAGE) && defined(MULTIPLELANGUAGES)
        if ((LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.ssIdx     == HMI_IDX)
         && (LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.objIdx    == HMI_IDX_language))
        {
            LanguageEdit = eTRUE;
        }
        #endif

        if (EngUnitsFlag == USE_NEXT_ATTRIBUTE)
        {
            TUSIGN8     unitTable = EngUnitsFlag;

            TUSIGN16 getResult = AdjusterGetAttribute((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.ssIdx,
                                                      (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.objIdx,
                                                      (TUSIGN8)(LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.attribIdx + 1),
                                                      (void FAST *)&unitTable);

            if ((unitTable < USE_UOM_1) || (unitTable >= USE_NEXT_ATTRIBUTE) || (getResult != (TUSIGN16)OK))
            {
                EngUnitsFlag = UOM_NOT_APPLICABLE;
            }
            else
            {
                EngUnitsFlag = unitTable;
            }
        }

        TUSIGN8  nBits;
        TUSIGN16 eVal = AdjusterGetEnumVariable(&nBits);

        TBOOL eValOffsetShown;
        TBOOL ShowCursor = eFALSE;
        TUSIGN8 startPacket;

        T_UNIT const SLOW *pSub; // Pointer to Subsystem
        T_DO_ATTRIB_RANGE Range; // range information
        TUSIGN16 eValOffset;

        TUSIGN16 numberOfCodes;
        TUSIGN8  itemsPerMenu;

        #ifdef COMMON_TOP_WORKS_NEW_FEATURES
            switch (SFD_SIMPLE_CTW.MenuFormat)
            {
            case HMI_MENU_FORMAT_3_LINES:   itemsPerMenu = 3;   break;
            case HMI_MENU_FORMAT_4_LINES:   itemsPerMenu = 4;   break;
            case HMI_MENU_FORMAT_5_LINES:   itemsPerMenu = 5;   break;
            case HMI_MENU_FORMAT_6_LINES:   itemsPerMenu = 6;   break;
            default:                    itemsPerMenu = 4;   break;
            }
        #else
            itemsPerMenu = ITEMS_PER_MENU;
        #endif

        #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
        if (LanguageEdit)
        {
            itemsPerMenu = 3;
        }

        if (LOCAL_Asian)
        {
            if (EngUnitsFlag == UOM_NOT_APPLICABLE)
            {
                itemsPerMenu = 2;
            }
            else
            {
                // Edit of engineering units enum in a frame displayed in chinese
                if (itemsPerMenu == 3)  { itemsPerMenu = 2; }
                else                    { itemsPerMenu = 4; }
            }
        }
        #endif

        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
        if ((FrameTableGetSecondaryIdentifier(SecondaryIdentifierText) == eTRUE) && ((itemsPerMenu == 6) || (itemsPerMenu == 3)))
        {
            itemsPerMenu --;
        }
        #endif

        // Get Details of what is to be displayed
        pSub = GetSubsystemPtr((T_SUBSYSTEM_IDX)LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.ssIdx);
        (void)pSub->GetAttributeDescription(pSub,
                                            (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.objIdx,
                                            (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.attribIdx,
                                            &Range);


        eValOffset = 0;

        #ifdef HMI_SUPPORTS_16BIT_ENUMS
        if (nBits == 16)
        {
            numberOfCodes = Range.range.e16.numberOfCodes;
            while ((eVal != Range.range.e16.ptrCodeTab[eValOffset]) && (eValOffset < numberOfCodes))
            {
                eValOffset ++;
            }
        }
        else
        #endif
        {
            numberOfCodes = Range.range.e8.numberOfCodes;
            while ((eVal != Range.range.e8.ptrCodeTab[eValOffset]) && (eValOffset < numberOfCodes))
            {
                eValOffset ++;
            }
        }

        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
        #ifdef HMI_SUPPORTS_SERVICEPORT
        if (PacketManagerIsRemoteInstance())
        {
            EnumSliderMax_REMOTE = numberOfCodes - 1;
            EnumSliderAct_REMOTE = eValOffset;
        }
        else
        #endif
        {
            EnumSliderMax_LOCAL = numberOfCodes - 1;
            EnumSliderAct_LOCAL = eValOffset;
        }
        #endif

//        #ifdef HMI_SUPPORTS_ASIAN
//        // To improve appearance on Asian version ...
//        // if itemsPerMenu == 4  (which means the user is selecting engineering units)
//        // and numberOfCodes < 4 (which means there are no more than 3 avaialble codes)
//        // then modify display style to 2 items per menu
//        if ((LOCAL_Asian) && (itemsPerMenu == 4) && (numberOfCodes < 4))
//        {
//            itemsPerMenu = 2;
//        }
//        #endif

        if (LOCAL_updateStaticArea)
        {
            // update static area flag is set - current enum value in not being displayed
            eValOffsetShown = eFALSE;
        }
        else
        {
            // update static area flag is not set - Check if the current enum value is being displayed
            eValOffsetShown = eFALSE;
            DisplayedValuesIndex = 0;
            while ((eValOffsetShown == eFALSE) && (DisplayedValuesIndex < itemsPerMenu))
            {
                if (pDisplayedValues[DisplayedValuesIndex] == eValOffset)
                {
                    eValOffsetShown = eTRUE;
                }
                else
                {
                    DisplayedValuesIndex ++;
                }
            }
        }

        if (eValOffsetShown)
        {
            // current enum value is being displayed..just set the cursor position
            LOCAL_enumCursor = DisplayedValuesIndex;
            ShowCursor = eTRUE;
        }
        else
        {
            // current enum value is not being displayed
            // Get Details of what to display
            TUSIGN16 rangeIndex = eValOffset;

            if (LOCAL_updateStaticArea)
            {
                // update static area flag is set - build a new display from scratch
                if (rangeIndex >= numberOfCodes)
                {
                    // (rangeIndex >= Range.range.e8.numberOfCodes) - current value is not valid
                    LOCAL_enumCursor = 0;                           // set the cursor to the first line
                    ShowCursor = eFALSE;                            // do not allow the cursor to be shown
                    rangeIndex = 0;                                 // set the first item to be displayed as the first enum value
                }
                else if (rangeIndex < itemsPerMenu)
                {
                    // (rangeIndex < itemsPerMenu) - current value is within the first few items
                    LOCAL_enumCursor = rangeIndex;                  // set the cursor to the selected value
                    ShowCursor = eTRUE;                             // allow the cursor to be shown
                    rangeIndex = 0;                                 // set the first item to be displayed as the first enum value
                }
                else
                {
                    // (rangeIndex >= itemsPerMenu) - current value is beyond the end of display (if displaying the first few enum values)
                    LOCAL_enumCursor = (itemsPerMenu - 1);          // set the cursor to the last line
                    ShowCursor = eTRUE;                             // allow the cursor to be shown
                    rangeIndex = (rangeIndex - itemsPerMenu) + 1;   // set the first item to be displayed so that the last item to be displayed is the selected value
                }
            }
            else
            {
                // update static area flag is not set - build a new display based on what was previously displayed
                if (eValOffset < pDisplayedValues[0])
                {
                    // new value is less than previous lowest displayed value - build a new display with selected value at top
                    LOCAL_enumCursor = 0;                           // set the cursor to the first line
                    ShowCursor = eTRUE;                             // allow the cursor to be shown
                    rangeIndex = rangeIndex;                        // do not change range index so that the first item to be displayed is the selected value
                }
                else
                {
                    // new value must be more than previous highest displayed value - build a new display with selected value at bottom
                    LOCAL_enumCursor = (itemsPerMenu - 1);          // set the cursor to the last line
                    ShowCursor = eTRUE;                             // allow the cursor to be shown
                    rangeIndex = (rangeIndex - itemsPerMenu) + 1;   // set the first item to be displayed so that the last item to be displayed is the selected value
                }
            }

            // Fill the displayed values array
            for (DisplayedValuesIndex = 0; DisplayedValuesIndex < itemsPerMenu; DisplayedValuesIndex++)
            {
                if (rangeIndex < numberOfCodes)
                {
                    pDisplayedValues[DisplayedValuesIndex] = rangeIndex;
                }
                rangeIndex ++;
            }
        }

        do
        {
            startPacket = LOCAL_packetStage;
            TUSIGN8 lineNumber = LOCAL_packetStage - ENUM_FRAME_PACKET_TEXT_1;
            if ((pDisplayedValues[lineNumber] < 0) || (lineNumber >= itemsPerMenu))
            {
                LOCAL_packetStage ++;
            }
            else
            {
                TUSIGN16 enumItem;
                TUSIGN8  yPos;
                TUSIGN8  font;

                if (EngUnitsFlag == UOM_NOT_APPLICABLE)
                {
                    enumItem = Range.range.e8.ptrCodeTab[pDisplayedValues[lineNumber]]
                             + ((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.firstItem_MSByte << 8)
                             + ((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.firstItem_LSByte);
                    LOCAL_stringtable_text_id.attribIdx = FrameTableGetEnumItem(enumItem);

                }
                else
                {
                    #ifdef HMI_SUPPORTS_16BIT_ENUMS
                    if (nBits == 16)
                    {
                        enumItem = Range.range.e16.ptrCodeTab[pDisplayedValues[lineNumber]];
                    }
                    else
                    #endif
                    {
                        enumItem = Range.range.e8.ptrCodeTab[pDisplayedValues[lineNumber]];
                    }
                    LOCAL_stringtable_text_id.attribIdx = enumItem;
                }

                LOCAL_stringtable_text_id.objIdx = SS_HMI_OBJ_STRINGTABLE - EngUnitsFlag;
                LOCAL_stringtable_text_id.ssIdx = HMI_IDX;

                switch (itemsPerMenu)
                {
                case 2:     yPos = lineNumber + lineNumber + 2;     font = FONT_1;      break;
                case 3:     yPos = lineNumber + lineNumber + 1;     font = FONT_1;      break;
                case 4:     yPos = lineNumber + 2;                  font = FONT_0;      break;
                case 5:     yPos = lineNumber + 2;                  font = FONT_0;      break;
                case 6:     yPos = lineNumber + 1;                  font = FONT_0;      break;
                default:    VIP_ASSERT(0);                                                  break;
                }

                #if !defined(DISABLE_NATIVE_LANGUAGE) && defined(MULTIPLELANGUAGES)
                if (LanguageEdit)
                {
                    TUSIGN8 dispLang = Range.range.e8.ptrCodeTab[pDisplayedValues[lineNumber]];

                    #ifdef HMI_SUPPORTS_ASIAN
                    if (dispLang == HMI_LANGUAGE_CHINESE)
                    {
                        packetsBuilt += BuildWriteString_w(FrameTableGetStringSpecificLanguage(LOCAL_stringtable_text_id,HMI_LANGUAGE_CHINESE),
                                                           yPos,
                                                           JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,
                                                           (TUSIGN8)(ShowCursor && (lineNumber == LOCAL_enumCursor) ? STRING_INVERT : NO_INVERT),
                                                           0,
                                                           ASIAN_MAX_CHARS,
                                                           ASIAN_MAX_CHARS,
                                                           0);
                    }
                    else
                    #endif
                    {
                        TUSIGN8 extendedCharacterPage;

                        if (dispLang > HMI_LANGUAGE_TURKISH)
                        {
                            dispLang = HMI_LANGUAGE_TURKISH + 1;
                        }

                        switch (dispLang)
                        {
                        case HMI_LANGUAGE_JAPANESE:     extendedCharacterPage = HMI_EXTENDED_CHARACTER_PAGE_KATAKANA;   break;
                        case HMI_LANGUAGE_TURKISH:      extendedCharacterPage = HMI_EXTENDED_CHARACTER_PAGE_TURKISH;    break;
                        case HMI_LANGUAGE_RUSSIAN:      extendedCharacterPage = HMI_EXTENDED_CHARACTER_PAGE_RUSSIAN;    break;
                        default:                        extendedCharacterPage = HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN;   break;
                        }

                        packetsBuilt += BuildWriteString(FrameTableGetStringSpecificLanguage(LOCAL_stringtable_text_id,dispLang),
                                                         extendedCharacterPage,
                                                         yPos,
                                                         JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,
                                                         font,
                                                         (TUSIGN8)(ShowCursor && (lineNumber == LOCAL_enumCursor) ? STRING_INVERT : NO_INVERT),
                                                         0,
                                                         0,
                                                         FONT1_MAX_CHARS-1,
                                                         0);
                    }
                }
                else
                #endif  // end of  #if !defined(DISABLE_NATIVE_LANGUAGE) && defined(MULTIPLELANGUAGES)
                {
                    #ifdef HMI_SUPPORTS_ASIAN

                    if ((LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.engUnitsFlag == UOM_NOT_APPLICABLE) && (LOCAL_Asian))
                    {

                        packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),
                                                           yPos,
                                                           JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,
                                                           (TUSIGN8)(ShowCursor && (lineNumber == LOCAL_enumCursor) ? STRING_INVERT : NO_INVERT),
                                                           0,
                                                           ASIAN_MAX_CHARS,
                                                           ASIAN_MAX_CHARS,
                                                           0);
                    }
                    else
                    #endif
                    {
                        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),
                                                         HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                                         yPos,
                                                         JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,
                                                         font,
                                                         (TUSIGN8)(ShowCursor && (lineNumber == LOCAL_enumCursor) ? STRING_INVERT : NO_INVERT),
                                                         0,
                                                         0,
                                                         FONT1_MAX_CHARS-1,
                                                         0);
                    }
                }



                LOCAL_stringtable_text_id.ssIdx = HMI_IDX;
                LOCAL_stringtable_text_id.objIdx = SS_HMI_OBJ_STRINGTABLE;
            }
        }
        while ((LOCAL_packetStage != startPacket) && (LOCAL_packetStage <= ENUM_FRAME_PACKET_TEXT_6));
    }

//---------------------------------------------//-----------------------------------------|
// ENUM_FRAME_PACKET_HL_ON_1                   // LHS of highlighted Item (ypos = 1)      |
// ENUM_FRAME_PACKET_HL_ON_2                   // LHS of highlighted Item (ypos = 2)      |
// ENUM_FRAME_PACKET_HL_ON_3                   // LHS of highlighted Item (ypos = 3)      |
// ENUM_FRAME_PACKET_HL_ON_4                   // LHS of highlighted Item (ypos = 4)      |
// ENUM_FRAME_PACKET_HL_ON_5                   // LHS of highlighted Item (ypos = 5)      |
// ENUM_FRAME_PACKET_HL_ON_6                   // LHS of highlighted Item (ypos = 6)      |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= ENUM_FRAME_PACKET_HL_ON_1) && (LOCAL_packetStage <= ENUM_FRAME_PACKET_HL_ON_6))
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage  = ENUM_FRAME_PACKET_HL_ON_6 + 1;   // Additional Highlight not required on TFT displays
        #else
            TUSIGN8 customChar, startPacket, yPos;
            TUSIGN8 itemsPerMenuIndex,cursorIndex,lineNumberIndex;

            TUSIGN8  itemsPerMenu;

            #ifdef COMMON_TOP_WORKS_NEW_FEATURES
                switch (SFD_SIMPLE_CTW.MenuFormat)
                {
                case HMI_MENU_FORMAT_3_LINES:   itemsPerMenu = 3;   break;
                case HMI_MENU_FORMAT_4_LINES:   itemsPerMenu = 4;   break;
                case HMI_MENU_FORMAT_5_LINES:   itemsPerMenu = 5;   break;
                case HMI_MENU_FORMAT_6_LINES:   itemsPerMenu = 6;   break;
                default:                    itemsPerMenu = 4;   break;
                }
            #else
                itemsPerMenu = ITEMS_PER_MENU;
            #endif

            #ifdef HMI_SUPPORTS_ASIAN

            TBOOL   LanguageEdit = eFALSE;

            #if !defined(DISABLE_NATIVE_LANGUAGE) && defined(MULTIPLELANGUAGES)
            if ((LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.ssIdx     == HMI_IDX)
             && (LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value.objIdx    == HMI_IDX_language))
            {
                LanguageEdit = eTRUE;
            }
            #endif

            if (LanguageEdit)
            {
                itemsPerMenu = 3;
            }

            if (LOCAL_Asian)
            {
                if (LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.engUnitsFlag == UOM_NOT_APPLICABLE)
                {
                    itemsPerMenu = 2;
                }
                else
                {
                    // Edit of engineering units enum in a frame displayed in chinese
                    if (itemsPerMenu == 3)  { itemsPerMenu = 2; }
                    else                    { itemsPerMenu = 4; }
                }
            }
            #endif


            #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
            TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
            if ((FrameTableGetSecondaryIdentifier(SecondaryIdentifierText) == eTRUE) && ((itemsPerMenu == 6) || (itemsPerMenu == 3)))
            {
                itemsPerMenu --;
            }
            #endif

//            #ifdef HMI_SUPPORTS_ASIAN
//            // To improve appearance on Asian version ...
//            // if itemsPerMenu == 4  (which means the user is selecting engineering units)
//            // and numberOfCodes < 4 (which means there are no more than 3 avaialble codes)
//            // then modify display style to 2 items per menu
//            if ((LOCAL_Asian) && (itemsPerMenu == 4) && (numberOfCodes < 4))
//            {
//                itemsPerMenu = 2;
//            }
//            #endif


            itemsPerMenuIndex = itemsPerMenu - 2;

            cursorIndex = LOCAL_enumCursor >= 6 ? 6 : LOCAL_enumCursor;

            do
            {
                startPacket = LOCAL_packetStage;
                lineNumberIndex = LOCAL_packetStage - ENUM_FRAME_PACKET_HL_ON_1;
                yPos = lineNumberIndex + 1;

                customChar = HighlightPattern[itemsPerMenuIndex][cursorIndex][lineNumberIndex];

                packetsBuilt += BuildCustomCharacterString(&customChar, 1, 0, yPos, 0, 0);
            }
            while ((LOCAL_packetStage != startPacket) && (LOCAL_packetStage <= ENUM_FRAME_PACKET_HL_ON_6));
        #endif
    }
#if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
//---------------------------------------------//-----------------------------------------|
// ENUM_FRAME_PACKET_SLIDER_BAR                // Slider Bar                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_FRAME_PACKET_SLIDER_BAR)
    {
        TINT16 SliderMax = (TINT16)EnumSliderMax_LOCAL;
        TINT16 SliderAct = (TINT16)EnumSliderAct_LOCAL;

        #ifdef HMI_SUPPORTS_SERVICEPORT
        if (PacketManagerIsRemoteInstance())
        {
            SliderMax = (TINT16)EnumSliderMax_REMOTE;
            SliderAct = (TINT16)EnumSliderAct_REMOTE;
        }
        #endif
        packetsBuilt += BuildSliderBar(SliderMax, SliderAct, 0);
    }
#endif
//---------------------------------------------//-----------------------------------------|
// ENUM_FRAME_PACKET_LEFT_KEY                  // Left function key  "Cancel"             |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_FRAME_PACKET_LEFT_KEY)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_CANCEL;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// ENUM_FRAME_PACKET_RIGHT_KEY                 // Right function key  "OK"                |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ENUM_FRAME_PACKET_RIGHT_KEY)
    {
        if (WriteProtect_HMICanAccess(LOCAL_pCurrDisplayFrame->frameDefinition.enumParamFrame.value, 0))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_OK;
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,1);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,1);
        }
    }
    return packetsBuilt;
}

//end of "#if HMI_SUPPORTS_ENUM_PARAM_FRAMES"
#endif


#if defined (HMI_SUPPORTS_MANUAL_ADJUST) || defined(HMI_SUPPORTS_AUTO_ADJUST)
// No restriction on the optimization of this function
TUSIGN8 BuildAdjustFrame(void)
{

typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    ADJUST_FRAME_PACKET_TITLE_BAR,              // Title Bar "-------Device--------"       | - Start of Static Area
                                                //-----------------------------------------|
    ADJUST_FRAME_PACKET_ID_2,                   // Secondary Identifier                    |
                                                //-----------------------------------------|
    ADJUST_FRAME_ICON_T,                        // Title Bar Icon (top)                    |
                                                //-----------------------------------------|
    ADJUST_FRAME_ICON_B,                        // Title Bar Icon (bottom)                 |
                                                //-----------------------------------------|
    ADJUST_FRAME_PACKET_TITLE,                  // Parameter title                         |
                                                //-----------------------------------------|
    ADJUST_FRAME_BAR_BORDER_T,                  // bargraph border RHS Top                 |
                                                //-----------------------------------------|
    ADJUST_FRAME_BAR_BORDER_B,                  // bargraph border RHS Bottom              |
                                                //-----------------------------------------|
    ADJUST_FRAME_ENG_UNITS,                     // Engineering Units                       | - Start of active area for auto and manual adjust
                                                //-----------------------------------------|
    ADJUST_FRAME_PACKET_LEFT_KEY,               // left function key "Cancel"/"Back"/Next" |
                                                //-----------------------------------------|
    ADJUST_FRAME_PACKET_SET_CONTRAST,           // Set Contrast                            | - Start of keypress area
                                                //-----------------------------------------|
    ADJUST_FRAME_BAR_FILL_T,                    // bargraph filled area Top                |
                                                //-----------------------------------------|
    ADJUST_FRAME_BAR_FILL_B,                    // bargraph filled area Bottom             |
                                                //-----------------------------------------|
    ADJUST_FRAME_BAR_BLANK_T,                   // bargraph blank area Top                 |
                                                //-----------------------------------------|
    ADJUST_FRAME_BAR_BLANK_B,                   // bargraph blank area Bottom              |
                                                //-----------------------------------------|
    ADJUST_FRAME_FAILURE_MESSAGE,               // Failure message - auto adjust           |
                                                //-----------------------------------------|
    ADJUST_FRAME_VALUE_1,                       // Parameter Value (1st Value)             |
                                                //-----------------------------------------|
    ADJUST_FRAME_VALUE_2,                       // Parameter Value (2nd Value)             |
                                                //-----------------------------------------|
    ADJUST_FRAME_VALUE_3,                       // Parameter Value (3rd Value)             |
                                                //-----------------------------------------|
    ADJUST_FRAME_VALUE_4,                       // Parameter Value (4th Value) (or normal) |
                                                //-----------------------------------------|
#ifdef MANUAL_ADJUST_ACCELERATOR
                                                //-----------------------------------------|
    ADJUST_FRAME_BARGRAPH_VALUE,                // Numeric display of Bargraph value       |
                                                //-----------------------------------------|
    ADJUST_FRAME_BARGRAPH_VALUE_BLANK_L,        // Blank area to left of Bargraph value    |
                                                //-----------------------------------------|
    ADJUST_FRAME_BARGRAPH_VALUE_BLANK_R,        // Blank area to right of Bargraph value   |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    ADJUST_FRAME_PACKET_RIGHT_KEY,              // right function key "OK"                 |
                                                //-----------------------------------------|
    ADJUST_FRAME_PACKET_READ_SWITCHES           //                                         |
                                                //-----------------------------------------|
}ADJUST_FRAME_PACKET;

#ifdef MANUAL_ADJUST_ACCELERATOR
    static TUSIGN8 BarValueFirstPixel[2] = {0,0};
    static TUSIGN8 BarValueLastPixel[2]  = {ADJUST_BAR_MAX,ADJUST_BAR_MAX};
#endif


//    STR_REF FailMessage_stringID;
//    TUSIGN8 FailMessage_invert;
//    TUSIGN8 FailMessage_type;
//    TUSIGN8 FailMessage_justify;
//    TUSIGN8 FailMessage_font;
//    TUSIGN8 FailMessage_minlength;
//    static TUSIGN8 PrvFailMessageType[2] = {0xFF,0xFF};

    TUSIGN8 autoAdjustment = 0;
    TUSIGN8 packetsBuilt = 0;
    TUSIGN8 customChar;

    #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
    TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
    TBOOL SecondaryIdentifierActive = FrameTableGetSecondaryIdentifier(SecondaryIdentifierText);
    #endif

    if (LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_AUTO_ADJUST)
    {
        autoAdjustment = 1;
    }

    if (LOCAL_pCurrDisplayFrame->frameType == FRAME_TYPE_AUTO_ADJUST_WITH_TIMER_AND_RESULT)
    {
        autoAdjustment = 2;
    }

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = ADJUST_FRAME_PACKET_TITLE_BAR;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > ADJUST_FRAME_ENG_UNITS))
    {
        LOCAL_packetStage = ADJUST_FRAME_ENG_UNITS;
    }
    else if ((LOCAL_keypressProcessed) && (LOCAL_packetStage > ADJUST_FRAME_PACKET_SET_CONTRAST))
    {
        LOCAL_packetStage = ADJUST_FRAME_PACKET_SET_CONTRAST;
    }
    else if ((autoAdjustment == 1) && (LOCAL_packetStage > ADJUST_FRAME_BAR_FILL_T))
    {
        LOCAL_packetStage = ADJUST_FRAME_BAR_FILL_T;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == ADJUST_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = ADJUST_FRAME_PACKET_READ_SWITCHES;
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_PACKET_TITLE_BAR               // Title Bar "-------Device--------"       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.titleBar;
        #if MAX_STRINGS > 255
        LOCAL_stringtable_text_id.attribIdx += ((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.titleBar_HighByte * 256);
        #endif

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),MAX_ASIAN_TITLE_LEN,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_PACKET_ID_2                    // Secondary Identifier                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_PACKET_ID_2)
    {
        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        if (SecondaryIdentifierActive)
        {
            packetsBuilt += BuildWriteString(SecondaryIdentifierText,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,1,JUSTIFY_AS_SECONDARY_IDENTIFER,FONT_0,NO_INVERT,0,0,SECONDARY_IDENTIFIER_LEN,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_ICON_T                         // Title Bar Icon (top)                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_ICON_T)
    {
        #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
        if (LOCAL_Asian)
        {
            TUSIGN8 CustomChar[5] = {0xBE,0x41,0x43,0xFF,0xBE};
            packetsBuilt += BuildCustomCharacterString(CustomChar, 5, (TUSIGN8)(MAX_COMMON_HMI_WIDTH-5), 0, 0, 0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteIcon(ICON_ADJUST_EDIT1, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_ICON_B                         // Title Bar Icon (bottom)                 |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_ICON_B)
    {
        #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
        if (LOCAL_Asian)
        {
            TUSIGN8 CustomChar[5] = {0x01,0x7F,0x61,0x7F,0x01};
            packetsBuilt += BuildCustomCharacterString(CustomChar, 5, (TUSIGN8)(MAX_COMMON_HMI_WIDTH-5), 1, 0, 0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteIcon(ICON_ADJUST_EDIT2, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 1, 0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_PACKET_TITLE                   // Parameter title                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_PACKET_TITLE)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.title;
        #if MAX_STRINGS > 255
        LOCAL_stringtable_text_id.attribIdx += ((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.title_HighByte * 256);
        #endif

        if (autoAdjustment == 2)
        {

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,1,6,0);
            }
            else
            #endif
            {
                TUSIGN8  text[FULLWIDTH_TEXT_BUFFER_SIZE + 1];
                memset((void*)text,0x00,FULLWIDTH_TEXT_BUFFER_SIZE+1);

                strncpy((char *)text,(const char *)FrameTableGetString(LOCAL_stringtable_text_id),FULLWIDTH_TEXT_BUFFER_SIZE);
#ifndef NAVIGATOR_SPECIAL_FEATURES_HMI
                LimitTextLength(text, 12);
#endif
                packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT,FONT_1,NO_INVERT,0,1,1,0);
            }
        }
        else
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,1,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT,FONT_1,NO_INVERT,0,1,1,0);
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_BAR_BORDER_T                   // bargraph border RHS Top                 |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_BAR_BORDER_T)
    {
        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_TestValve))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == REL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == REL_IDX_RelayTestStatus))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == DIO_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == DIO_IDX_DigitalOutputTestStatus))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ImpedanceCheckResistor_TestState)))
        {
            LOCAL_packetStage ++;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_MANUAL_ADJUST_MODIFIER
            if (FrameTableGetManualAdjustModifier())
            {
                LOCAL_packetStage ++;
            }
            else
            #endif
            {
                customChar = 0xF0;
                packetsBuilt += BuildCustomCharacterString(&customChar, 1, ADJUST_BAR_MAX, 4, 0, 0);
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_BAR_BORDER_B                   // bargraph border RHS Bottom              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_BAR_BORDER_B)
    {
        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_TestValve))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == REL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == REL_IDX_RelayTestStatus))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == DIO_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == DIO_IDX_DigitalOutputTestStatus))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ImpedanceCheckResistor_TestState)))
        {
            LOCAL_packetStage ++;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_MANUAL_ADJUST_MODIFIER
            if (FrameTableGetManualAdjustModifier())
            {
                LOCAL_packetStage ++;
            }
            else
            #endif
            {
                customChar = 0x7F;
                packetsBuilt += BuildCustomCharacterString(&customChar, 1, ADJUST_BAR_MAX, 5, 0, 0);
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_ENG_UNITS                      // Engineering Units                       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_ENG_UNITS)
    {
        if ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_objidx == NO_DISPLAY_ON_ADJUST) || (autoAdjustment == 2))
        {
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 units[15];

            // Return value of "strcpy()" ignored
            //lint -e{534} Roger Arnold 2005-2-01
            strcpy((char *)units,
                   (const char *)PacketManagerGetEngUnits((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.engUnits.ssIdx,
                                                          LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.engUnits.objIdx,
                                                          LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.engUnits.attribIdx,
                                                          LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.engUnitsType));

            #ifdef HMI_SUPPORTS_CUSTOM_UNITS
            PacketManagerRemoveCustomfromUnits(units);
            #endif
            LimitTextLength(units,8);

            packetsBuilt += BuildWriteString(units,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,8,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_PACKET_LEFT_KEY                // left function key "Cancel"/"Back"/Next" |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_PACKET_LEFT_KEY)
    {
        switch (autoAdjustment)
        {
        case 2:     // FRAME_TYPE_AUTO_ADJUST_WITH_TIMER_AND_RESULT
            LOCAL_stringtable_text_id.attribIdx = IDS_BACK;

            if (AdjusterIsDataAdjusted() != 0)
            {
                // get timer value (timer goes from 0 to 100)
                ADJUST_DATA tVal;
                TUSIGN8 tType;
                TUSIGN16 percentComplete;

                if (AdjusterGetFloatValue((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx,
                                          (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_objidx,
                                          0,
                                          &tVal,
                                          &tType) == OK)
                {
                    #ifdef HMI_USES_DOUBLE
                    if (tType == ST_DOUBLE)
                    {
                        percentComplete = (TUSIGN16)(tVal.data_D + 0.5);
                    }
                    else
                    #endif
                    {
                        percentComplete = (TUSIGN16)(tVal.data_F + 0.5F);
                    }

                    // if timer < 100 then adjust function not complete
                    if (percentComplete < 100)
                    {
                        LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
                    }
                }
            }

            if (LOCAL_stringtable_text_id.attribIdx == IDS_BACK)
            {
                #ifdef HMI_SUPPORTS_SEQUENCES
                if (FrameTableIsSequenceEnabled())
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
                }
                else
                #endif
                {
                    #ifdef HMI_SUPPORTS_EASYSETUP
                    if (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.easySetupFlag != 0)
                    {
                        LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
                    }
                    else
                    #endif
                    {
                        LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
                    }
                }
            }
            break;

        case 1:     // FRAME_TYPE_AUTO_ADJUST
            #ifdef HMI_SUPPORTS_SEQUENCES
            if (FrameTableIsSequenceEnabled())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            }
            else
            #endif
            {
                #ifdef HMI_SUPPORTS_EASYSETUP
                if (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.easySetupFlag != 0)
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
                }
                else
                #endif
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
                }
            }
            break;

        default:    // FRAME_TYPE_MANUAL_ADJUST
            #ifdef HMI_SUPPORTS_SEQUENCES
            if (FrameTableIsSequenceEnabled())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            }
            else
            #endif
            {
                #ifdef HMI_SUPPORTS_EASYSETUP
                if (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.easySetupFlag != 0)
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
                }
                else
                #endif
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_CANCEL;
                }
            }
            break;
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_PACKET_SET_CONTRAST            // Set Contrast                            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_PACKET_SET_CONTRAST)
    {
        if ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == HMI_IDX)
         && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == HMI_IDX_contrast)
         && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_attribidx == 0))
        {
            packetsBuilt += BuildSetContrast(SFD_SIMPLE.contrast,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_BAR_FILL_T                     // bargraph filled area Top                |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_BAR_FILL_T)
    {
        #pragma diag_suppress=Pm057
        switch (autoAdjustment)
        {
        case 2:     // FRAME_TYPE_AUTO_ADJUST_WITH_TIMER_AND_RESULT:
            if (AdjusterIsDataAdjusted() == 0)
            {
                LOCAL_barPosition = 0;
            }
            else
            {
                // calculate bar position according to timer value (timer goes from 0 to 100)
                ADJUST_DATA tVal;
                TUSIGN8 tType;

                if (AdjusterGetFloatValue((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx,
                                          (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_objidx,
                                          0,
                                          &tVal,
                                          &tType) == OK)
                {
                    TUSIGN8 newBarPosition;
                    #ifdef HMI_USES_DOUBLE
                    if (tType == ST_DOUBLE)
                    {
//                      LOCAL_barPosition = (TUSIGN8)((tVal.data_D * ADJUST_BAR_MAX) / 100);
                        newBarPosition = (TUSIGN8)((tVal.data_D * ADJUST_BAR_MAX) / 100);
                    }
                    else
                    #endif
                    {
//                      LOCAL_barPosition = (TUSIGN8)((tVal.data_F * ADJUST_BAR_MAX) / 100);
                        newBarPosition = (TUSIGN8)((tVal.data_F * ADJUST_BAR_MAX) / 100);
                    }

#ifdef NAVIGATOR_SPECIAL_FEATURES_HMI
                    if (newBarPosition < LOCAL_barPosition)
                    {
                        AdjusterResetDataAdjusted();
                    }
#endif
                    LOCAL_barPosition = newBarPosition;
                }
                else
                {
                    LOCAL_barPosition = 0;
                }
            }
            break;

        case 1:     // FRAME_TYPE_AUTO_ADJUST
            if (AdjusterIsDataAdjusted() == 0)
            {
                LOCAL_barPosition = 0;
            }
            else
            {
                #ifdef AZ200_SPECIAL_FEATURES_HMI

                if ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX)
                 && (   (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ManualStartWarnOnErrorLimit_1pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ManualStartWarnOnErrorLimit_2pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ManualStartCalOnErrorLimit_1pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ManualStartCalOnErrorLimit_2pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ManualStartPerformanceCheck_1pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ManualStartPerformanceCheck_2pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ManualStartCal_1pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ManualStartCal_2pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_RemoteManualStartWarnOnErrorLimit_1pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_RemoteManualStartWarnOnErrorLimit_2pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_RemoteManualStartCalOnErrorLimit_1pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_RemoteManualStartCalOnErrorLimit_2pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_RemoteManualStartPerformanceCheck_1pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_RemoteManualStartPerformanceCheck_2pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_RemoteManualStartCal_1pt)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_RemoteManualStartCal_2pt))
                 && (   (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_attribidx == 0)
                     || (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_attribidx == (TUSIGN8)WHOLE_OBJECT)))
                {
                    LOCAL_barPosition += (ADJUST_BAR_MAX / 13);
                    if (LOCAL_barPosition > ADJUST_BAR_MAX)
                    {
                        LOCAL_barPosition = 0;
                        AdjusterResetDataAdjusted();
                        LOCAL_autoExit = eTRUE;
                    }
                }
                else
                #endif
                {
                    LOCAL_barPosition += (ADJUST_BAR_MAX / 35);
                    if (LOCAL_barPosition > ADJUST_BAR_MAX)
                    {
                        LOCAL_barPosition = 0;
                        AdjusterResetDataAdjusted();
                    }
                }
            }
            break;

        case 0:     // FRAME_TYPE_MANUAL_ADJUST:
            {
                ADJUST_DATA tVal, tHigh, tLow, tInc;
                TUSIGN8 tType;
//                T_RANGE_E8 enumRange;
                TBOOL rulesAreActive;

                if (AdjusterGetFloatValueAndLimits((TUSIGN16)(LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx),
                                                   (TUSIGN16)(LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx),
                                                   LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_attribidx,
                                                   &tVal,
                                                   &tHigh,
                                                   &tLow,
                                                   &tInc,
                                                   &rulesAreActive,
                                                   &tType) == OK)
                {

                    #ifdef HMI_USES_DOUBLE
                    if (tType == ST_DOUBLE)
                    {
                        if (fabs(tLow.data_D - tHigh.data_D) == 0.0)
                        {
                            if (tVal.data_D > tHigh.data_D)
                            {
                                LOCAL_barPosition = (ADJUST_BAR_MAX -1);
                            }
                            else
                            {
                                LOCAL_barPosition = 0;
                            }
                        }
                        else
                        {
                            LOCAL_barPosition = (TUSIGN8)((((tVal.data_D - tLow.data_D)/(tHigh.data_D - tLow.data_D)) * (TDOUBLE)(ADJUST_BAR_MAX -1)) + 0.5);
                        }
                    }
                    else
                    #endif
                    {
                        if ((TFLOAT)(fabs((TDOUBLE)(tLow.data_F - tHigh.data_F))) == 0.0f)
                        {
                            if (tVal.data_F > tHigh.data_F)
                            {
                                LOCAL_barPosition = (ADJUST_BAR_MAX -1);
                            }
                            else
                            {
                                LOCAL_barPosition = 0;
                            }
                        }
                        else
                        {
                            LOCAL_barPosition = (TUSIGN8)((((tVal.data_F - tLow.data_F)/(tHigh.data_F - tLow.data_F)) * (TFLOAT)(ADJUST_BAR_MAX -1)) + 0.5F);
                        }
                    }
                }
                else
                {
                    LOCAL_barPosition = 0;
                }
            } // end of case 0
            break;

        default:
            VIP_ASSERT(0);
        } // end of switch (autoAdjustment)
        #pragma diag_default=Pm057

        if (LOCAL_barPosition > (ADJUST_BAR_MAX -1)) {LOCAL_barPosition = (ADJUST_BAR_MAX -1);}

        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_TestValve))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == REL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == REL_IDX_RelayTestStatus))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == DIO_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == DIO_IDX_DigitalOutputTestStatus))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ImpedanceCheckResistor_TestState)))
        {
            LOCAL_packetStage ++;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_MANUAL_ADJUST_MODIFIER
            if (FrameTableGetManualAdjustModifier())
            {
                LOCAL_packetStage ++;
            }
            else
            #endif
            {
                customChar = 0xF0;
                packetsBuilt += BuildCustomCharacterString(&customChar, 1, 0, 4, LOCAL_barPosition, 0);
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_BAR_FILL_B                     // bargraph filled area Bottom             |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_BAR_FILL_B)
    {
        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_TestValve))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == REL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == REL_IDX_RelayTestStatus))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == DIO_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == DIO_IDX_DigitalOutputTestStatus))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ImpedanceCheckResistor_TestState)))
        {
            LOCAL_packetStage ++;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_MANUAL_ADJUST_MODIFIER
            if (FrameTableGetManualAdjustModifier())
            {
                LOCAL_packetStage ++;
            }
            else
            #endif
            {
                customChar = 0x7F;
                packetsBuilt += BuildCustomCharacterString(&customChar, 1, 0, 5, LOCAL_barPosition, 0);
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_BAR_BLANK_T                    // bargraph blank area Top                 |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_BAR_BLANK_T)
    {
        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX)
         && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_TestValve))
        {
            if (LOCAL_barPosition == 0)
            {
                //show valve closed
                packetsBuilt += BuildWriteArray(ValveClosedUpper, 25, 50, 4, 0);
            }
            else
            {
                //show valve open
                packetsBuilt += BuildWriteArray(ValveOpenUpper, 25, 50, 4, 0);
            }
        }
        else if ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == REL_IDX)
              && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == REL_IDX_RelayTestStatus))
        {
            if (LOCAL_barPosition == 0)
            {
                //show Relay Contact Closed
                packetsBuilt += BuildWriteArray(RelayOnUpper, 25, 50, 4, 0);
            }
            else
            {
                //show Relay Contact Open
                packetsBuilt += BuildWriteArray(RelayOffUpper, 25, 50, 4, 0);
            }
        }
        else if ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == DIO_IDX)
              && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == DIO_IDX_DigitalOutputTestStatus))
        {
            if (LOCAL_barPosition == 0)
            {
                //show Relay Contact Closed
                packetsBuilt += BuildWriteArray(DigoutLowUpper, 25, 50, 4, 0);
            }
            else
            {
                //show Relay Contact Open
                packetsBuilt += BuildWriteArray(DigoutHighUpper, 25, 50, 4, 0);
            }

        }
        else if ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX)
              && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ImpedanceCheckResistor_TestState))
        {
            LOCAL_packetStage ++;
        }

        else
        #endif
        {
            #ifdef HMI_SUPPORTS_MANUAL_ADJUST_MODIFIER
            if (FrameTableGetManualAdjustModifier() == 3)       //  3 = Manual Digital O/P Control
            {
                packetsBuilt += BuildWriteArray(LOCAL_barPosition == 0 ? DigoutLowUpper : DigoutHighUpper, 25, 50, 4, 0);
            }
            else if (FrameTableGetManualAdjustModifier() == 2)  //  2 = Manual Relay Control
            {
                packetsBuilt += BuildWriteArray(LOCAL_barPosition == 0 ? RelayOnUpper : RelayOffUpper, 25, 50, 4, 0);
            }
            else if (FrameTableGetManualAdjustModifier() == 1)  //  1 = Manual Valve control
            {
                packetsBuilt += BuildWriteArray(LOCAL_barPosition == 0 ? ValveClosedUpper : ValveOpenUpper, 25, 50, 4, 0);
            }
            else
            #endif
            {
                customChar = 0x10;
                if (LOCAL_barPosition < (ADJUST_BAR_MAX -1))
                {
                    packetsBuilt += BuildCustomCharacterString(&customChar, 1, (TUSIGN8)(LOCAL_barPosition+1), 4, (TUSIGN8)((ADJUST_BAR_MAX - 2) - LOCAL_barPosition) , 0);
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_BAR_BLANK_B                    // bargraph blank area Bottom              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_BAR_BLANK_B)
    {
        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX)
         && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_TestValve))
        {
            if (LOCAL_barPosition == 0)
            {
                //show valve closed
                packetsBuilt += BuildWriteArray(ValveClosedLower, 25, 50, 5, 0);
            }
            else
            {
                //show valve open
                packetsBuilt += BuildWriteArray(ValveOpenLower, 25, 50, 5, 0);
            }
        }
        else if ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == REL_IDX)
              && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == REL_IDX_RelayTestStatus))
        {
            if (LOCAL_barPosition == 0)
            {
                //show Relay Contact Closed
                packetsBuilt += BuildWriteArray(RelayOnLower, 25, 50, 5, 0);
            }
            else
            {
                //show Relay Contact Open
                packetsBuilt += BuildWriteArray(RelayOffLower, 25, 50, 5, 0);
            }
        }
        else if ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == DIO_IDX)
              && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == DIO_IDX_DigitalOutputTestStatus))
        {
            if (LOCAL_barPosition == 0)
            {
                //show Relay Contact Closed
                packetsBuilt += BuildWriteArray(DigoutLowLower, 25, 50, 5, 0);
            }
            else
            {
                //show Relay Contact Open
                packetsBuilt += BuildWriteArray(DigoutHighLower, 25, 50, 5, 0);
            }
        }
        else if ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX)
              && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ImpedanceCheckResistor_TestState))
        {
            TUSIGN8 resString[5] = {0,0,0,0,0};

            if      (LOCAL_barPosition <  7.7f) {strcpy((char*)resString, "NONE");      }   // No resistance Applied
            else if (LOCAL_barPosition < 23.1f) {strcpy((char*)resString, "200\x16");   }   // 200R Selected
            else if (LOCAL_barPosition < 38.5f) {strcpy((char*)resString, "500\x16");   }   // 500R Selected
            else if (LOCAL_barPosition < 53.9f) {strcpy((char*)resString, "1k\x16");    }   // 1k Selected
            else if (LOCAL_barPosition < 69.3f) {strcpy((char*)resString, "5k\x16");    }   // 5k Selected
            else                                {strcpy((char*)resString, "10k\x16");   }   // 10k Selected

            packetsBuilt += BuildWriteString(resString, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 5, JUSTIFY_CENTRE, FONT_1, NO_INVERT, 0, 0, 5, 0);
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_MANUAL_ADJUST_MODIFIER
            if (FrameTableGetManualAdjustModifier() == 3)       //  3 = Manual Digital O/P Control
            {
                packetsBuilt += BuildWriteArray(LOCAL_barPosition == 0 ? DigoutLowLower : DigoutHighLower, 25, 50, 5, 0);
            }
            else if (FrameTableGetManualAdjustModifier() == 2)  //  2 = Manual Relay Control
            {
                packetsBuilt += BuildWriteArray(LOCAL_barPosition == 0 ? RelayOnLower : RelayOffLower, 25, 50, 5, 0);
            }
            else if (FrameTableGetManualAdjustModifier() == 1)  //  1 = Manual Valve control
            {
                packetsBuilt += BuildWriteArray(LOCAL_barPosition == 0 ? ValveClosedLower : ValveOpenLower, 25, 50, 5, 0);
            }
            else
            #endif
            {
                customChar = 0x40;
                if (LOCAL_barPosition < (ADJUST_BAR_MAX -1))
                {
                    packetsBuilt += BuildCustomCharacterString(&customChar, 1, (TUSIGN8)(LOCAL_barPosition+1), 5, (TUSIGN8)((ADJUST_BAR_MAX -2) - LOCAL_barPosition) , 0);
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_FAILURE_MESSAGE                // Failure message - auto adjust           |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_FAILURE_MESSAGE)
    {
        TUSIGN8 inv = NO_INVERT;
        TUSIGN8 justify = JUSTIFY_LEFT_WITH_INDENT_9;
        TUSIGN8 font = FONT_1;
        TUSIGN8 minlength = 1;
        if (autoAdjustment)
        {
            if (autoAdjustment == 1)
            {
                TUSIGN16 errorCode;
                if ((AdjusterGetLimitError(&errorCode)) && (LOCAL_barPosition == 0))
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_ERROR;
                    inv = STRING_INVERT;
                }
                else
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_CLEAR_ERROR;
                    inv = NO_INVERT;
                }
            }
            else if (autoAdjustment == 2)
            {

                // Get error result and display accordingly
                ADJUST_DATA tVal;
                TUSIGN8 tType;
                TUSIGN8 errorFlag = 0;

                #ifdef HMI_SUPPORTS_AUTO_ADJUST
                if (FrameTableGetAutoAdjustAbortSettings((TUSIGN8*)NULL, (TUSIGN8*)NULL, (TUSIGN8*)NULL))
                {
                     justify = JUSTIFY_CENTRE;
                     font = FONT_0;
                     minlength = 20;
                }
                #endif

                switch (AdjusterGetFloatValue((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx,
                                              (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_objidx,
                                              1,
                                              &tVal,
                                              &tType))
                {
                case OK:
                    #ifdef HMI_USES_DOUBLE
                    if (tType == ST_DOUBLE)
                    {
                        errorFlag = tVal.data_D >= 11.0 ? 1 : (TUSIGN8)(tVal.data_D + 0.5);
                    }
                    else
                    #endif
                    {
                        errorFlag = tVal.data_F >= 11.0F ? 1 : (TUSIGN8)(tVal.data_F + 0.5);
                    }


                    #if defined(EDP300_SPECIAL_FEATURES_HMI)
                    #ifdef HMI_SUPPORTS_AUTO_ADJUST
                    if (FrameTableGetAutoAdjustAbortSettings((TUSIGN8*)NULL, (TUSIGN8*)NULL, (TUSIGN8*)NULL))
                    #else
                    if (0)
                    #endif
                    {
                        switch (errorFlag)
                        {
                        case 0:     inv = NO_INVERT;        LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;        break;
                        case 6:     inv = STRING_INVERT;    LOCAL_stringtable_text_id.attribIdx = IDS_OK;           break;
                        case 7:     inv = STRING_INVERT;    LOCAL_stringtable_text_id.attribIdx = IDS_TIMEOUT;      break;
                        case 8:     inv = STRING_INVERT;    LOCAL_stringtable_text_id.attribIdx = IDS_OUT_OF_RANGE; break;
                        case 9:     inv = STRING_INVERT;    LOCAL_stringtable_text_id.attribIdx = IDS_TERMINATED;   break;
                        case 10:    inv = STRING_INVERT;    LOCAL_stringtable_text_id.attribIdx = IDS_FAILED;       break;
                        default:    inv = STRING_INVERT;    LOCAL_stringtable_text_id.attribIdx = IDS_ERROR;        break;
                        }

                        #ifdef HMI_SUPPORTS_ASIAN
                        if ((LOCAL_Asian) && (LOCAL_stringtable_text_id.attribIdx == IDS_OUT_OF_RANGE))
                        {
                            LOCAL_stringtable_text_id.attribIdx = IDS_RANGE_ERROR;      // "Out of range" is 6 characters in Chinese so change text to "Range Error" which is only 4
                        }
                        #endif
                    }
                    else
                    {
                        if (errorFlag == 0)
                        {
                            inv = NO_INVERT;
                            LOCAL_stringtable_text_id.attribIdx = IDS_CLEAR_ERROR;
                        }
                        else
                        {
                            inv = STRING_INVERT;
                            LOCAL_stringtable_text_id.attribIdx = IDS_ERROR;
                        }
                    }
                    #elif defined(APA592_SPECIAL_FEATURES_HMI)

                    if (errorFlag == 0)
                    {
                        inv = NO_INVERT;
                        LOCAL_stringtable_text_id.attribIdx = IDS_CLEAR_ERROR;

                        // if timer has reached 100% then display "OK"
                        if (AdjusterGetFloatValue((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx,
                                                  (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_objidx,
                                                  0,
                                                  &tVal,
                                                  &tType) == OK)
                        {
                            #ifdef HMI_USES_DOUBLE
                            if (((tType == ST_DOUBLE) && (tVal.data_D >= 100.0)) || ((tType == ST_FLOAT) && (tVal.data_F >= 100.0f)))
                            #else
                            if (tVal.data_F >= 100.0f)
                            #endif
                            {
                                LOCAL_stringtable_text_id.attribIdx = IDS_OK;
                            }
                        }
                    }
                    else
                    {
                        inv = STRING_INVERT;
                        LOCAL_stringtable_text_id.attribIdx = IDS_ERROR;
                    }
                    #else
                    if (errorFlag == 0)
                    {
                        inv = NO_INVERT;
                        LOCAL_stringtable_text_id.attribIdx = IDS_CLEAR_ERROR;
                    }
                    else
                    {
                        LOCAL_stringtable_text_id.attribIdx = IDS_ERROR;
                        inv = STRING_INVERT;
                    }
                    #endif
                    break;

                case ILLEGAL_ATTRIB_IDX:
                    LOCAL_stringtable_text_id.attribIdx = IDS_CLEAR_ERROR;
                    inv = NO_INVERT;
                    break;

                default:
                    LOCAL_stringtable_text_id.attribIdx = IDS_ERROR;
                    inv = STRING_INVERT;
                    break;
                }
            }
            else
            {
                VIP_ASSERT(0);
            }

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),6,JUSTIFY_CENTRE,inv,0,1,4,0);
            }
            else
            #endif
            {
                TUSIGN8 errorText[21] = " OK ";

                if (LOCAL_stringtable_text_id.attribIdx != IDS_OK)
                {
                    strcpy((char*)errorText,(const char *)FrameTableGetString(LOCAL_stringtable_text_id));
                }

                #if defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION)
                    justify = JUSTIFY_CENTRE;
                    font = FONT_0;
                #endif
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,justify,font,inv,0,0,minlength,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_VALUE_1                        // Parameter Value (1st Value)             |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_VALUE_1)
    {
        if (autoAdjustment != 2)
        {
            LOCAL_packetStage = ADJUST_FRAME_VALUE_4;
        }
        else
        {
            TUSIGN8 text[9] = {0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x00};

            if (!PacketManagerBuilderServices_GetValueAndMakeString_AutoAdjust((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx,
                                                                               (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_objidx,
                                                                               2,
                                                                               LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.attributes.maxCharacters,
                                                                               LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.attributes.characterSet_dpPosn,
                                                                               &text[0]))
            {
                LOCAL_packetStage = (ADJUST_FRAME_VALUE_4 + 1);
            }
            else
            {
                packetsBuilt += BuildWriteString(text,
                                                 HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
#ifndef NAVIGATOR_SPECIAL_FEATURES_HMI
                                                 2,
#else
                                                 5,
#endif
                                                 JUSTIFY_RIGHT,
                                                 FONT_0,
                                                 NO_INVERT,
                                                 0,0,8,0);
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_VALUE_2                        // Parameter Value (2nd Value)             |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_VALUE_2)
    {
        TUSIGN8 text[9] = {0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x00};

        if (!PacketManagerBuilderServices_GetValueAndMakeString_AutoAdjust((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx,
                                                                           (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_objidx,
                                                                           3,
                                                                           LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.attributes.maxCharacters,
                                                                           LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.attributes.characterSet_dpPosn,
                                                                           &text[0]))
        {
            LOCAL_packetStage = (ADJUST_FRAME_VALUE_4 + 1);
        }
        else
        {
            packetsBuilt += BuildWriteString(text,
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
#ifndef NAVIGATOR_SPECIAL_FEATURES_HMI
                                             3,
#else
                                             4,
#endif
                                             JUSTIFY_RIGHT,
                                             FONT_0,
                                             NO_INVERT,
                                             0,0,8,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_VALUE_3                        // Parameter Value (3rd Value)             |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_VALUE_3)
    {
        TUSIGN8 text[9] = {0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x00};

        if (!PacketManagerBuilderServices_GetValueAndMakeString_AutoAdjust((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx,
                                                                           (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_objidx,
                                                                           4,
                                                                           LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.attributes.maxCharacters,
                                                                           LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.attributes.characterSet_dpPosn,
                                                                           &text[0]))
        {
            LOCAL_packetStage = (ADJUST_FRAME_VALUE_4 + 1);
        }
        else
        {
            packetsBuilt += BuildWriteString(text,
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
#ifndef NAVIGATOR_SPECIAL_FEATURES_HMI
                                             4,
#else
                                             3,
#endif
                                             JUSTIFY_RIGHT,
                                             FONT_0,
                                             NO_INVERT,
                                             0,0,6,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_VALUE_4                        // Parameter Value (4th Value) (or normal) |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_VALUE_4)
    {
        if (autoAdjustment != 2)
        {
            if (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_objidx == NO_DISPLAY_ON_ADJUST)
            {
                LOCAL_packetStage ++;
            }
            else
            {
                TUSIGN8 *pNumber;
                TUSIGN8 negNumber;
                TUSIGN8 text[10];
                TUSIGN8 within_over_under;

                ADJUST_DATA tVal, tHigh, tLow, tInc;
                TUSIGN8 tType;
//                T_RANGE_E8 enumRange;
                TBOOL rulesAreActive;

                if (AdjusterGetFloatValueAndLimits((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx,
                                                   (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_objidx,
                                                   LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_attribidx,
                                                   &tVal,
                                                   &tHigh,
                                                   &tLow,
                                                   &tInc,
                                                   &rulesAreActive,
                                                   &tType) == OK)
                {

                    #ifdef HMI_USES_DOUBLE
                    if (tType == ST_DOUBLE)
                    {
                        pNumber = AdjusterBuildNumberStringFromDouble(tVal.data_D,
                                                                      LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.attributes.maxCharacters,
                                                                      LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.attributes.characterSet_dpPosn,
                                                                      &negNumber,
                                                                      &within_over_under);
                    }
                    else
                    #endif
                    {
                        pNumber = AdjusterBuildNumberString(tVal.data_F,
                                                            LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.attributes.maxCharacters,
                                                            LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.attributes.characterSet_dpPosn,
                                                            &negNumber,
                                                            &within_over_under);
                    }

                    if ((within_over_under == 1) || (within_over_under == 2))
                    {
                        // overrange or underrange
                        TUSIGN8 i;
                        text[0] = 0x20;
                        for (i = 1; i <= LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.attributes.maxCharacters; )
                        {
                            text[i] = 0x05 + within_over_under;
                            i++;
                            text[i] = 0x00;
                        }
                    }
                    else
                    {
                        while (*pNumber == 0x20)
                        {
                            #pragma diag_suppress=Pm088
                            pNumber ++;
                            #pragma diag_default=Pm088
                        }

                        text[0] = negNumber ? '-' : ' ';
                        text[1] = 0x00;
                        (void)strcat((char *)text,(char *)pNumber);
                    }
                }
                else
                {
                    // failed to read value - display "..."
                    TUSIGN8 i;
                    text[0] = 0x20;
                    for (i = 1; i <= LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.attributes.maxCharacters; )
                    {
                        text[i] = 0x09;
                        i ++;
                        text[i] = 0x00;
                    }
                }
                packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,7,0);
            }
        }
        else
        {
            TUSIGN8 text[9] = {0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x00};

            if (!PacketManagerBuilderServices_GetValueAndMakeString_AutoAdjust((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx,
                                                                               (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_objidx,
                                                                               5,
                                                                               LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.attributes.maxCharacters,
                                                                               LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.attributes.characterSet_dpPosn,
                                                                               &text[0]))
            {
                LOCAL_packetStage ++;
            }
            else
            {

                packetsBuilt += BuildWriteString(text,
                                                 HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
#ifndef NAVIGATOR_SPECIAL_FEATURES_HMI
                                                 5,
#else
                                                 2,
#endif
                                                 JUSTIFY_RIGHT,
                                                 FONT_0,
                                                 NO_INVERT,
                                                 0,0,8,0);
            }
        }
    }

#ifdef MANUAL_ADJUST_ACCELERATOR
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_BARGRAPH_VALUE,                // Numeric display of Bargraph value       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_BARGRAPH_VALUE)
    {
        #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
        if (LOCAL_Asian)
        {
            LOCAL_packetStage ++;
        }
        else
        #endif
        {
            if ((FrameTableGetSpecialManualAdjustDisplayBargraphValueCharacters()) && (autoAdjustment == 0))
            {
                TUSIGN8 text[9] = {0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x2C,0x00};

                if (!PacketManagerBuilderServices_GetValueAndMakeString_AutoAdjust((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx,
                                                                                   (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx,
                                                                                   LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_attribidx,
                                                                                   FrameTableGetSpecialManualAdjustDisplayBargraphValueCharacters(),
                                                                                   FrameTableGetSpecialManualAdjustDisplayBargraphValuePrecision(),
                                                                                   &text[0]))
                {
                    LOCAL_packetStage ++;
                }
                else
                {
                    if (text[0] == ' ')
                    {
                        TUSIGN8 i = 0;
                        TUSIGN8 len = (TUSIGN8)strlen((const char *)text);

                        while (i < len)
                        {
                            text[i] = text[i+1];
                            i ++;
                        }
                    }
                    TUSIGN8 pixelOffset = (strlen((const char *)text) * 3) - 1;
                    TUSIGN8 JustifyLimit = 72 - (strlen((const char *)text) * 6);

                    TUSIGN8 Justification = 0;
                    if (LOCAL_barPosition > pixelOffset)
                    {
                        Justification = LOCAL_barPosition - pixelOffset;
                    }

                    if (Justification > JustifyLimit)
                    {
                        Justification = JustifyLimit;
                    }

                    #ifdef HMI_SUPPORTS_SERVICEPORT
                    if (PacketManagerIsRemoteInstance())
                    {
                        BarValueFirstPixel[1] = Justification;
                        BarValueLastPixel[1] = (Justification + (strlen((const char *)text) * 6)) - 1;
                    }
                    else
                    #endif
                    {
                        BarValueFirstPixel[0] = Justification;
                        BarValueLastPixel[0] = (Justification + (strlen((const char *)text) * 6)) - 1;
                    }
                    packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,(TUSIGN8)(Justification + JUSTIFY_FOR_MANUAL_ADJ_0),FONT_0,NO_INVERT,0,0,5,0);
                }
            }
            else
            {
                LOCAL_packetStage ++;
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_BARGRAPH_VALUE_BLANK_L,        // Blank area to left of Bargraph value    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_BARGRAPH_VALUE_BLANK_L)
    {
        TUSIGN8 firstPixel = 0;
        #ifdef HMI_SUPPORTS_SERVICEPORT
        if (PacketManagerIsRemoteInstance())
        {
            firstPixel = BarValueFirstPixel[1];
        }
        else
        #endif
        {
            firstPixel = BarValueFirstPixel[0];
        }

        if (firstPixel > 0)
        {
            customChar = 0x00;
            TUSIGN8 nRepeats = firstPixel -1;
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, 0, 6, nRepeats , 0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_BARGRAPH_VALUE_BLANK_R,        // Blank area to right of Bargraph value   |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_BARGRAPH_VALUE_BLANK_R)
    {
        TUSIGN8 lastPixel = 0;
        #ifdef HMI_SUPPORTS_SERVICEPORT
        if (PacketManagerIsRemoteInstance())
        {
            lastPixel = BarValueLastPixel[1];
        }
        else
        #endif
        {
            lastPixel = BarValueLastPixel[0];
        }

        if (lastPixel < ADJUST_BAR_MAX)
        {
            customChar = 0x00;
            TUSIGN8 startPos = lastPixel + 1;
            TUSIGN8 nRepeats = ADJUST_BAR_MAX - startPos;
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, startPos, 6, nRepeats , 0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#endif

//---------------------------------------------//-----------------------------------------|
// ADJUST_FRAME_PACKET_RIGHT_KEY               // right function key "OK"                 |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == ADJUST_FRAME_PACKET_RIGHT_KEY)
    {
        ATTRIB_IDENTIFIER_TYPE valueID;
        valueID.ssIdx = LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx;
        valueID.objIdx = LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx;
        valueID.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_attribidx;

        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_TestValve))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == REL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == REL_IDX_RelayTestStatus))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == DIO_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == DIO_IDX_DigitalOutputTestStatus))
         || ((LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx == CAL_IDX) && (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx == CAL_IDX_ImpedanceCheckResistor_TestState)))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_MANUAL_ADJUST_MODIFIER
            if (FrameTableGetManualAdjustModifier())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;

                if (WriteProtect_HMICanAccess(valueID, 0) == eTRUE)
                {
                    if ((AdjusterIsDataAdjusted() == 0) || (autoAdjustment == 0))
                    {
                        LOCAL_stringtable_text_id.attribIdx = IDS_OK;
                    }
                    else
                    {
                        if (autoAdjustment == 2)    // FRAME_TYPE_AUTO_ADJUST_WITH_TIMER_AND_RESULT
                        {
                            // get timer value (timer goes from 0 to 100)
                            ADJUST_DATA tVal;
                            TUSIGN8 tType;
                            TBOOL adjustInProgress = eFALSE;

                            if (AdjusterGetFloatValue((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx,
                                                      (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_objidx,
                                                      0,
                                                      &tVal,
                                                      &tType) == OK)
                            {
                                #ifdef HMI_USES_DOUBLE
                                if (tType == ST_DOUBLE)
                                {
                                    adjustInProgress = (TUSIGN16)(tVal.data_D + 0.5) < 100 ? eTRUE : eFALSE;
                                }
                                else
                                #endif
                                {
                                    adjustInProgress = (TUSIGN16)(tVal.data_F + 0.5F) < 100 ? eTRUE : eFALSE;
                                }
                            }

                            if (adjustInProgress)
                            {
                                #ifdef HMI_SUPPORTS_AUTO_ADJUST
                                if (FrameTableGetAutoAdjustAbortSettings((TUSIGN8*)NULL, (TUSIGN8*)NULL, (TUSIGN8*)NULL))
                                {
                                    #ifdef IDS_ABORT
                                    LOCAL_stringtable_text_id.attribIdx = IDS_ABORT;
                                    #else
                                    LOCAL_stringtable_text_id.attribIdx = IDS_CANCEL;
                                    #endif

                                }
                                #endif
                            }
                        }
                    }
                }
            }
        }
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,1);
        }
        else
        #endif
        {
            TUSIGN8 minlength = 3;
            #ifdef HMI_SUPPORTS_AUTO_ADJUST
            if (FrameTableGetAutoAdjustAbortSettings((TUSIGN8*)NULL, (TUSIGN8*)NULL, (TUSIGN8*)NULL))
            {
                minlength = 9;
            }
            #endif
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,minlength,1);
        }
    }
    return packetsBuilt;
}

//end of "#if defined (HMI_SUPPORTS_MANUAL_ADJUST) || defined(HMI_SUPPORTS_AUTO_ADJUST)"
#endif

#ifdef HMI_SUPPORTS_PROGRESS_FRAMES
// No restriction on the optimization of this function
TUSIGN8 BuildProgressFrame(void)
{
typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    PROGRESS_FRAME_TITLE_BAR,                   // Title Bar "-------Device--------"       | - Start of Static Area
                                                //-----------------------------------------|
    PROGRESS_FRAME_BAR_BORDER_T,                // bargraph border RHS Top                 |
                                                //-----------------------------------------|
    PROGRESS_FRAME_BAR_BORDER_B,                // bargraph border RHS Bottom              |
                                                //-----------------------------------------|
    PROGRESS_FRAME_BAR_FILL_T,                  // bargraph filled area Top                | - Start of active area
                                                //-----------------------------------------|
    PROGRESS_FRAME_BAR_FILL_B,                  // bargraph filled area Bottom             |
                                                //-----------------------------------------|
    PROGRESS_FRAME_BAR_BLANK_T,                 // bargraph blank area Top                 |
                                                //-----------------------------------------|
    PROGRESS_FRAME_BAR_BLANK_B,                 // bargraph blank area Bottom              |
                                                //-----------------------------------------|
    PROGRESS_FRAME_UPPER_ROW_TEXT,              // Upper row text                          |
                                                //-----------------------------------------|
    PROGRESS_FRAME_LOWER_ROW_TEXT,              // Lower row text                          |
                                                //-----------------------------------------|
    PROGRESS_FRAME_ABB_UPPER_LEFT,              // ABB Logo Upper Left                     |
                                                //-----------------------------------------|
    PROGRESS_FRAME_ABB_UPPER_RIGHT,             // ABB Logo Upper Right                    |
                                                //-----------------------------------------|
    PROGRESS_FRAME_ABB_LOWER_LEFT,              // ABB Logo Lower Left                     |
                                                //-----------------------------------------|
    PROGRESS_FRAME_ABB_LOWER_RIGHT,             // ABB Logo Lower Right                    |
                                                //-----------------------------------------|
    PROGRESS_FRAME_SOFTWARE_VERSION,            // Software Version                        |
                                                //-----------------------------------------|
    PROGRESS_FRAME_LEFT_KEY,                    // left function key                       |
                                                //-----------------------------------------|
    PROGRESS_FRAME_RIGHT_KEY,                   // right function key                      |
                                                //-----------------------------------------|
    PROGRESS_FRAME_READ_SWITCHES                //                                         |
                                                //-----------------------------------------| - There is no keypress area
}PROGRESS_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;

    TUSIGN8 progress_barStart;
    TUSIGN8 progress_barRepeats;
    TUSIGN8 progress_barEnd;

    TUSIGN8 statusValue = 3;
    TUSIGN8 tVal_status;

    if (AdjusterGetAttribute((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.ssidx,
                             (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.objidx_status,
                             (TUSIGN8)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.attribIdx_status,
                             (void FAST *) &tVal_status) == (TUSIGN16)OK)
    {

        statusValue = tVal_status;
    }

    #ifdef AZ200_SPECIAL_FEATURES_HMI

    TBOOL AZ200_StartupFrame = eFALSE;

    if ((LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.ssidx == NVINIT_SUBSYSTEM)
     && (LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.objidx_status == NVINIT_STATUS_OBJECT)
     && (LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.attribIdx_status == 0)
//     && (statusValue == 1)
         )
    {
        AZ200_StartupFrame = eTRUE;
    }
    #endif


    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = PROGRESS_FRAME_TITLE_BAR;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > PROGRESS_FRAME_BAR_FILL_T))
    {
        LOCAL_packetStage = PROGRESS_FRAME_BAR_FILL_T;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == PROGRESS_FRAME_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = PROGRESS_FRAME_READ_SWITCHES;
    }
//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_TITLE_BAR,                   // Title Bar "-------Device--------"       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.titleBar_attribidx;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),8,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_BAR_BORDER_T,                // bargraph border RHS Top                 |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_BAR_BORDER_T)
    {
        TUSIGN8 customChar = 0xF0;
        TUSIGN8 xpos = 115;
        TUSIGN8 ypos = 4;

        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (AZ200_StartupFrame)
        {
            ypos = 5;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                customChar = 0xFF;
                xpos = 88;
                ypos = 6;
            }
            #endif
        }
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, xpos, ypos, 0, 0);
    }
//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_BAR_BORDER_B,                // bargraph border RHS Bottom              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_BAR_BORDER_B)
    {
        TUSIGN8 customChar = 0x7F;
        TUSIGN8 xpos = 115;
        TUSIGN8 ypos = 5;

        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (AZ200_StartupFrame)
        {
            ypos = 6;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                customChar = 0xFF;
                xpos = 88;
                ypos = 6;
            }
            #endif
        }
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, xpos, ypos, 0, 0);
    }
//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_BAR_FILL_T,                  // bargraph filled area Top                |
// PROGRESS_FRAME_BAR_FILL_B,                  // bargraph filled area Bottom             |
// PROGRESS_FRAME_BAR_BLANK_T,                 // bargraph blank area Top                 |
// PROGRESS_FRAME_BAR_BLANK_B,                 // bargraph blank area Bottom              |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= PROGRESS_FRAME_BAR_FILL_T) && (LOCAL_packetStage <= PROGRESS_FRAME_BAR_BLANK_B))
    {
        // calculate bar position according to timer value (timer goes from 0 to 100)
        ADJUST_DATA tVal;
        TUSIGN8 tType;

        progress_barStart = 15;
        progress_barEnd   = 115;

        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (AZ200_StartupFrame)
        {
            progress_barStart = 15;
            progress_barEnd   = 115;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                progress_barStart = 39;
                progress_barEnd   = 88;
            }
            #endif
        }

        progress_barRepeats = 0;


        if (AdjusterGetFloatValue((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.ssidx,
                                  (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.objidx_progress,
                                  LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.attribIdx_progress,
                                  &tVal,
                                  &tType) == OK)
        {
            TUSIGN16 barPercent;

            #ifdef HMI_USES_DOUBLE
            if (tType == ST_DOUBLE)
            {
                barPercent = (TUSIGN16)(tVal.data_D + 0.5);
            }
            else
            #endif
            {
                barPercent = (TUSIGN16)(tVal.data_F + 0.5);
            }

            progress_barRepeats = ((TUSIGN16)((progress_barEnd - 1) - progress_barStart) * barPercent) / 100;
        }

        if (progress_barRepeats > ((progress_barEnd - 1) - progress_barStart))
        {
            progress_barRepeats = ((progress_barEnd - 1) - progress_barStart);
        }
    }
//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_BAR_FILL_T,                  // bargraph filled area Top                |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_BAR_FILL_T)
    {
        TUSIGN8 customChar = 0xF0;
        TUSIGN8 ypos = 4;

        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (AZ200_StartupFrame)
        {
            ypos = 5;
        }
        else
        #endif
        {

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                customChar = 0xFF;
                ypos = 6;
            }
            #endif
        }

        packetsBuilt += BuildCustomCharacterString(&customChar,
                                                   1,
                                                   progress_barStart,
                                                   ypos,
                                                   progress_barRepeats,
                                                   0);
    }
//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_BAR_FILL_B,                  // bargraph filled area Bottom             |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_BAR_FILL_B)
    {
        TUSIGN8 customChar = 0x7F;
        TUSIGN8 ypos = 5;

        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (AZ200_StartupFrame)
        {
            ypos = 6;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                customChar = 0xFF;
                ypos = 6;
            }
            #endif
        }
        packetsBuilt += BuildCustomCharacterString(&customChar,
                                                   1,
                                                   progress_barStart,
                                                   ypos,
                                                   progress_barRepeats,
                                                   0);
    }
//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_BAR_BLANK_T,                 // bargraph blank area Top                 |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_BAR_BLANK_T)
    {
        TUSIGN8 xpos = (TUSIGN8)(progress_barStart + progress_barRepeats + 1);

        if (xpos >= progress_barEnd)
        {
            // position where pattern should start is beyond end marker
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 customChar = 0x10;
            TUSIGN8 ypos = 4;

            #ifdef AZ200_SPECIAL_FEATURES_HMI
            if (AZ200_StartupFrame)
            {
                ypos = 5;
            }
            else
            #endif
            {
                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    customChar = 0x81;
                    ypos = 6;
                }
                #endif
            }
            packetsBuilt += BuildCustomCharacterString(&customChar,
                                                       1,
                                                       xpos,
                                                       ypos,
                                                       (TUSIGN8)(progress_barEnd - (progress_barStart + progress_barRepeats + 2)),
                                                       0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_BAR_BLANK_B,                 // bargraph blank area Bottom              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_BAR_BLANK_B)
    {
        TUSIGN8 xpos = (TUSIGN8)(progress_barStart + progress_barRepeats + 1);

        if (xpos >= progress_barEnd)
        {
            // position where pattern should start is beyond end marker
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 customChar = 0x40;
            TUSIGN8 ypos = 5;

            #ifdef AZ200_SPECIAL_FEATURES_HMI
            if (AZ200_StartupFrame)
            {
                ypos = 6;
            }
            else
            #endif
            {
                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    customChar = 0x81;
                    ypos = 6;
                }
                #endif
            }
            packetsBuilt += BuildCustomCharacterString(&customChar,
                                                       1,
                                                       xpos,
                                                       ypos,
                                                       (TUSIGN8)(progress_barEnd - (progress_barStart + progress_barRepeats + 2)),
                                                       0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_UPPER_ROW_TEXT,              // Upper row text                          |
// PROGRESS_FRAME_LOWER_ROW_TEXT,              // Lower row text                          |
// PROGRESS_FRAME_ABB_UPPER_LEFT,              // ABB Logo Upper Left                     |
// PROGRESS_FRAME_ABB_UPPER_RIGHT,             // ABB Logo Upper Right                    |
// PROGRESS_FRAME_ABB_UPPER_LEFT,              // ABB Logo Lower Left                     |
// PROGRESS_FRAME_ABB_UPPER_RIGHT,             // ABB Logo Lower Right                    |
// PROGRESS_FRAME_SOFTWARE_VERSION,            // ABB Logo Lower Right                    |
// PROGRESS_FRAME_LEFT_KEY,                    // left function key                       |
// PROGRESS_FRAME_RIGHT_KEY,                   // right function key                      |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= PROGRESS_FRAME_UPPER_ROW_TEXT) && (LOCAL_packetStage <= PROGRESS_FRAME_RIGHT_KEY))
    {
        TUSIGN8 tVal;

        if (AdjusterGetAttribute((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.ssidx,
                                 (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.objidx_status,
                                 (TUSIGN8)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.attribIdx_status,
                                 (void FAST *) &tVal) == (TUSIGN16)OK)
        {
            statusValue = tVal;
        }

        #if NVINIT_STYLE > 0
        if (LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.nVinitFlag)
        {
            if (statusValue > NVINIT_MAX_STATUS)
            {
                statusValue = 1;
            }
        }
        #endif
    }

//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_UPPER_ROW_TEXT,              // Upper row text                          |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_UPPER_ROW_TEXT)
    {
        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (AZ200_StartupFrame)
        {
            LOCAL_packetStage ++;
        }
        else
        #endif
        {
            TUSIGN16 tableOffset = (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.firstItem_MSB_Status1;
                     tableOffset = tableOffset << 8;
                     tableOffset += (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.firstItem_LSB_Status1;
                     tableOffset += (TUSIGN16)statusValue;

            LOCAL_stringtable_text_id.attribIdx = FrameTableGetEnumItem(tableOffset);

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,5,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_CENTRE,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS,0);
            }
        }
    }

//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_LOWER_ROW_TEXT,              // Lower row text                          |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_LOWER_ROW_TEXT)
    {
        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (AZ200_StartupFrame)
        {
            LOCAL_packetStage ++;
        }
        else
        #endif
        {
            TUSIGN16 tableOffset = (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.firstItem_MSB_Status2;
            tableOffset = tableOffset << 8;
            tableOffset += (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.firstItem_LSB_Status2;
            tableOffset += (TUSIGN16)statusValue;

            LOCAL_stringtable_text_id.attribIdx = FrameTableGetEnumItem(tableOffset);

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_RIGHT,NO_INVERT,0,5,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
				packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,3,JUSTIFY_CENTRE,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS,0);
            }
        }
    }

//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_ABB_UPPER_LEFT,              // ABB Logo Upper Left                     |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_ABB_UPPER_LEFT)
    {
        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (AZ200_StartupFrame)
        {
            packetsBuilt += BuildWriteArray(ABB_logo_upperLeft, 20, 43, 2, 0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_ABB_UPPER_RIGHT,             // ABB Logo Upper Right                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_ABB_UPPER_RIGHT)
    {
        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (AZ200_StartupFrame)
        {
            packetsBuilt += BuildWriteArray(ABB_logo_upperRight, 20, 63, 2, 0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_ABB_LOWER_LEFT,              // ABB Logo Lower Left                     |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_ABB_LOWER_LEFT)
    {
        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (AZ200_StartupFrame)
        {
            packetsBuilt += BuildWriteArray(ABB_logo_lowerLeft, 20, 43, 3, 0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_ABB_LOWER_RIGHT,             // ABB Logo Lower Right                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_ABB_LOWER_RIGHT)
    {
        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (AZ200_StartupFrame)
        {
            packetsBuilt += BuildWriteArray(ABB_logo_lowerRight, 20, 63, 3, 0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_SOFTWARE_VERSION,            // ABB Logo Lower Right                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_SOFTWARE_VERSION)
    {
        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (AZ200_StartupFrame)
        {
            // Software Version string is in the format "XXXX.YY.ZZ          "
            // This is a 20 character string (the first 10 characters contain the version number, any subsequent characters identify build errors)
            // A 20 byte array is declared and the 20 character string is copied into the array
            T_UNIT const* pDevice = (const T_UNIT*)GetSubsystemPtr((T_SUBSYSTEM_IDX)DEV_IDX);
            TUSIGN8 softwareVersion[20];
            pDevice->Get(pDevice, DEV_IDX_SoftwareVersionString, WHOLE_OBJECT, (void FAST*)softwareVersion);
            packetsBuilt += BuildWriteString(softwareVersion,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_CENTRE,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_LEFT_KEY,                    // left function key                       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_LEFT_KEY)
    {
        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (AZ200_StartupFrame)
        {
            LOCAL_packetStage ++;
        }
        else
        #endif
        {
            TUSIGN16 tableOffset = (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.firstItem_MSB_Left;
                     tableOffset = tableOffset << 8;
                     tableOffset += (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.firstItem_LSB_Left;
                     tableOffset += (TUSIGN16)statusValue;

            LOCAL_stringtable_text_id.attribIdx = FrameTableGetEnumItem(tableOffset);

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,11,0);
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// PROGRESS_FRAME_RIGHT_KEY,                   // right function key                      |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PROGRESS_FRAME_RIGHT_KEY)
    {
        #ifdef AZ200_SPECIAL_FEATURES_HMI
        if (AZ200_StartupFrame)
        {
            TUSIGN8 customChar = 0x00;
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, 0, 7, MAX_COMMON_HMI_WIDTH - 1, 0);
        }
        else
        #endif
        {
            TUSIGN16 tableOffset = (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.firstItem_MSB_Right;
                     tableOffset = tableOffset << 8;
                     tableOffset += (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.progressFrame.firstItem_LSB_Right;
                     tableOffset += (TUSIGN16)statusValue;

            LOCAL_stringtable_text_id.attribIdx = FrameTableGetEnumItem(tableOffset);

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,1);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,11,1);
            }
        }
    }
    return packetsBuilt;
}
#endif

#ifdef HMI_SUPPORTS_DISPLAY_TEST
// No restriction on the optimization of this function
TUSIGN8 BuildDisplayTest(void)
{
/*      |Packet| Parameter Edit                           |
        |------|------------------------------------------|
        |   0  | Title Bar                                | 0
        |------|------------------------------------------|
        |   1  | Title Bar Icon (top)                     | 0
        |------|------------------------------------------|
        |   2  | Title Bar Icon (bottom)                  | 0
        |------|------------------------------------------|
        |   3  | Parameter title                          | 0
        |------|------------------------------------------|
        |   4  | Blank Area                               | 1 3 5
        |------|------------------------------------------|
        |   5  | Checkerboard (line 1)                    | 1 2
        |------|------------------------------------------|
        |   6  | Checkerboard (line 2)                    | 1 2
        |------|------------------------------------------|
        |   7  | Checkerboard (line 3)                    | 1 2
        |------|------------------------------------------|
        |   8  | Checkerboard (line 4)                    | 1 2
        |------|------------------------------------------|
        |   9  | Checkerboard (line 5)                    | 1 2
        |------|------------------------------------------|
        |  10  | Checkerboard (line 6)                    | 1 2
        |------|------------------------------------------|
        |  11  | Checkerboard (line 7)                    | 1 2
        |------|------------------------------------------|
        |  12  | Checkerboard (line 8)                    | 1 2
        |------|------------------------------------------|
        |  13  | Inverse checkerboard (line 1)            | 3 4
        |------|------------------------------------------|
        |  14  | Inverse checkerboard (line 2)            | 3 4
        |------|------------------------------------------|
        |  15  | Inverse checkerboard (line 3)            | 3 4
        |------|------------------------------------------|
        |  16  | Inverse checkerboard (line 4)            | 3 4
        |------|------------------------------------------|
        |  17  | Inverse checkerboard (line 5)            | 3 4
        |------|------------------------------------------|
        |  18  | Inverse checkerboard (line 6)            | 3 4
        |------|------------------------------------------|
        |  19  | Inverse checkerboard (line 7)            | 3 4
        |------|------------------------------------------|
        |  20  | Inverse checkerboard (line 8)            | 3 4
        |------|------------------------------------------|
        |  21  | (1) Signal ID                            | 5 6
        |------|------------------------------------------|
        |  22  | (2) Signal ID                            | 5 6
        |------|------------------------------------------|
        |  23  | (3) Signal ID                            | 5 6
        |------|------------------------------------------|
        |  24  | (1) Units of measure                     | 5 6
        |------|------------------------------------------|
        |  25  | (2) Units of measure                     | 5 6
        |------|------------------------------------------|
        |  26  | (3) Units of measure                     | 5 6
        |------|------------------------------------------|
        |  27  | (1) Value  "888888888888"                | 7
        |------|------------------------------------------|
        |  28  | (1) Value  "000000000000"                | 8
        |------|------------------------------------------|
        |  29  | (2) Value  "888888888888"                | 9
        |------|------------------------------------------|
        |  30  | (2) Value  "000000000000"                | 10
        |------|------------------------------------------|
        |  31  | (3) Value  "888888888888"                | 11
        |------|------------------------------------------|
        |  32  | (3) Value  "000000000000"                | 12
        |------|------------------------------------------|
        |  33  | left function key  "Cancel"/"Back"/Next" | 0 5 6 7 8 9 10 11 12
        |------|------------------------------------------|
        |  34  | right function key "OK"                  | 0 5 6 7 8 9 10 11 12
        |------|------------------------------------------|
        |  35  | read switches                            | All
        |------|------------------------------------------|
                                                            - There is no keypress area
*/
#ifdef DISPLAY_SIZE_E
    TUSIGN8 Checkerboard1[20] = {0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
    TUSIGN8 Checkerboard2[20] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF};
    const TUSIGN8	checkerboardLen = 20;
    const TUSIGN8	checkerboardRepeat = 5;
#else
    TUSIGN8 Checkerboard1[16] = {0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
    TUSIGN8 Checkerboard2[16] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF};
    const TUSIGN8	checkerboardLen = 16;
    const TUSIGN8	checkerboardRepeat = 7;
#endif
    TUSIGN8 packetsBuilt = 0;
    TUSIGN8 TestStage;

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = 0;
        TestStage = 0;
    }
    else
    {
        // Calculate Test Stage
        // LOCAL_barPosition is used as timer
        if (AdjusterIsDataAdjusted() == 0)
        {
            LOCAL_barPosition = 0;
            TestStage = 0;
        }
        else
        {
            if ((LOCAL_updateActiveArea) && (LOCAL_packetStage == 36))
            {
                LOCAL_packetStage = 0;
                LOCAL_barPosition ++ ;

                if (LOCAL_barPosition > 12)
                {
                    LOCAL_barPosition = 0;
                    AdjusterResetDataAdjusted();
                }
            }
            TestStage = LOCAL_barPosition;
        }
    }

    if (LOCAL_packetStage == 36)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = 36;
    }

//  |------|------------------------------------------|
//  |   0  | Title Bar                                |
//  |------|------------------------------------------|
    if (LOCAL_packetStage == 0)
    {
        if (TestStage != 0)
        {
            LOCAL_packetStage = 4;
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.titleBar;
            #if MAX_STRINGS > 255
            LOCAL_stringtable_text_id.attribIdx += ((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.titleBar_HighByte * 256);
            #endif

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),8,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
            }
        }
    }
//  |------|------------------------------------------|
//  |   1  | Title Bar Icon (top)                     |
//  |------|------------------------------------------|
    if (LOCAL_packetStage == 1)
    {
        if (TestStage != 0)
        {
            LOCAL_packetStage = 4;
        }
        else
        {
            TUSIGN8 CustomChar[12] = {0x70, 0x8C, 0x02, 0xBA, 0x39, 0xB9, 0x39, 0xBA, 0x02, 0x8C, 0x70, 0x00};
            packetsBuilt += BuildCustomCharacterString(CustomChar,SMALL_ICON_WIDTH,MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1,0,0,0);
        }
    }
//  |------|------------------------------------------|
//  |   2  | Title Bar Icon (bottom)                  |
//  |------|------------------------------------------|
    if (LOCAL_packetStage == 2)
    {
        if (TestStage != 0)
        {
            LOCAL_packetStage = 4;
        }
        else
        {
            TUSIGN8 CustomChar[12] = {0x00, 0x01, 0x02, 0x02, 0x04, 0x05, 0x04, 0x02, 0x02, 0x01, 0x00, 0x00};
            packetsBuilt += BuildCustomCharacterString(CustomChar,SMALL_ICON_WIDTH,MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1,1,0,0);
        }
    }
//  |------|------------------------------------------|
//  |   3  | Parameter title                          |
//  |------|------------------------------------------|
    if (LOCAL_packetStage == 3)
    {
        if (TestStage != 0)
        {
            LOCAL_packetStage = 4;
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.title;
            #if MAX_STRINGS > 255
            LOCAL_stringtable_text_id.attribIdx += ((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.title_HighByte * 256);
            #endif

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,1,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT,FONT_1,NO_INVERT,0,1,1,0);
            }
        }
    }

//  |------|------------------------------------------|
//  |   4  | Blank Area                               |
//  |------|------------------------------------------|
    if (LOCAL_packetStage == 4)
    {
        if ((TestStage == 1) || (TestStage == 3) || (TestStage == 5))
        {
            packetsBuilt += BuildBlankArea(0,7,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//  |------|------------------------------------------|
//  |   5  | Checkerboard (line 1)                    |
//  |   6  | Checkerboard (line 2)                    |
//  |   7  | Checkerboard (line 3)                    |
//  |   8  | Checkerboard (line 4)                    |
//  |   9  | Checkerboard (line 5)                    |
//  |  10  | Checkerboard (line 6)                    |
//  |  11  | Checkerboard (line 7)                    |
//  |  12  | Checkerboard (line 8)                    |
//  |------|------------------------------------------|
    if ((LOCAL_packetStage >= 5) && (LOCAL_packetStage <= 12))
    {
        if ((TestStage != 1) && (TestStage != 2))
        {
            LOCAL_packetStage = 13;
        }
        else
        {
            TUSIGN8 startPacket;
            do
            {
                TUSIGN8 *pCCString = (LOCAL_packetStage % 2) ? Checkerboard1 : Checkerboard2;
                TUSIGN8 lineNumber = LOCAL_packetStage - 5;

                startPacket = LOCAL_packetStage;

                packetsBuilt += BuildCustomCharacterString(pCCString,checkerboardLen,0,lineNumber,checkerboardRepeat,0);
            } while ((startPacket != LOCAL_packetStage) && (LOCAL_packetStage <= 12));
        }
    }
//  |------|------------------------------------------|
//  |  13  | Inverse checkerboard (line 1)            |
//  |  14  | Inverse checkerboard (line 2)            |
//  |  15  | Inverse checkerboard (line 3)            |
//  |  16  | Inverse checkerboard (line 4)            |
//  |  17  | Inverse checkerboard (line 5)            |
//  |  18  | Inverse checkerboard (line 6)            |
//  |  19  | Inverse checkerboard (line 7)            |
//  |  20  | Inverse checkerboard (line 8)            |
//  |------|------------------------------------------|
    if ((LOCAL_packetStage >= 13) && (LOCAL_packetStage <= 20))
    {
        if ((TestStage != 3) && (TestStage != 4))
        {
            LOCAL_packetStage = 21;
        }
        else
        {
            TUSIGN8 startPacket;
            do
            {
                TUSIGN8 *pCCString = (LOCAL_packetStage % 2) ? Checkerboard2 : Checkerboard1;

                TUSIGN8 lineNumber = LOCAL_packetStage - 13;

                startPacket = LOCAL_packetStage;

                packetsBuilt += BuildCustomCharacterString(pCCString,checkerboardLen,0,lineNumber,checkerboardRepeat,0);
            } while ((startPacket != LOCAL_packetStage) && (LOCAL_packetStage <= 20));
        }
    }
//  |------|------------------------------------------|
//  |  21  | (1) Signal ID                            |
//  |  22  | (2) Signal ID                            |
//  |  23  | (3) Signal ID                            |
//  |------|------------------------------------------|
    if ((LOCAL_packetStage >= 21) && (LOCAL_packetStage <= 23))
    {
        if ((TestStage != 5) &&  (TestStage != 6))
        {
            LOCAL_packetStage = 24;
        }
        else
        {
            TUSIGN8 Text_ID[4] = {0x49,0x44,0x00,0x00}; // ID1
            TUSIGN8 startPacket;
            do
            {
                TUSIGN8 lineNumber = (LOCAL_packetStage - 20) * 2;
                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    lineNumber --;
                }
                #endif
                Text_ID[2] = LOCAL_packetStage + 28;
                startPacket = LOCAL_packetStage;
                packetsBuilt += BuildWriteString(Text_ID,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,3,0);
            } while ((startPacket != LOCAL_packetStage) && (LOCAL_packetStage <= 23));
        }
    }
//  |------|------------------------------------------|
//  |  24  | (1) Units of measure                     |
//  |  25  | (2) Units of measure                     |
//  |  26  | (3) Units of measure                     |
//  |------|------------------------------------------|
    if ((LOCAL_packetStage >= 24) && (LOCAL_packetStage <= 26))
    {
        if ((TestStage != 5) &&  (TestStage != 6))
        {
            LOCAL_packetStage = 27;
        }
        else
        {
            TUSIGN8 Text_Units[7] = {0x09,0x09,0x09,0x09,0x09,0x09,0x00};
            TUSIGN8 startPacket;
            do
            {
                TUSIGN8 lineNumber = (LOCAL_packetStage - 23) * 2;
                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    lineNumber --;
                }
                #endif
                startPacket = LOCAL_packetStage;

                packetsBuilt += BuildWriteString(Text_Units,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,3,0);
            } while ((startPacket != LOCAL_packetStage) && (LOCAL_packetStage <= 26));
        }
    }

//  |------|------------------------------------------|
//  |  27  | (1) Value  "888888888888"                |
//  |------|------------------------------------------|
    if (LOCAL_packetStage == 27)
    {
        if (TestStage != 7)
        {
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 Text_Value[13] = {0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x00};
            TUSIGN8 lineNumber = 1;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                lineNumber --;
            }
            #endif
            packetsBuilt += BuildWriteString(Text_Value,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_RIGHT_WITH_INDENT_6,FONT_1,NO_INVERT,0,0,12,0);
        }
    }
//  |------|------------------------------------------|
//  |  28  | (1) Value  "000000000000"                |
//  |------|------------------------------------------|
    if (LOCAL_packetStage == 28)
    {
        if (TestStage != 8)
        {
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 Text_Value[13] = {0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x00};
            TUSIGN8 lineNumber = 1;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                lineNumber --;
            }
            #endif
            packetsBuilt += BuildWriteString(Text_Value,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_RIGHT_WITH_INDENT_6,FONT_1,NO_INVERT,0,0,12,0);
        }
    }
//  |------|------------------------------------------|
//  |  29  | (2) Value  "888888888888"                |
//  |------|------------------------------------------|
    if (LOCAL_packetStage == 29)
    {
        if (TestStage != 9)
        {
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 Text_Value[13] = {0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x00};
            TUSIGN8 lineNumber = 3;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                lineNumber --;
            }
            #endif
            packetsBuilt += BuildWriteString(Text_Value,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_RIGHT_WITH_INDENT_6,FONT_1,NO_INVERT,0,0,12,0);
        }
    }
//  |------|------------------------------------------|
//  |  30  | (2) Value  "000000000000"                |
//  |------|------------------------------------------|
    if (LOCAL_packetStage == 30)
    {
        if (TestStage != 10)
        {
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 Text_Value[13] = {0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x00};
            TUSIGN8 lineNumber = 3;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                lineNumber --;
            }
            #endif
            packetsBuilt += BuildWriteString(Text_Value,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_RIGHT_WITH_INDENT_6,FONT_1,NO_INVERT,0,0,12,0);
        }
    }
//  |------|------------------------------------------|
//  |  31  | (3) Value  "888888888888"                |
//  |------|------------------------------------------|
    if (LOCAL_packetStage == 31)
    {
        if (TestStage != 11)
        {
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 Text_Value[13] = {0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x00};
            TUSIGN8 lineNumber = 5;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                lineNumber --;
            }
            #endif
            packetsBuilt += BuildWriteString(Text_Value,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_RIGHT_WITH_INDENT_6,FONT_1,NO_INVERT,0,0,12,0);
        }
    }
//  |------|------------------------------------------|
//  |  32  | (3) Value  "000000000000"                |
//  |------|------------------------------------------|
    if (LOCAL_packetStage == 32)
    {
        if (TestStage != 12)
        {
            LOCAL_packetStage ++;
        }
        else
        {
            TUSIGN8 Text_Value[13] = {0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x00};
            TUSIGN8 lineNumber = 5;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                lineNumber --;
            }
            #endif
            packetsBuilt += BuildWriteString(Text_Value,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_RIGHT_WITH_INDENT_6,FONT_1,NO_INVERT,0,0,12,0);
        }
    }
//  |------|------------------------------------------|
//  |  33  | left function key  "Cancel"/"Back"/Next" |
//  |------|------------------------------------------|
    if (LOCAL_packetStage == 33)
    {
        if ((TestStage == 0) || (TestStage >= 5))
        {
            #ifdef HMI_SUPPORTS_SEQUENCES
            if (FrameTableIsSequenceEnabled())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            }
            else
            #endif
            {
                #ifdef HMI_SUPPORTS_EASYSETUP
                if (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.easySetupFlag != 0)
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
                }
                else
                #endif
                {
                    if (TestStage >= 5)
                    {
                        LOCAL_stringtable_text_id.attribIdx = IDS_CANCEL;
                    }
                    else
                    {
                        LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
                    }
                }
            }
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//  |------|------------------------------------------|
//  |  34  | right function key "OK"                  |
//  |------|------------------------------------------|
    if (LOCAL_packetStage == 34)
    {
        if ((TestStage == 0) || (TestStage >= 5))
        {
            ATTRIB_IDENTIFIER_TYPE valueID;
            valueID.ssIdx = LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx;
            valueID.objIdx = LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_objidx;
            valueID.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.adjvalue_attribidx;

            if (WriteProtect_HMICanAccess(valueID, 0))
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_OK;
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            }

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//  |------|------------------------------------------|
//  |  35  | read switches                            |
//  |------|------------------------------------------|
    if (LOCAL_packetStage == 35)
    {
        packetsBuilt += BuildReadSwitches(1);
    }
    return packetsBuilt;
}
#endif


#ifdef HMI_SUPPORTS_2PT_PH_CALIBRATION
TUSIGN8 BuildTwoPointpHCalFrame(void)
{
typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_TITLE_BAR,              // Title Bar                               |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_ICON_T,                 // Icon (Top)                              |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_ICON_B,                 // Icon (Bottom                            |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_BLANK_AREA,             // Blank Area (lines 2-6)                  |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_LINE_5,                 // "Immerse In Buffer X"                   |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_LINE_6,                 // "Continue When Stable" or "Please Wait" |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_RESULT_1,               // Result 1                                |
                                                //-----------------------------------------|
#ifdef HMI_SUPPORTS_ASIAN
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_RESULT_1_ID,            // Identifier for 1st Result               |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_RESULT_2,               // Result 2                                |
                                                //-----------------------------------------|
#ifdef HMI_SUPPORTS_ASIAN
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_RESULT_2_ID,            // Identifier for 2nd Result               |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_CAL_PASS,               // "Calibration Complete"                  |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_CAL_FAIL,               // "Calibration Failed"                    |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_FAIL_REASON,            // Reason for calibration failure          |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_EDIT_UNITS,             //                                         |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_EDIT_MAX,               //                                         |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_EDIT_MIN,               //                                         |
                                                //-----------------------------------------|
#ifdef HMI_SUPPORTS_ASIAN
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_MAX_ICON,               // High Limit icon (Asian only)            |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_MIN_ICON,               // Low Limit icon (Asian only)             |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_EDIT_VALUE,             //                                         |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_VIEW_PROMPT,            //                                         |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_VIEW_VALUE_AND_UNITS,   //                                         | - Start of active area
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_PROCESS_VALUE,          //                                         | - Start of active area
                                                //-----------------------------------------|
#ifdef HMI_SUPPORTS_ASIAN
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_PV_ID,                  // Identifier for Process Value            |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    PH_CAL_FRAME_OUTPUT_HOLD_PROMPT,            //                                         |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_RIGHT_KEY,              // Right Key                               |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_LEFT_KEY,               // Left Key                                |
                                                //-----------------------------------------|
    PH_CAL_FRAME_PACKET_READ_SWITCHES           //                                         |
                                                //-----------------------------------------|
}PH_CAL_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;

    ADJUST_DATA value;
    TUSIGN8     type;

    TFLOAT edit_max = 0;
    TFLOAT edit_min = 0;
    TUSIGN8 edit_decpt = 1;
    TUSIGN8 edit_chars = 5;

    TUSIGN8 LimitError = 0;
    TUSIGN16 errorCode;

    TUSIGN8     calibrationStatus = 0;


    TUSIGN16 subsystem = LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ssidx;
    TUSIGN16 object    = LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.objidx_status;
    TUSIGN8  attribute = 0;

    if (AdjusterGetFloatValue(subsystem, object, attribute, &value, &type) == (TUSIGN16)OK)
    {
        VIP_ASSERT(type == ST_U8);
        calibrationStatus = (TUSIGN8)value.data_F;
    }

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = PH_CAL_FRAME_PACKET_TITLE_BAR;
    }

    if (LOCAL_updateActiveArea)
    {
        TUSIGN8 ActiveAreaStartPacket = PH_CAL_FRAME_PACKET_PROCESS_VALUE;

        if ((calibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_TEMP)
         || (calibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_1)
         || (calibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_2))
        {
            ActiveAreaStartPacket = PH_CAL_FRAME_PACKET_VIEW_VALUE_AND_UNITS;
        }

#ifdef HMI_SUPPORTS_OUTPUT_HOLD_AND_RELEASE
        if ((calibrationStatus == HMI_CAL_STATUS_SET_OUTPUT_HOLD)
         || (calibrationStatus == HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT)
         || (calibrationStatus == HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT))
        {
            ActiveAreaStartPacket = PH_CAL_FRAME_OUTPUT_HOLD_PROMPT;
        }
#endif


        if (LOCAL_packetStage > ActiveAreaStartPacket)
        {
            LOCAL_packetStage = ActiveAreaStartPacket;
        }
    }

    if (LOCAL_keypressProcessed)
    {
        TUSIGN8 KeypressAreaStartPacket = PH_CAL_FRAME_PACKET_READ_SWITCHES;

        if ((calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_TEMP)
         || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_1)
         || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_2))
        {
            KeypressAreaStartPacket = PH_CAL_FRAME_PACKET_EDIT_MAX;
        }

#ifdef HMI_SUPPORTS_OUTPUT_HOLD_AND_RELEASE
        if ((calibrationStatus == HMI_CAL_STATUS_SET_OUTPUT_HOLD)
         || (calibrationStatus == HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT)
         || (calibrationStatus == HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT))
        {
            KeypressAreaStartPacket = PH_CAL_FRAME_OUTPUT_HOLD_PROMPT;
        }
#endif

        if (LOCAL_packetStage > KeypressAreaStartPacket)
        {
            LOCAL_packetStage = KeypressAreaStartPacket;
        }
    }

    if (calibrationStatus != LOCAL_prvCalibrationStatus)
    {
        TUSIGN8 statusChangedStartPacket = PH_CAL_FRAME_PACKET_BLANK_AREA;

        if (((calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_1)              && (LOCAL_prvCalibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_1))
         || ((calibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_1)              && (LOCAL_prvCalibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_1))
         || ((calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_2)              && (LOCAL_prvCalibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_2))
         || ((calibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_2)              && (LOCAL_prvCalibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_2))
         || ((calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_TEMP)           && (LOCAL_prvCalibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_TEMP))
         || ((calibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_TEMP)           && (LOCAL_prvCalibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_TEMP))

#ifdef HMI_SUPPORTS_OUTPUT_HOLD_AND_RELEASE
         || ((calibrationStatus == HMI_CAL_STATUS_SET_OUTPUT_HOLD)            && (LOCAL_prvCalibrationStatus != HMI_CAL_STATUS_SET_OUTPUT_HOLD))
         || ((calibrationStatus == HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT) && (LOCAL_prvCalibrationStatus != HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT))
         || ((calibrationStatus == HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT) && (LOCAL_prvCalibrationStatus != HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT))
#endif
            )
        {
            statusChangedStartPacket = PH_CAL_FRAME_PACKET_TITLE_BAR;
        }

        if (LOCAL_packetStage > statusChangedStartPacket)
        {
            LOCAL_packetStage = statusChangedStartPacket;
        }
    }

    LOCAL_prvCalibrationStatus = calibrationStatus;


    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = PH_CAL_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_TITLE_BAR               // Title Bar                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_TITLE_BAR)
    {
        switch (calibrationStatus)
        {
        case HMI_CAL_STATUS_EDIT_BUFFER_TEMP:
            LOCAL_stringtable_text_id.attribIdx = IDS_BUFFER_TEMPERATURE;
            break;

        case HMI_CAL_STATUS_EDIT_BUFFER_1:
            LOCAL_stringtable_text_id.attribIdx = IDS_BUFFER_1;
            break;

        case HMI_CAL_STATUS_EDIT_BUFFER_2:
            LOCAL_stringtable_text_id.attribIdx = IDS_BUFFER_2;
            break;

        default:
            LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.titleBar_attribidx;
            break;
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),8,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_ICON_T                  // Icon (Top)                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_ICON_T)
    {
        if ((calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_TEMP)
         || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_1)
         || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_2))
        {
            packetsBuilt += BuildWriteIcon(ICON_NUMBER_EDIT, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
        }
        else
        {
            packetsBuilt += BuildWriteIcon(ICON_ADJUST_EDIT1, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_ICON_B                  // Icon (Bottom                            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_ICON_B)
    {
        if ((calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_TEMP)
         || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_1)
         || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_2))
        {
            LOCAL_packetStage ++;
        }
        else
        {
            packetsBuilt += BuildWriteIcon(ICON_ADJUST_EDIT2, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 1, 0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_BLANK_AREA              // Blank Area (lines 2-6)                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_BLANK_AREA)
    {
        packetsBuilt += BuildBlankArea(2,6,0);
    }


//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_LINE_5                  // "Immerse In Buffer X"                   |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_LINE_5)
    {
        switch (calibrationStatus)
        {
        case HMI_CAL_STATUS_WAITING_FOR_STABILITY_BUFFER_1:
            LOCAL_stringtable_text_id.attribIdx = IDS_IMMERSE_IN_BUFFER_1;
            break;

        case HMI_CAL_STATUS_WAITING_FOR_STABILITY_BUFFER_2:
            LOCAL_stringtable_text_id.attribIdx = IDS_IMMERSE_IN_BUFFER_2;
            break;

        default:
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            break;
        }

        if (LOCAL_stringtable_text_id.attribIdx != IDS_BLANK)
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_LEFT,NO_INVERT,0,5,5,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_LINE_6                  // "Continue When Stable" or "Please Wait" |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_LINE_6)
    {
        switch (calibrationStatus)
        {
        case HMI_CAL_STATUS_WAITING_FOR_STABILITY_BUFFER_1:
        case HMI_CAL_STATUS_WAITING_FOR_STABILITY_BUFFER_2:
            LOCAL_stringtable_text_id.attribIdx = IDS_CONTINUE_WHEN_STABLE;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_RIGHT,NO_INVERT,0,5,5,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS,0);
            }
            break;

        case HMI_CAL_STATUS_CALCULATING_1:
        case HMI_CAL_STATUS_CALCULATING_2:
            LOCAL_stringtable_text_id.attribIdx = IDS_PLEASE_WAIT;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_CENTRE,NO_INVERT,0,ASIAN_MAX_CHARS,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_CENTRE,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS,0);
            }
            break;

        default:
            LOCAL_packetStage ++;
            break;
        }
    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_RESULT_1                // Result 1                                |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_RESULT_1)
    {
        TUSIGN8 ResultSignal = LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ResultSignal_1;

        if (((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (ResultSignal != 0xFF))
        {
            TUSIGN8 ResultText[22];
            PacketManagerBuilderServices_buildSignalText(ResultText,ResultSignal,eFALSE);

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ResultSignal_2 == 0xFF) || (LOCAL_flashState))
                {
                    packetsBuilt += BuildWriteString(&ResultText[11], HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 4, JUSTIFY_LEFT_WITH_INDENT_11, FONT_1, NO_INVERT, 0, 0, FONT1_MAX_CHARS - 11, 0);
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(ResultText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 4, JUSTIFY_LEFT, FONT_0, NO_INVERT, 0, 0, FONT1_MAX_CHARS, 0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }

    }
#ifdef HMI_SUPPORTS_ASIAN
//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_RESULT_1_ID,            // Identifier for 1st Result               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_RESULT_1_ID)
    {
        if ((LOCAL_Asian)
         && ((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ResultSignal_1 != 0xFF)
         && ((LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ResultSignal_2 == 0xFF) || (LOCAL_flashState)))
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ResultSignal_1)->long_identifier;
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_LEFT,NO_INVERT,0,5,5,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_RESULT_2                // Result 2                                |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_RESULT_2)
    {
        TUSIGN8 ResultSignal = LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ResultSignal_2;

        if (((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (ResultSignal != 0xFF))
        {
            TUSIGN8 ResultText[22];
            PacketManagerBuilderServices_buildSignalText(ResultText,ResultSignal,eFALSE);
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ResultSignal_1 == 0xFF) || (!LOCAL_flashState))
                {
                    packetsBuilt += BuildWriteString(&ResultText[11], HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 4, JUSTIFY_LEFT_WITH_INDENT_11, FONT_1, NO_INVERT, 0, 0, FONT1_MAX_CHARS - 11, 0);
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(ResultText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 5, JUSTIFY_LEFT, FONT_0, NO_INVERT, 0, 0, FONT1_MAX_CHARS, 0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#ifdef HMI_SUPPORTS_ASIAN
//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_RESULT_2_ID,            // Identifier for 1st Result               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_RESULT_2_ID)
    {
        if ((LOCAL_Asian)
         && ((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ResultSignal_2 != 0xFF)
         && ((LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ResultSignal_1 == 0xFF) || (!LOCAL_flashState)))
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ResultSignal_2)->long_identifier;
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_LEFT,NO_INVERT,0,5,5,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_CAL_PASS                // "Calibration Complete"                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_CAL_PASS)
    {
        if (((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ResultSignal_1 == 0xFF)
         && (LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ResultSignal_2 == 0xFF))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_CALIBRATION_COMPLETE;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_CENTRE,NO_INVERT,0,ASIAN_MAX_CHARS,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_CENTRE,FONT_1,NO_INVERT,0,0,FONT2_MAX_CHARS,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_CAL_FAIL                // "Calibration Failed"                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_CAL_FAIL)
    {
        if (calibrationStatus == HMI_CAL_STATUS_FAILURE)
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                LOCAL_packetStage ++;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_CALIBRATION_FAILED;
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_CENTRE,FONT_1,STRING_INVERT,0,0,FONT2_MAX_CHARS,0);
            }
        }
        else
        {
            LOCAL_packetStage  = PH_CAL_FRAME_PACKET_FAIL_REASON + 1;
        }
    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_FAIL_REASON             // Reason for calibration failure          |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_FAIL_REASON)
    {
        if (calibrationStatus == HMI_CAL_STATUS_FAILURE)
        {
            TUSIGN8 ErrorReason = HMI_CAL_RESULT_NO_FAILURE;
            subsystem = LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ssidx;
            object    = LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.objidx_errorResult;
            attribute = 0;

            if (AdjusterGetFloatValue(subsystem, object, attribute, &value, &type) == (TUSIGN16)OK)
            {
                VIP_ASSERT(type == ST_U8);
                ErrorReason = (TUSIGN8)value.data_F;
            }

            switch (ErrorReason)
            {
            case HMI_CAL_RESULT_FAIL_RESULT_OUT_OF_BOUNDS:  LOCAL_stringtable_text_id.attribIdx = IDS_RESULT_OUT_OF_BOUNDS; break;
            case HMI_CAL_RESULT_FAIL_UNSTABLE_INPUT:        LOCAL_stringtable_text_id.attribIdx = IDS_UNSTABLE_INPUT;       break;
            case HMI_CAL_RESULT_FAIL_TEST_GAS_NOT_PRESENT:  LOCAL_stringtable_text_id.attribIdx = IDS_TEST_GAS_NOT_PRESENT; break;
            case HMI_CAL_RESULT_FAIL_NO_RESPONSE:           LOCAL_stringtable_text_id.attribIdx = IDS_NO_RESPONSE;          break;
            case HMI_CAL_RESULT_FAIL_NV_ERROR:              LOCAL_stringtable_text_id.attribIdx = IDS_NV_ERROR;             break;
            case HMI_CAL_RESULT_FAIL_OFFSET_HIGH:           LOCAL_stringtable_text_id.attribIdx = IDS_OFFSET_HIGH;          break;
            case HMI_CAL_RESULT_FAIL_OFFSET_LOW:            LOCAL_stringtable_text_id.attribIdx = IDS_OFFSET_LOW;           break;
            case HMI_CAL_RESULT_FAIL_SLOPE_HIGH:            LOCAL_stringtable_text_id.attribIdx = IDS_SLOPE_HIGH;           break;
            case HMI_CAL_RESULT_FAIL_SLOPE_LOW:             LOCAL_stringtable_text_id.attribIdx = IDS_SLOPE_LOW;            break;
            default:                                        LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;                break;
            }
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_CENTRE,NO_INVERT,0,ASIAN_MAX_CHARS,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_CENTRE,FONT_0,STRING_INVERT,0,0,FONT1_MAX_CHARS,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_EDIT_UNITS              //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_EDIT_UNITS)
    {
        if (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_TEMP)
        {
            TUSIGN8 UnitStr[3] = {0,0,0};
            TUSIGN8 TempUnits = 0;
            subsystem = LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ssidx;
            object    = LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.objidx_tempUnits;
            attribute = 0;

            if (AdjusterGetFloatValue(subsystem, object, attribute, &value, &type) == (TUSIGN16)OK)
            {
                VIP_ASSERT(type == ST_U8);
                TempUnits = (TUSIGN8)value.data_F;
            }

            switch (TempUnits)
            {
            case 0:     UnitStr[0] = 0xF8;  UnitStr[1] = 'C';   break;  // deg C
            case 1:     UnitStr[0] = 0xF8;  UnitStr[1] = 'F';   break;  // deg F
            case 2:     UnitStr[0] = 'K';                       break;  // K
            case 3:     UnitStr[0] = 0xF8;  UnitStr[1] = 'R';   break;  // deg R
            default:    UnitStr[0] = ' ';   UnitStr[1] = ' ';   break;  // ?
            }

            packetsBuilt += BuildWriteString(UnitStr,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,8,0);
        }
        else if ((calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_1)
              || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_2))
        {
            TUSIGN8  UnitStr[9] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
            const SIGNAL_TABLE_TYPE *pSignal = FrameTableGetSignal((TUSIGN8)LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ProcessSignal_1);
            TUSIGN8 const* pUnits = PacketManagerGetEngUnits((TUSIGN16)pSignal->engUnits.ssIdx,
                                                             pSignal->engUnits.objIdx,
                                                             pSignal->engUnits.attribIdx,
                                                             pSignal->engUnitsType);

            strcpy((char *)UnitStr,(const char *)pUnits);

            #ifdef HMI_SUPPORTS_CUSTOM_UNITS
            PacketManagerRemoveCustomfromUnits(UnitStr);
            #endif
            LimitTextLength(UnitStr,8);

            packetsBuilt += BuildWriteString(UnitStr,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,8,0);
        }
        else
        {
            LOCAL_packetStage = PH_CAL_FRAME_PACKET_EDIT_VALUE + 1;
        }
    }

//      Prepare data for stages PH_CAL_FRAME_PACKET_EDIT_MAX..PH_CAL_FRAME_PACKET_EDIT_MIN
//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_EDIT_MAX                //                                         |
// PH_CAL_FRAME_PACKET_EDIT_MIN                //                                         |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage == PH_CAL_FRAME_PACKET_EDIT_MAX) || (LOCAL_packetStage == PH_CAL_FRAME_PACKET_EDIT_MIN))
    {
        if ((calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_TEMP)
         || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_1)
         || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_2))
        {
            TUSIGN16   objectIndex;

            if (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_1)
            {
                objectIndex = (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.objidx_buffer_1;
            }
            else if (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_2)
            {
                objectIndex = (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.objidx_buffer_2;
            }
            else
            {
                objectIndex = (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.objidx_temperature;
            }

            T_UNIT const SLOW *pSub; // Pointer to Subsystem
            T_DO_ATTRIB_RANGE Range; // Pointer to range information

            pSub = GetSubsystemPtr((T_SUBSYSTEM_IDX)LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ssidx);  // Get the pointer
            pSub->GetAttributeDescription(pSub,objectIndex,0,&Range);

            edit_max = Range.range.flt.max;
            edit_min = Range.range.flt.min;

            edit_decpt = 1;  // 1 decimal place for temperature
            edit_chars = 5;  // 5 characters for temperature (XXX.X)

            if ((calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_1)
             || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_2))
            {
                // get dp associated with process value
                edit_decpt = (FrameTableGetSignal((TUSIGN8)LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ProcessSignal_1))->dpPosn;
                AdjusterAdjustResolutionForCustomDP(&edit_decpt);

                // calculate number of characters for buffer value
                if (edit_decpt == 0)
                {
                    edit_chars = 0;             // no characters reqd for dp
                }
                else
                {
                    edit_chars = edit_decpt + 1; // characters reqd for decimal places and '.' symbol
                }

                // calculate largest potential number
                TFLOAT abs_max = edit_max < 0 ? (edit_max * -1) : edit_max;
                TFLOAT abs_min = edit_min < 0 ? (edit_min * -1) : edit_min;
                if (abs_min > abs_max)  {abs_max = abs_min;}

                if      (abs_max <  10.0f)  {edit_chars += 1;}  // character(s) reqd for units
                else if (abs_max < 100.0f)  {edit_chars += 2;}  // character(s) reqd for tens & units
                else if (abs_max < 1000.0f) {edit_chars += 3;}  // character(s) reqd for hundreds,tens & units
                else                        {edit_chars += 4;}  // character(s) reqd for thousands,hundreds,tens & units
            }
            LimitError = AdjusterGetLimitError(&errorCode);
        }
        else
        {
            LOCAL_packetStage = PH_CAL_FRAME_PACKET_EDIT_VALUE + 1;
        }

    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_EDIT_MAX                //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_EDIT_MAX)
    {
        if ((calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_TEMP)
         || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_1)
         || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_2))
        {
            TUSIGN8 LineText[22];
            TUSIGN8 *pNumber;
            TUSIGN8 negNumber = 0;
            TUSIGN8 within_over_under = 0;
            TUSIGN8 i;

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                LineText[0] = 0x20;
                LineText[1] = 0x20;
                LineText[2] = 0x20;
                LineText[3] = 0x00;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_HIGH_LIMIT;
                strcpy((char *)LineText,(const char *)FrameTableGetString(LOCAL_stringtable_text_id));
            }
            pNumber = AdjusterBuildNumberString(edit_max, edit_chars, edit_decpt, &negNumber, &within_over_under);

            if (within_over_under == 1)
            {
                // overrange
                (void)strcat((char *)LineText,"  ");
                for (i = 0; i < edit_chars; i ++)
                {
                    (void)strcat((char *)LineText,"\x06");
                }
            }
            else if (within_over_under == 2)
            {
                // underrange
                (void)strcat((char *)LineText,"  ");
                for (i = 0; i < edit_chars; i ++)
                {
                    (void)strcat((char *)LineText,"\x07");
                }
            }
            else
            {
                while (*pNumber == 0x20)
                {
                    #pragma diag_suppress=Pm088
                    pNumber ++;
                    #pragma diag_default=Pm088
                }

                (void)strcat((char *)LineText,(negNumber) ? " -" : "  ");
                (void)strcat((char *)LineText,(char *)pNumber);
            }

            packetsBuilt += BuildWriteString(LineText,
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                             4,
                                             JUSTIFY_LEFT,
                                             FONT_0,
                                             (TUSIGN8)((LimitError & 0x02) != 0 ? STRING_INVERT:NO_INVERT),
                                             0,
                                             0,
                                             FONT1_MAX_CHARS,
                                             0);
        }
        else
        {
            LOCAL_packetStage = PH_CAL_FRAME_PACKET_EDIT_VALUE + 1;
        }
    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_EDIT_MIN                //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_EDIT_MIN)
    {
        if ((calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_TEMP)
         || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_1)
         || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_2))
        {
            TUSIGN8 LineText[22];
            TUSIGN8 *pNumber;
            TUSIGN8 negNumber = 0;
            TUSIGN8 within_over_under = 0;
            TUSIGN8 i;

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                LineText[0] = 0x20;
                LineText[1] = 0x20;
                LineText[2] = 0x20;
                LineText[3] = 0x00;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_LOW_LIMIT;
                strcpy((char *)LineText,(const char *)FrameTableGetString(LOCAL_stringtable_text_id));
            }

            pNumber = AdjusterBuildNumberString(edit_min, edit_chars, edit_decpt, &negNumber, &within_over_under);

            if (within_over_under == 1)
            {
                // overrange
                (void)strcat((char *)LineText,"  ");
                for (i = 0; i < edit_chars; i ++)
                {
                    (void)strcat((char *)LineText,"\x06");
                }
            }
            else if (within_over_under == 2)
            {
                // underrange
                (void)strcat((char *)LineText,"  ");
                for (i = 0; i < edit_chars; i ++)
                {
                    (void)strcat((char *)LineText,"\x07");
                }
            }
            else
            {
                while (*pNumber == 0x20)
                {
                    #pragma diag_suppress=Pm088
                    pNumber ++;
                    #pragma diag_default=Pm088
                }

                (void)strcat((char *)LineText,(negNumber) ? " -" : "  ");
                (void)strcat((char *)LineText,(char *)pNumber);
            }

            packetsBuilt += BuildWriteString(LineText,
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                             5,
                                             JUSTIFY_LEFT,FONT_0,
                                             (TUSIGN8)((LimitError & 0x01) != 0 ? STRING_INVERT:NO_INVERT),
                                             0,
                                             0,
                                             FONT1_MAX_CHARS,
                                             0);
        }
        else
        {
            LOCAL_packetStage = PH_CAL_FRAME_PACKET_EDIT_VALUE + 1;
        }
    }
#ifdef HMI_SUPPORTS_ASIAN
//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_MAX_ICON,               // High Limit icon (Asian only)            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_MAX_ICON)
    {
        if (LOCAL_Asian)
        {
            TUSIGN8 customChar[11] = {0x00,0x00,0x00,0x09,0x0D,0x5F,0x0D,0x09,0x00,0x00,0x00,};
            packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 0, 4, 0, 0);

        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_MIN_ICON,               // Low Limit icon (Asian only)             |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_MIN_ICON)
    {
        if (LOCAL_Asian)
        {
            TUSIGN8 customChar[11] = {0x00,0x00,0x00,0x48,0x58,0x7D,0x58,0x48,0x00,0x00,0x00};
            packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 0, 5, 0, 0);

        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_EDIT_VALUE              //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_EDIT_VALUE)
    {
        if ((calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_TEMP)
         || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_1)
         || (calibrationStatus == HMI_CAL_STATUS_EDIT_BUFFER_2))
        {
            TUSIGN8 CursorPsn = FrameTableGetCursorPosition();
            TUSIGN8 CursorLim = FrameTableGetCursorPositionLimit();

            TUSIGN8 LineText[22];
            TUSIGN8 negValue;
            TUSIGN8 *pValue;

            // get parameter value from Adjuster
            pValue = AdjusterGetVariableAsString(&negValue);

            LineText[0] = negValue ? '-' : ' ';
            LineText[1] = 0x00;
            (void)strcat((char *)LineText,(char*)pValue);

            if (CursorPsn == CursorLim)
            {
                packetsBuilt += BuildWriteString(LineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,(TUSIGN8)(LOCAL_Asian ? 2 : 1),JUSTIFY_RIGHT_WITH_INDENT_8,FONT_1,NO_INVERT,0,0,1,0);
            }
            else
            {
                packetsBuilt += BuildWriteString(LineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,(TUSIGN8)(LOCAL_Asian ? 2 : 1),JUSTIFY_RIGHT_WITH_INDENT_8,FONT_1,CHAR_INVERT,CursorPsn,0,1,0);
            }
        }
        else
        {
            LOCAL_packetStage = PH_CAL_FRAME_PACKET_EDIT_VALUE + 1;
        }
    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_VIEW_PROMPT             //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_VIEW_PROMPT)
    {
        switch (calibrationStatus)
        {
        case HMI_CAL_STATUS_VIEW_BUFFER_TEMP:
            LOCAL_stringtable_text_id.attribIdx = IDS_BUFFER_TEMPERATURE;
            break;

        case HMI_CAL_STATUS_VIEW_BUFFER_1:
            LOCAL_stringtable_text_id.attribIdx = IDS_BUFFER_1;
            break;

        case HMI_CAL_STATUS_VIEW_BUFFER_2:
            LOCAL_stringtable_text_id.attribIdx = IDS_BUFFER_2;
            break;

        default:
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            break;
        }

        if (LOCAL_stringtable_text_id.attribIdx != IDS_BLANK)
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,1,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT,FONT_1,NO_INVERT,0,0,1,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_VIEW_VALUE_AND_UNITS    //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_VIEW_VALUE_AND_UNITS)
    {
        if ((calibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_TEMP)
         || (calibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_1)
         || (calibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_2))
        {
            TUSIGN8  UnitStr[10] = {0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
            TUSIGN16 objectIndex;
            TFLOAT   view_value;

            TUSIGN8 LineText[22];
            TUSIGN8 *pNumber;
            TUSIGN8 negNumber = 0;
            TUSIGN8 within_over_under = 0;
            TUSIGN8 i;

            TUSIGN8 view_decpt, view_chars;

            T_UNIT const SLOW *pSub = GetSubsystemPtr((T_SUBSYSTEM_IDX)LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ssidx);

            if (calibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_TEMP)
            {
                TUSIGN8 TempUnits = 0;
                objectIndex    = LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.objidx_tempUnits;

                (void)pSub->Get(pSub,objectIndex,0,(void FAST *)&TempUnits);

                switch (TempUnits)
                {
                case 0:     (void)strcpy((char *)UnitStr, "\x20\xF8\x43");  break;  // deg C
                case 1:     (void)strcpy((char *)UnitStr, "\x20\xF8\x46");  break;  // deg F
                case 2:     (void)strcpy((char *)UnitStr, "\x20\x4B");      break;  // K
                case 3:     (void)strcpy((char *)UnitStr, "\x20\xF8\x52");  break;  // deg R
                default:    (void)strcpy((char *)UnitStr, "\x20\x3F");      break;  // ?
                }

                objectIndex = (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.objidx_temperature;

                view_decpt = 1;  // 1 decimal place for temperature
                view_chars = 5;  // 5 characters for temperature (XXX.X)
            }
            else // (calibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_1) || (calibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_2)
            {
                T_DO_ATTRIB_RANGE BufferRange; // Pointer to range information

                const SIGNAL_TABLE_TYPE *pSignal = FrameTableGetSignal((TUSIGN8)LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ProcessSignal_1);
                TUSIGN8 const * pUnits = PacketManagerGetEngUnits((TUSIGN16)pSignal->engUnits.ssIdx,
                                                                   pSignal->engUnits.objIdx,
                                                                   pSignal->engUnits.attribIdx,
                                                                   pSignal->engUnitsType);

                strcpy((char *)&UnitStr[1],(const char *)pUnits);

                #ifdef HMI_SUPPORTS_CUSTOM_UNITS
                PacketManagerRemoveCustomfromUnits(&UnitStr[1]);
                #endif
                LimitTextLength(&UnitStr[1],8);


                if (calibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_1)
                {
                    objectIndex = (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.objidx_buffer_1;
                }
                else // (calibrationStatus == HMI_CAL_STATUS_VIEW_BUFFER_2)
                {
                    objectIndex = (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.objidx_buffer_2;
                }

                view_decpt = pSignal->dpPosn;
                AdjusterAdjustResolutionForCustomDP(&view_decpt);

                // calculate number of characters for buffer value
                if (view_decpt == 0)
                {
                    view_chars = 0;             // no characters reqd for dp
                }
                else
                {
                    view_chars = view_decpt + 1; // characters reqd for decimal places and '.' symbol
                }

                pSub->GetAttributeDescription(pSub,objectIndex,0,&BufferRange);

                // calculate largest potential number
                TFLOAT view_abs_max = BufferRange.range.flt.max < 0 ? (BufferRange.range.flt.max * -1) : BufferRange.range.flt.max;
                TFLOAT view_abs_min = BufferRange.range.flt.min < 0 ? (BufferRange.range.flt.min * -1) : BufferRange.range.flt.min;
                if (view_abs_min > view_abs_max)  {view_abs_max = view_abs_min;}

                if      (view_abs_max <  10.0f)  {view_chars += 1;}  // character(s) reqd for units
                else if (view_abs_max < 100.0f)  {view_chars += 2;}  // character(s) reqd for tens & units
                else if (view_abs_max < 1000.0f) {view_chars += 3;}  // character(s) reqd for hundreds,tens & units
                else                             {view_chars += 4;}  // character(s) reqd for thousands,hundreds,tens & units

            }

            (void)pSub->Get(pSub,objectIndex,0,(void FAST *)&view_value);

            pNumber = AdjusterBuildNumberString(view_value, view_chars, view_decpt, &negNumber, &within_over_under);

            if (within_over_under == 1)
            {
                // overrange
                (void)strcpy((char *)LineText," ");
                for (i = 0; i < view_chars; i ++)
                {
                    (void)strcat((char *)LineText,"\x06");
                }
            }
            else if (within_over_under == 2)
            {
                // underrange
                (void)strcpy((char *)LineText," ");
                for (i = 0; i < view_chars; i ++)
                {
                    (void)strcat((char *)LineText,"\x07");
                }
            }
            else
            {
                while (*pNumber == 0x20)
                {
                    #pragma diag_suppress=Pm088
                    pNumber ++;
                    #pragma diag_default=Pm088
                }

                (void)strcpy((char *)LineText,(negNumber) ? "-" : " ");
                (void)strcat((char *)LineText,(char *)pNumber);
            }

            (void)strcat((char *)LineText,(char *)UnitStr);

            packetsBuilt += BuildWriteString(LineText,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_RIGHT_WITH_INDENT_1,FONT_1,NO_INVERT,0,0,16,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_PROCESS_VALUE           //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_PROCESS_VALUE)
    {
        if ((calibrationStatus != HMI_CAL_STATUS_VIEW_BUFFER_TEMP)
         && (calibrationStatus != HMI_CAL_STATUS_EDIT_BUFFER_TEMP)
         && (calibrationStatus != HMI_CAL_STATUS_VIEW_BUFFER_1)
         && (calibrationStatus != HMI_CAL_STATUS_EDIT_BUFFER_1)
         && (calibrationStatus != HMI_CAL_STATUS_VIEW_BUFFER_2)
         && (calibrationStatus != HMI_CAL_STATUS_EDIT_BUFFER_2))
        {
            TUSIGN8 PVText[22];

            PacketManagerBuilderServices_buildSignalText(PVText,(TUSIGN8)LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ProcessSignal_1,eTRUE);
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString(&PVText[4], HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 2, JUSTIFY_LEFT_WITH_INDENT_25_PIXEL, FONT_1, NO_INVERT, 0, 0, FONT2_MAX_CHARS - 4, 0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(PVText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 2, JUSTIFY_LEFT, FONT_1, NO_INVERT, 0, 0, FONT2_MAX_CHARS, 0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#ifdef HMI_SUPPORTS_ASIAN
//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_PV_ID,                  // Identifier for Process Value            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_PV_ID)
    {
        if ((LOCAL_Asian) && ((calibrationStatus != HMI_CAL_STATUS_VIEW_BUFFER_TEMP)
                           && (calibrationStatus != HMI_CAL_STATUS_EDIT_BUFFER_TEMP)
                           && (calibrationStatus != HMI_CAL_STATUS_VIEW_BUFFER_1)
                           && (calibrationStatus != HMI_CAL_STATUS_EDIT_BUFFER_1)
                           && (calibrationStatus != HMI_CAL_STATUS_VIEW_BUFFER_2)
                           && (calibrationStatus != HMI_CAL_STATUS_EDIT_BUFFER_2)))
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal((TUSIGN8)LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ProcessSignal_1)->short_identifier;
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,2,2,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_OUTPUT_HOLD_PROMPT             //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_OUTPUT_HOLD_PROMPT)
    {
#ifdef HMI_SUPPORTS_OUTPUT_HOLD_AND_RELEASE
        if (calibrationStatus == HMI_CAL_STATUS_SET_OUTPUT_HOLD)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_HOLD_OUTPUT;
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id), HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 2, JUSTIFY_LEFT, FONT_1, NO_INVERT, 0, 0, FONT2_MAX_CHARS, 0);
        }
        else if ((calibrationStatus == HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT)
              || (calibrationStatus == HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_RELEASE_OUTPUT;
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id), HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 2, JUSTIFY_LEFT, FONT_1, NO_INVERT, 0, 0, FONT2_MAX_CHARS, 0);
        }
        else
#endif
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_RIGHT_KEY               // Right Key                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_RIGHT_KEY)
    {
        TBOOL wpWriteAllowed = eFALSE;
        ATTRIB_IDENTIFIER_TYPE wpCheckAttribute;
        TUSIGN8 invert = NO_INVERT;
        TUSIGN8 minlen = 9;


        // Not strictly correct but write protection checked using status object.
        // It is assumed that the write protection settings are the same for temp, buffer 1 & buffer 2
        wpCheckAttribute.ssIdx = LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.ssidx;
        wpCheckAttribute.objIdx = LOCAL_pCurrDisplayFrame->frameDefinition.pHCalFrame.objidx_status;
        wpCheckAttribute.attribIdx = 0;
        wpWriteAllowed = WriteProtect_HMICanAccess(wpCheckAttribute, (TUSIGN8)0);

        switch (calibrationStatus)
        {
        #ifdef HMI_SUPPORTS_OUTPUT_HOLD_AND_RELEASE
        case HMI_CAL_STATUS_SET_OUTPUT_HOLD:
        case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT:
        case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT:
            LOCAL_stringtable_text_id.attribIdx = IDS_YES;
            break;
        #endif

        case HMI_CAL_STATUS_VIEW_BUFFER_TEMP:
        case HMI_CAL_STATUS_VIEW_BUFFER_1:
        case HMI_CAL_STATUS_VIEW_BUFFER_2:
            if (wpWriteAllowed)
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_EDIT;
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            }
            break;

        case HMI_CAL_STATUS_EDIT_BUFFER_TEMP:
        case HMI_CAL_STATUS_EDIT_BUFFER_1:
        case HMI_CAL_STATUS_EDIT_BUFFER_2:
            {
                TUSIGN8 CursorPsn = FrameTableGetCursorPosition();
                TUSIGN8 CursorLim = FrameTableGetCursorPositionLimit();

                if ((wpWriteAllowed) && (CursorPsn != CursorLim))
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_OK;
                }
                else
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_CANCEL;
                    invert = STRING_INVERT;
                    minlen = 0;
                }
            }
            break;

        case HMI_CAL_STATUS_SUCCESS:
            LOCAL_stringtable_text_id.attribIdx = IDS_ACCEPT;
            break;

        case HMI_CAL_STATUS_WAITING_FOR_STABILITY_BUFFER_1:
        case HMI_CAL_STATUS_WAITING_FOR_STABILITY_BUFFER_2:
            LOCAL_stringtable_text_id.attribIdx = IDS_CONTINUE;
            break;

        case HMI_CAL_STATUS_CALCULATING_1:
        case HMI_CAL_STATUS_CALCULATING_2:
        case HMI_CAL_STATUS_SUCCESS_NO_REJECT:
        case HMI_CAL_STATUS_FAILURE:
        case HMI_CAL_STATUS_ACCEPT:
        case HMI_CAL_STATUS_REJECT:
        default:
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            break;
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,invert,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,invert,0,0,minlen,0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// PH_CAL_FRAME_PACKET_LEFT_KEY                // Left Key                                |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PH_CAL_FRAME_PACKET_LEFT_KEY)
    {
        switch (calibrationStatus)
        {
        #ifdef HMI_SUPPORTS_OUTPUT_HOLD_AND_RELEASE
        case HMI_CAL_STATUS_SET_OUTPUT_HOLD:
        case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT:
        case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT:
            LOCAL_stringtable_text_id.attribIdx = IDS_NO;
            break;
        #endif

        case HMI_CAL_STATUS_VIEW_BUFFER_TEMP:
        case HMI_CAL_STATUS_VIEW_BUFFER_1:
        case HMI_CAL_STATUS_VIEW_BUFFER_2:
        case HMI_CAL_STATUS_EDIT_BUFFER_TEMP:
        case HMI_CAL_STATUS_EDIT_BUFFER_1:
        case HMI_CAL_STATUS_EDIT_BUFFER_2:
            LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            break;

        case HMI_CAL_STATUS_SUCCESS:
            LOCAL_stringtable_text_id.attribIdx = IDS_REJECT;
            break;

        case HMI_CAL_STATUS_SUCCESS_NO_REJECT:
        case HMI_CAL_STATUS_FAILURE:
            LOCAL_stringtable_text_id.attribIdx = IDS_EXIT;
            break;

        case HMI_CAL_STATUS_WAITING_FOR_STABILITY_BUFFER_1:
        case HMI_CAL_STATUS_WAITING_FOR_STABILITY_BUFFER_2:
            LOCAL_stringtable_text_id.attribIdx = IDS_ABORT;
            break;

        case HMI_CAL_STATUS_CALCULATING_1:
        case HMI_CAL_STATUS_CALCULATING_2:
        case HMI_CAL_STATUS_ACCEPT:
        case HMI_CAL_STATUS_REJECT:
        default:
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            break;
        }
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,1);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,1);
        }
    }
    return packetsBuilt;
}
// end of #ifdef HMI_SUPPORTS_2PT_PH_CALIBRATION
#endif

#ifdef HMI_SUPPORTS_MANUAL_CALIBRATION
// No restriction on the optimization of this function

#define MAN_CAL_FRAME_PROGRESS_BAR_WIDTH    50
#define MAN_CAL_FRAME_PROGRESS_BLOCK_WIDTH  15

TUSIGN8 BuildManualCalFrame(void)
{

typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_TITLE_BAR,             // Title Bar                               | - Start of Static Area
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_ICON_T,                // Icon (Top)                              |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_ICON_B,                // Icon (Bottom                            |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_BLANK_AREA,            // Blank Area (lines 2-6)                  | - Start of status changed area
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_L_4,   // Left side of progress bar               |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_M_4,   // Middle of Progress bar                  |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_R_4,   // Right Side of progress bar              |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_L_5,   // Left side of progress bar               |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_M_5,   // Middle of Progress bar                  |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_R_5,   // Right Side of progress bar              |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_CONTINUE_PROMPT,       // "Continue When Stable"                  |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_NEW_VALUE_PROMPT,      // "New"                                   |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_NEW_VALUE,             // New Value                               | - Start of keypress area (Status = HMI_CAL_STATUS_WAITING_FOR_NEW_VALUE)
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_RESULT_1,              // Result 1                                | - Start of Active Area (Status = HMI_CAL_STATUS_SUCCESS or HMI_CAL_STATUS_SUCCESS_NO_REJECT)
                                                //-----------------------------------------|
#ifdef HMI_SUPPORTS_ASIAN
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_RESULT_1_ID,           // Identifier for 1st Result               |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_RESULT_2,              // Result 2                                |
                                                //-----------------------------------------|
#ifdef HMI_SUPPORTS_ASIAN
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_RESULT_2_ID,           // Identifier for 2nd Result               |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_CAL_PASS,              // "Calibration Complete"                  |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_CAL_FAIL,              // "Calibration Failed"                    | - Start of Active Area (Status = HMI_CAL_STATUS_FAILURE)
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_FAIL_REASON,           // Reason for calibration failure          |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_PV,                    // Process Value                           | - Start of Active Area (Status = HMI_CAL_STATUS_WAITING_FOR_STABILITY or HMI_CAL_STATUS_CALCULATING_1)
                                                //-----------------------------------------|
#ifdef HMI_SUPPORTS_ASIAN
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_PV_ID,                 // Identifier for Process Value            |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    MAN_CAL_FRAME_OUTPUT_HOLD_PROMPT,           //                                         |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_CALCULATION_PROGRESS,  //                                         |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_SAMPLING_PROGRESS_4,   //                                         |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_SAMPLING_PROGRESS_5,   //                                         |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_RIGHT_KEY,             // Right Key -  Continue/Abort/Accept      |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_LEFT_KEY,              // Left Key -  Abort/Next/Reject           |
                                                //-----------------------------------------|
    MAN_CAL_FRAME_PACKET_READ_SWITCHES          //                                         |
                                                //-----------------------------------------|
}MAN_CAL_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;
    TUSIGN8 SamplingProgressRepeats;

    ADJUST_DATA value;
    TUSIGN8     type;
    static TUSIGN8 progressPosition = (MAX_COMMON_HMI_WIDTH / 2) - (MAN_CAL_FRAME_PROGRESS_BAR_WIDTH / 2);
    static TBOOL   progressCountUp  = eTRUE;

    TUSIGN8     calibrationStatus = 0;
    TUSIGN8     ActiveAreaStartPacket = MAN_CAL_FRAME_PACKET_PV;
    TUSIGN8     KeypressAreaStartPacket = MAN_CAL_FRAME_PACKET_READ_SWITCHES;

    TUSIGN16 subsystem = LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ssidx;
    TUSIGN16 object    = LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.objidx_status;
    TUSIGN8  attribute = 0;

    if (AdjusterGetFloatValue(subsystem, object, attribute, &value, &type) == (TUSIGN16)OK)
    {
        VIP_ASSERT(type == ST_U8);
        calibrationStatus = (TUSIGN8)value.data_F;
    }

    switch (calibrationStatus)
    {
    case HMI_CAL_STATUS_WAITING_FOR_NEW_VALUE:
        ActiveAreaStartPacket = MAN_CAL_FRAME_PACKET_NEW_VALUE;
        KeypressAreaStartPacket = MAN_CAL_FRAME_PACKET_NEW_VALUE;
        break;

    case HMI_CAL_STATUS_SUCCESS_NO_REJECT:
    case HMI_CAL_STATUS_SUCCESS:
        ActiveAreaStartPacket = MAN_CAL_FRAME_PACKET_RESULT_1;
        KeypressAreaStartPacket = MAN_CAL_FRAME_PACKET_READ_SWITCHES;
        break;

    case HMI_CAL_STATUS_FAILURE:
        ActiveAreaStartPacket = MAN_CAL_FRAME_PACKET_CAL_FAIL;
        KeypressAreaStartPacket = MAN_CAL_FRAME_PACKET_READ_SWITCHES;
        break;

    case HMI_CAL_STATUS_WAITING_FOR_STABILITY:
    case HMI_CAL_STATUS_CALCULATING_1:
    case HMI_CAL_STATUS_SAMPLE_COLLECTION_IN_PROGRESS:
    case HMI_CAL_STATUS_SAMPLE_COLLECTION_COMPLETE:
    case HMI_CAL_STATUS_SAMPLE_COLLECTION_STOPPED:
        ActiveAreaStartPacket = MAN_CAL_FRAME_PACKET_PV;
        KeypressAreaStartPacket = MAN_CAL_FRAME_PACKET_READ_SWITCHES;
        break;

#ifdef HMI_SUPPORTS_OUTPUT_HOLD_AND_RELEASE
    case HMI_CAL_STATUS_SET_OUTPUT_HOLD:
    case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT:
    case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT:
        ActiveAreaStartPacket = MAN_CAL_FRAME_OUTPUT_HOLD_PROMPT;
        KeypressAreaStartPacket = MAN_CAL_FRAME_OUTPUT_HOLD_PROMPT;
        break;
#endif

    default:
        ActiveAreaStartPacket = MAN_CAL_FRAME_PACKET_READ_SWITCHES;
        KeypressAreaStartPacket = MAN_CAL_FRAME_PACKET_READ_SWITCHES;
        break;
    }



    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = MAN_CAL_FRAME_PACKET_TITLE_BAR;
        LOCAL_prvCalibrationStatus = calibrationStatus;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > ActiveAreaStartPacket))
    {
        LOCAL_packetStage = ActiveAreaStartPacket;
    }
    else if ((LOCAL_keypressProcessed) && (LOCAL_packetStage > KeypressAreaStartPacket))
    {
        LOCAL_packetStage = MAN_CAL_FRAME_PACKET_NEW_VALUE;
    }
    else
    {
        asm("nop");
    }

    if ((calibrationStatus == HMI_CAL_STATUS_CALCULATING_1) && (LOCAL_packetStage > MAN_CAL_FRAME_PACKET_CALCULATION_PROGRESS))
    {
        LOCAL_packetStage = MAN_CAL_FRAME_PACKET_CALCULATION_PROGRESS;
    }

    if ((calibrationStatus != LOCAL_prvCalibrationStatus) && (LOCAL_packetStage > MAN_CAL_FRAME_PACKET_BLANK_AREA))
    {
        LOCAL_packetStage = MAN_CAL_FRAME_PACKET_BLANK_AREA;
    }

    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = MAN_CAL_FRAME_PACKET_READ_SWITCHES;
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_TITLE_BAR              // Title Bar                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.titleBar_attribidx;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),8,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_ICON_T                 // Icon (Top)                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_ICON_T)
    {
        packetsBuilt += BuildWriteIcon(ICON_ADJUST_EDIT1, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_ICON_B                 // Icon (Bottom                            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_ICON_B)
    {
        packetsBuilt += BuildWriteIcon(ICON_ADJUST_EDIT2, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 1, 0);
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_BLANK_AREA             // Blank Area (lines 2-6)                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_BLANK_AREA)
    {
        if (calibrationStatus != LOCAL_prvCalibrationStatus)
        {
            packetsBuilt += BuildBlankArea(2,6,0);

            if (LOCAL_packetStage != MAN_CAL_FRAME_PACKET_BLANK_AREA)
            {
                LOCAL_prvCalibrationStatus = calibrationStatus;
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_L_4,   // Left side of progress bar               |
// MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_M_4,   // Middle of Progress bar                  |
// MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_R_4,   // Right Side of progress bar              |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_L_4)
        && (LOCAL_packetStage <= MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_R_4))
    {
        if ((calibrationStatus != HMI_CAL_STATUS_SAMPLE_COLLECTION_COMPLETE)
         && (calibrationStatus != HMI_CAL_STATUS_SAMPLE_COLLECTION_STOPPED)
         && (calibrationStatus != HMI_CAL_STATUS_SAMPLE_COLLECTION_IN_PROGRESS))
        {
            LOCAL_packetStage = MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_R_4 + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_L_4,   // Left side of progress bar               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_L_4)
    {
        TUSIGN8 customChar = 0xF0;
        TUSIGN8 xPos       = 0;
        TUSIGN8 nRepeats   = 0;
        packetsBuilt += BuildCustomCharacterString(&customChar, // const TUSIGN8 *pCustomCharacter
                                                   1,           // TUSIGN8 nChars
                                                   xPos,        // TUSIGN8 x_pos
                                                   4,           // TUSIGN8 y_pos
                                                   nRepeats,    // TUSIGN8 nRepeats
                                                   0);          // TUSIGN8 lastPacket
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_M_4,   // Middle of Progress bar                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_M_4)
    {
        TUSIGN8 customChar = 0x10;
        TUSIGN8 xPos       = 1;
        TUSIGN8 nRepeats   = 76;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            nRepeats   = 47;
        }
        #endif

        packetsBuilt += BuildCustomCharacterString(&customChar, // const TUSIGN8 *pCustomCharacter
                                                   1,           // TUSIGN8 nChars
                                                   xPos,        // TUSIGN8 x_pos
                                                   4,           // TUSIGN8 y_pos
                                                   nRepeats,    // TUSIGN8 nRepeats
                                                   0);          // TUSIGN8 lastPacket
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_R_4,   // Right Side of progress bar              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_R_4)
    {
        TUSIGN8 customChar = 0xF0;
        TUSIGN8 xPos       = 78;
        TUSIGN8 nRepeats   = 0;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            xPos           = 49;
        }
        #endif

        packetsBuilt += BuildCustomCharacterString(&customChar, // const TUSIGN8 *pCustomCharacter
                                                   1,           // TUSIGN8 nChars
                                                   xPos,        // TUSIGN8 x_pos
                                                   4,           // TUSIGN8 y_pos
                                                   nRepeats,    // TUSIGN8 nRepeats
                                                   0);          // TUSIGN8 lastPacket
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_L_5,   // Left side of progress bar               |
// MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_M_5,   // Middle of Progress bar                  |
// MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_R_5,   // Right Side of progress bar              |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_L_5)
     && (LOCAL_packetStage <= MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_R_5))
    {
        if ((calibrationStatus != HMI_CAL_STATUS_SAMPLE_COLLECTION_COMPLETE)
         && (calibrationStatus != HMI_CAL_STATUS_SAMPLE_COLLECTION_STOPPED)
         && (calibrationStatus != HMI_CAL_STATUS_SAMPLE_COLLECTION_IN_PROGRESS)
         && (calibrationStatus != HMI_CAL_STATUS_CALCULATING_1))
        {
            LOCAL_packetStage = MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_R_5 + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_L_5,   // Left side of progress bar               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_L_5)
    {
        // initialised assuming calibrationStatus == HMI_CAL_STATUS_SAMPLE_COLLECTION_IN_PROGRESS, HMI_CAL_STATUS_SAMPLE_COLLECTION_COMPLETE or HMI_CAL_STATUS_SAMPLE_COLLECTION_STOPPED
        TUSIGN8 customChar = 0x7F;
        TUSIGN8 xPos       = 0;
        TUSIGN8 nRepeats   = 0;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            customChar     = 0x6F;
        }
        #endif

        if (calibrationStatus == HMI_CAL_STATUS_CALCULATING_1)
        {
            customChar = 0xFF;
            xPos       = (TUSIGN8)(((MAX_COMMON_HMI_WIDTH / 2) - (MAN_CAL_FRAME_PROGRESS_BAR_WIDTH / 2)) - 1);
            nRepeats   = 0;
        }

        packetsBuilt += BuildCustomCharacterString(&customChar,     // const TUSIGN8 *pCustomCharacter
                                                   1,               // TUSIGN8 nChars
                                                   xPos,            // TUSIGN8 x_pos
                                                   5,               // TUSIGN8 y_pos
                                                   nRepeats,        // TUSIGN8 nRepeats
                                                   0);              // TUSIGN8 lastPacket
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_M_5    // Middle of Progress bar                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_M_5)
    {
        // initialised assuming calibrationStatus == HMI_CAL_STATUS_SAMPLE_COLLECTION_IN_PROGRESS, HMI_CAL_STATUS_SAMPLE_COLLECTION_COMPLETE or HMI_CAL_STATUS_SAMPLE_COLLECTION_STOPPED
        TUSIGN8 customChar = 0x40;
        TUSIGN8 xPos       = 1;
        TUSIGN8 nRepeats   = 76;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            customChar     = 0x20;
            nRepeats       = 47;
        }
        #endif

        if (calibrationStatus == HMI_CAL_STATUS_CALCULATING_1)
        {
            customChar = 0x81;
            xPos       = (TUSIGN8)((MAX_COMMON_HMI_WIDTH / 2) - (MAN_CAL_FRAME_PROGRESS_BAR_WIDTH / 2));
            nRepeats   = (TUSIGN8)(MAN_CAL_FRAME_PROGRESS_BAR_WIDTH - 1);
        }

        packetsBuilt += BuildCustomCharacterString(&customChar,     // const TUSIGN8 *pCustomCharacter
                                                   1,               // TUSIGN8 nChars
                                                   xPos,            // TUSIGN8 x_pos
                                                   5,               // TUSIGN8 y_pos
                                                   nRepeats,        // TUSIGN8 nRepeats
                                                   0);              // TUSIGN8 lastPacket
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_R_5    // Right Side of progress bar              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_PROGRESS_BORDER_R_5)
    {
        // initialised assuming calibrationStatus == HMI_CAL_STATUS_SAMPLE_COLLECTION_IN_PROGRESS, HMI_CAL_STATUS_SAMPLE_COLLECTION_COMPLETE or HMI_CAL_STATUS_SAMPLE_COLLECTION_STOPPED
        TUSIGN8 customChar = 0x7F;
        TUSIGN8 xPos       = 78;
        TUSIGN8 nRepeats   = 0;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            customChar     = 0x6F;
            xPos           = 49;
        }
        #endif

        if (calibrationStatus == HMI_CAL_STATUS_CALCULATING_1)
        {
            customChar = 0xFF;
            xPos       = (TUSIGN8)((MAX_COMMON_HMI_WIDTH / 2) + (MAN_CAL_FRAME_PROGRESS_BAR_WIDTH / 2));
            nRepeats   = 0;
        }

        packetsBuilt += BuildCustomCharacterString(&customChar,     // const TUSIGN8 *pCustomCharacter
                                                   1,               // TUSIGN8 nChars
                                                   xPos,            // TUSIGN8 x_pos
                                                   5,               // TUSIGN8 y_pos
                                                   nRepeats,        // TUSIGN8 nRepeats
                                                   0);              // TUSIGN8 lastPacket
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_CONTINUE_PROMPT        // "Continue When Stable"                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_CONTINUE_PROMPT)
    {
        TBOOL SkipThisStage = eFALSE;

        TUSIGN8 yPos      = 6;
        TUSIGN8 Justify   = JUSTIFY_CENTRE;
        TUSIGN8 TextLimit = FONT1_MAX_CHARS;

        switch (calibrationStatus)
        {
        case HMI_CAL_STATUS_WAITING_FOR_STABILITY:
            if (!FrameTableIsSampleCollectionEnabled())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_CONTINUE_WHEN_STABLE;
                yPos      = 4;
              //Justify   = JUSTIFY_CENTRE;
              //TextLimit = FONT1_MAX_CHARS;
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_SAMPLE_COLLECTION;
                yPos      = 5;
              //Justify   = JUSTIFY_CENTRE;
              //TextLimit = FONT1_MAX_CHARS;

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    yPos      = 4;
                  //Justify   = JUSTIFY_CENTRE;
                    TextLimit = ASIAN_MAX_CHARS;
                }
                #endif
            }
            break;

        case HMI_CAL_STATUS_SAMPLE_COLLECTION_IN_PROGRESS:
            LOCAL_stringtable_text_id.attribIdx = IDS_SAMPLE_COLLECTION;
          //yPos      = 6;
          //Justify   = JUSTIFY_CENTRE;
          //TextLimit = FONT1_MAX_CHARS;

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                yPos      = 4;
                Justify   = JUSTIFY_RIGHT;
                TextLimit = 6;
            }
            #endif
            break;

        case HMI_CAL_STATUS_SAMPLE_COLLECTION_COMPLETE:
        case HMI_CAL_STATUS_SAMPLE_COLLECTION_STOPPED:
            LOCAL_stringtable_text_id.attribIdx = IDS_SAMPLING_COMPLETE;
          //yPos      = 6;
          //Justify   = JUSTIFY_CENTRE;
          //TextLimit = FONT1_MAX_CHARS;

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                yPos      = 4;
                Justify   = JUSTIFY_RIGHT;
                TextLimit = 6;
            }
            #endif
            break;

        default:
            SkipThisStage = eTRUE;
            break;
        }

        if (SkipThisStage)
        {
            LOCAL_packetStage ++;
        }
        else
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),  // const TUSIGN8 *text
                                                   yPos,                                            // TUSIGN8 line
                                                   Justify,                                         // TUSIGN8 justify
                                                   NO_INVERT,                                       // TUSIGN8 invert
                                                   0,                                               // TUSIGN8 blank
                                                   TextLimit,                                       // TUSIGN8 minLength
                                                   TextLimit,                                       // TUSIGN8 maxLength
                                                   0);                                              // TUSIGN8 lastPacket
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),    // const TUSIGN8 *suppliedText
                                                 HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,          // TUSIGN8 extendedCharacterPage
                                                 yPos,                                              // TUSIGN8 line
                                                 Justify,                                           // TUSIGN8 justify
                                                 FONT_0,                                            // TUSIGN8 font
                                                 NO_INVERT,                                         // TUSIGN8 invert
                                                 0,                                                 // TUSIGN8 invchar
                                                 0,                                                 // TUSIGN8 blank
                                                 TextLimit,                                         // TUSIGN8 minLength
                                                 0);                                                // TUSIGN8 lastPacket
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_NEW_VALUE_PROMPT       // "New"                                   |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_NEW_VALUE_PROMPT)
    {
        if (calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_NEW_VALUE)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_NEW;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_LEFT,NO_INVERT,0,2,2,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_LEFT,FONT_1,NO_INVERT,0,0,3,0);
            }
        }
        else
        {
            LOCAL_packetStage = MAN_CAL_FRAME_PACKET_NEW_VALUE + 1;
        }
    }

//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_NEW_VALUE              // New Value                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_NEW_VALUE)
    {
        if (calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_NEW_VALUE)
        {
            TUSIGN8 negValue;
            TUSIGN8 *pValue;
            TUSIGN8 text[10];

            // get parameter value from Adjuster
            pValue = AdjusterGetVariableAsString(&negValue);
            text[0] = negValue ? '-' : ' ';
            text[1] = 0x00;

            (void)strcat((char *)text,(char*)pValue);

            if (FrameTableGetCursorPosition() == FrameTableGetCursorPositionLimit())
            {
                packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_RIGHT_WITH_INDENT_8,FONT_1,NO_INVERT,0,0,1,0);
            }
            else
            {
                packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_RIGHT_WITH_INDENT_8,FONT_1,CHAR_INVERT,FrameTableGetCursorPosition(),0,1,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_RESULT_1               // Result 1                                |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_RESULT_1)
    {
        TUSIGN8 ResultSignal = LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ResultSignal_1;

        if (((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (ResultSignal != 0xFF))
        {
            TUSIGN8 ResultText[22];
            PacketManagerBuilderServices_buildSignalText(ResultText,ResultSignal,eFALSE);

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ResultSignal_2 == 0xFF) || (LOCAL_flashState))
                {
                    packetsBuilt += BuildWriteString(&ResultText[11], HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 4, JUSTIFY_LEFT_WITH_INDENT_11, FONT_1, NO_INVERT, 0, 0, FONT1_MAX_CHARS - 11, 0);
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(ResultText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 4, JUSTIFY_LEFT, FONT_0, NO_INVERT, 0, 0, FONT1_MAX_CHARS, 0);
            }
        }
        else
        {
            LOCAL_packetStage = MAN_CAL_FRAME_PACKET_RESULT_2 + 1;
        }
    }
#ifdef HMI_SUPPORTS_ASIAN
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_RESULT_1_ID,           // Identifier for 1st Result               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_RESULT_1_ID)
    {
        if ((LOCAL_Asian)
         && ((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ResultSignal_1 != 0xFF)
         && ((LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ResultSignal_2 == 0xFF) || (LOCAL_flashState)))
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ResultSignal_1)->long_identifier;
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_LEFT,NO_INVERT,0,5,5,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_RESULT_2               // Result 2                                |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_RESULT_2)
    {
        TUSIGN8 ResultSignal = LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ResultSignal_2;

        if (((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (ResultSignal != 0xFF))
        {
            TUSIGN8 ResultText[22];
            PacketManagerBuilderServices_buildSignalText(ResultText,ResultSignal,eFALSE);
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ResultSignal_1 == 0xFF) || (!LOCAL_flashState))
                {
                    packetsBuilt += BuildWriteString(&ResultText[11], HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 4, JUSTIFY_LEFT_WITH_INDENT_11, FONT_1, NO_INVERT, 0, 0, FONT1_MAX_CHARS - 11, 0);
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(ResultText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 5, JUSTIFY_LEFT, FONT_0, NO_INVERT, 0, 0, FONT1_MAX_CHARS, 0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#ifdef HMI_SUPPORTS_ASIAN
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_RESULT_2_ID,           // Identifier for 1st Result               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_RESULT_2_ID)
    {
        if ((LOCAL_Asian)
         && ((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ResultSignal_2 != 0xFF)
         && ((LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ResultSignal_1 == 0xFF) || (!LOCAL_flashState)))
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ResultSignal_2)->long_identifier;
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_LEFT,NO_INVERT,0,5,5,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#endif


//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_CAL_PASS               // "Calibration Complete"                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_CAL_PASS)
    {
        if (((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ResultSignal_1 == 0xFF)
         && (LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ResultSignal_2 == 0xFF))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_CALIBRATION_COMPLETE;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_CENTRE,NO_INVERT,0,ASIAN_MAX_CHARS,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_CENTRE,FONT_1,NO_INVERT,0,0,FONT2_MAX_CHARS,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_CAL_FAIL               // "Calibration Failed"                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_CAL_FAIL)
    {
        if (calibrationStatus == HMI_CAL_STATUS_FAILURE)
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {

                LOCAL_packetStage++;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_CALIBRATION_FAILED;
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_CENTRE,FONT_1,STRING_INVERT,0,0,FONT2_MAX_CHARS,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_FAIL_REASON            // Reason for calibration failure          |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_FAIL_REASON)
    {
        if ((calibrationStatus == HMI_CAL_STATUS_FAILURE) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
        {
            TUSIGN8 ErrorReason = HMI_CAL_RESULT_NO_FAILURE;
            subsystem = LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ssidx;
            object    = LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.objidx_errorResult;
            attribute = 0;

            if (AdjusterGetFloatValue(subsystem, object, attribute, &value, &type) == (TUSIGN16)OK)
            {
                VIP_ASSERT(type == ST_U8);
                ErrorReason = (TUSIGN8)value.data_F;
            }

            switch (ErrorReason)
            {
            case HMI_CAL_RESULT_FAIL_RESULT_OUT_OF_BOUNDS:  LOCAL_stringtable_text_id.attribIdx = IDS_RESULT_OUT_OF_BOUNDS; break;
            case HMI_CAL_RESULT_FAIL_UNSTABLE_INPUT:        LOCAL_stringtable_text_id.attribIdx = IDS_UNSTABLE_INPUT;       break;
            case HMI_CAL_RESULT_FAIL_TEST_GAS_NOT_PRESENT:  LOCAL_stringtable_text_id.attribIdx = IDS_TEST_GAS_NOT_PRESENT; break;
            case HMI_CAL_RESULT_FAIL_NO_RESPONSE:           LOCAL_stringtable_text_id.attribIdx = IDS_NO_RESPONSE;          break;
            case HMI_CAL_RESULT_FAIL_NV_ERROR:              LOCAL_stringtable_text_id.attribIdx = IDS_NV_ERROR;             break;
            case HMI_CAL_RESULT_FAIL_OFFSET_HIGH:           LOCAL_stringtable_text_id.attribIdx = IDS_OFFSET_HIGH;          break;
            case HMI_CAL_RESULT_FAIL_OFFSET_LOW:            LOCAL_stringtable_text_id.attribIdx = IDS_OFFSET_LOW;           break;
            case HMI_CAL_RESULT_FAIL_SLOPE_HIGH:            LOCAL_stringtable_text_id.attribIdx = IDS_SLOPE_HIGH;           break;
            case HMI_CAL_RESULT_FAIL_SLOPE_LOW:             LOCAL_stringtable_text_id.attribIdx = IDS_SLOPE_LOW;            break;
            default:                                        LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;                break;
            }

            TUSIGN8 invert = STRING_INVERT;
            if ((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
            {
                invert = NO_INVERT;
            }

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_CENTRE,invert,0,ASIAN_MAX_CHARS,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_CENTRE,FONT_0,invert,0,0,FONT1_MAX_CHARS,0);
            }
        }
        else
        {
            LOCAL_packetStage = MAN_CAL_FRAME_PACKET_FAIL_REASON + 1;
        }
    }

//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_PV                     // Process Value                           |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_PV)
    {
        TUSIGN8 PVText[22];

        PacketManagerBuilderServices_buildSignalText(PVText,LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ProcessSignal_1,eTRUE);

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString(&PVText[4], HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 2, JUSTIFY_LEFT_WITH_INDENT_25_PIXEL, FONT_1, NO_INVERT, 0, 0, FONT2_MAX_CHARS - 4, 0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(PVText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 2, JUSTIFY_LEFT, FONT_1, NO_INVERT, 0, 0, FONT2_MAX_CHARS, 0);
        }
    }
#ifdef HMI_SUPPORTS_ASIAN
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_PV_ID,                 // Identifier for Process Value            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_PV_ID)
    {
        if (LOCAL_Asian)
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ProcessSignal_1)->short_identifier;
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,2,2,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#endif

//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_OUTPUT_HOLD_PROMPT            //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_OUTPUT_HOLD_PROMPT)
    {
        TBOOL skipThisStage = eTRUE;

        #ifdef HMI_SUPPORTS_OUTPUT_HOLD_AND_RELEASE
        if (calibrationStatus == HMI_CAL_STATUS_SET_OUTPUT_HOLD)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_HOLD_OUTPUT;
            skipThisStage = eFALSE;
        }
        else if ((calibrationStatus == HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT)
              || (calibrationStatus == HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_RELEASE_OUTPUT;
            skipThisStage = eFALSE;
        }
        else
        {
            skipThisStage = eTRUE;
        }
        #endif

        if (skipThisStage)
        {
            LOCAL_packetStage ++;
        }
        else
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,ASIAN_MAX_CHARS,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2, JUSTIFY_LEFT, FONT_1, NO_INVERT, 0, 0, FONT2_MAX_CHARS, 0);
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_CALCULATION_PROGRESS,  //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_CALCULATION_PROGRESS)
    {
        if (calibrationStatus == HMI_CAL_STATUS_CALCULATING_1)
        {
            TUSIGN8 customChar[MAN_CAL_FRAME_PROGRESS_BLOCK_WIDTH];  //{0x81,0xBD,0xBD,0xBD,0xBD,0xBD,0xBD,0xBD,0xBD,0xBD,0xBD,0xBD,0xBD,0xBD,0x81}
            TUSIGN8 r;

            customChar[0] = 0x81;
            for (r = 1; r < MAN_CAL_FRAME_PROGRESS_BLOCK_WIDTH; r ++)
            {
                customChar[r] = 0xBD;
            }
            customChar[MAN_CAL_FRAME_PROGRESS_BLOCK_WIDTH - 1] = 0x81;


            packetsBuilt += BuildWriteArray(customChar, MAN_CAL_FRAME_PROGRESS_BLOCK_WIDTH, progressPosition, 5, 0);

            if (progressCountUp)
            {
                if (progressPosition >= ((MAX_COMMON_HMI_WIDTH / 2) + (MAN_CAL_FRAME_PROGRESS_BAR_WIDTH / 2)) - MAN_CAL_FRAME_PROGRESS_BLOCK_WIDTH)
                {
                    progressCountUp  = eFALSE;
                    progressPosition = (((MAX_COMMON_HMI_WIDTH / 2) + (MAN_CAL_FRAME_PROGRESS_BAR_WIDTH / 2)) - MAN_CAL_FRAME_PROGRESS_BLOCK_WIDTH) - 1;
                }
                else
                {
                    progressPosition ++;
                }
            }
            else
            {
                if (progressPosition <= ((MAX_COMMON_HMI_WIDTH / 2) - (MAN_CAL_FRAME_PROGRESS_BAR_WIDTH / 2)))
                {
                    progressCountUp  = eTRUE;
                    progressPosition = ((MAX_COMMON_HMI_WIDTH / 2) - (MAN_CAL_FRAME_PROGRESS_BAR_WIDTH / 2)) + 1;
                }
                else
                {
                    progressPosition --;
                }
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_SAMPLING_PROGRESS_4,   //                                         |
// MAN_CAL_FRAME_PACKET_SAMPLING_PROGRESS_5,   //                                         |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= MAN_CAL_FRAME_PACKET_SAMPLING_PROGRESS_4)
     && (LOCAL_packetStage <= MAN_CAL_FRAME_PACKET_SAMPLING_PROGRESS_5))
    {
        TINT16  SamplingProgress = 0;
        TBOOL   SamplingActive   = eTRUE;

        if (calibrationStatus == HMI_CAL_STATUS_SAMPLE_COLLECTION_IN_PROGRESS)
        {
            subsystem = LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ssidx;
            object    = LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.objidx_settlingTimer;
            attribute = 0;

            if (AdjusterGetFloatValue(subsystem, object, attribute, &value, &type) == (TUSIGN16)OK)
            {
                VIP_ASSERT(type == ST_FLOAT);
                SamplingProgress = (TUSIGN8)(value.data_F + 0.5);
            }
        }
        else if ((calibrationStatus == HMI_CAL_STATUS_SAMPLE_COLLECTION_COMPLETE) || (calibrationStatus == HMI_CAL_STATUS_SAMPLE_COLLECTION_STOPPED))
        {
            SamplingProgress = 100;
        }
        else
        {
            SamplingActive    = eFALSE;
            LOCAL_packetStage = MAN_CAL_FRAME_PACKET_SAMPLING_PROGRESS_5 + 1;
        }

        if (SamplingActive)
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                SamplingProgressRepeats = (TUSIGN8)((SamplingProgress * 49) / 100);
            }
            else
            #endif
            {
                SamplingProgressRepeats = (TUSIGN8)((SamplingProgress * 78) / 100);
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_SAMPLING_PROGRESS_4,   //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_SAMPLING_PROGRESS_4)
    {
        TUSIGN8 customChar = 0xF0;
        packetsBuilt += BuildCustomCharacterString(&customChar,             // const TUSIGN8 *pCustomCharacter
                                                   1,                       // TUSIGN8 nChars
                                                   0,                       // TUSIGN8 x_pos
                                                   4,                       // TUSIGN8 y_pos
                                                   SamplingProgressRepeats, // TUSIGN8 nRepeats
                                                   0);                      // TUSIGN8 lastPacket
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_SAMPLING_PROGRESS_5,   //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_SAMPLING_PROGRESS_5)
    {
        TUSIGN8 customChar = 0x7F;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            customChar     = 0x6F;
        }
        #endif

        packetsBuilt += BuildCustomCharacterString(&customChar,             // const TUSIGN8 *pCustomCharacter
                                                   1,                       // TUSIGN8 nChars
                                                   0,                       // TUSIGN8 x_pos
                                                   5,                       // TUSIGN8 y_pos
                                                   SamplingProgressRepeats, // TUSIGN8 nRepeats
                                                   0);                      // TUSIGN8 lastPacket
    }
//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_RIGHT_KEY              // Right Key -  Continue/Abort/Accept      |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_RIGHT_KEY)
    {
        TUSIGN8 Invert = NO_INVERT;
        ATTRIB_IDENTIFIER_TYPE StatusID;

        switch (calibrationStatus)
        {
        #ifdef HMI_SUPPORTS_OUTPUT_HOLD_AND_RELEASE
        case HMI_CAL_STATUS_SET_OUTPUT_HOLD:
        case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT:
        case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT:
            LOCAL_stringtable_text_id.attribIdx = IDS_YES;
            break;
        #endif

        case HMI_CAL_STATUS_WAITING_FOR_STABILITY:

            StatusID.ssIdx = LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.ssidx;
            StatusID.objIdx = LOCAL_pCurrDisplayFrame->frameDefinition.manualCalFrame.objidx_status;
            StatusID.attribIdx = 0;

            if (WriteProtect_HMICanAccess(StatusID, (TUSIGN8)0))
            {
                if (FrameTableIsSampleCollectionEnabled())
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_START;
                }
                else
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_CONTINUE;
                }
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            }
            break;

        case HMI_CAL_STATUS_WAITING_FOR_NEW_VALUE:
            if (FrameTableGetCursorPosition() == FrameTableGetCursorPositionLimit())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_ABORT;
                Invert = STRING_INVERT;
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_CONTINUE;
            }
            break;

        case HMI_CAL_STATUS_SUCCESS:
            LOCAL_stringtable_text_id.attribIdx = IDS_ACCEPT;
            break;

        case HMI_CAL_STATUS_SAMPLE_COLLECTION_COMPLETE:
            LOCAL_stringtable_text_id.attribIdx = IDS_CONTINUE;
            break;


        case HMI_CAL_STATUS_SAMPLE_COLLECTION_IN_PROGRESS:
            LOCAL_stringtable_text_id.attribIdx = IDS_STOP;
            break;

        case HMI_CAL_STATUS_SAMPLE_COLLECTION_STOPPED:
        default:
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            break;
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,Invert,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,Invert,0,0,9,0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// MAN_CAL_FRAME_PACKET_LEFT_KEY               // Left Key -  Abort/Next/Reject           |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_CAL_FRAME_PACKET_LEFT_KEY)
    {
        switch (calibrationStatus)
        {
        #ifdef HMI_SUPPORTS_OUTPUT_HOLD_AND_RELEASE
        case HMI_CAL_STATUS_SET_OUTPUT_HOLD:
        case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT:
        case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT:
            LOCAL_stringtable_text_id.attribIdx = IDS_NO;
            break;
        #endif

        case HMI_CAL_STATUS_WAITING_FOR_STABILITY:
        case HMI_CAL_STATUS_CALCULATING_1:
        case HMI_CAL_STATUS_SAMPLE_COLLECTION_COMPLETE:
        case HMI_CAL_STATUS_SAMPLE_COLLECTION_IN_PROGRESS:
            LOCAL_stringtable_text_id.attribIdx = IDS_ABORT;
            break;

        case HMI_CAL_STATUS_WAITING_FOR_NEW_VALUE:
            LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            break;

        case HMI_CAL_STATUS_SUCCESS:
            LOCAL_stringtable_text_id.attribIdx = IDS_REJECT;
            break;

        case HMI_CAL_STATUS_SUCCESS_NO_REJECT:
        case HMI_CAL_STATUS_FAILURE:
            LOCAL_stringtable_text_id.attribIdx = IDS_EXIT;
            break;

        case HMI_CAL_STATUS_SAMPLE_COLLECTION_STOPPED:
        default:
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            break;
        }
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,1);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,1);
        }
    }
    return packetsBuilt;
}
// end of #ifdef HMI_SUPPORTS_MANUAL_CALIBRATION
#endif

#ifdef HMI_SUPPORTS_AUTO_CALIBRATION
// No restriction on the optimization of this function
TUSIGN8 BuildAutoCalFrame(void)
{

#ifndef IDS_START_PROCEDURE
const STR_REF IDS_START_PROCEDURE    = IDS_START_CALIBRATION;
#endif
#ifndef IDS_PROCEDURE_FAILED
const STR_REF IDS_PROCEDURE_FAILED   = IDS_CALIBRATION_FAILED;
#endif
#ifndef IDS_PROCEDURE_COMPLETE
const STR_REF IDS_PROCEDURE_COMPLETE = IDS_CALIBRATION_COMPLETE;
#endif

typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_TITLE_BAR,            // Title Bar                               | - Start of Static Area
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_ICON_T,               // Icon (Top)                              |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_ICON_B,               // Icon (Bottom                            |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_BLANK_AREA,           // Blank Area (lines 2-6)                  | - Start of status changed area
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_START_PROMPT,         // "Start Calibration?"                    |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_PROMPT,               // Prompt eg "Immerse in buffer 1"         |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_STD_TYPE,             // Standard (Buffer/Test Gas) Type         | - Start of Active Area (Status = HMI_CAL_STATUS_WAITING_FOR_STANDARD_1 or HMI_CAL_STATUS_WAITING_FOR_STANDARD_2)
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_STD_VAL,              // Standard Value eg. "7.00"               |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_STD_UOM,              // Eng units of Standard Value eg. "pH"    |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_STD_VAL_UOM,          // Standard Value & Eng Units eg. "7.00 pH"|
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_SETTLING,             // "Settling - Please Wait"                |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_BAR_RHS_BORDER_T,     // Bargraph Right Hand Border (Top)        |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_BAR_RHS_BORDER_B,     // Bargraph Right Hand Border (Bottom)     |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_BAR_FILL_TOP,         // Filled Area of Bargraph (Top)           | - Start of Active Area (Status = HMI_CAL_STATUS_CALCULATING_1 or HMI_CAL_STATUS_CALCULATING_2)
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_BAR_FILL_BOTTOM,      // Filled Area of Bargraph (Bottom)        |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_BAR_EMPTY_TOP,        // Blank Area of Bargraph (Top)            |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_BAR_EMPTY_BOTTOM,     // Blank Area of Bargraph (Bottom)         |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_CAL_FAIL,             // "Calibration Failed"                    | - Start of Active Area (Status = HMI_CAL_STATUS_FAILURE)
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_FAIL_REASON,          // Reason for calibration failure          |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_RESULT_1,             // 1st Result                              | - Start of Active Area (Status = HMI_CAL_STATUS_SUCCESS or HMI_CAL_STATUS_SUCCESS_NO_REJECT)
                                                //-----------------------------------------|
#ifdef HMI_SUPPORTS_ASIAN
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_RESULT_1_ID,          // Identifier for 1st Result               |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_RESULT_2,             // 2nd Result 2                            |
                                                //-----------------------------------------|
#ifdef HMI_SUPPORTS_ASIAN
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_RESULT_2_ID,          // Identifier for 2nd Result 2             |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_CAL_PASS,             // "Calibration Complete"                  |
                                                //-----------------------------------------|
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_PV_1,                 // 1st Process Value                       |
                                                //-----------------------------------------|
#ifdef HMI_SUPPORTS_ASIAN
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_PV_1_ID,              // Identifier for 1st Process Value        |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_PV_2_ID,              // Identifier for 2nd Process Value        |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_PV_2,                 // 2nd Process Value                       |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_OUTPUT_HOLD_PROMPT,          //                                         |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_RIGHT_KEY,            // Right Key -  Continue/Abort/Accept      |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_LEFT_KEY,             // Left Key -  Abort/Next/Reject           |
                                                //-----------------------------------------|
    AUTO_CAL_FRAME_PACKET_READ_SWITCHES         //                                         |
                                                //-----------------------------------------| - There is no keypress area
}AUTO_CAL_FRAME_PACKET;

    #ifdef AZ200_SPECIAL_FEATURES_HMI
    T_O2_CALIBRATION const SLOW *pCal = (const T_O2_CALIBRATION*)GetSubsystemPtr((T_SUBSYSTEM_IDX)CAL_IDX);
    #endif

    TUSIGN8 packetsBuilt = 0;

    TUSIGN8 autocal_barStart;
    TUSIGN8 autocal_barRepeats;
    TUSIGN8 autocal_barEnd;

    TUSIGN8 ProcessSignal_1,ProcessSignal_2;

    ADJUST_DATA value;
    TUSIGN8     type;

    TUSIGN8     calibrationStatus = 0;
    #ifdef AZ200_SPECIAL_FEATURES_HMI
    TUSIGN8     calibrationType;
    #endif
    TUSIGN8     ActiveAreaStartPacket = AUTO_CAL_FRAME_PACKET_READ_SWITCHES;
    TUSIGN8     KeypressAreaStartPacket = AUTO_CAL_FRAME_PACKET_READ_SWITCHES;

    FRAME_FORMAT_TYPE const *pSecondaryFrame = (FRAME_FORMAT_TYPE const *)LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.pSecondaryInfo;

    TUSIGN16 subsystem = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ssidx;
    TUSIGN16 object    = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.objidx_status;
    TUSIGN8 attribute  = 0;

    TUSIGN8 Str_Std_UOM[9] = {0,0,0,0,0,0,0,0,0};
    TUSIGN8 Str_Std_Val[9] = {0,0,0,0,0,0,0,0,0};

    if (AdjusterGetFloatValue(subsystem, object, attribute, &value, &type) == (TUSIGN16)OK)
    {
        VIP_ASSERT(type == ST_U8);
        calibrationStatus = (TUSIGN8)value.data_F;
    }

    #ifdef AZ200_SPECIAL_FEATURES_HMI
    if (pCal->IsScheduledCalibrationActiveSRV(&calibrationType))
    {
        if (calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_1)
        {
            calibrationStatus = HMI_CAL_STATUS_CALCULATING_1;
        }
        else
        {
            if (calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_2)
            {
                calibrationStatus = HMI_CAL_STATUS_CALCULATING_2;
            }
        }
    }
    #endif

    switch (calibrationStatus)
    {
    case HMI_CAL_STATUS_CALCULATING_1:
        ActiveAreaStartPacket = AUTO_CAL_FRAME_PACKET_BAR_FILL_TOP;
        KeypressAreaStartPacket = AUTO_CAL_FRAME_PACKET_READ_SWITCHES;
        break;

    case HMI_CAL_STATUS_CALCULATING_2:
        ActiveAreaStartPacket = AUTO_CAL_FRAME_PACKET_BAR_FILL_TOP;
        KeypressAreaStartPacket = AUTO_CAL_FRAME_PACKET_READ_SWITCHES;
        break;

    case HMI_CAL_STATUS_FAILURE:
        ActiveAreaStartPacket = AUTO_CAL_FRAME_PACKET_CAL_FAIL;
        KeypressAreaStartPacket = AUTO_CAL_FRAME_PACKET_READ_SWITCHES;
        break;

    case HMI_CAL_STATUS_SUCCESS_NO_REJECT:
    case HMI_CAL_STATUS_SUCCESS:
        ActiveAreaStartPacket = AUTO_CAL_FRAME_PACKET_RESULT_1;
        KeypressAreaStartPacket = AUTO_CAL_FRAME_PACKET_READ_SWITCHES;
        break;

    case HMI_CAL_STATUS_WAITING_FOR_STANDARD_1:
        ActiveAreaStartPacket = AUTO_CAL_FRAME_PACKET_STD_TYPE;
        KeypressAreaStartPacket = AUTO_CAL_FRAME_PACKET_READ_SWITCHES;
        break;

    case HMI_CAL_STATUS_WAITING_FOR_STANDARD_2:
        ActiveAreaStartPacket = AUTO_CAL_FRAME_PACKET_STD_TYPE;
        KeypressAreaStartPacket = AUTO_CAL_FRAME_PACKET_READ_SWITCHES;
        break;

#ifdef HMI_SUPPORTS_OUTPUT_HOLD_AND_RELEASE
    case HMI_CAL_STATUS_SET_OUTPUT_HOLD:
    case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT:
    case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT:
        ActiveAreaStartPacket = AUTO_CAL_FRAME_OUTPUT_HOLD_PROMPT;
        KeypressAreaStartPacket = AUTO_CAL_FRAME_OUTPUT_HOLD_PROMPT;
        break;
#endif

    default:
        ActiveAreaStartPacket = AUTO_CAL_FRAME_PACKET_READ_SWITCHES;
        KeypressAreaStartPacket = AUTO_CAL_FRAME_PACKET_READ_SWITCHES;
        break;
    }


    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = AUTO_CAL_FRAME_PACKET_TITLE_BAR;
        LOCAL_prvCalibrationStatus = calibrationStatus;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > ActiveAreaStartPacket))
    {
        LOCAL_packetStage = ActiveAreaStartPacket;
    }
    else if ((LOCAL_keypressProcessed) && (LOCAL_packetStage > KeypressAreaStartPacket))
    {
        LOCAL_packetStage = KeypressAreaStartPacket;
    }
    else
    {
        asm("nop");
    }

    if ((calibrationStatus != LOCAL_prvCalibrationStatus) && (LOCAL_packetStage > AUTO_CAL_FRAME_PACKET_BLANK_AREA))
    {
        LOCAL_packetStage = AUTO_CAL_FRAME_PACKET_BLANK_AREA;
    }

    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = AUTO_CAL_FRAME_PACKET_READ_SWITCHES;
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_TITLE_BAR             // Title Bar                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.titleBar_attribidx;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),8,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_ICON_T                // Icon (Top)                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_ICON_T)
    {
        packetsBuilt += BuildWriteIcon(ICON_ADJUST_EDIT1, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_ICON_B                // Icon (Bottom                            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_ICON_B)
    {
        packetsBuilt += BuildWriteIcon(ICON_ADJUST_EDIT2, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 1, 0);
    }


//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_BLANK_AREA            // Blank Area (lines 2-6)                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_BLANK_AREA)
    {
        if (calibrationStatus != LOCAL_prvCalibrationStatus)
        {
            packetsBuilt += BuildBlankArea(2,6,0);

            if (LOCAL_packetStage != AUTO_CAL_FRAME_PACKET_BLANK_AREA)
            {
                LOCAL_prvCalibrationStatus = calibrationStatus;
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_START_PROMPT          // "Start Calibration?"                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_START_PROMPT)
    {
        if ((FrameTableIsNavigationFromAutoCalAllowed())
         && (calibrationStatus == HMI_CAL_STATUS_INACTIVE))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_START_CALIBRATION;
            if (FrameTableIsAutoCalRenamed())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_START_PROCEDURE;
            }

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),3,JUSTIFY_CENTRE,NO_INVERT,0,ASIAN_MAX_CHARS,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,3,JUSTIFY_CENTRE,FONT_1,NO_INVERT,0,0,FONT1_MAX_CHARS,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_PROMPT                // Prompt eg "Immerse in buffer 1"         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_PROMPT)
    {
        TBOOL skipStage = eFALSE;
        if (calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_1)
        {
            LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.Prompt_1;
        }
        else if (calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_2)
        {
            LOCAL_stringtable_text_id.attribIdx = pSecondaryFrame->frameDefinition.autoCalFrame_2.Prompt_2;
        }
        else
        {
            skipStage = eTRUE;
        }

        if (skipStage)
        {
            LOCAL_packetStage ++;
        }
        else
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,ASIAN_MAX_CHARS,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS,0);
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_STD_TYPE              // Standard (Buffer/Test Gas) Type         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_STD_TYPE)
    {
        TBOOL skipStage = eFALSE;

        if (calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_1)
        {
            TUSIGN8 StandardType;
            subsystem = pSecondaryFrame->frameDefinition.autoCalFrame_2.ssidx;
            object    = pSecondaryFrame->frameDefinition.autoCalFrame_2.objidx_Std_1;
            attribute = pSecondaryFrame->frameDefinition.autoCalFrame_2.attribidx_Std_1;

            //if (AdjusterGetValue(subsystem, object, attribute, &value, &type) == (TUSIGN16)OK)
            if (AdjusterGetAttribute(subsystem, object, attribute, (void FAST *)&StandardType) == (TUSIGN16)OK)

            {
                TUSIGN16 tableOffset = ((TUSIGN16)pSecondaryFrame->frameDefinition.autoCalFrame_2.firstItem_MSB_Status1 << 8)
                                     + pSecondaryFrame->frameDefinition.autoCalFrame_2.firstItem_LSB_Status1
                                     + StandardType;

                LOCAL_stringtable_text_id.attribIdx = FrameTableGetEnumItem(tableOffset);
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            }
        }
        else if (calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_2)
        {
            TUSIGN8 StandardType;
            subsystem = pSecondaryFrame->frameDefinition.autoCalFrame_2.ssidx;
            object    = pSecondaryFrame->frameDefinition.autoCalFrame_2.objidx_Std_2;
            attribute = pSecondaryFrame->frameDefinition.autoCalFrame_2.attribidx_Std_2;

            //if (AdjusterGetValue(subsystem, object, attribute, &value, &type) == (TUSIGN16)OK)
            if (AdjusterGetAttribute(subsystem, object, attribute, (void FAST *)&StandardType) == (TUSIGN16)OK)
            {
                TUSIGN16 tableOffset = ((TUSIGN16)pSecondaryFrame->frameDefinition.autoCalFrame_2.firstItem_MSB_Status2 << 8)
                                     + pSecondaryFrame->frameDefinition.autoCalFrame_2.firstItem_LSB_Status2
                                     + StandardType;

                LOCAL_stringtable_text_id.attribIdx = FrameTableGetEnumItem(tableOffset);
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            }
        }
        else
        {
            skipStage = eTRUE;
        }

        if (skipStage)
        {
            LOCAL_packetStage = AUTO_CAL_FRAME_PACKET_STD_VAL_UOM + 1;
        }
        else
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
    		    packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_RIGHT_WITH_INDENT_49_PIXEL,NO_INVERT,0,6,6,0);
            }
            else
            #endif
            {
    		    packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_CENTRE,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS,0);
            }

        }
    }
//  Prepare data for display of standard value display
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_STD_VAL               // Standard Value eg. "7.00"               |
// AUTO_CAL_FRAME_PACKET_STD_UOM               // Eng units of Standard Value eg. "pH"    |
// AUTO_CAL_FRAME_PACKET_STD_VAL_UOM           // Standard Value & Eng Units eg. "7.00 pH"|
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= AUTO_CAL_FRAME_PACKET_STD_VAL) && (LOCAL_packetStage <= AUTO_CAL_FRAME_PACKET_STD_VAL_UOM))
    {
        if ((calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_1) || (calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_2))
        {
            const SIGNAL_TABLE_TYPE *pSignal = FrameTableGetSignal(LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ProcessSignal_1);

            subsystem = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ssidx;
            object    = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.objidx_targetValue;
            attribute = 0;

            // Get Standard value
            if (AdjusterGetFloatValue(subsystem, object, attribute, &value, &type) == (TUSIGN16)OK)
            {
                TUSIGN8 *pNumber;
                TUSIGN8 negNumber;
                TUSIGN8 within_over_under;

                #ifdef HMI_USES_DOUBLE
                if (type == ST_DOUBLE)
                {
                    pNumber = AdjusterBuildNumberStringFromDouble(value.data_D, 6, pSignal->dpPosn, &negNumber, &within_over_under);
                }
                else
                #endif
                {
                    pNumber = AdjusterBuildNumberString(value.data_F, 6, pSignal->dpPosn, &negNumber, &within_over_under);
                }

                if ((within_over_under == 1) || (within_over_under == 2))
                {
                    // overrange or underrange
                    TUSIGN8 i;
                    Str_Std_Val[0] = 0x20;
                    LOCAL_overrangeValue_EditNotAllowed = eTRUE;

                    for (i = 1; i <= 6; )
                    {
                        Str_Std_Val[i] = 0x05 + within_over_under;
                        i++;
                        Str_Std_Val[i] = 0x00;
                    }
                }
                else
                {
                    while (*pNumber == 0x20)
                    {
                        #pragma diag_suppress=Pm088
                        pNumber ++;
                        #pragma diag_default=Pm088
                    }

                    if (negNumber)
                    {
                        Str_Std_Val[0] = '-';
                        Str_Std_Val[1] = 0x00;
                    }

                    (void)strcat((char *)Str_Std_Val,(char *)pNumber);
                }
            }
            else
            {
                Str_Std_Val[0] = '?';
                Str_Std_Val[1] = 0x00;
            }

            // Get engineering units for Standard value
            strcpy((char *)Str_Std_UOM,(const char *)PacketManagerGetEngUnits((TUSIGN16)pSignal->engUnits.ssIdx,
                                                                               pSignal->engUnits.objIdx,
                                                                               pSignal->engUnits.attribIdx,
                                                                               pSignal->engUnitsType));

            #ifdef HMI_SUPPORTS_CUSTOM_UNITS
            PacketManagerRemoveCustomfromUnits(Str_Std_UOM);
            #endif
            LimitTextLength(Str_Std_UOM,8);
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_STD_VAL               // Standard Value eg. "7.00"               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_STD_VAL)
    {
        #ifdef HMI_SUPPORTS_ASIAN
        if ((LOCAL_Asian)
         && ((calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_1) || (calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_2)))
        {
            packetsBuilt += BuildWriteString(Str_Std_Val,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_LEFT_WITH_INDENT_78_PIXEL,FONT_0,NO_INVERT,0,0,8,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_STD_UOM               // Eng units of Standard Value eg. "pH"    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_STD_UOM)
    {
        #ifdef HMI_SUPPORTS_ASIAN
        if ((LOCAL_Asian)
         && ((calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_1) || (calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_2)))
        {
            packetsBuilt += BuildWriteString(Str_Std_UOM,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_LEFT_WITH_INDENT_78_PIXEL,FONT_0,NO_INVERT,0,0,8,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_STD_VAL_UOM           // Standard Value & Eng Units eg. "7.00 pH"|
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_STD_VAL_UOM)
    {
        #ifdef HMI_SUPPORTS_ASIAN
        if (((calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_1) || (calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_2)) && (!LOCAL_Asian))
        #else
        if ((calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_1) || (calibrationStatus == HMI_CAL_STATUS_WAITING_FOR_STANDARD_2))
        #endif
        {
            TUSIGN8 value_and_units[20] = "";
            strcpy((char*)value_and_units, (const char*)Str_Std_Val);
            strcat((char*)value_and_units, " ");
            strcat((char*)value_and_units, (const char*)Str_Std_UOM);

    		packetsBuilt += BuildWriteString(value_and_units,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_CENTRE,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_SETTLING              // "Settling - Please Wait"                |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_SETTLING)
    {
        if ((calibrationStatus == HMI_CAL_STATUS_CALCULATING_1) || (calibrationStatus == HMI_CAL_STATUS_CALCULATING_2))
        {
            if (FrameTableIsSettlingRemoved())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_PLEASE_WAIT;
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_SETTLING;
            }

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                LOCAL_packetStage ++;
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_CENTRE,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS,0);
            }
        }
        else
        {
            LOCAL_packetStage = AUTO_CAL_FRAME_PACKET_BAR_EMPTY_BOTTOM + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_BAR_RHS_BORDER_T      // Bargraph Right Hand Border (Top)        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_BAR_RHS_BORDER_T)
    {
        if ((calibrationStatus == HMI_CAL_STATUS_CALCULATING_1) || (calibrationStatus == HMI_CAL_STATUS_CALCULATING_2))
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                LOCAL_packetStage ++;
            }
            else
            #endif
            {
                TUSIGN8 customChar = 0xF0;
                packetsBuilt += BuildCustomCharacterString(&customChar, 1, 78, 4, 0, 0);
            }
        }
        else
        {
            LOCAL_packetStage = AUTO_CAL_FRAME_PACKET_BAR_EMPTY_BOTTOM + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_BAR_RHS_BORDER_B      // Bargraph Right Hand Border (Bottom)     |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_BAR_RHS_BORDER_B)
    {
        if ((calibrationStatus == HMI_CAL_STATUS_CALCULATING_1) || (calibrationStatus == HMI_CAL_STATUS_CALCULATING_2))
        {
            TUSIGN8 customChar = 0x7F;
            TUSIGN8 xpos = 78;
            TUSIGN8 ypos = 5;

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                customChar = 0xFF;
                xpos = 88;
                if (LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ProcessSignal_2 != 0xFF)
                {
                    ypos = 6;
                }
            }
            #endif
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, xpos, ypos, 0, 0);
        }
        else
        {
            LOCAL_packetStage = AUTO_CAL_FRAME_PACKET_BAR_EMPTY_BOTTOM + 1;
        }
    }
//  Prepare data for Filled Area of Bargraph
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_BAR_FILL_TOP          // Filled Area of Bargraph (Top)           |
// AUTO_CAL_FRAME_PACKET_BAR_FILL_BOTTOM       // Filled Area of Bargraph (Bottom)        |
// AUTO_CAL_FRAME_PACKET_BAR_EMPTY_TOP         // Blank Area of Bargraph (Top)            |
// AUTO_CAL_FRAME_PACKET_BAR_EMPTY_BOTTOM      // Blank Area of Bargraph (Bottom)         |
//---------------------------------------------//-----------------------------------------|
    if (((LOCAL_packetStage >= AUTO_CAL_FRAME_PACKET_BAR_FILL_TOP) && (LOCAL_packetStage <= AUTO_CAL_FRAME_PACKET_BAR_EMPTY_BOTTOM)) &&
        ((calibrationStatus == HMI_CAL_STATUS_CALCULATING_1) || (calibrationStatus == HMI_CAL_STATUS_CALCULATING_2)))
    {
        subsystem = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ssidx;
        object    = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.objidx_settlingTimer;
        attribute = 0;

        autocal_barStart = 0;
        autocal_barEnd   = 78;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            autocal_barStart = 39;
            autocal_barEnd   = 88;
        }
        #endif

        autocal_barRepeats = 0;

        if (AdjusterGetFloatValue(subsystem, object, attribute, &value, &type) == (TUSIGN16)OK)
        {
            TUSIGN16 barPercent;
            #ifdef HMI_USES_DOUBLE
            if (type == ST_DOUBLE)
            {
                barPercent = (TUSIGN16)(value.data_D + 0.5)
            }
            else
            #endif
            {
                barPercent = (TUSIGN16)(value.data_F + 0.5F);
            }

            autocal_barRepeats = ((TUSIGN16)((autocal_barEnd - 1) - autocal_barStart) * barPercent) / 100;
        }

        if (autocal_barRepeats > ((autocal_barEnd - 1) - autocal_barStart))
        {
            autocal_barRepeats = ((autocal_barEnd - 1) - autocal_barStart);
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_BAR_FILL_TOP          // Filled Area of Bargraph (Top)           |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_BAR_FILL_TOP)
    {
        if ((calibrationStatus == HMI_CAL_STATUS_CALCULATING_1) || (calibrationStatus == HMI_CAL_STATUS_CALCULATING_2))
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                LOCAL_packetStage ++;
            }
            else
            #endif
            {
                TUSIGN8 customChar = 0xF0;
                packetsBuilt += BuildCustomCharacterString(&customChar,
                                                           1,
                                                           autocal_barStart,
                                                           4,
                                                           autocal_barRepeats,
                                                           0);
            }
        }
        else
        {
            LOCAL_packetStage = AUTO_CAL_FRAME_PACKET_BAR_EMPTY_BOTTOM + 1;
        }
    }

//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_BAR_FILL_BOTTOM       // Filled Area of Bargraph (Bottom)        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_BAR_FILL_BOTTOM)
    {
        if ((calibrationStatus == HMI_CAL_STATUS_CALCULATING_1) || (calibrationStatus == HMI_CAL_STATUS_CALCULATING_2))
        {
            TUSIGN8 customChar = 0x7F;
            TUSIGN8 ypos = 5;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                customChar = 0xFF;
                if (LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ProcessSignal_2 != 0xFF)
                {
                    ypos = 6;
                }
            }
            #endif
            packetsBuilt += BuildCustomCharacterString(&customChar,
                                                       1,
                                                       autocal_barStart,
                                                       ypos,
                                                       autocal_barRepeats,
                                                       0);
        }
        else
        {
            LOCAL_packetStage = AUTO_CAL_FRAME_PACKET_BAR_EMPTY_BOTTOM + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_BAR_EMPTY_TOP         // Bargraph Top Border                     |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_BAR_EMPTY_TOP)
    {
        if ((calibrationStatus == HMI_CAL_STATUS_CALCULATING_1) || (calibrationStatus == HMI_CAL_STATUS_CALCULATING_2))
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                LOCAL_packetStage ++;
            }
            else
            #endif
            {
                TUSIGN8 customChar = 0x10;
                // calculate position where pattern should start
                TUSIGN8 xpos = (TUSIGN8)(autocal_barStart + autocal_barRepeats + 1);

                if (xpos >= autocal_barEnd)
                {
                    // position where pattern should start is beyond end marker
                    LOCAL_packetStage ++;
                }
                else
                {
                    packetsBuilt += BuildCustomCharacterString(&customChar,
                                                               1,
                                                               xpos,
                                                               4,
                                                               (TUSIGN8)(autocal_barEnd - (autocal_barStart + autocal_barRepeats + 2)),
                                                               0);
                }
            }
        }
        else
        {
            LOCAL_packetStage = AUTO_CAL_FRAME_PACKET_BAR_EMPTY_BOTTOM + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_BAR_EMPTY_BOTTOM      // Bargraph Bottom Border                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_BAR_EMPTY_BOTTOM)
    {
        if ((calibrationStatus == HMI_CAL_STATUS_CALCULATING_1) || (calibrationStatus == HMI_CAL_STATUS_CALCULATING_2))
        {
            TUSIGN8 customChar = 0x40;
            TUSIGN8 ypos = 5;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                customChar = 0x81;
                if (LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ProcessSignal_2 != 0xFF)
                {
                    ypos = 6;
                }
            }
            #endif

            // calculate position where pattern should start
            TUSIGN8 xpos = (TUSIGN8)(autocal_barStart + autocal_barRepeats + 1);

            if (xpos >= autocal_barEnd)
            {
                // position where pattern should start is beyond end marker
                LOCAL_packetStage ++;
            }
            else
            {

                packetsBuilt += BuildCustomCharacterString(&customChar,
                                                           1,
                                                           xpos,
                                                           ypos,
                                                           (TUSIGN8)(autocal_barEnd - (autocal_barStart + autocal_barRepeats + 2)),
                                                           0);
            }
        }
        else
        {
            LOCAL_packetStage = AUTO_CAL_FRAME_PACKET_BAR_EMPTY_BOTTOM + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_CAL_FAIL              // "Calibration Failed"                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_CAL_FAIL)
    {
        if (calibrationStatus == HMI_CAL_STATUS_FAILURE)
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {

                LOCAL_packetStage++;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_CALIBRATION_FAILED;
                if (FrameTableIsAutoCalRenamed())
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_PROCEDURE_FAILED;
                }
                #if defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION)
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_CENTRE,FONT_0,STRING_INVERT,0,0,FONT1_MAX_CHARS,0);
                #else
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_CENTRE,FONT_1,STRING_INVERT,0,0,FONT2_MAX_CHARS,0);
                #endif
            }
        }
        else
        {
            LOCAL_packetStage  = AUTO_CAL_FRAME_PACKET_FAIL_REASON + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_FAIL_REASON           // Reason for calibration failure          |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_FAIL_REASON)
    {
        if (calibrationStatus == HMI_CAL_STATUS_FAILURE)
        {
            TUSIGN8 ErrorReason = HMI_CAL_RESULT_NO_FAILURE;
            subsystem = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ssidx;
            object    = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.objidx_errorResult;
            attribute = 0;

            if (AdjusterGetFloatValue(subsystem, object, attribute, &value, &type) == (TUSIGN16)OK)
            {
                VIP_ASSERT(type == ST_U8);
                ErrorReason = (TUSIGN8)value.data_F;
            }

            switch (ErrorReason)
            {
            case HMI_CAL_RESULT_FAIL_RESULT_OUT_OF_BOUNDS:      LOCAL_stringtable_text_id.attribIdx = IDS_RESULT_OUT_OF_BOUNDS; break;

            case HMI_CAL_RESULT_FAIL_UNSTABLE_INPUT:            LOCAL_stringtable_text_id.attribIdx = IDS_UNSTABLE_INPUT;       break;
            case HMI_CAL_RESULT_FAIL_TEST_GAS_NOT_PRESENT:      LOCAL_stringtable_text_id.attribIdx = IDS_TEST_GAS_NOT_PRESENT; break;
            case HMI_CAL_RESULT_FAIL_NO_RESPONSE:               LOCAL_stringtable_text_id.attribIdx = IDS_NO_RESPONSE;          break;
#ifdef AZ200_SPECIAL_FEATURES_HMI
            case HMI_CAL_RESULT_FAIL_UNSTABLE_INPUT + 50:       LOCAL_stringtable_text_id.attribIdx = IDS_UNSTABLE_INPUT;       break;
            case HMI_CAL_RESULT_FAIL_TEST_GAS_NOT_PRESENT + 50: LOCAL_stringtable_text_id.attribIdx = IDS_TEST_GAS_NOT_PRESENT; break;
            case HMI_CAL_RESULT_FAIL_NO_RESPONSE + 50:          LOCAL_stringtable_text_id.attribIdx = IDS_NO_RESPONSE;          break;
#endif
            case HMI_CAL_RESULT_FAIL_NV_ERROR:                  LOCAL_stringtable_text_id.attribIdx = IDS_NV_ERROR;             break;
            case HMI_CAL_RESULT_FAIL_OFFSET_HIGH:               LOCAL_stringtable_text_id.attribIdx = IDS_OFFSET_HIGH;          break;
            case HMI_CAL_RESULT_FAIL_OFFSET_LOW:                LOCAL_stringtable_text_id.attribIdx = IDS_OFFSET_LOW;           break;
            case HMI_CAL_RESULT_FAIL_SLOPE_HIGH:                LOCAL_stringtable_text_id.attribIdx = IDS_SLOPE_HIGH;           break;
            case HMI_CAL_RESULT_FAIL_SLOPE_LOW:                 LOCAL_stringtable_text_id.attribIdx = IDS_SLOPE_LOW;            break;
            default:                                            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;                break;
            }

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                #ifdef AZ200_SPECIAL_FEATURES_HMI
                if ((ErrorReason == HMI_CAL_RESULT_FAIL_UNSTABLE_INPUT)
                 || (ErrorReason == HMI_CAL_RESULT_FAIL_UNSTABLE_INPUT + 50)
                 || (ErrorReason == HMI_CAL_RESULT_FAIL_TEST_GAS_NOT_PRESENT)
                 || (ErrorReason == HMI_CAL_RESULT_FAIL_TEST_GAS_NOT_PRESENT + 50)
                 || (ErrorReason == HMI_CAL_RESULT_FAIL_NO_RESPONSE)
                 || (ErrorReason == HMI_CAL_RESULT_FAIL_NO_RESPONSE + 50))
                {
                    packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_LEFT_WITH_INDENT_30_PIXEL,STRING_INVERT,0,8,8,0);
                }
                else
                #endif
                {
                    packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_CENTRE,STRING_INVERT,0,ASIAN_MAX_CHARS,ASIAN_MAX_CHARS,0);
                }
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_CENTRE,FONT_0,STRING_INVERT,0,0,FONT1_MAX_CHARS,0);
            }
        }
        else
        {
            LOCAL_packetStage  = AUTO_CAL_FRAME_PACKET_FAIL_REASON + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_RESULT_1              // 1st Result                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_RESULT_1)
    {
        TUSIGN8 ResultSignal = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ResultSignal_1;

        if (((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (ResultSignal != 0xFF))
        {
            TUSIGN8 ResultText[22];
            PacketManagerBuilderServices_buildSignalText(ResultText,ResultSignal,eFALSE);

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ResultSignal_2 == 0xFF) || (LOCAL_flashState))
                {
                    packetsBuilt += BuildWriteString(&ResultText[11], HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 4, JUSTIFY_LEFT_WITH_INDENT_11, FONT_1, NO_INVERT, 0, 0, FONT1_MAX_CHARS - 11, 0);
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(ResultText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 4, JUSTIFY_LEFT, FONT_0, NO_INVERT, 0, 0, FONT1_MAX_CHARS, 0);
            }
        }
        else
        {
            LOCAL_packetStage = AUTO_CAL_FRAME_PACKET_RESULT_2 + 1;
        }
    }
#ifdef HMI_SUPPORTS_ASIAN
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_RESULT_1_ID,          // Identifier for 1st Result               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_RESULT_1_ID)
    {
        if ((LOCAL_Asian)
         && ((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ResultSignal_1 != 0xFF)
         && ((LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ResultSignal_2 == 0xFF) || (LOCAL_flashState)))
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ResultSignal_1)->long_identifier;
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_LEFT,NO_INVERT,0,5,5,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_RESULT_2              // 2nd Result 2                            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_RESULT_2)
    {
        TUSIGN8 ResultSignal = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ResultSignal_2;

        if (((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (ResultSignal != 0xFF))
        {
            TUSIGN8 ResultText[22];
            PacketManagerBuilderServices_buildSignalText(ResultText,ResultSignal,eFALSE);
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                if ((LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ResultSignal_1 == 0xFF) || (!LOCAL_flashState))
                {
                    packetsBuilt += BuildWriteString(&ResultText[11], HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 4, JUSTIFY_LEFT_WITH_INDENT_11, FONT_1, NO_INVERT, 0, 0, FONT1_MAX_CHARS - 11, 0);
                }
                else
                {
                    LOCAL_packetStage ++;
                }
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(ResultText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 5, JUSTIFY_LEFT, FONT_0, NO_INVERT, 0, 0, FONT1_MAX_CHARS, 0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#ifdef HMI_SUPPORTS_ASIAN
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_RESULT_2_ID,          // Identifier for 2nd Result               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_RESULT_2_ID)
    {
        if ((LOCAL_Asian)
         && ((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ResultSignal_2 != 0xFF)
         && ((LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ResultSignal_1 == 0xFF) || (!LOCAL_flashState)))
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ResultSignal_2)->long_identifier;
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_LEFT,NO_INVERT,0,5,5,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_CAL_PASS              // "Calibration Complete"                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_CAL_PASS)
    {
        if (((calibrationStatus == HMI_CAL_STATUS_SUCCESS) || (calibrationStatus == HMI_CAL_STATUS_SUCCESS_NO_REJECT))
         && (LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ResultSignal_1 == 0xFF)
         && (LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ResultSignal_2 == 0xFF))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_CALIBRATION_COMPLETE;
            if (FrameTableIsAutoCalRenamed())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_PROCEDURE_COMPLETE;
            }
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_CENTRE,NO_INVERT,0,ASIAN_MAX_CHARS,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_CENTRE,FONT_1,NO_INVERT,0,0,FONT2_MAX_CHARS,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_PV_1                  // 1st Process Value                       |
// AUTO_CAL_FRAME_PACKET_PV_1_ID,              // Identifier for 1st Process Value        |
// AUTO_CAL_FRAME_PACKET_PV_2_ID,              // Identifier for 2nd Process Value        |
// AUTO_CAL_FRAME_PACKET_PV_2                  // 2nd Process Value                       |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= AUTO_CAL_FRAME_PACKET_PV_1) && (LOCAL_packetStage <= AUTO_CAL_FRAME_PACKET_PV_2))
    {
        ProcessSignal_1 = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ProcessSignal_1;
        ProcessSignal_2 = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ProcessSignal_2;

        switch (calibrationStatus)
        {
        case HMI_CAL_STATUS_CALCULATING_1:
            break;

        case HMI_CAL_STATUS_CALCULATING_2:
            #if defined(AZ200_SPECIAL_FEATURES_HMI) || defined(NAVIGATOR_SPECIAL_FEATURES_HMI)
            if (ProcessSignal_2 != 0xFF)
            {
                ProcessSignal_2 ++;
            }
            #endif
            break;

        case HMI_CAL_STATUS_FAILURE:
            #ifdef AZ200_SPECIAL_FEATURES_HMI

            if (ProcessSignal_2 != 0xFF)
            {
                TUSIGN8 ErrorReason = HMI_CAL_RESULT_NO_FAILURE;
                subsystem = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ssidx;
                object    = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.objidx_errorResult;
                attribute = 0;

                if (AdjusterGetFloatValue(subsystem, object, attribute, &value, &type) == (TUSIGN16)OK)
                {
                    ErrorReason = type == ST_U8 ? (TUSIGN8)value.data_F : HMI_CAL_RESULT_NO_FAILURE;
                }
                else
                {
                    ErrorReason = HMI_CAL_RESULT_NO_FAILURE;
                }

                switch (ErrorReason)
                {
                case HMI_CAL_RESULT_FAIL_UNSTABLE_INPUT:
                case HMI_CAL_RESULT_FAIL_TEST_GAS_NOT_PRESENT:
                case HMI_CAL_RESULT_FAIL_NO_RESPONSE:
                    asm("nop");             // Error related to test gas 1 - do not change ProcessSignal_2
                    break;

                case HMI_CAL_RESULT_FAIL_UNSTABLE_INPUT + 50:
                case HMI_CAL_RESULT_FAIL_TEST_GAS_NOT_PRESENT + 50:
                case HMI_CAL_RESULT_FAIL_NO_RESPONSE + 50:
                    ProcessSignal_2 ++;     // Error related to test gas 2 - change ProcessSignal_2 to next Test gas
                    break;

                default:
                    ProcessSignal_2 = 0xFF; // Error not related to either test gas 2 - clear ProcessSignal_2
                    break;
                }
            }
            #endif

            break;

        case HMI_CAL_STATUS_SUCCESS:
        case HMI_CAL_STATUS_SUCCESS_NO_REJECT:
            #ifdef AZ200_SPECIAL_FEATURES_HMI
            ProcessSignal_2 = 0xFF;
            #endif

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                ProcessSignal_2 = 0xFF;
            }
            #endif

            break;

        default:
            ProcessSignal_1 = 0xFF;
            ProcessSignal_2 = 0xFF;
            break;
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_PV_1                  // 1st Process Value                       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_PV_1)
    {
        if (ProcessSignal_1 != 0xFF)
        {
            TUSIGN8 PVText[22];
            PacketManagerBuilderServices_buildSignalText(PVText,ProcessSignal_1,eTRUE);

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString(&PVText[4], HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 2, JUSTIFY_LEFT_WITH_INDENT_25_PIXEL, FONT_1, NO_INVERT, 0, 0, FONT1_MAX_CHARS - 4, 0);
            }
            else
            #endif
            {
                TUSIGN8 font = FONT_0;
                if (ProcessSignal_2 == 0xFF)
                {
                    font = FONT_1;
                }
                packetsBuilt += BuildWriteString(PVText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 2, JUSTIFY_LEFT, font, NO_INVERT, 0, 0, FONT1_MAX_CHARS, 0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

#ifdef HMI_SUPPORTS_ASIAN
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_PV_1_ID,              // Identifier for 1st Process Value        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_PV_1_ID)
    {
        if ((ProcessSignal_1 != 0xFF) && (LOCAL_Asian))
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(ProcessSignal_1)->short_identifier;
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,2,2,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_PV_2_ID,              // Identifier for 2nd Process Value        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_PV_2_ID)
    {
        if ((ProcessSignal_2 != 0xFF) && (LOCAL_Asian))
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableGetSignal(ProcessSignal_2)->short_identifier;
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),4,JUSTIFY_LEFT,NO_INVERT,0,2,2,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#endif
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_PV_2                  // 2nd Process Value                       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_PV_2)
    {
        if (ProcessSignal_2 != 0xFF)
        {
            #ifdef AZ200_SPECIAL_FEATURES_HMI
            if ((LOCAL_Asian) && (calibrationStatus == HMI_CAL_STATUS_FAILURE))
            {
                LOCAL_packetStage ++;
            }
            else
            #endif
            {
                // 1. Build Text String (ID Value Units)
                TUSIGN8 PVText[22];
                PacketManagerBuilderServices_buildSignalText(PVText,ProcessSignal_2,eTRUE);

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    packetsBuilt += BuildWriteString(&PVText[4], HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 4, JUSTIFY_LEFT_WITH_INDENT_25_PIXEL, FONT_1, NO_INVERT, 0, 0, FONT1_MAX_CHARS - 4, 0);
                }
                else
                #endif
                {
                    packetsBuilt += BuildWriteString(PVText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 3, JUSTIFY_LEFT, FONT_0, NO_INVERT, 0, 0, FONT1_MAX_CHARS, 0);
                }
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_OUTPUT_HOLD_PROMPT           //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_OUTPUT_HOLD_PROMPT)
    {
        TBOOL skipThisStage = eTRUE;

        #ifdef HMI_SUPPORTS_OUTPUT_HOLD_AND_RELEASE
        if (calibrationStatus == HMI_CAL_STATUS_SET_OUTPUT_HOLD)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_HOLD_OUTPUT;
            skipThisStage = eFALSE;
        }
        else if ((calibrationStatus == HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT)
                 || (calibrationStatus == HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_RELEASE_OUTPUT;
            skipThisStage = eFALSE;
        }
        else
        {
            skipThisStage = eTRUE;
        }
        #endif

        if (skipThisStage)
        {
            LOCAL_packetStage ++;
        }
        else
        {
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,ASIAN_MAX_CHARS,ASIAN_MAX_CHARS,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id), HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 2, JUSTIFY_LEFT, FONT_1, NO_INVERT, 0, 0, FONT2_MAX_CHARS, 0);
            }
        }
    }
//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_RIGHT_KEY             // Right Key -  Continue/Abort/Accept      |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_RIGHT_KEY)
    {
        ATTRIB_IDENTIFIER_TYPE StatusID;

        switch (calibrationStatus)
        {
        #ifdef HMI_SUPPORTS_OUTPUT_HOLD_AND_RELEASE
        case HMI_CAL_STATUS_SET_OUTPUT_HOLD:
        case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT:
        case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT:
            LOCAL_stringtable_text_id.attribIdx = IDS_YES;
            break;
        #endif

        case HMI_CAL_STATUS_WAITING_FOR_STANDARD_1:
        case HMI_CAL_STATUS_WAITING_FOR_STANDARD_2:

            StatusID.ssIdx = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.ssidx;
            StatusID.objIdx = LOCAL_pCurrDisplayFrame->frameDefinition.autoCalFrame.objidx_status;
            StatusID.attribIdx = 0;

            if (WriteProtect_HMICanAccess(StatusID, (TUSIGN8)0))
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_CONTINUE;
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            }
            break;

        case HMI_CAL_STATUS_SUCCESS:
            LOCAL_stringtable_text_id.attribIdx = IDS_ACCEPT;
            break;

        case HMI_CAL_STATUS_CALCULATING_1:
        case HMI_CAL_STATUS_CALCULATING_2:
            if (FrameTableIsNavigationFromAutoCalAllowed())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_OK;
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            }
            break;

        case HMI_CAL_STATUS_INACTIVE:
            if (FrameTableIsNavigationFromAutoCalAllowed())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_YES;
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            }
            break;

        default:
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            break;
        }
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,NO_INVERT,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// AUTO_CAL_FRAME_PACKET_LEFT_KEY              // Left Key -  Abort/Next/Reject           |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == AUTO_CAL_FRAME_PACKET_LEFT_KEY)
    {
        switch (calibrationStatus)
        {
        #ifdef HMI_SUPPORTS_OUTPUT_HOLD_AND_RELEASE
        case HMI_CAL_STATUS_SET_OUTPUT_HOLD:
        case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_ACCEPT:
        case HMI_CAL_STATUS_RELEASE_OUTPUT_HOLD_REJECT:
            LOCAL_stringtable_text_id.attribIdx = IDS_NO;
            break;
        #endif

        case HMI_CAL_STATUS_WAITING_FOR_STANDARD_1:
        case HMI_CAL_STATUS_WAITING_FOR_STANDARD_2:
        case HMI_CAL_STATUS_CALCULATING_1:
        case HMI_CAL_STATUS_CALCULATING_2:
            LOCAL_stringtable_text_id.attribIdx = IDS_ABORT;
            break;

        case HMI_CAL_STATUS_SUCCESS:
            LOCAL_stringtable_text_id.attribIdx = IDS_REJECT;
            break;

        case HMI_CAL_STATUS_SUCCESS_NO_REJECT:
        case HMI_CAL_STATUS_FAILURE:
            LOCAL_stringtable_text_id.attribIdx = IDS_EXIT;
            break;

        case HMI_CAL_STATUS_INACTIVE:
            if (FrameTableIsNavigationFromAutoCalAllowed())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NO;
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            }
            break;

        default:
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            break;
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,1);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,1);
        }
    }
    return packetsBuilt;
}

// end of #ifdef HMI_SUPPORTS_AUTO_CALIBRATION
#endif


#ifdef AZ200_SPECIAL_FEATURES_HMI
TUSIGN8 BuildPerfomanceLogView(void)
{

typedef enum
{                                               // Packet                                         |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_BLANK_AREA,                  // Blank Area                                     | - Start of Static Area
                                                //------------------------------------------------|
    PL_VIEW_PACKET_ICONFIELD_1,                 // Top line of Icon                               |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_ICONFIELD_7,                 // Bottom line of Icon                            |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_SLIDER_BAR,                  // Slider Bar                                     | - Start of Active Area - Start of keypress area
                                                //------------------------------------------------|
    PL_VIEW_PACKET_ENTRY_NUMBER,                // Entry Number                                   |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_ICONFIELD_2,                 // 2nd line of Icon                               |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_ICONFIELD_3,                 // 3rd line of Icon                               |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_ICONFIELD_4,                 // 4th line of Icon                               |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_ICONFIELD_5,                 // 5th line of Icon                               |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_ICONFIELD_6,                 // 6th line of Icon                               |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_TIME,                        // Time from PLog Entry or "History Empty"        |
                                                //------------------------------------------------|
#ifdef HMI_SUPPORTS_ASIAN
                                                //------------------------------------------------|
    PL_VIEW_PACKET_TIME_DATE,                   // Time & Date from PLog Entry or "History Empty" |
                                                //------------------------------------------------|
#endif
                                                //------------------------------------------------|
    PL_VIEW_PACKET_DATE,                        // Date from Performance Log Entry                |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_OFFSET,                      // Offset from Performance Log Entry              |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_FACTOR,                      // Factor from Performance Log Entry              |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_RECOVERY_RATE,               // Recovery rate from Performance Log Entry       |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_DEVIATION,                   // Deviation from Performance Log Entry           |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_TIME_DIFF,                   // Time Diff from Performance Log Entry           |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_LEFT_KEY,                    // Left function key  "Back"                      |
                                                //------------------------------------------------|
    PL_VIEW_PACKET_READ_SWITCHES                //                                                |
                                                //------------------------------------------------|
}PL_VIEW_PACKET;

    TUSIGN8 packetsBuilt = 0;

    LOG_ENTRY PL_Entry;
    TIMEANDDATE convertedTimeDate;

    TBOOL HistoryIsEmpty = eFALSE;

    T_DO_ATTRIB_RANGE Range;                                                // Pointer to range information
    TUSIGN8 PL_Selector = 0;

    T_NVINTERFACE *pNVinterface = (T_NVINTERFACE*)GetSubsystemPtr((T_SUBSYSTEM_IDX)NVINTERFACE_IDX);
    T_UNIT        *pCal         = (T_UNIT*)GetSubsystemPtr((T_SUBSYSTEM_IDX)CAL_IDX);

    (void)pCal->GetAttributeDescription(pCal,CAL_IDX_PerformanceLogEntryIndex,0,&Range);
    (void)pCal->Get(pCal,CAL_IDX_PerformanceLogEntryIndex,0,(void FAST *)&PL_Selector);

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = PL_VIEW_PACKET_BLANK_AREA;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > PL_VIEW_PACKET_SLIDER_BAR))
    {
        LOCAL_packetStage = PL_VIEW_PACKET_SLIDER_BAR;
    }
    else if ((LOCAL_keypressProcessed) && (LOCAL_packetStage > PL_VIEW_PACKET_SLIDER_BAR))
    {
        LOCAL_packetStage = PL_VIEW_PACKET_SLIDER_BAR;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == PL_VIEW_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = PL_VIEW_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_BLANK_AREA                   // Blank Area                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_BLANK_AREA)
    {
        packetsBuilt += BuildBlankArea(0,7,0);
    }

//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_ICONFIELD_1                  // Top line of Icon                        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_ICONFIELD_1)
    {
        packetsBuilt += BuildWriteArray(PLog_Top, 18, 0, 0, 0);
    }

//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_ICONFIELD_7                  // Bottom line of Icon                     |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_ICONFIELD_7)
    {
        TUSIGN8 LineNumber = 6;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            LineNumber --;
        }
        #endif

        packetsBuilt += BuildWriteArray(PLog_Bottom, 18, 0, LineNumber, 0);
    }
//---------------------------------------------//------------------------------------------------|
// PL_VIEW_PACKET_SLIDER_BAR                   // Slider Bar                                     |
// PL_VIEW_PACKET_ENTRY_NUMBER                 // Entry Number                                   |
// PL_VIEW_PACKET_ICONFIELD_2                  // 2nd line of Icon                               |
// PL_VIEW_PACKET_ICONFIELD_3                  // 3rd line of Icon                               |
// PL_VIEW_PACKET_ICONFIELD_4                  // 4th line of Icon                               |
// PL_VIEW_PACKET_ICONFIELD_5                  // 5th line of Icon                               |
// PL_VIEW_PACKET_ICONFIELD_6                  // 6th line of Icon                               |
// PL_VIEW_PACKET_TIME                         // Time from PLog Entry or "History Empty"        |
// PL_VIEW_PACKET_TIME_DATE,                   // Time & Date from PLog Entry or "History Empty" |
// PL_VIEW_PACKET_DATE                         // Date from Performance Log Entry                |
// PL_VIEW_PACKET_OFFSET                       // Offset from Performance Log Entry              |
// PL_VIEW_PACKET_FACTOR                       // Factor from Performance Log Entry              |
// PL_VIEW_PACKET_RECOVERY_RATE                // Recovery rate from Performance Log Entry       |
// PL_VIEW_PACKET_DEVIATION                    // Deviation from Performance Log Entry           |
// PL_VIEW_PACKET_TIME_DIFF                    // Time Diff from Performance Log Entry           |
//---------------------------------------------//------------------------------------------------|
    if ((LOCAL_packetStage >= PL_VIEW_PACKET_SLIDER_BAR) && (LOCAL_packetStage <= PL_VIEW_PACKET_TIME_DIFF))
    {
        if (pNVinterface->GetPerformanceLogEntryCount_SRV(sizeof(LOG_ENTRY)) == 0)
        {
            PL_Entry.Type = CAL_INVALID_ENTRY;
            HistoryIsEmpty = eTRUE;
        }
        else if (pNVinterface->GetPerformanceLogEntrySRV(PL_Selector, (TUSIGN8*)&PL_Entry,  sizeof(LOG_ENTRY)) == 0)
        {
            PL_Entry.Type = CAL_INVALID_ENTRY;
            HistoryIsEmpty = eFALSE;
        }
        else
        {
            HistoryIsEmpty = eFALSE;
        }
    }
//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_SLIDER_BAR                   // Slider Bar                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_SLIDER_BAR)
    {
        if (HistoryIsEmpty)
        {
            LOCAL_packetStage = PL_VIEW_PACKET_ENTRY_NUMBER + 1;
        }
        else
        {
            packetsBuilt += BuildSliderBar((TINT16)(Range.range.u8.max) , (TINT16)(PL_Selector + 1), 0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_ENTRY_NUMBER                 // Entry Number                            |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_ENTRY_NUMBER)
    {
        if (HistoryIsEmpty)
        {
            LOCAL_packetStage = PL_VIEW_PACKET_ENTRY_NUMBER + 1;
        }
        else
        {
            TUSIGN8 selectorStr[4];
            TUSIGN8 i = PL_Selector + 1;

            selectorStr[0] = (i > 99) ? ((PL_Selector + 1) / 100) + '0'          : ' ';
            selectorStr[1] = (i > 9)  ? ((((PL_Selector + 1) % 100)) / 10) + '0' : ' ';
            selectorStr[2] = ((PL_Selector + 1) % 10) + '0';
            selectorStr[3] = 0x00;

            packetsBuilt += BuildWriteString(selectorStr, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 0, JUSTIFY_RIGHT, FONT_0, NO_INVERT, 0, 0, 3, 0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_ICONFIELD_2                  // 2nd line of Icon                        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_ICONFIELD_2)
    {
        const TUSIGN8* pArray;

        switch (PL_Entry.Type)
        {
        case CAL_NEW_PROBE:     pArray = PLog_ProbeHead;    break;
        case CAL_CAL_SUCCESS:   pArray = PLog_CalUpper;     break;
        case CAL_CAL_BADRESULT: pArray = PLog_CalUpper;     break;
        case CAL_ACC_SUCCESS:   pArray = PLog_AccChkUpper;  break;
        case CAL_ACC_BADRESULT: pArray = PLog_AccChkUpper;  break;
        default:                pArray = PLog_Blank;        break;
        }

        packetsBuilt += BuildWriteArray(pArray, 18, 0, 1, 0);
    }

//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_ICONFIELD_3                  // 3rd line of Icon                        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_ICONFIELD_3)
    {
        const TUSIGN8* pArray;

        switch (PL_Entry.Type)
        {
        case CAL_NEW_PROBE:     pArray = PLog_ProbeFlange;  break;
        case CAL_CAL_SUCCESS:   pArray = PLog_CalLower;     break;
        case CAL_CAL_BADRESULT: pArray = PLog_CalLower;     break;
        case CAL_ACC_SUCCESS:   pArray = PLog_AccChkLower;  break;
        case CAL_ACC_BADRESULT: pArray = PLog_AccChkLower;  break;
        default:                pArray = PLog_Blank;        break;
        }
        packetsBuilt += BuildWriteArray(pArray, 18, 0, 2, 0);
    }

//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_ICONFIELD_4                  // 4th line of Icon                        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_ICONFIELD_4)
    {
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            LOCAL_packetStage ++;
        }
        else
        #endif
        {
            const TUSIGN8* pArray;

            if (PL_Entry.Type == CAL_NEW_PROBE)
            {
                pArray = PLog_ProbeBody;
            }
            else
            {
                pArray = PLog_Blank;
            }

            packetsBuilt += BuildWriteArray(pArray, 18, 0, 3, 0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_ICONFIELD_5                  // 5th line of Icon                        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_ICONFIELD_5)
    {
        TUSIGN8 LineNumber = 4;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            LineNumber --;
        }
        #endif

        const TUSIGN8* pArray;

        switch (PL_Entry.Type)
        {
        case CAL_NEW_PROBE:     pArray = PLog_ProbeBody;    break;
        case CAL_CAL_SUCCESS:   pArray = PLog_GoodUpper;    break;
        case CAL_CAL_BADRESULT: pArray = PLog_BadUpper;     break;
        case CAL_ACC_SUCCESS:   pArray = PLog_GoodUpper;    break;
        case CAL_ACC_BADRESULT: pArray = PLog_BadUpper;     break;
        default:                pArray = PLog_Blank;        break;
        }

        packetsBuilt += BuildWriteArray(pArray, 18, 0, LineNumber, 0);
    }

//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_ICONFIELD_6                  // 6th line of Icon                        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_ICONFIELD_6)
    {
        TUSIGN8 LineNumber = 5;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            LineNumber --;
        }
        #endif

        const TUSIGN8* pArray;

        switch (PL_Entry.Type)
        {
        case CAL_NEW_PROBE:     pArray = PLog_ProbeSensor;  break;
        case CAL_CAL_SUCCESS:   pArray = PLog_GoodLower;    break;
        case CAL_CAL_BADRESULT: pArray = PLog_BadLower;     break;
        case CAL_ACC_SUCCESS:   pArray = PLog_GoodLower;    break;
        case CAL_ACC_BADRESULT: pArray = PLog_BadLower;     break;
        default:                pArray = PLog_Blank;        break;
        }
        packetsBuilt += BuildWriteArray(pArray, 18, 0, LineNumber, 0);
    }
//---------------------------------------------//------------------------------------------------|
// PL_VIEW_PACKET_TIME                         // Time from PLog Entry or "History Empty"        |
// PL_VIEW_PACKET_TIME_DATE,                   // Time & Date from PLog Entry or "History Empty" |
// PL_VIEW_PACKET_DATE                         // Date from Performance Log Entry                |
//---------------------------------------------//------------------------------------------------|
    if ((LOCAL_packetStage >= PL_VIEW_PACKET_TIME) && (LOCAL_packetStage <= PL_VIEW_PACKET_DATE))
    {
        if (PL_Entry.Type != CAL_INVALID_ENTRY)
        {
            #ifdef HMI_SUPPORTS_TIME_DATE_PARAM_FRAMES
            (void)AdjusterConvertSecondsToDate(PL_Entry.Time, &convertedTimeDate);
            #else
            convertedTimeDate.year   = 0;
            convertedTimeDate.month  = 0;
            convertedTimeDate.date   = 0;
            convertedTimeDate.hour   = 0;
            convertedTimeDate.minute = 0;
            convertedTimeDate.second = 0;
            #endif
        }
    }


//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_TIME                         // Time from PLog Entry or "History Empty" |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_TIME)
    {
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            LOCAL_packetStage ++;
        }
        else
        #endif
        {
            if (HistoryIsEmpty)
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NO_HISTORY;
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,0,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,18,0);
            }
            else
            {
                TUSIGN8 TextLine[16];
                (void)strcpy((char*)TextLine, "               ");

                if (PL_Entry.Type != CAL_INVALID_ENTRY)
                {
                    TextLine[3]  = (convertedTimeDate.hour / 10) + 0x30;
                    TextLine[4]  = (convertedTimeDate.hour % 10) + 0x30;
                    TextLine[5]  = ':';
                    TextLine[6]  = (convertedTimeDate.minute / 10) + 0x30;
                    TextLine[7]  = (convertedTimeDate.minute % 10) + 0x30;
                    TextLine[8]  = ':';
                    TextLine[9]  = (convertedTimeDate.second / 10) + 0x30;
                    TextLine[10] = (convertedTimeDate.second % 10) + 0x30;
                }
                packetsBuilt += BuildWriteString(TextLine, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 0, JUSTIFY_LEFT_WITH_INDENT_19_PIXEL, FONT_0, NO_INVERT, 0,0,15,0);
            }
        }
    }

#ifdef HMI_SUPPORTS_ASIAN
//---------------------------------------------//------------------------------------------------|
// PL_VIEW_PACKET_TIME_DATE,                   // Time & Date from PLog Entry or "History Empty" |
//---------------------------------------------//------------------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_TIME_DATE)
    {
        if (LOCAL_Asian)
        {
            if (HistoryIsEmpty)
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NO_HISTORY;
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),0,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,NO_INVERT,0,8,8,0);
            }
            else
            {
                TUSIGN8 TextLine[16];
                (void)strcpy((char*)TextLine, "               ");

                if (PL_Entry.Type != CAL_INVALID_ENTRY)
                {
                    TextLine[1]  = (convertedTimeDate.hour / 10) + 0x30;
                    TextLine[2]  = (convertedTimeDate.hour % 10) + 0x30;
                    TextLine[3]  = ':';
                    TextLine[4]  = (convertedTimeDate.minute / 10) + 0x30;
                    TextLine[5]  = (convertedTimeDate.minute % 10) + 0x30;
                    TextLine[6]  = ' ';

                    TUSIGN8 y_t  = ((TUSIGN8)((convertedTimeDate.year / 10) % 10)) + 0x30;
                    TUSIGN8 y_u  = ((TUSIGN8)(convertedTimeDate.year % 10)) + 0x30;

                    TUSIGN8 m_t  = (convertedTimeDate.month / 10) + 0x30;
                    TUSIGN8 m_u  = (convertedTimeDate.month % 10) + 0x30;

                    TUSIGN8 d_t  = (convertedTimeDate.date / 10) + 0x30;
                    TUSIGN8 d_u  = (convertedTimeDate.date % 10) + 0x30;

                    switch (SFD_SIMPLE.DateFormat)
                    {
                    case HMI_DATE_FORMAT_DD_MM_YYYY:
                        TextLine[ 7] = d_t;
                        TextLine[ 8] = d_u;
                        TextLine[ 9] = '-';
                        TextLine[10] = m_t;
                        TextLine[11] = m_u;
                        TextLine[12] = '-';
                        TextLine[13] = y_t;
                        TextLine[14] = y_u;
                        TextLine[15] = 0x00;
                        break;

                    case HMI_DATE_FORMAT_MM_DD_YYYY:
                        TextLine[ 7] = m_t;
                        TextLine[ 8] = m_u;
                        TextLine[ 9] = '-';
                        TextLine[10] = d_t;
                        TextLine[11] = d_u;
                        TextLine[12] = '-';
                        TextLine[13] = y_t;
                        TextLine[14] = y_u;
                        TextLine[15] = 0x00;
                        break;

                    default: // HMI_DATE_FORMAT_YYYY_MM_DD
                        TextLine[ 7] = y_t;
                        TextLine[ 8] = y_u;
                        TextLine[ 9] = '-';
                        TextLine[10] = m_t;
                        TextLine[11] = m_u;
                        TextLine[12] = '-';
                        TextLine[13] = d_t;
                        TextLine[14] = d_u;
                        TextLine[15] = 0x00;
                        break;
                    }
                }
                packetsBuilt += BuildWriteString(TextLine, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 0, JUSTIFY_LEFT_WITH_INDENT_19_PIXEL, FONT_0, NO_INVERT, 0,0,15,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
#endif

//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_DATE                         // Date from Performance Log Entry         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_DATE)
    {
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            LOCAL_packetStage ++;
        }
        else
        #endif
        {

            TUSIGN8 TextLine[16];
            (void)strcpy((char*)TextLine, "               ");

            if (PL_Entry.Type != CAL_INVALID_ENTRY)
            {
                TUSIGN8 y_th = ((TUSIGN8)(convertedTimeDate.year / 1000)) + 0x30;
                TUSIGN8 y_h  = ((TUSIGN8)((convertedTimeDate.year / 100) % 10)) + 0x30;
                TUSIGN8 y_t  = ((TUSIGN8)((convertedTimeDate.year / 10) % 10)) + 0x30;
                TUSIGN8 y_u  = ((TUSIGN8)(convertedTimeDate.year % 10)) + 0x30;

                TUSIGN8 m_t  = (convertedTimeDate.month / 10) + 0x30;
                TUSIGN8 m_u  = (convertedTimeDate.month % 10) + 0x30;

                TUSIGN8 d_t  = (convertedTimeDate.date / 10) + 0x30;
                TUSIGN8 d_u  = (convertedTimeDate.date % 10) + 0x30;

                switch (SFD_SIMPLE.DateFormat)
                {
                case HMI_DATE_FORMAT_DD_MM_YYYY:
                    TextLine[2] = d_t;
                    TextLine[3] = d_u;
                    TextLine[4] = '-';
                    TextLine[5] = m_t;
                    TextLine[6] = m_u;
                    TextLine[7] = '-';
                    TextLine[8] = y_th;
                    TextLine[9] = y_h;
                    TextLine[10] = y_t;
                    TextLine[11] = y_u;
                    TextLine[12] = 0x00;
                    break;

                case HMI_DATE_FORMAT_MM_DD_YYYY:
                    TextLine[2] = m_t;
                    TextLine[3] = m_u;
                    TextLine[4] = '-';
                    TextLine[5] = d_t;
                    TextLine[6] = d_u;
                    TextLine[7] = '-';
                    TextLine[8] = y_th;
                    TextLine[9] = y_h;
                    TextLine[10] = y_t;
                    TextLine[11] = y_u;
                    TextLine[12] = 0x00;
                    break;

                default: // HMI_DATE_FORMAT_YYYY_MM_DD
                    TextLine[2] = y_th;
                    TextLine[3] = y_h;
                    TextLine[4] = y_t;
                    TextLine[5] = y_u;
                    TextLine[6] = '-';
                    TextLine[7] = m_t;
                    TextLine[8] = m_u;
                    TextLine[9] = '-';
                    TextLine[10] = d_t;
                    TextLine[11] = d_u;
                    TextLine[12] = 0x00;
                    break;
                }
            }
            packetsBuilt += BuildWriteString(TextLine, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 1, JUSTIFY_LEFT_WITH_INDENT_19_PIXEL, FONT_0, NO_INVERT, 0,0,15,0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_OFFSET                       // Offset from Performance Log Entry (mV)  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_OFFSET)
    {
        TUSIGN8 TextLine[18] = "                 ";
        TUSIGN8 LineNumber = 2;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            LineNumber --;
        }

        if ((LOCAL_Asian) && (HistoryIsEmpty))
        {
            LOCAL_packetStage ++;
        }
        else
        #endif
        {
            if (PL_Entry.Type != CAL_INVALID_ENTRY)
            {
                TBOOL signalFound = eFALSE;
                TUSIGN8 signalNum = 0;
                const SIGNAL_TABLE_TYPE *pSignal;

                TUSIGN8 i, negNumber, within_over_under;

                TUSIGN8* pStart;

                #ifdef HMI_SUPPORTS_ASIAN
                if (LOCAL_Asian)
                {
                    signalFound = eFALSE;
                }
                else
                #endif
                {
                    do
                    {
                        pSignal = FrameTableGetSignal(signalNum);
                        if ((pSignal->value.ssIdx == CAL_IDX) && (pSignal->value.objIdx == CAL_IDX_CalibrationOffset) && (pSignal->value.attribIdx == 0))
                        {
                            signalFound = eTRUE;
                        }
                        else
                        {
                            signalNum ++;
                        }
                    }
                    while ((signalNum <= MAX_SIGNALS) && (signalFound == eFALSE));
                }

                // 3 chars ID
                if (signalFound)
                {
                    LOCAL_stringtable_text_id.attribIdx = pSignal->short_identifier;
                    (void)strncpy((char *)TextLine, (char *)FrameTableGetString(LOCAL_stringtable_text_id),3);
                }
                else
                {
                    (void)strcpy((char *)TextLine, "Off");
                }

                for (i = strlen((char *)TextLine); i < 3; i++)
                {
                    TextLine[i] = ' ';
                }

                // 7 chars value
                pStart = AdjusterBuildNumberString(PL_Entry.Offset, 6, 2, &negNumber, &within_over_under);
                if ((within_over_under == 1) || (within_over_under == 2))
                {
                    TextLine[3] = ' ';
                    for (i = 4; i < 10; i++)
                    {
                        TextLine[i] = 0x05 + within_over_under;
                    }
                    TextLine[10] = 0x00;
                }
                else
                {
                    for (i = 3; i < 10; i++)
                    {
                        TextLine[i] = ' ';
                    }

                    while (*pStart == 0x20)
                    {
                        #pragma diag_suppress=Pm088
                        pStart ++;
                        #pragma diag_default=Pm088
                    }

                    i = 9 - strlen((char *)pStart);
                    TextLine[i] = negNumber ? '-' : ' ';
                    i++;
                    TextLine[i] = 0x00;
                    (void)strcat((char *)TextLine,(char *)pStart);
                }

                // 8 chars units
                TextLine[10] = ' ';
                TextLine[11] = 'm';
                TextLine[12] = 'V';
                // remaining characters are already spaces
            }
            packetsBuilt += BuildWriteString(TextLine, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, LineNumber, JUSTIFY_LEFT_WITH_INDENT_19_PIXEL, FONT_0, NO_INVERT, 0,0,17,0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_FACTOR                       // Factor from Performance Log Entry       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_FACTOR)
    {
        TUSIGN8 TextLine[18] = "                 ";
        TUSIGN8 LineNumber = 3;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            LineNumber --;
        }
        #endif

        if (PL_Entry.Type != CAL_INVALID_ENTRY)
        {
            TBOOL signalFound = eFALSE;
            TUSIGN8 signalNum = 0;
            const SIGNAL_TABLE_TYPE *pSignal;

            TUSIGN8 i, negNumber, within_over_under;

            TUSIGN8* pStart;

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                signalFound = eFALSE;
            }
            else
            #endif
            {
                do
                {
                    pSignal = FrameTableGetSignal(signalNum);
                    if ((pSignal->value.ssIdx == CAL_IDX) && (pSignal->value.objIdx == CAL_IDX_CalibrationFactor) && (pSignal->value.attribIdx == 0))
                    {
                        signalFound = eTRUE;
                    }
                    else
                    {
                        signalNum ++;
                    }
                }
                while ((signalNum <= MAX_SIGNALS) && (signalFound == eFALSE));
            }

            // 3 chars ID
            if (signalFound)
            {
                LOCAL_stringtable_text_id.attribIdx = pSignal->short_identifier;
                (void)strncpy((char *)TextLine, (char *)FrameTableGetString(LOCAL_stringtable_text_id),3);
            }
            else
            {
                (void)strcpy((char *)TextLine, "Fct");
            }
            for (i = strlen((char *)TextLine); i < 3; i++)
            {
                TextLine[i] = ' ';
            }

            // 7 chars value
            pStart = AdjusterBuildNumberString(PL_Entry.Factor, 6, 3, &negNumber, &within_over_under);
            if ((within_over_under == 1) || (within_over_under == 2))
            {
                TextLine[3] = ' ';
                for (i = 4; i < 10; i++)
                {
                    TextLine[i] = 0x05 + within_over_under;
                }
                TextLine[10] = 0x00;
            }
            else
            {
                for (i = 3; i < 10; i++)
                {
                    TextLine[i] = ' ';
                }

                while (*pStart == 0x20)
                {
                    #pragma diag_suppress=Pm088
                    pStart ++;
                    #pragma diag_default=Pm088
                }

                i = 9 - strlen((char *)pStart);
                TextLine[i] = negNumber ? '-' : ' ';
                i++;
                TextLine[i] = 0x00;
                (void)strcat((char *)TextLine,(char *)pStart);
            }

            // 8 chars units
            // no Units for factor
        }
        packetsBuilt += BuildWriteString(TextLine, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, LineNumber, JUSTIFY_LEFT_WITH_INDENT_19_PIXEL, FONT_0, NO_INVERT, 0,0,17,0);
    }

//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_RECOVERY_RATE                // Recovery rate from Performance Log Entry|
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_RECOVERY_RATE)
    {
        TUSIGN8 TextLine[18] = "                 ";
        TUSIGN8 LineNumber = 4;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            LineNumber --;
        }
        #endif

        if ((PL_Entry.Type == CAL_CAL_SUCCESS) || (PL_Entry.Type == CAL_CAL_BADRESULT)
         || (PL_Entry.Type == CAL_ACC_SUCCESS) || (PL_Entry.Type == CAL_ACC_BADRESULT))
        {
            TBOOL signalFound = eFALSE;
            TUSIGN8 signalNum = 0;
            const SIGNAL_TABLE_TYPE *pSignal;

            TUSIGN8 i, negNumber, within_over_under;

            TUSIGN8* pStart;

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                signalFound = eFALSE;
            }
            else
            #endif
            {
                do
                {
                    pSignal = FrameTableGetSignal(signalNum);
                    if ((pSignal->value.ssIdx == CAL_IDX) && (pSignal->value.objIdx == CAL_IDX_RecoveryRate) && (pSignal->value.attribIdx == 0))
                    {
                        signalFound = eTRUE;
                    }
                    else
                    {
                        signalNum ++;
                    }
                }
                while ((signalNum <= MAX_SIGNALS) && (signalFound == eFALSE));
            }

            // 3 chars ID
            if (signalFound)
            {
                LOCAL_stringtable_text_id.attribIdx = pSignal->short_identifier;
                (void)strncpy((char *)TextLine, (char *)FrameTableGetString(LOCAL_stringtable_text_id),3);
            }
            else
            {
                (void)strcpy((char *)TextLine, "RR ");
            }

            for (i = strlen((char *)TextLine); i < 3; i++)
            {
                TextLine[i] = ' ';
            }

            if ((PL_Entry.validFlags & RATE_VALID_MASK) != 0)
            {
                // 7 chars value
                pStart = AdjusterBuildNumberString(PL_Entry.RecoveryRate, 6, 2, &negNumber, &within_over_under);
                if ((within_over_under == 1) || (within_over_under == 2))
                {
                    TextLine[3] = ' ';
                    for (i = 4; i < 10; i++)
                    {
                        TextLine[i] = 0x05 + within_over_under;
                    }
                    TextLine[10] = 0x00;
                }
                else
                {
                    for (i = 3; i < 10; i++)
                    {
                        TextLine[i] = ' ';
                    }

                    while (*pStart == 0x20)
                    {
                        #pragma diag_suppress=Pm088
                        pStart ++;
                        #pragma diag_default=Pm088
                    }

                    i = 9 - strlen((char *)pStart);
                    TextLine[i] = negNumber ? '-' : ' ';
                    i++;
                    TextLine[i] = 0x00;
                    (void)strcat((char *)TextLine,(char *)pStart);
                }

                // 8 chars units
                TextLine[10] = ' ';
                TextLine[11] = '%';
                TextLine[12] = 'O';
                TextLine[13] = '2';
                TextLine[14] = '/';
                TextLine[15] = 's';
                // remaining characters are already spaces
            }
            else
            {
                TextLine[3]  = ' ';
                TextLine[4]  = '-';
                TextLine[5]  = '-';
                TextLine[6]  = '-';
                TextLine[7]  = '-';
                TextLine[8]  = '-';
                TextLine[9]  = '-';
                TextLine[10] = 0x00;
            }
        }

        packetsBuilt += BuildWriteString(TextLine, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, LineNumber, JUSTIFY_LEFT_WITH_INDENT_19_PIXEL, FONT_0, NO_INVERT, 0,0,17,0);
    }

//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_DEVIATION                    // Deviation from Performance Log Entry    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_DEVIATION)
    {
        TUSIGN8 TextLine[18] = "                 ";
        TUSIGN8 LineNumber = 5;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            LineNumber --;
        }
        #endif

        if ((PL_Entry.Type == CAL_CAL_SUCCESS) || (PL_Entry.Type == CAL_CAL_BADRESULT)
         || (PL_Entry.Type == CAL_ACC_SUCCESS) || (PL_Entry.Type == CAL_ACC_BADRESULT))
        {
            TBOOL signalFound = eFALSE;
            TUSIGN8 signalNum = 0;
            const SIGNAL_TABLE_TYPE *pSignal;

            TUSIGN8 i, negNumber, within_over_under;

            TUSIGN8* pStart;

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                signalFound = eFALSE;
            }
            else
            #endif
            {
                do
                {
                    pSignal = FrameTableGetSignal(signalNum);
                    if ((pSignal->value.ssIdx == CAL_IDX) && (pSignal->value.objIdx == CAL_IDX_O2Deviation) && (pSignal->value.attribIdx == 0))
                    {
                        signalFound = eTRUE;
                    }
                    else
                    {
                        signalNum ++;
                    }
                }
                while ((signalNum <= MAX_SIGNALS) && (signalFound == eFALSE));
            }

            // 3 chars ID
            if (signalFound)
            {
                LOCAL_stringtable_text_id.attribIdx = pSignal->short_identifier;
                (void)strncpy((char *)TextLine, (char *)FrameTableGetString(LOCAL_stringtable_text_id),3);
            }
            else
            {
                (void)strcpy((char *)TextLine, "Dev");
            }
            for (i = strlen((char *)TextLine); i < 3; i++)
            {
                TextLine[i] = ' ';
            }

            if ((PL_Entry.validFlags & DEVIATION_VALID_MASK) != 0)
            {
                // 7 chars value
                pStart = AdjusterBuildNumberString(PL_Entry.Deviation, 6, 2, &negNumber, &within_over_under);
                if ((within_over_under == 1) || (within_over_under == 2))
                {
                    TextLine[3] = ' ';
                    for (i = 4; i < 10; i++)
                    {
                        TextLine[i] = 0x05 + within_over_under;
                    }
                    TextLine[10] = 0x00;
                }
                else
                {
                    for (i = 3; i < 10; i++)
                    {
                        TextLine[i] = ' ';
                    }

                    while (*pStart == 0x20)
                    {
                        #pragma diag_suppress=Pm088
                        pStart ++;
                        #pragma diag_default=Pm088
                    }

                    i = 9 - strlen((char *)pStart);
                    TextLine[i] = negNumber ? '-' : ' ';
                    i++;
                    TextLine[i] = 0x00;
                    (void)strcat((char *)TextLine,(char *)pStart);
                }

                // 8 chars units
                TextLine[10] = ' ';
                TextLine[11] = '%';
                TextLine[12] = 'O';
                TextLine[13] = '2';
                // remaining characters are already spaces
            }
            else
            {
                TextLine[3]  = ' ';
                TextLine[4]  = '-';
                TextLine[5]  = '-';
                TextLine[6]  = '-';
                TextLine[7]  = '-';
                TextLine[8]  = '-';
                TextLine[9]  = '-';
                TextLine[10] = 0x00;
            }
        }
        packetsBuilt += BuildWriteString(TextLine, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, LineNumber, JUSTIFY_LEFT_WITH_INDENT_19_PIXEL, FONT_0, NO_INVERT, 0,0,17,0);
    }

//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_TIME_DIFF                    // Time Diff from Performance Log Entry    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_TIME_DIFF)
    {
        TUSIGN8 TextLine[18] = "                 ";
        TUSIGN8 LineNumber = 6;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            LineNumber --;
        }
        #endif

        if ((PL_Entry.Type == CAL_CAL_SUCCESS) || (PL_Entry.Type == CAL_CAL_BADRESULT)
         || (PL_Entry.Type == CAL_ACC_SUCCESS) || (PL_Entry.Type == CAL_ACC_BADRESULT))
        {
            TextLine[0] = 't';
            TextLine[1] = ' ';
            TextLine[2] = ' ';
            TextLine[3] = 0x00;

            if ((PL_Entry.validFlags & DEVIATION_VALID_MASK) != 0)
            {
                TUSIGN8 numberText[6];

                TUSIGN16 seconds = (TUSIGN16)(PL_Entry.TimeSinceLastCal % 60);
                TUSIGN16 minutes = (TUSIGN16)((PL_Entry.TimeSinceLastCal / 60) % 60);
                TUSIGN16 hours   = (TUSIGN16)((PL_Entry.TimeSinceLastCal / 3600) % 24);
                TUSIGN16 days    = (TUSIGN16)( PL_Entry.TimeSinceLastCal / 86400);

                if (days != 0)
                {
                    (void)PacketManagerConvertValue(days, numberText, eFALSE);
                    (void)strcat((char *)TextLine,(char *)numberText);
                    (void)strcat((char *)TextLine,"d ");
                }

                (void)PacketManagerConvertValue(hours , numberText, eTRUE);
                (void)strcat((char *)TextLine,(char *)numberText);
                (void)strcat((char *)TextLine,"h ");

                (void)PacketManagerConvertValue(minutes , numberText, eTRUE);
                (void)strcat((char *)TextLine,(char *)numberText);
                (void)strcat((char *)TextLine,"m");

                if (days < 10)
                {
                    (void)strcat((char *)TextLine," ");

                    (void)PacketManagerConvertValue(seconds , numberText, eTRUE);
                    (void)strcat((char *)TextLine,(char *)numberText);
                    (void)strcat((char *)TextLine,"s");
                }
            }
            else
            {
                TextLine[3]  = ' ';
                TextLine[4]  = '-';
                TextLine[5]  = '-';
                TextLine[6]  = '-';
                TextLine[7]  = '-';
                TextLine[8]  = '-';
                TextLine[9]  = '-';
                TextLine[10] = 0x00;
            }

        }

        packetsBuilt += BuildWriteString(TextLine,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,LineNumber,JUSTIFY_LEFT_WITH_INDENT_19_PIXEL,FONT_0,NO_INVERT,0,0,17,0);
    }

//---------------------------------------------//-----------------------------------------|
// PL_VIEW_PACKET_LEFT_KEY                     // Left function key  "Back"               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == PL_VIEW_PACKET_LEFT_KEY)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,1);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,1);
        }
    }
    return packetsBuilt;
}
#endif

#ifdef HMI_SUPPORTS_BIT_ENUM_PARAM_FRAMES
// No restriction on the optimization of this function
TUSIGN8 BuildBitEnumerationFrame(TBOOL edit)
{

typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_TITLE_BAR,            // Title Bar "-------Device--------"       | - Start of Static Area
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_ID_2,                 // Secondary Identifier                    |
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_SLIDER_BAR,           // Slider Bar                              |
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_EDIT_ICON,            // Edit Icon                               |
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_TITLE,                // Parameter title                         |
                                                //-----------------------------------------|
#ifndef DISABLE_BACK_MOVE_SELECT
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_BMS_ICON_6,           // BACK_MOVE_SELECT (UP/Down) Icon         |
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_BMS_ICON_7,           // BACK_MOVE_SELECT (UP/Down) Icon         |
                                                //-----------------------------------------|
#endif
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_VALUE,                // Parameter Value                         | - Start of Active Area (View). - Start of Keypress area (Edit).
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_SET_HIGHLIGHT_TOP,    // Highlight border on edit field (Top)    |
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_SET_HIGHLIGHT_BOTTOM, // Highlight border on edit field (Bottom) |
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_CLR_HIGHLIGHT_TOP,    // Highlight border on edit field (Top)    |
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_CLR_HIGHLIGHT_BOTTOM, // Highlight border on edit field (Bottom) |
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_RIGHT_FUNCTION_KEY,   // Right Function Key                      |
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_LEFT_FUNCTION_KEY,    // Left Function Key                       |
                                                //-----------------------------------------|
    BIT_ENUM_FRAME_PACKET_READ_SWITCHES         //                                         |
                                                //-----------------------------------------|
}BIT_ENUM_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;

    #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
    TUSIGN8 SecondaryIdentifierText[SECONDARY_IDENTIFIER_LEN];
    TBOOL SecondaryIdentifierActive = FrameTableGetSecondaryIdentifier(SecondaryIdentifierText);
    #endif

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = BIT_ENUM_FRAME_PACKET_TITLE_BAR;
    }

    if ((edit == eFALSE) && (LOCAL_updateActiveArea) && (LOCAL_packetStage > BIT_ENUM_FRAME_PACKET_VALUE))
    {
        LOCAL_packetStage = BIT_ENUM_FRAME_PACKET_VALUE;
    }

    if ((edit == eTRUE) && (LOCAL_keypressProcessed) && (LOCAL_packetStage > BIT_ENUM_FRAME_PACKET_VALUE))
    {
        LOCAL_packetStage = BIT_ENUM_FRAME_PACKET_VALUE;
    }

    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = BIT_ENUM_FRAME_PACKET_READ_SWITCHES;
    }
//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_TITLE_BAR             // Title Bar "-------Device--------"       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.titleBar_attribidx;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),MAX_ASIAN_TITLE_LEN,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_ID_2,                 // Secondary Identifier                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_ID_2)
    {
        #ifdef HMI_SUPPORTS_SECONDARY_IDENTIFIER
        if (SecondaryIdentifierActive)
        {
            packetsBuilt += BuildWriteString(SecondaryIdentifierText,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,1,JUSTIFY_AS_SECONDARY_IDENTIFER,FONT_0,NO_INVERT,0,0,SECONDARY_IDENTIFIER_LEN,0);
        }
        else
        #endif
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_SLIDER_BAR            // Slider Bar                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_SLIDER_BAR)
    {
        if (edit == eTRUE)
        {
            LOCAL_packetStage ++;
        }
        else
        {
            #ifdef HMI_SUPPORTS_EASYSETUP
            if (LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.easySetupFlag != 0)
            {
                TUSIGN8 lastStage, currentStage;
                FrameTableGetEasySetupStages(&lastStage, &currentStage);

                packetsBuilt += BuildSliderBar((TINT16)lastStage,(TINT16)currentStage,0);
            }
            else
            #endif
            {
                TUSIGN8 high,actual;
                #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
                FrameTableGetMenuPositionDetailsForTFT(&actual, &high);
                #else
                FrameTableAccessMenuPositionDetails(&actual, &high, eTRUE);
                #endif
                packetsBuilt += BuildSliderBar((TINT16)high,(TINT16)actual,0);
            }
        }
    }

//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_EDIT_ICON             // Edit Icon                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_EDIT_ICON)
    {
        if (edit == eTRUE)
        {
            #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
                LOCAL_packetStage  ++;   // Icon not displayed on TFT displays
            #else
                TUSIGN8 customChar[13] = {0x00, 0x1, 0x0F, 0x08, 0x48, 0x2F, 0x11, 0x88, 0xF4, 0x12, 0x11, 0xF0, 0x80};
                packetsBuilt += BuildCustomCharacterString(customChar, 13, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0, 0);
            #endif
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }

//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_TITLE                 // Parameter title                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_TITLE)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.title_attribidx;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),2,JUSTIFY_LEFT,NO_INVERT,0,1,ASIAN_MAX_CHARS,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT,FONT_1,NO_INVERT,0,0,1,0);
        }
    }

#ifndef DISABLE_BACK_MOVE_SELECT
//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_BMS_ICON_6,           // BACK_MOVE_SELECT (UP/Down) Icon         |
// BIT_ENUM_FRAME_PACKET_BMS_ICON_7,           // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_BMS_ICON_6)
     || (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_BMS_ICON_7))
    {
        if ((!FrameTableIsBackMoveSelectAvailable(LOCAL_pCurrDisplayFrame)) || (edit))
        {
            LOCAL_packetStage = BIT_ENUM_FRAME_PACKET_BMS_ICON_7 + 1;
        }
    }
//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_BMS_ICON_6,           // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_BMS_ICON_6)
    {
      #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
        LOCAL_packetStage ++;
      #else
        packetsBuilt += BuildCustomCharacterString(UpKey, UP_DOWN_ICON_FIELD_WIDTH, UP_DOWN_ICON_POS, 6, 0, 0);
      #endif
    }
//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_BMS_ICON_7,           // BACK_MOVE_SELECT (UP/Down) Icon         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_BMS_ICON_7)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            packetsBuilt += BuildWriteIcon(ICON_SCROLL_ARROWS, 0, 7, 0);
        #else
            packetsBuilt += BuildCustomCharacterString(DownKey, UP_DOWN_ICON_FIELD_WIDTH, UP_DOWN_ICON_POS, 7, 0, 0);
        #endif
    }
#endif

//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_VALUE                 // Parameter Value                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_VALUE)
    {
        TUSIGN8 bitEnumValue, i, mask_LSB_First, mask_MSB_First;
        TUSIGN8 bitData[9];

        TUSIGN8 justify = JUSTIFY_RIGHT_WITH_INDENT_1;
        TUSIGN8 invert_type = NO_INVERT;
        TUSIGN8 invert_char = 0;

        if (edit == eTRUE)
        {
            TUSIGN8  nBits;
            bitEnumValue = (TUSIGN8)AdjusterGetEnumVariable(&nBits);
        }
        else
        {
            (void)AdjusterGetAttribute((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.value.ssIdx,
                                       (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.value.objIdx,
                                       (TUSIGN8)LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.value.attribIdx,
                                       (void FAST *)&bitEnumValue);
        }

        mask_LSB_First = 0x01;
        mask_MSB_First = 0x01 << (LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.numberOfBits - 1);

        for (i = 0; i <= 8; i++)
        {
            if (i >= LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.numberOfBits)
            {
                bitData[i] = 0x00;
            }
            else
            {
                switch (LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.displayStyle)
                {
                case 3:
                    if ((bitEnumValue & mask_LSB_First) == 0)
                    {
                        bitData[i] = '-';
                    }
                    else
                    {
                        bitData[i] = '1' + i;
                    }
                    break;

                case 2:
                    if ((bitEnumValue & mask_MSB_First) == 0)
                    {
                        bitData[i] = '-';
                    }
                    else
                    {
                        bitData[i] = (LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.numberOfBits - i) + '0';
                    }
                    break;

                case 1:
                    if ((bitEnumValue & mask_MSB_First) == 0)
                    {
                        bitData[i] = '0';
                    }
                    else
                    {
                        bitData[i] = '1';
                    }
                    break;

                default:
                    bitData[i] = ' ';
                    break;
                }
            }
            mask_LSB_First = mask_LSB_First << 1;
            mask_MSB_First = mask_MSB_First >> 1;
        }

        if (edit == eTRUE)
        {
            justify = JUSTIFY_LEFT_WITH_INDENT_7;

            if (FrameTableGetCursorPosition() < LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.numberOfBits)
            {
                invert_type = CHAR_INVERT;
                invert_char = FrameTableGetCursorPosition();
            }
        }
        packetsBuilt += BuildWriteString(bitData,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,justify,FONT_1,invert_type,invert_char,0,0,0);
    }

//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_SET_HIGHLIGHT_TOP     // Highlight border on edit field (Top)    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_SET_HIGHLIGHT_TOP)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage  ++;   // Additional highlight not required on TFT displays
        #else
            if ((FrameTableGetCursorPosition() < LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.numberOfBits)
             && (edit == eTRUE))
            {
                TUSIGN8 customCharVal = 0xFF;
                packetsBuilt += BuildCustomCharacterString(&customCharVal, 1, (TUSIGN8)(41 + (FrameTableGetCursorPosition() * 6)), 4, 0, 0);
            }
            else
            {
                LOCAL_packetStage ++;
            }
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_SET_HIGHLIGHT_BOTTOM  // Highlight border on edit field (Bottom) |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_SET_HIGHLIGHT_BOTTOM)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage  ++;   // Additional highlight not required on TFT displays
        #else
            if ((FrameTableGetCursorPosition() < LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.numberOfBits)
             && (edit == eTRUE))
            {
                TUSIGN8 customCharVal = 0xFF;
                packetsBuilt += BuildCustomCharacterString(&customCharVal, 1, (TUSIGN8)(41 + (FrameTableGetCursorPosition() * 6)), 5, 0, 0);
            }
            else
            {
                LOCAL_packetStage ++;
            }
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_CLR_HIGHLIGHT_TOP     // Highlight border on edit field (Top)    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_CLR_HIGHLIGHT_TOP)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage  ++;   // Additional highlight not required on TFT displays
        #else
            if ((FrameTableGetCursorPosition() != 0)
             && (edit == eTRUE))
            {
                TUSIGN8 customCharVal = 0x00;
                packetsBuilt += BuildCustomCharacterString(&customCharVal, 1, 41, 4, 0, 0);
            }
            else
            {
                LOCAL_packetStage ++;
            }
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_CLR_HIGHLIGHT_BOTTOM  // Highlight border on edit field (Bottom) |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_CLR_HIGHLIGHT_BOTTOM)
    {
        #if defined (TYPE_4_IMPLEMENTATION) || defined (TYPE_5_IMPLEMENTATION)
            LOCAL_packetStage  ++;   // Additional highlight not required on TFT displays
        #else
            if ((FrameTableGetCursorPosition() != 0)
             && (edit == eTRUE))
            {
                TUSIGN8 customCharVal = 0x00;
                packetsBuilt += BuildCustomCharacterString(&customCharVal, 1, 41, 5, 0, 0);
            }
            else
            {
                LOCAL_packetStage ++;
            }
        #endif
    }
//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_RIGHT_FUNCTION_KEY    // Right Function Key                      |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_RIGHT_FUNCTION_KEY)
    {
        TUSIGN8 invert, minlen;

        TBOOL cursorAtLimit = FrameTableGetCursorPosition() < LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.numberOfBits ? eFALSE : eTRUE;
        TBOOL AccessAllowed = WriteProtect_HMICanAccess(LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.value, (TUSIGN8)0) ? eTRUE : eFALSE;

        if (edit == eTRUE)
        {
            if ((AccessAllowed == eTRUE) && (cursorAtLimit == eFALSE))
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_OK;
                invert = NO_INVERT;
                minlen = 9;
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_CANCEL;
                invert = STRING_INVERT;
                minlen = 0;
            }
        }
        else
        {
            if ((AccessAllowed == eTRUE) && (LOCAL_pCurrDisplayFrame->frameType != FRAME_TYPE_BIT_ENUMERATED_PARAM_NO_EDIT))
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_EDIT;
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            }
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,invert,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,invert,0,0,minlen,0);
        }
    }

//---------------------------------------------//-----------------------------------------|
// BIT_ENUM_FRAME_PACKET_LEFT_FUNCTION_KEY     // Left Function Key                       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == BIT_ENUM_FRAME_PACKET_LEFT_FUNCTION_KEY)
    {
        if (edit == eTRUE)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
        }
        else
        {
            #ifdef HMI_SUPPORTS_SEQUENCES
            if (FrameTableIsSequenceEnabled())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            }
            else
            #endif
            {
                #ifdef HMI_SUPPORTS_EASYSETUP
                if (LOCAL_pCurrDisplayFrame->frameDefinition.bitEnumParamFrame.easySetupFlag != 0)
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
                }
                else
                #endif
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
                }
            }
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,1);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,1);
        }
    }
    return packetsBuilt;
}

#endif // #ifdef HMI_SUPPORTS_BIT_ENUM_PARAM_FRAMES

#ifdef EDP300_SPECIAL_FEATURES_HMI

TUSIGN8 BuildEDP300ModeFrame(void)
{

typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_TITLE_BAR,         // Title Bar "---Operating Mode----"       | - Start of Static Area
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_LEFT_KEY,          // Left Function Key "Back"                |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_AUTO_ADJ,          // "Auto Adjust"                           | - Start of Keypress Area (cursor changed)
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_AUTO_ADJ_HL,       // Highlight to left of "Auto Adjust"      |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_ADAPTION,          // "Adaption"                              |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_ADAPTION_HL,       // Highlight to left of "Adaption"         |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_CONTROL,           // "Control"                               |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_CONTROL_HL,        // Highlight to left of "Control"          |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_MAN_SP,            // "Manual SP"                             |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_MAN_SP_HL,         // Highlight to left of "Manual SP"        |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_MAN_SEN,           // "Manual Sensor"                         |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_MAN_SEN_HL,        // Highlight to left of "Manual Sensor"    |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_CONFIGURATION,     // "Configuration"                         |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_CONFIGURATION_HL,  // Highlight to left of "Configuration"    |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_AUTO_ADJ_COUNT,    // Auto Adjust countdown                   | - Start of Active Area Start of Keypress Area (cursor unchanged)
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_ADAPTION_CHECK,    // "Adaption" Check Box                    |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_CONTROL_CHECK,     // "Control" Check Box                     |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_MAN_SP_CHECK,      // "Manual SP" Check Box                   |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_MAN_SEN_CHECK,     // "Manual Sensor" Check Box               |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_RIGHT_KEY,         // Right Function Key "OK"                 |
                                                //-----------------------------------------|
    EDP300_MODE_FRAME_PACKET_READ_SWITCHES      //                                         |
                                                //-----------------------------------------|
}EDP300_MODE_FRAME_PACKET;


    TBOOL ControlCheck,ManSPCheck,ManSenCheck;
    static  TUSIGN8 prvCursonPosn = 99;
    TUSIGN8 keypressAreaStartPacket = EDP300_MODE_FRAME_PACKET_AUTO_ADJ;

    if (FrameTableGetCursorPosition() == prvCursonPosn)
    {
        keypressAreaStartPacket = EDP300_MODE_FRAME_PACKET_AUTO_ADJ_COUNT;
    }

    TUSIGN8 packetsBuilt = 0;

    if (LOCAL_updateStaticArea)
    {
            LOCAL_packetStage = EDP300_MODE_FRAME_PACKET_TITLE_BAR;
    }
    else if ((LOCAL_packetStage > keypressAreaStartPacket)
          && (LOCAL_keypressProcessed))
    {
        LOCAL_packetStage = keypressAreaStartPacket;
    }
    else if ((LOCAL_packetStage > EDP300_MODE_FRAME_PACKET_AUTO_ADJ_COUNT)
          && (LOCAL_updateActiveArea))
    {
        LOCAL_packetStage = EDP300_MODE_FRAME_PACKET_AUTO_ADJ_COUNT;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = EDP300_MODE_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_TITLE_BAR          // Title Bar "---Operating Mode----"       |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_OPERATING_MODE;
        packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_LEFT_KEY,          // Left Function Key "Back"                |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_LEFT_KEY)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_AUTO_ADJ,          // "Auto Adjust"                           | - Start of Keypress Area
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_AUTO_ADJ)
    {
        TUSIGN8  invert = FrameTableGetCursorPosition() == 0 ? STRING_INVERT : NO_INVERT;
        LOCAL_stringtable_text_id.attribIdx = IDS_AUTO_ADJUST;
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,1,JUSTIFY_LEFT_WITH_INDENT_2,FONT_0,invert,0,0,EDP300_MODE_FRAME_STR_LEN,0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_AUTO_ADJ_HL,       // Highlight to left of "Auto Adjust"      |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_AUTO_ADJ_HL)
    {
        TUSIGN8 customChar = FrameTableGetCursorPosition() == 0 ? 0xFF : 0x00;
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, 11, 1, 0, 0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_ADAPTION,          // "Adaption"                              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_ADAPTION)
    {
        TUSIGN8  invert = FrameTableGetCursorPosition() == 1 ? STRING_INVERT : NO_INVERT;
        LOCAL_stringtable_text_id.attribIdx = IDS_ADAPTION;
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_LEFT_WITH_INDENT_2,FONT_0,invert,0,0,EDP300_MODE_FRAME_STR_LEN,0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_ADAPTION_HL,       // Highlight to left of "Adaption"         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_ADAPTION_HL)
    {
        TUSIGN8 customChar = FrameTableGetCursorPosition() == 1 ? 0xFF : 0x00;
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, 11, 2, 0, 0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_CONTROL,           // "Control"                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_CONTROL)
    {
        TUSIGN8  invert = FrameTableGetCursorPosition() == 2 ? STRING_INVERT : NO_INVERT;
        LOCAL_stringtable_text_id.attribIdx = IDS_CONTROL;
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,3,JUSTIFY_LEFT_WITH_INDENT_2,FONT_0,invert,0,0,EDP300_MODE_FRAME_STR_LEN,0);
    }

//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_CONTROL_HL,        // Highlight to left of "Control"          |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_CONTROL_HL)
    {
        TUSIGN8 customChar = FrameTableGetCursorPosition() == 2 ? 0xFF : 0x00;
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, 11, 3, 0, 0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_MAN_SP,            // "Manual SP"                             |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_MAN_SP)
    {
        TUSIGN8  invert = FrameTableGetCursorPosition() == 3 ? STRING_INVERT : NO_INVERT;
        LOCAL_stringtable_text_id.attribIdx = IDS_MANUAL_SP;
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_LEFT_WITH_INDENT_2,FONT_0,invert,0,0,EDP300_MODE_FRAME_STR_LEN,0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_MAN_SP_HL,         // Highlight to left of "Manual SP"        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_MAN_SP_HL)
    {
        TUSIGN8 customChar = FrameTableGetCursorPosition() == 3 ? 0xFF : 0x00;
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, 11, 4, 0, 0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_MAN_SEN,           // "Manual Sensor"                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_MAN_SEN)
    {
        TUSIGN8  invert = FrameTableGetCursorPosition() == 4 ? STRING_INVERT : NO_INVERT;
        LOCAL_stringtable_text_id.attribIdx = IDS_MANUAL_SENSOR;
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_LEFT_WITH_INDENT_2,FONT_0,invert,0,0,EDP300_MODE_FRAME_STR_LEN,0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_MAN_SEN_HL,        // Highlight to left of "Manual Sensor"    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_MAN_SEN_HL)
    {
        TUSIGN8 customChar = FrameTableGetCursorPosition() == 4 ? 0xFF : 0x00;
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, 11, 5, 0, 0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_CONFIGURATION,     // "Configuration"                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_CONFIGURATION)
    {
        TUSIGN8  invert = FrameTableGetCursorPosition() == 5 ? STRING_INVERT : NO_INVERT;
        LOCAL_stringtable_text_id.attribIdx = IDS_CONFIG;
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_LEFT_WITH_INDENT_2,FONT_0,invert,0,0,EDP300_MODE_FRAME_STR_LEN,0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_CONFIGURATION_HL,  // Highlight to left of "Configuration"    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_CONFIGURATION_HL)
    {
        TUSIGN8 customChar = FrameTableGetCursorPosition() == 5 ? 0xFF : 0x00;
        packetsBuilt += BuildCustomCharacterString(&customChar, 1, 11, 6, 0, 0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_AUTO_ADJ_COUNT,    // Auto Adjust countdown                   | - Start of Active Area
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_AUTO_ADJ_COUNT)
    {
        TUSIGN8 countdown[2] = {0x20,0x00};
        if (FrameTableIsAutoAdjustTimerRunning())
        {
            countdown[0] = (0x30 + FrameTableAutoAdjustTimeRemaining());
        }
        packetsBuilt += BuildWriteString(countdown,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,1,JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,FONT_0,NO_INVERT,0,0,1,0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_ADAPTION_CHECK,    // "Adaption" Check Box                    |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_ADAPTION_CHECK)
    {
        if (FrameTableGetAdaptionCheck() == eTRUE)
        {
            packetsBuilt += BuildWriteArray(Radio_Checked,10,0,2,0);
        }
        else
        {
            packetsBuilt += BuildWriteArray(Radio_Unchecked,10,0,2,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_CONTROL_CHECK,     // "Control" Check Box                     |
// EDP300_MODE_FRAME_PACKET_MAN_SP_CHECK,      // "Manual SP" Check Box                   |
// EDP300_MODE_FRAME_PACKET_MAN_SEN_CHECK,     // "Manual Sensor"                         |
//---------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= EDP300_MODE_FRAME_PACKET_CONTROL_CHECK)
     && (LOCAL_packetStage <= EDP300_MODE_FRAME_PACKET_MAN_SEN_CHECK))
    {
        FrameTableGetEDP300Mode(&ControlCheck,&ManSPCheck,&ManSenCheck);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_CONTROL_CHECK,     // "Control" Check Box                     |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_CONTROL_CHECK)
    {
        if (ControlCheck)
        {
            packetsBuilt += BuildWriteArray(Radio_Checked,10,0,3,0);
        }
        else
        {
            packetsBuilt += BuildWriteArray(Radio_Unchecked,10,0,3,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_MAN_SP_CHECK,      // "Manual SP" Check Box                   |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_MAN_SP_CHECK)
    {
        if (ManSPCheck)
        {
            packetsBuilt += BuildWriteArray(Radio_Checked,10,0,4,0);
        }
        else
        {
            packetsBuilt += BuildWriteArray(Radio_Unchecked,10,0,4,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_MAN_SEN_CHECK,     // "Manual Sensor"                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_MAN_SEN_CHECK)
    {
        if (ManSenCheck)
        {
            packetsBuilt += BuildWriteArray(Radio_Checked,10,0,5,0);
        }
        else
        {
            packetsBuilt += BuildWriteArray(Radio_Unchecked,10,0,5,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_MODE_FRAME_PACKET_RIGHT_KEY,         // Right Function Key "OK"                 |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_MODE_FRAME_PACKET_RIGHT_KEY)
    {

        //===================================== =============================== ====================================== ==================
        // FrameTableIsAccessToModePermitted() | FrameTableGetCursorPosition() | FrameTableIsAutoAdjustStartAllowed() | Right Key Prompt |
        //===================================== =============================== ====================================== ==================
        //                                     |                               |       eTRUE   (Start Allowed)        |       "OK"       |
        //                                     |       0 (Auto Adjust)         |--------------------------------------|------------------|
        //                                     |                               |       eFALSE  (Start Not Allowed)    |      BLANK       |
        //                                     |-------------------------------|--------------------------------------|------------------|
        //     eTRUE  (access permitted)       |       1 (Adaption)            |                   X                  |       "OK"       |
        //                                     |       2 (Control)             |                   X                  |       "OK"       |
        //                                     |       3 (Manual SP)           |                   X                  |       "OK"       |
        //                                     |       4 (Manual Sensor)       |                   X                  |       "OK"       |
        //                                     |       5 (Configuration)       |                   X                  |       "OK"       |
        //-------------------------------------|-------------------------------|--------------------------------------|------------------|
        //     eFALSE (access not permitted)   |              X                |                   X                  |      BLANK       |
        //-------------------------------------|-------------------------------|--------------------------------------|------------------|

        if (FrameTableIsAccessToModePermitted() == eTRUE)
        {
            if (FrameTableGetCursorPosition() == 0)
            {
                if (FrameTableIsAutoAdjustStartAllowed() == eTRUE)
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_OK;
                }
                else
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
                }
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_OK;
            }
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
        }
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,1);
    }
//---------------------------------------------//-----------------------------------------|

    prvCursonPosn = FrameTableGetCursorPosition();

    return packetsBuilt;
}

TUSIGN8 BuildEDP300QuickAdjustFrame(TBOOL fromConfig)
{
typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_TITLE_BAR,     // Title Bar "---Auto Adjust----"          | - Start of Static Area
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_ICON_U,        // Icon top right (upper)                  |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_ICON_L,        // Icon top right (lower)                  |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_SCOPE,         // Scope "Control Parameters"              |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_START_ROTARY,  //                                         |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_START_LINEAR,  //                                         |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_START_ICON_UP, //                                         |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_START_ICON_DN, //                                         |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_ACTUATOR,      //                                         |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_ACTION,        //                                         |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_BLANK,         //                                         | - Start of Status Changed Area
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_BAR_RHS,       //                                         |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_STATUS,        //                                         | - Start of Active Area
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_BAR_FILL,      //                                         |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_BAR_EMPTY,     //                                         |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_RESULT,        //                                         |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_ERROR_REASON,  //                                         |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_RIGHT_KEY,     // Right Function Key                      |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_LEFT_KEY,      // Left Function Key "Back"                |
                                                //-----------------------------------------|
    EDP300_QUICKADJ_FRAME_PACKET_READ_SWITCHES  //                                         |
                                                //-----------------------------------------| there is no keypress area
}EDP300_QUICKADJ_FRAME_PACKET;

    static  TUSIGN8 prevStatus = 0;
    static  TUSIGN8 prevErrorReason = 0;
    TUSIGN8 currStatus = FrameTableGetAutoAdjustStatus();

    TUSIGN8 packetsBuilt = 0;

    if (currStatus < 8)
    {
        prevErrorReason = 0;
    }

    if (LOCAL_updateStaticArea)
    {
            LOCAL_packetStage = EDP300_QUICKADJ_FRAME_PACKET_TITLE_BAR;
    }
    else if ((LOCAL_packetStage > EDP300_QUICKADJ_FRAME_PACKET_BLANK)
          && (currStatus != prevStatus))
    {
        LOCAL_packetStage = EDP300_QUICKADJ_FRAME_PACKET_BLANK;
    }
    else if ((LOCAL_packetStage > EDP300_QUICKADJ_FRAME_PACKET_STATUS)
          && (LOCAL_updateActiveArea))
    {
        LOCAL_packetStage = EDP300_QUICKADJ_FRAME_PACKET_STATUS;
    }
    else
    {
        asm("nop");
    }

    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = EDP300_QUICKADJ_FRAME_PACKET_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_TITLE_BAR,     // Title Bar "---Auto Adjust----"          |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_AUTO_ADJUST;
        packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_ICON_U,        // Icon top right (upper)                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_ICON_U)
    {
        packetsBuilt += BuildWriteArray(QuickAdjIcon_U,13,MAX_COMMON_HMI_WIDTH-13,0,0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_ICON_L,        // Icon top right (lower)                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_ICON_L)
    {
        packetsBuilt += BuildWriteArray(QuickAdjIcon_L,13,MAX_COMMON_HMI_WIDTH-13,1,0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_SCOPE,         // Scope "Control Parameters"              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_SCOPE)
    {
        switch (FrameTableGetAutoAdjustScope())
        {
        case 0:     LOCAL_stringtable_text_id.attribIdx = IDS_FULL_AUTO_ADJUST;     break;
        case 1:     LOCAL_stringtable_text_id.attribIdx = IDS_CONTROL_PARAMETERS;   break;
        case 2:     LOCAL_stringtable_text_id.attribIdx = IDS_VALVE_RANGE;          break;
        case 3:     LOCAL_stringtable_text_id.attribIdx = IDS_ZERO_POSITION;        break;
        case 4:     LOCAL_stringtable_text_id.attribIdx = IDS_ADJUSTMENT_LOCKED;    break;
        default:    LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;                break;
        }
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_CENTRE,FONT_0,NO_INVERT,0,0,EDP300_SCOPE_STR_LEN,0);
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_START_ROTARY,  //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_START_ROTARY)
    {
        if ((currStatus == 0) && (fromConfig == eFALSE))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_ROTARY;
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_LEFT_WITH_INDENT_6,FONT_0,NO_INVERT,0,0,0,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_START_LINEAR,  //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_START_LINEAR)
    {
        if ((currStatus == 0) && (fromConfig == eFALSE))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_LINEAR;
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_LEFT_WITH_INDENT_6,FONT_0,NO_INVERT,0,0,0,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_START_ICON_UP, //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_START_ICON_UP)
    {
        if ((currStatus == 0) && (fromConfig == eFALSE))
        {
            packetsBuilt += BuildWriteArray(QuickAdjIcon_UP_Key,9,25,4,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_START_ICON_DN, //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_START_ICON_DN)
    {
        if ((currStatus == 0) && (fromConfig == eFALSE))
        {
            packetsBuilt += BuildWriteArray(QuickAdjIcon_DN_Key,9,25,5,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_ACTUATOR,      //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_ACTUATOR)
    {
        if ((currStatus == 0) && (fromConfig == eTRUE))
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableIsActuatorRotary() ? IDS_ROTARY : IDS_LINEAR;
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_CENTRE,FONT_0,NO_INVERT,0,0,0,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_ACTION,        //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_ACTION)
    {
        if ((currStatus == 0) && (fromConfig == eTRUE))
        {
            LOCAL_stringtable_text_id.attribIdx = FrameTableModeIsExhaustPosition0() ? IDS_0pc_POSITION : IDS_100pc_POSITION;
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,5,JUSTIFY_CENTRE,FONT_0,NO_INVERT,0,0,0,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_BLANK,         //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_BLANK)
    {
        if ((currStatus != prevStatus) && ((currStatus == 8) || (currStatus == 9)))
        {
            packetsBuilt += BuildBlankArea(4,6,0);
        }
        else if ((currStatus != prevStatus) && (currStatus != 0))
        {
            packetsBuilt += BuildBlankArea(4,4,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_BAR_RHS,       //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_BAR_RHS)
    {
        if ((currStatus > 0) && (currStatus < 8))
        {
            TUSIGN8 customChar = 0xFF;
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, 113, 5, 0, 0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_STATUS,        //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_STATUS)
    {
        switch (currStatus)
        {
//      case 1:     LOCAL_stringtable_text_id.attribIdx = IDS_EXHAUST;          break;  /* auto adjustment is searching for exhaust end limit */
//      case 2:     LOCAL_stringtable_text_id.attribIdx = IDS_VENTILATE;        break;  /* auto adjustment is searching for ventilate end limit */

        case 1:     LOCAL_stringtable_text_id.attribIdx = IDS_VENTILATE;        break;  /* auto adjustment is searching for ventilate end limit */
        case 2:     LOCAL_stringtable_text_id.attribIdx = IDS_PRESSURIZE;       break;  /* auto adjustment is searching for pressurization end limit */
        case 3:     LOCAL_stringtable_text_id.attribIdx = IDS_TIMER;            break;  /* auto adjustment is preparing time */
        case 4:     LOCAL_stringtable_text_id.attribIdx = IDS_TIMER_DN;         break;  /* auto adjustment is measuring time */
        case 5:     LOCAL_stringtable_text_id.attribIdx = IDS_TIMER_UP;         break;  /* auto adjustment is measuring time */
        case 6:     LOCAL_stringtable_text_id.attribIdx = IDS_IP_CONVERTER;     break;  /* auto adjustment of ip-converter */
        case 7:     LOCAL_stringtable_text_id.attribIdx = IDS_CONTROLLER;       break;  /* auto adjustment of controller */
        default:    LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;            break;  /* none of the above */
        }

        if (LOCAL_stringtable_text_id.attribIdx == IDS_BLANK)
        {
            LOCAL_packetStage ++;
        }
        else
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_LEFT_WITH_INDENT_2,FONT_0,NO_INVERT,0,0,0,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_BAR_FILL,      //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_BAR_FILL)
    {
        if ((currStatus > 0) && (currStatus < 8))
        {
            TUSIGN8 customChar = 0xFF;
            TUSIGN8 pc = FrameTableGetAutoAdjustPercentComplete();
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, 12, 5, pc, 0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_BAR_EMPTY,      //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_BAR_EMPTY)
    {
        if ((currStatus > 0) && (currStatus < 8))
        {
            TUSIGN8 customChar = 0x81;
            TUSIGN8 pc = FrameTableGetAutoAdjustPercentComplete();
            packetsBuilt += BuildCustomCharacterString(&customChar, 1, (TUSIGN8)(13 + pc), 5, (TUSIGN8)(99-pc), 0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_RESULT,        //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_RESULT)
    {

        if ((currStatus == 8) && (prevStatus != 8))         //auto adjustement procedure finished (SUCCESSFUL)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_AUTO_ADJUST_COMLPETE;
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_CENTRE,FONT_1,NO_INVERT,0,1,0,0);
        }
        else if ((currStatus == 9) && (prevStatus != 9))    //auto adjustement procedure stopped (UNSUCCESSFUL)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_AUTO_ADJUST_FAILED;
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_CENTRE,FONT_1,STRING_INVERT,0,1,0,0);
        }
        else                                                // auto adjustment inactive or running
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_ERROR_REASON,  //                                         |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_ERROR_REASON)
    {
        TBOOL ErrorReasonValid = eFALSE;
        if (currStatus == 9)   //auto adjustement procedure stopped (UNSUCCESSFUL)
        {
            TUSIGN8 ErrorReason = FrameTableGetAutoAdjustErrorReason();

            if (ErrorReason != prevErrorReason)
            {
                ErrorReasonValid = eTRUE;
                switch (ErrorReason)
                {
                case 11:    LOCAL_stringtable_text_id.attribIdx = IDS_FAILSAFE;             break;  // IP in fail safe
                case 10:    LOCAL_stringtable_text_id.attribIdx = IDS_ADJUSTMENT_LOCKED;    break;  // auto adjustment is locked
                case 9:     LOCAL_stringtable_text_id.attribIdx = IDS_CONTROL_PARAM_ERROR;  break;  // found invalid controller parameter
                case 8:     LOCAL_stringtable_text_id.attribIdx = IDS_IP_CONVERTER_ERROR;   break;  // error during ip converter adjustment
                case 7:     LOCAL_stringtable_text_id.attribIdx = IDS_NO_MOVEMENT;          break;  // valve does not move
                case 6:     LOCAL_stringtable_text_id.attribIdx = IDS_SENSOR_ERROR;         break;  // auto adjustement err sensor
                case 5:     LOCAL_stringtable_text_id.attribIdx = IDS_TIMEOUT;              break;  // auto adjustement timeout error
                case 4:     LOCAL_stringtable_text_id.attribIdx = IDS_OUT_OF_RANGE;         break;  // auto adjustment error out of range
                case 3:     LOCAL_stringtable_text_id.attribIdx = IDS_SPAN_TOO_SMALL;       break;  // auto adjustement error span too small
                case 2:     LOCAL_stringtable_text_id.attribIdx = IDS_TERMINATED;           break;  // auto adjustment was terminated
                case 1:     LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;                break;  // auto adjustment error not specified
                default:    ErrorReasonValid = eFALSE;                                      break;
                }
                prevErrorReason = ErrorReason;
            }
        }

        if (ErrorReasonValid)
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_CENTRE,FONT_0,STRING_INVERT,0,1,0,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_RIGHT_KEY,     // Right Function Key                      |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_RIGHT_KEY)
    {
        if (fromConfig)
        {
            if ((FrameTableIsAutoAdjustStartAllowed()) && (currStatus == 0))    // if "START" allowed and not already started
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_START;                // then display "START"
            }
            else
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;                // else blank key function
            }
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,9,0);
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// EDP300_QUICKADJ_FRAME_PACKET_LEFT_KEY,      // Left Function Key "Back"                |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == EDP300_QUICKADJ_FRAME_PACKET_LEFT_KEY)
    {
        if ((currStatus > 0) && (currStatus < 8))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_ABORT;
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_EXIT;

            #ifdef HMI_SUPPORTS_SEQUENCES
            if (FrameTableIsSequenceEnabled())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            }
            #endif

            #ifdef HMI_SUPPORTS_EASYSETUP
            if (fromConfig)
            {
                if (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.easySetupFlag != 0)
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
                }
            }
            #endif
        }
        packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,1);
    }
//---------------------------------------------//-----------------------------------------|

    prevStatus = currStatus;

    return packetsBuilt;
}
#endif //#ifdef EDP300_SPECIAL_FEATURES_HMI

#ifdef HMI_SUPPORTS_MANUAL_VALVE_CAL

TUSIGN8 BuildEDP300ManualValveCalFrame(void)
{
typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
                                                // Primary Variable Value                  |
                                                //-----------------------------------------|
                                                // Right Function Key                      |
                                                //-----------------------------------------|
    MAN_VALVE_CAL_FRAME_TITLE_BAR,              // Title Bar                               | - Start of Static Area
                                                //-----------------------------------------|
    MAN_VALVE_CAL_FRAME_ICON_U,                 // Icon top right (upper)                  |
                                                //-----------------------------------------|
    MAN_VALVE_CAL_FRAME_ICON_L,                 // Icon top right (lower)                  |
                                                //-----------------------------------------|
    MAN_VALVE_CAL_FRAME_RESULT_1,               // 1st Result    <ID><Value><Units>        | - Start of Active area
                                                //-----------------------------------------|
    MAN_VALVE_CAL_FRAME_RESULT_2,               // 2nd Result    <ID><Value><Units>        |
                                                //-----------------------------------------|
    MAN_VALVE_CAL_FRAME_FAILURE,                // Calibration Failure Message             |
                                                //-----------------------------------------|
    MAN_VALVE_CAL_FRAME_SUCCESS,                // Calibration Successful Message          |
                                                //-----------------------------------------|
    MAN_VALVE_CAL_FRAME_LEFT_KEY,               // Left Function Key "Cancel"              |
                                                //-----------------------------------------|
    MAN_VALVE_CAL_FRAME_READ_SWITCHES           //                                         | - There is no Keypress area
                                                //-----------------------------------------|
}MAN_VALVE_CAL_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;

//  TUSIGN8 startPacketStage = LOCAL_packetStage;

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = MAN_VALVE_CAL_FRAME_TITLE_BAR;
    }
    else if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > MAN_VALVE_CAL_FRAME_RESULT_1))
    {
        LOCAL_packetStage = MAN_VALVE_CAL_FRAME_RESULT_1;
    }
    else
    {
        asm("nop");
    }


    TUSIGN8 CalibrationStatus = 0;
    TFLOAT tempStatus;
    if (AdjusterGetAttribute((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx,
                             (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_objidx,
                             (TUSIGN8) LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_attribidx,
                             (void FAST *)&tempStatus) == (TUSIGN16)OK)
    {
        CalibrationStatus = (TUSIGN8)tempStatus;
    }
    else
    {
        CalibrationStatus = HMI_VALVE_CAL_STATUS_INACTIVE;
    }

    TUSIGN8  PrimarySignal = 0xFF;
    TUSIGN8  ResultSignal_1 = 0xFF;
    TUSIGN8  ResultSignal_2 = 0xFF;
    TUSIGN8  nSignalsFound = 0;

    SIGNAL_TABLE_TYPE const *pSignal;
    TUSIGN8 i = 0;

    while ((nSignalsFound < 3) && (i < MAX_SIGNALS))
    {
        pSignal = FrameTableGetSignal(i);

        if ((pSignal->value.ssIdx  == (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.value_ssIdx)
         && (pSignal->value.objIdx == (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_objidx))
        {
            if ((PrimarySignal == 0xFF)
             && (pSignal->value.attribIdx == LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_attribidx + 1))
            {
                PrimarySignal = i;
                nSignalsFound ++;
            }

            if ((ResultSignal_1 == 0xFF) && (pSignal->value.attribIdx == LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_attribidx + 2))
            {
                ResultSignal_1 = i;
                nSignalsFound ++;
            }

            if ((ResultSignal_2 == 0xFF) && (pSignal->value.attribIdx == LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.dispvalue_attribidx + 3))
            {
                ResultSignal_2 = i;
                nSignalsFound ++;
            }
        }
        i ++;
    }

    if (!LOCAL_updateStaticArea)
    {
        TUSIGN8 tempPacketStage = LOCAL_packetStage;
        //-------------------------------------//-----------------------------------------|
        //                                     // Primary Variable Value                  |
        //-------------------------------------//-----------------------------------------|
        if (PrimarySignal != 0xFF)
        {
            TUSIGN8 PrimaryVariableText[22];

            PacketManagerBuilderServices_buildSignalText(PrimaryVariableText, PrimarySignal, eTRUE);
            packetsBuilt += BuildWriteString(PrimaryVariableText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 2, JUSTIFY_LEFT, FONT_1, NO_INVERT, 0, 0, FONT2_MAX_CHARS, 0);
        }
        else
        {
            packetsBuilt += BuildBlankArea(2,3,0);
        }

        //-------------------------------------//-----------------------------------------|
        //                                     // Right Function Key                      |
        //-------------------------------------//-----------------------------------------|
        if (CalibrationStatus == HMI_VALVE_CAL_STATUS_INACTIVE)
        {
            if ((LOCAL_SwitchPressedCode == KEYSTATE_UP) && (CalibrationStatus == HMI_VALVE_CAL_STATUS_INACTIVE))
            {
                packetsBuilt += BuildCustomCharacterString(FastIncAvailable_Icon, SMALL_ICON_WIDTH, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH, 7, 0, 0);
            }
            else if ((LOCAL_SwitchPressedCode == (KEYSTATE_UP | KEYSTATE_RIGHT)) && (CalibrationStatus == HMI_VALVE_CAL_STATUS_INACTIVE))
            {
                packetsBuilt += BuildCustomCharacterString(FastIncActive_Icon, SMALL_ICON_WIDTH, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH, 7, 0, 0);
            }
            else if ((LOCAL_SwitchPressedCode == KEYSTATE_DOWN) && (CalibrationStatus == HMI_VALVE_CAL_STATUS_INACTIVE))
            {
                packetsBuilt += BuildCustomCharacterString(FastDecAvailable_Icon, SMALL_ICON_WIDTH, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH, 7, 0, 0);
            }
            else if ((LOCAL_SwitchPressedCode == (KEYSTATE_DOWN | KEYSTATE_RIGHT)) && (CalibrationStatus == HMI_VALVE_CAL_STATUS_INACTIVE))
            {
                packetsBuilt += BuildCustomCharacterString(FastDecActive_Icon, SMALL_ICON_WIDTH, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH, 7, 0, 0);
            }
            else
            {
                if (CalibrationStatus == HMI_VALVE_CAL_STATUS_INACTIVE)
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_OK;
                }
                else
                {
                    LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
                }
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,3,0);
            }
        }
        LOCAL_packetStage = tempPacketStage;
    }

    if (LOCAL_packetStage == MAN_VALVE_CAL_FRAME_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = MAN_VALVE_CAL_FRAME_READ_SWITCHES;
    }

//---------------------------------------------//-----------------------------------------|
// MAN_VALVE_CAL_FRAME_TITLE_BAR,              // Title Bar                               |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_VALVE_CAL_FRAME_TITLE_BAR)
    {
        LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.title;
        #if MAX_STRINGS > 255
        LOCAL_stringtable_text_id.attribIdx += ((TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.title_HighByte * 256);
        #endif

        packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
    }
//---------------------------------------------//-----------------------------------------|
// MAN_VALVE_CAL_FRAME_ICON_U,                 // Icon top right (upper)                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_VALVE_CAL_FRAME_ICON_U)
    {
        packetsBuilt += BuildWriteIcon(ICON_ADJUST_EDIT1, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
    }
//---------------------------------------------//-----------------------------------------|
// MAN_VALVE_CAL_FRAME_ICON_L,                 // Icon top right (lower)                  |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_VALVE_CAL_FRAME_ICON_L)
    {
        packetsBuilt += BuildWriteIcon(ICON_ADJUST_EDIT2, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 1, 0);
    }
//---------------------------------------------//-----------------------------------------|
// MAN_VALVE_CAL_FRAME_RESULT_1,               // 1st Result    <ID><Value><Units>        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_VALVE_CAL_FRAME_RESULT_1)
    {
        if ((CalibrationStatus == HMI_VALVE_CAL_STATUS_INACTIVE) || (CalibrationStatus == HMI_VALVE_CAL_STATUS_SUCCESSFUL))
        {
            if (ResultSignal_1 != 0xFF)
            {
                TUSIGN8 ResultText[22];
                PacketManagerBuilderServices_buildSignalText(ResultText, ResultSignal_1, eTRUE);
                packetsBuilt += BuildWriteString(ResultText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 4, JUSTIFY_LEFT, FONT_0, NO_INVERT, 0, 0, FONT1_MAX_CHARS, 0);
            }
            else
            {
                packetsBuilt += BuildBlankArea(4,4,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// MAN_VALVE_CAL_FRAME_RESULT_2,               // 2nd Result    <ID><Value><Units>        |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_VALVE_CAL_FRAME_RESULT_2)
    {
        if ((CalibrationStatus == HMI_VALVE_CAL_STATUS_INACTIVE) || (CalibrationStatus == HMI_VALVE_CAL_STATUS_SUCCESSFUL))
        {
            if (ResultSignal_2 != 0xFF)
            {
                TUSIGN8 ResultText[22];
                PacketManagerBuilderServices_buildSignalText(ResultText, ResultSignal_2, eTRUE);
                packetsBuilt += BuildWriteString(ResultText, HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE, 5, JUSTIFY_LEFT, FONT_0, NO_INVERT, 0, 0, FONT1_MAX_CHARS, 0);
            }
            else
            {
                packetsBuilt += BuildBlankArea(5,5,0);
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//---------------------------------------------//-----------------------------------------|
// MAN_VALVE_CAL_FRAME_FAILURE,                // Calibration Failure Message             |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_VALVE_CAL_FRAME_FAILURE)
    {
        if ((CalibrationStatus == HMI_VALVE_CAL_STATUS_INACTIVE) || (CalibrationStatus == HMI_VALVE_CAL_STATUS_SUCCESSFUL))
        {
            LOCAL_packetStage ++;
        }
        else
        {
            #ifdef EDP300_SPECIAL_FEATURES_HMI
            switch (CalibrationStatus)
            {
            case HMI_VALVE_CAL_STATUS_FAIL_SPAN_TOO_SMALL:  LOCAL_stringtable_text_id.attribIdx = IDS_SPAN_TOO_SMALL;       break;
            case HMI_VALVE_CAL_STATUS_FAIL_RANGE_ERROR:     LOCAL_stringtable_text_id.attribIdx = IDS_RANGE_ERROR;          break;
            case HMI_VALVE_CAL_STATUS_FAIL_SENSOR_ERROR:    LOCAL_stringtable_text_id.attribIdx = IDS_SENSOR_ERROR;         break;
            default:                                        LOCAL_stringtable_text_id.attribIdx = IDS_CALIBRATION_FAILED;   break;
            }
            #else
            LOCAL_stringtable_text_id.attribIdx = IDS_CALIBRATION_FAILED;
            #endif

            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,4,JUSTIFY_CENTRE,FONT_1,STRING_INVERT,0,0,FONT2_MAX_CHARS,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// MAN_VALVE_CAL_FRAME_SUCCESS,                // Calibration Successful Message          |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_VALVE_CAL_FRAME_SUCCESS)
    {
        if (CalibrationStatus == HMI_VALVE_CAL_STATUS_SUCCESSFUL)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_CALIBRATION_COMPLETE;
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,6,JUSTIFY_CENTRE,FONT_0,NO_INVERT,0,0,FONT1_MAX_CHARS,0);
        }
        else
        {
            packetsBuilt += BuildBlankArea(6,6,0);
        }
    }
//---------------------------------------------//-----------------------------------------|
// MAN_VALVE_CAL_FRAME_LEFT_KEY,               // Left Function Key "Cancel"              |
//---------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MAN_VALVE_CAL_FRAME_LEFT_KEY)
    {
        #ifdef HMI_SUPPORTS_SEQUENCES
        if (FrameTableIsSequenceEnabled())
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
        }
        else
        #endif
        {
            #ifdef HMI_SUPPORTS_EASYSETUP
            if (LOCAL_pCurrDisplayFrame->frameDefinition.adjParamFrame.easySetupFlag != 0)
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            }
            else
            #endif
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_BACK;
            }
        }

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,1);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,1);
        }
    }
//---------------------------------------------//-----------------------------------------|
    return packetsBuilt;
}
#endif //#ifdef HMI_SUPPORTS_MANUAL_VALVE_CAL

#ifdef HMI_SUPPORTS_WAVEFORM_FRAMES
const TUSIGN8 unitsPattern_None[UNITS_1_FIELD_WIDTH] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
const TUSIGN8 unitsPattern_ft[UNITS_1_FIELD_WIDTH]   = {0x00, 0x00, 0x08, 0x7C, 0x0A, 0x02, 0x00, 0x3E, 0x48, 0x48, 0x20, 0x00};
const TUSIGN8 unitsPattern_in[UNITS_1_FIELD_WIDTH]   = {0x00, 0x00, 0x48, 0x7A, 0x40, 0x00, 0x78, 0x10, 0x08, 0x08, 0x70, 0x00};
const TUSIGN8 unitsPattern_m[UNITS_1_FIELD_WIDTH]    = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3C, 0x04, 0x08, 0x04, 0x38, 0x00};
const TUSIGN8 unitsPattern_cm[UNITS_1_FIELD_WIDTH]   = {0x18, 0x24, 0x24, 0x24, 0x10, 0x00, 0x3C, 0x04, 0x08, 0x04, 0x38, 0x00};
const TUSIGN8 unitsPattern_mm[UNITS_1_FIELD_WIDTH]   = {0x3C, 0x04, 0x08, 0x04, 0x38, 0x00, 0x3C, 0x04, 0x08, 0x04, 0x38, 0x00};

const TUSIGN8 unitsPattern_PerDiv[UNITS_2_FIELD_WIDTH]   = {0x20, 0x10, 0x08, 0x04, 0x02, 0x7C, 0x44, 0x44, 0x38, 0x00, 0x44, 0x7C, 0x44, 0x00, 0x3C, 0x40, 0x3C, 0x00};

TUSIGN8 BuildWaveformFrame(void)
{
typedef enum
{                                               // Packet                                  |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_BLANK_AREA,                  // Blank entire display                    | - Start of Static Area
                                                //=========================================|
    WAVEFORM_FRAME_PLOT_0_0,                    // Plot area - Column 0, Row 0             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_0_1,                    // Plot area - Column 0, Row 1             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_0_2,                    // Plot area - Column 0, Row 2             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_0_3,                    // Plot area - Column 0, Row 3             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_0_4,                    // Plot area - Column 0, Row 4             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_0_5,                    // Plot area - Column 0, Row 5             |
                                                //=========================================|
    WAVEFORM_FRAME_PLOT_1_0,                    // Plot area - Column 1, Row 0             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_1_1,                    // Plot area - Column 1, Row 1             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_1_2,                    // Plot area - Column 1, Row 2             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_1_3,                    // Plot area - Column 1, Row 3             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_1_4,                    // Plot area - Column 1, Row 4             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_1_5,                    // Plot area - Column 1, Row 5             |
                                                //=========================================|
    WAVEFORM_FRAME_PLOT_2_0,                    // Plot area - Column 2, Row 0             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_2_1,                    // Plot area - Column 2, Row 1             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_2_2,                    // Plot area - Column 2, Row 2             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_2_3,                    // Plot area - Column 2, Row 3             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_2_4,                    // Plot area - Column 2, Row 4             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_2_5,                    // Plot area - Column 2, Row 5             |
                                                //=========================================|
    WAVEFORM_FRAME_PLOT_3_0,                    // Plot area - Column 3, Row 0             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_3_1,                    // Plot area - Column 3, Row 1             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_3_2,                    // Plot area - Column 3, Row 2             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_3_3,                    // Plot area - Column 3, Row 3             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_3_4,                    // Plot area - Column 3, Row 4             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_3_5,                    // Plot area - Column 3, Row 5             |
                                                //=========================================|
    WAVEFORM_FRAME_PLOT_4_0,                    // Plot area - Column 4, Row 0             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_4_1,                    // Plot area - Column 4, Row 1             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_4_2,                    // Plot area - Column 4, Row 2             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_4_3,                    // Plot area - Column 4, Row 3             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_4_4,                    // Plot area - Column 4, Row 4             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PLOT_4_5,                    // Plot area - Column 4, Row 5             |
                                                //=========================================|
    WAVEFORM_FRAME_NEG_RANGE_UPPER,             //                                         |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_NEG_RANGE_LOWER,             //                                         |
                                                //=========================================|
    WAVEFORM_FRAME_H_OFFSET_LEFT_HIGHLIGHT,     // Highlight to left of H_OFFSET           |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_H_OFFSET,                    // Horizontal offset Value                 |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_H_OFFSET_UNITS,              // Horizontal offset units                 |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_H_WIDTH_LEFT_HIGHLIGHT,      // Highlight to left of H_WIDTH            |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_H_WIDTH,                     // Horizontal Width Value                  |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_H_WIDTH_UNITS_1,             // Horizontal Width units (mm, cm etc)     |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_H_WIDTH_UNITS_2,             // Horizontal Width units (/DIV)           |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PRV_ID_LEFT_HIGHLIGHT,       // Highlight to left of PRV_ID             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PRV_ID,                      // Process Related Value Identifier        |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_PRV,                         // Process Related Value                   |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_CRV_ID_LEFT_HIGHLIGHT,       // Highlight to left of CRV_ID             |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_CRV_ID,                      // Configuration Related Value Identifier  |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_CRV,                         // Configuration Related Value             |
                                                //=========================================|
    WAVEFORM_FRAME_CRV_EDIT_ICON,               // Title Bar Icon                          |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_CRV_EDIT_UNITS,              // Engineering Units                       |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_CRV_EDIT_MAX,                // High Limit                              |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_CRV_EDIT_MIN,                // Low Limit                               |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_CRV_EDIT_MAX_ICON,           // High Limit icon or text                 |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_CRV_EDIT_MIN_ICON,           // Low Limit icon or text                  |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_CRV_EDIT_VALUE,              // Parameter value                         |
                                                //=========================================|
    WAVEFORM_FRAME_RIGHT_KEY,                   //                                         |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_LEFT_KEY,                    //                                         |
                                                //-----------------------------------------|
    WAVEFORM_FRAME_READ_SWITCHES                //                                         |
                                                //-----------------------------------------|

}WAVEFORM_FRAME_PACKET;

    TUSIGN8 packetsBuilt = 0;
    TUSIGN8 waveformIndex = LOCAL_pCurrDisplayFrame->frameDefinition.waveformFrame.waveformIndex;

    TUSIGN16 waveformSubsystem = (TUSIGN16)(LOCAL_pCurrDisplayFrame->frameDefinition.waveformFrame.waveformSubsystemIdx);
    const T_WAVEFORM *pWav = (T_WAVEFORM*)(GetSubsystemPtr(waveformSubsystem));
    TBOOL DataValid = eFALSE;

    TUSIGN8 PlotDistanceUnits = pWav->GetU8Data(HMI_WAVEFORM_PLOT_DISTANCE_UNITS_U8, &DataValid);
    if (!DataValid) {PlotDistanceUnits = HMI_WAVEFORM_PLOT_DISTANCE_NO_UNITS;}

    ADJUST_DATA tVal, tHigh, tLow, tInc;
    TUSIGN8 tType;
    TUSIGN8 LimitError = 0;
    TUSIGN16 errorCode;

    TBOOL rulesAreActive;

    tHigh.data_F = 0.0F;
    tLow.data_F = 0.0F;
    #ifdef HMI_USES_DOUBLE
    tHigh.data_D = 0.0;
    tLow.data_D = 0.0;
    #endif


    WAVEFORM_CURSOR_POS WaveformCursorPos = FrameTable_GetWaveformCursor(waveformIndex);
    TBOOL WaveformCursorChanged = FrameTable_IsWaveformCursorChanged(waveformIndex);

    if (FrameTable_IsWaveformEditStateChanged(waveformIndex))
    {
        LOCAL_updateStaticArea = eTRUE;
        FrameTable_AcknowledgeWaveformEditStateChange(waveformIndex);
    }

    const SIGNAL_TABLE_TYPE *pPRVsignal;
    const SIGNAL_TABLE_TYPE *pCRVsignal;

    if (LOCAL_updateStaticArea)
    {
        LOCAL_packetStage = WAVEFORM_FRAME_BLANK_AREA;
    }

    if (WaveformCursorPos == WAVEFORM_CURSOR_CFG_REL_VAL_EDIT)
    {
        if (LOCAL_updateActiveArea)
        {
            if (LOCAL_packetStage > WAVEFORM_FRAME_CRV_EDIT_UNITS)
            {
                LOCAL_packetStage = WAVEFORM_FRAME_CRV_EDIT_UNITS;
            }
        }

        if (LOCAL_keypressProcessed)
        {
            if (LOCAL_packetStage > WAVEFORM_FRAME_CRV_EDIT_MAX)
            {
                LOCAL_packetStage = WAVEFORM_FRAME_CRV_EDIT_MAX;
            }
        }

        if (LOCAL_packetStage >= WAVEFORM_FRAME_READ_SWITCHES)
        {
            LOCAL_packetStage = WAVEFORM_FRAME_READ_SWITCHES;
        }
    }
    else
    {
        // Whilst the waveform is being displayed the entire display is active however the "LOCAL_updateActiveArea" flag is not
        // tested because there is the risk that the there may not be time to update the entire display in the 1 second period.
        // Instead "LOCAL_packetStage" is reset back to "WAVEFORM_FRAME_PLOT_0_0" once it reaches "WAVEFORM_FRAME_READ_SWITCHES"
        //
        // if (LOCAL_updateActiveArea)
        // {
        //     if (LOCAL_packetStage > WAVEFORM_FRAME_H_OFFSET_LEFT_HIGHLIGHT)
        //     {
        //         LOCAL_packetStage = WAVEFORM_FRAME_H_OFFSET_LEFT_HIGHLIGHT;
        //     }
        // }

        if (LOCAL_keypressProcessed)
        {
            if (FrameTable_IsWaveformCursorChanged(waveformIndex) == eFALSE)
            {
                if (LOCAL_packetStage > WAVEFORM_FRAME_PLOT_0_0)
                {
                    LOCAL_packetStage = WAVEFORM_FRAME_PLOT_0_0;
                }
            }
            else
            {
                if (LOCAL_packetStage > WAVEFORM_FRAME_H_OFFSET_LEFT_HIGHLIGHT)
                {
                    LOCAL_packetStage = WAVEFORM_FRAME_H_OFFSET_LEFT_HIGHLIGHT;
                }
            }
        }

        if (LOCAL_packetStage >= WAVEFORM_FRAME_READ_SWITCHES)
        {
            LOCAL_packetStage = WAVEFORM_FRAME_PLOT_0_0;        // Autiomatically restart at beginning -
        }
    }


    TUSIGN8 V_ScaleFieldHigh[V_SCALE_FIELD_WIDTH];
    TUSIGN8 V_ScaleFieldLow[V_SCALE_FIELD_WIDTH];
    TUSIGN8 zeroPosn;

    if (LOCAL_packetStage != WAVEFORM_FRAME_READ_SWITCHES)
    {
        TBOOL HighValid, LowValid, DPValid;

        TFLOAT  V_ScaleRangeHigh = pWav->GetFloatData(HMI_WAVEFORM_V_SCALE_RANGE_HIGH_FLOAT, &HighValid);
        TFLOAT  V_ScaleRangeLow = pWav->GetFloatData(HMI_WAVEFORM_V_SCALE_RANGE_LOW_FLOAT, &LowValid);
        TUSIGN8 V_ScaleRangeDP = pWav->GetU8Data(HMI_WAVEFORM_V_SCALE_RANGE_DP_U8, &DPValid);

        if ((HighValid) && (LowValid) && (DPValid))
        {
            Set_NumericField(V_ScaleRangeHigh,V_ScaleRangeDP, V_ScaleFieldHigh, V_SCALE_FIELD_WIDTH, eTRUE);
            Set_NumericField(V_ScaleRangeLow, V_ScaleRangeDP, V_ScaleFieldLow,  V_SCALE_FIELD_WIDTH, eTRUE);
            zeroPosn = (TUSIGN8)((((0 - V_ScaleRangeLow) * 45) / (V_ScaleRangeHigh - V_ScaleRangeLow)) + 0.49f) + 1;
        }
        else
        {
            memset((void*)V_ScaleFieldHigh, 0x00, V_SCALE_FIELD_WIDTH);
            memset((void*)V_ScaleFieldLow, 0x00, V_SCALE_FIELD_WIDTH);
            zeroPosn = 0;
        }
    }

//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_BLANK_AREA,                  // Blank entire display                    | - Start of Static Area
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_BLANK_AREA)
    {
        if (WaveformCursorPos == WAVEFORM_CURSOR_CFG_REL_VAL_EDIT)
        {
            pCRVsignal = FrameTableGetSignal(FrameTable_GetWaveformCRVSignal(waveformIndex));
            LOCAL_stringtable_text_id.attribIdx = pCRVsignal->long_identifier;

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),MAX_ASIAN_TITLE_LEN,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
            }
        }
        else
        {
            packetsBuilt += BuildBlankArea(0,7,0);
        }
    }

//------------------------------------------------//-----------------------------------------|
//  if CRV edit selected then skip waveform packets
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= WAVEFORM_FRAME_PLOT_0_0)
     && (LOCAL_packetStage <= WAVEFORM_FRAME_CRV)
     && (WaveformCursorPos == WAVEFORM_CURSOR_CFG_REL_VAL_EDIT))
     {
        LOCAL_packetStage = WAVEFORM_FRAME_CRV + 1;
     }

//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_PLOT_0_0,                    // Plot area - Column 0, Row 0             |
//    WAVEFORM_FRAME_PLOT_0_1,                    // Plot area - Column 0, Row 1             |
//    WAVEFORM_FRAME_PLOT_0_2,                    // Plot area - Column 0, Row 2             |
//    WAVEFORM_FRAME_PLOT_0_3,                    // Plot area - Column 0, Row 3             |
//    WAVEFORM_FRAME_PLOT_0_4,                    // Plot area - Column 0, Row 4             |
//    WAVEFORM_FRAME_PLOT_0_5,                    // Plot area - Column 0, Row 5             |
//                                                                                           |
//    WAVEFORM_FRAME_PLOT_1_0,                    // Plot area - Column 1, Row 0             |
//    WAVEFORM_FRAME_PLOT_1_1,                    // Plot area - Column 1, Row 1             |
//    WAVEFORM_FRAME_PLOT_1_2,                    // Plot area - Column 1, Row 2             |
//    WAVEFORM_FRAME_PLOT_1_3,                    // Plot area - Column 1, Row 3             |
//    WAVEFORM_FRAME_PLOT_1_4,                    // Plot area - Column 1, Row 4             |
//    WAVEFORM_FRAME_PLOT_1_5,                    // Plot area - Column 1, Row 5             |
//                                                                                           |
//    WAVEFORM_FRAME_PLOT_2_0,                    // Plot area - Column 2, Row 0             |
//    WAVEFORM_FRAME_PLOT_2_1,                    // Plot area - Column 2, Row 1             |
//    WAVEFORM_FRAME_PLOT_2_2,                    // Plot area - Column 2, Row 2             |
//    WAVEFORM_FRAME_PLOT_2_3,                    // Plot area - Column 2, Row 3             |
//    WAVEFORM_FRAME_PLOT_2_4,                    // Plot area - Column 2, Row 4             |
//    WAVEFORM_FRAME_PLOT_2_5,                    // Plot area - Column 2, Row 5             |
//                                                                                           |
//    WAVEFORM_FRAME_PLOT_3_0,                    // Plot area - Column 3, Row 0             |
//    WAVEFORM_FRAME_PLOT_3_1,                    // Plot area - Column 3, Row 1             |
//    WAVEFORM_FRAME_PLOT_3_2,                    // Plot area - Column 3, Row 2             |
//    WAVEFORM_FRAME_PLOT_3_3,                    // Plot area - Column 3, Row 3             |
//    WAVEFORM_FRAME_PLOT_3_4,                    // Plot area - Column 3, Row 4             |
//    WAVEFORM_FRAME_PLOT_3_5,                    // Plot area - Column 3, Row 5             |
//                                                                                           |
//    WAVEFORM_FRAME_PLOT_4_0,                    // Plot area - Column 4, Row 0             |
//    WAVEFORM_FRAME_PLOT_4_1,                    // Plot area - Column 4, Row 1             |
//    WAVEFORM_FRAME_PLOT_4_2,                    // Plot area - Column 4, Row 2             |
//    WAVEFORM_FRAME_PLOT_4_3,                    // Plot area - Column 4, Row 3             |
//    WAVEFORM_FRAME_PLOT_4_4,                    // Plot area - Column 4, Row 4             |
//    WAVEFORM_FRAME_PLOT_4_5,                    // Plot area - Column 4, Row 5             |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= WAVEFORM_FRAME_PLOT_0_0)
     && (LOCAL_packetStage <= WAVEFORM_FRAME_PLOT_4_5))
    {
        if (WaveformCursorPos == WAVEFORM_CURSOR_CFG_REL_VAL_EDIT)
        {
            LOCAL_packetStage = WAVEFORM_FRAME_PLOT_4_5 + 1;
        }
        else
        {
            TUSIGN8 startPacket;
            TUSIGN8 row;
            TUSIGN8 column;
            TUSIGN8 PlotArea[WAVEFORM_PLOT_AREA_SIZE];

            TUSIGN8  PlotEnable_1, PlotEnable_2, PlotEnable_3;
            TUSIGN8 *PlotData_1,  *PlotData_2,  *PlotData_3;

            PlotEnable_1 = pWav->GetU8Data(HMI_WAVEFORM_PLOT_ENABLE_1_U8, &DataValid);
            if (!DataValid)     {PlotEnable_1 = 0;}
            if (PlotEnable_1)
            {
                PlotData_1 = pWav->GetAddressData(HMI_WAVEFORM_PLOT_DATA_1_ADDRESS, &DataValid);
                if (!DataValid)     {PlotEnable_1 = 0;}
            }

            PlotEnable_2 = pWav->GetU8Data(HMI_WAVEFORM_PLOT_ENABLE_2_U8, &DataValid);
            if (!DataValid)     {PlotEnable_2 = 0;}
            if (PlotEnable_2)
            {
                PlotData_2 = pWav->GetAddressData(HMI_WAVEFORM_PLOT_DATA_2_ADDRESS, &DataValid);
                if (!DataValid)     {PlotEnable_2 = 0;}
            }

            PlotEnable_3 = pWav->GetU8Data(HMI_WAVEFORM_PLOT_ENABLE_3_U8, &DataValid);
            if (!DataValid)     {PlotEnable_3 = 0;}
            if (PlotEnable_3)
            {
                PlotData_3 = pWav->GetAddressData(HMI_WAVEFORM_PLOT_DATA_3_ADDRESS, &DataValid);
                if (!DataValid)     {PlotEnable_3 = 0;}
            }

            TUSIGN8 V_ScaleRangeDiv = pWav->GetU8Data(HMI_WAVEFORM_V_SCALE_RANGE_DIV_U8, &DataValid);
            if (!DataValid) {V_ScaleRangeDiv = 0;}

            do
            {
                startPacket = LOCAL_packetStage;
                column = (LOCAL_packetStage - WAVEFORM_FRAME_PLOT_0_0) / 6;

                row = (LOCAL_packetStage - WAVEFORM_FRAME_PLOT_0_0) % 6;

                // clearPlotArea
                memset((void*)PlotArea,0x00,WAVEFORM_PLOT_AREA_SIZE);

                // Plot area contains vertical scale
                AddVerticalScale(PlotArea, row, column);

                // Plot area conrtains Major Divisions & zero Position lines
                AddMajorDivisions(PlotArea, V_ScaleRangeDiv, zeroPosn, row, column);

                // plotArea contains plots
                if (PlotEnable_1)   {AddPlots(PlotArea, PlotData_1, row, column);}
                if (PlotEnable_2)   {AddPlots(PlotArea, PlotData_2, row, column);}
                if (PlotEnable_3)   {AddPlots(PlotArea, PlotData_3, row, column);}

                if ((column == WAVEFORM_FRAME_COL_0) && (row == WAVEFORM_FRAME_ROW_0))
                {
                    // Plot area contains part of V_ScaleFieldHigh,
                    plotMerge(&PlotArea[0], &V_ScaleFieldHigh[COL_0_X_POS - V_SCALE_FIELD_X_POS], V_SCALE_FIELD_WIDTH - (COL_0_X_POS - V_SCALE_FIELD_X_POS));
                }
                if ((column == WAVEFORM_FRAME_COL_0) && (row == WAVEFORM_FRAME_ROW_5))
                {
                    // Plot area contains part of V_ScaleFieldLow,
                    plotMerge(&PlotArea[0], &V_ScaleFieldLow[COL_0_X_POS - V_SCALE_FIELD_X_POS], V_SCALE_FIELD_WIDTH - (COL_0_X_POS - V_SCALE_FIELD_X_POS));
                }

                packetsBuilt += BuildWriteArray(PlotArea,                                                   // const TUSIGN8 *array
                                                WAVEFORM_PLOT_AREA_SIZE,                                    // TUSIGN8 arraySize
                                                (TUSIGN8)(COL_0_X_POS + (column * WAVEFORM_PLOT_AREA_SIZE)),// TUSIGN8 x_pos
                                                (TUSIGN8)(row + 1),                                         // TUSIGN8 y_pos
                                                0);                                                         // TUSIGN8 lastPacket
            }
            while ((LOCAL_packetStage <= WAVEFORM_FRAME_PLOT_4_5) && (LOCAL_packetStage != startPacket));
        }
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_NEG_RANGE_UPPER,             //                                         |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_NEG_RANGE_UPPER)
    {
        packetsBuilt += BuildWriteArray(V_ScaleFieldHigh, COL_0_X_POS - V_SCALE_FIELD_X_POS, V_SCALE_FIELD_X_POS, 1, 0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_NEG_RANGE_LOWER,             //                                         |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_NEG_RANGE_LOWER)
    {
        packetsBuilt += BuildWriteArray(V_ScaleFieldLow, COL_0_X_POS - V_SCALE_FIELD_X_POS, V_SCALE_FIELD_X_POS, 6, 0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_H_OFFSET_LEFT_HIGHLIGHT      // Highlight to left of H_OFFSET           |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_H_OFFSET_LEFT_HIGHLIGHT)
    {
        TUSIGN8 highlight = WaveformCursorPos == WAVEFORM_CURSOR_H_OFFSET ? 0xFF : 0x00;
        packetsBuilt += BuildWriteArray(&highlight, 1, OFFSET_VALUE_FIELD_XPOS - 1, 7, 0);

        if (LOCAL_packetStage != WAVEFORM_FRAME_H_OFFSET_LEFT_HIGHLIGHT)
        {
            FrameTable_AcknowledgeWaveformCursorChange(waveformIndex);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_H_OFFSET,                    // Horizontal offset Value                 |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_H_OFFSET)
    {
        TUSIGN8 i;
        TUSIGN8 NumericField[OFFSET_VALUE_FIELD_WIDTH];
        TFLOAT H_ScaleOffset = pWav->GetFloatData(HMI_WAVEFORM_H_SCALE_OFFSET_FLOAT, &DataValid);
        if (!DataValid)
        {
            memset((void*)NumericField, 0x00, OFFSET_VALUE_FIELD_WIDTH);
        }
        else
        {
            TUSIGN8 offsetDP = 0;
            switch (PlotDistanceUnits)
            {
            case HMI_WAVEFORM_PLOT_DISTANCE_FEET:           offsetDP = 1;   break;
            case HMI_WAVEFORM_PLOT_DISTANCE_INCHES:         offsetDP = 0;   break;
            case HMI_WAVEFORM_PLOT_DISTANCE_METRES:         offsetDP = 2;   break;
            case HMI_WAVEFORM_PLOT_DISTANCE_CENTIMETRES:    offsetDP = 0;   break;
            case HMI_WAVEFORM_PLOT_DISTANCE_MILLIMETRES:    offsetDP = 0;   break;
            default:                                        offsetDP = 0;   break;
            }

            Set_NumericField(H_ScaleOffset,offsetDP, NumericField, OFFSET_VALUE_FIELD_WIDTH, eFALSE);
        }

        if (WaveformCursorPos == WAVEFORM_CURSOR_H_OFFSET)
        {
            for (i = 0; i < OFFSET_VALUE_FIELD_WIDTH; i ++)
            {
                NumericField[i] = ~NumericField[i];
            }
        }
        packetsBuilt += BuildWriteArray(NumericField, OFFSET_VALUE_FIELD_WIDTH, OFFSET_VALUE_FIELD_XPOS, 7, 0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_H_OFFSET_UNITS,              // Horizontal offset units                 |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_H_OFFSET_UNITS)
    {
        TUSIGN8 unitsField[OFFSET_UNITS_FIELD_WIDTH];

        switch (PlotDistanceUnits)
        {
        case HMI_WAVEFORM_PLOT_DISTANCE_FEET:           memcpy((void *)unitsField, (void const *)unitsPattern_ft, OFFSET_UNITS_FIELD_WIDTH);    break;
        case HMI_WAVEFORM_PLOT_DISTANCE_INCHES:         memcpy((void *)unitsField, (void const *)unitsPattern_in, OFFSET_UNITS_FIELD_WIDTH);    break;
        case HMI_WAVEFORM_PLOT_DISTANCE_METRES:         memcpy((void *)unitsField, (void const *)unitsPattern_m,  OFFSET_UNITS_FIELD_WIDTH);     break;
        case HMI_WAVEFORM_PLOT_DISTANCE_CENTIMETRES:    memcpy((void *)unitsField, (void const *)unitsPattern_cm, OFFSET_UNITS_FIELD_WIDTH);    break;
        case HMI_WAVEFORM_PLOT_DISTANCE_MILLIMETRES:    memcpy((void *)unitsField, (void const *)unitsPattern_mm, OFFSET_UNITS_FIELD_WIDTH);    break;
        default:                                        memset((void *)unitsField, 0x00,OFFSET_UNITS_FIELD_WIDTH);                              break;
        }

        if (WaveformCursorPos == WAVEFORM_CURSOR_H_OFFSET)
        {
            TUSIGN8 i;
            for (i = 0; i < OFFSET_UNITS_FIELD_WIDTH; i ++)
            {
                unitsField[i] = ~unitsField[i];
            }
        }
        packetsBuilt += BuildWriteArray(unitsField, OFFSET_UNITS_FIELD_WIDTH, OFFSET_UNITS_FIELD_XPOS, 7, 0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_H_WIDTH_LEFT_HIGHLIGHT       // Highlight to left of H_WIDTH            |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_H_WIDTH_LEFT_HIGHLIGHT)
    {
        TUSIGN8 highlight = WaveformCursorPos == WAVEFORM_CURSOR_H_WIDTH ? 0xFF : 0x00;
        packetsBuilt += BuildWriteArray(&highlight, 1, H_WIDTH_VALUE_FIELD_XPOS - 1, 7, 0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_H_WIDTH,                     // Horizontal Width Value                  |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_H_WIDTH)
    {
        TUSIGN8 i;
        TUSIGN8 NumericField[OFFSET_VALUE_FIELD_WIDTH];
        TFLOAT H_ScaleResn = pWav->GetFloatData(HMI_WAVEFORM_H_SCALE_RES_FLOAT, &DataValid);
        if (!DataValid)
        {
            memset((void*)NumericField, 0x00, OFFSET_VALUE_FIELD_WIDTH);
        }
        else
        {
            TUSIGN8 widthDP = 0;
            switch (PlotDistanceUnits)
            {
            case HMI_WAVEFORM_PLOT_DISTANCE_FEET:           widthDP = 1;    break;
            case HMI_WAVEFORM_PLOT_DISTANCE_INCHES:         widthDP = 0;    break;
            case HMI_WAVEFORM_PLOT_DISTANCE_METRES:         widthDP = 2;    break;
            case HMI_WAVEFORM_PLOT_DISTANCE_CENTIMETRES:    widthDP = 0;    break;
            case HMI_WAVEFORM_PLOT_DISTANCE_MILLIMETRES:    widthDP = 0;    break;
            default:                                        widthDP = 0;    break;
            }

            Set_NumericField(H_ScaleResn,widthDP, NumericField, H_WIDTH_VALUE_FIELD_WIDTH, eFALSE);
        }

        if (WaveformCursorPos == WAVEFORM_CURSOR_H_WIDTH)
        {
            for (i = 0; i < H_WIDTH_VALUE_FIELD_WIDTH; i ++)
            {
                NumericField[i] = ~NumericField[i];
            }
        }
        packetsBuilt += BuildWriteArray(NumericField, H_WIDTH_VALUE_FIELD_WIDTH, H_WIDTH_VALUE_FIELD_XPOS, 7, 0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_H_WIDTH_UNITS_1,             // Horizontal Width units (mm, cm etc)     |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_H_WIDTH_UNITS_1)
    {
        TUSIGN8 unitsField[H_WIDTH_UNITS1_FIELD_WIDTH];

        switch (PlotDistanceUnits)
        {
        case HMI_WAVEFORM_PLOT_DISTANCE_FEET:           memcpy((void *)unitsField, (void const *)unitsPattern_ft, OFFSET_UNITS_FIELD_WIDTH);    break;
        case HMI_WAVEFORM_PLOT_DISTANCE_INCHES:         memcpy((void *)unitsField, (void const *)unitsPattern_in, OFFSET_UNITS_FIELD_WIDTH);    break;
        case HMI_WAVEFORM_PLOT_DISTANCE_METRES:         memcpy((void *)unitsField, (void const *)unitsPattern_m,  OFFSET_UNITS_FIELD_WIDTH);     break;
        case HMI_WAVEFORM_PLOT_DISTANCE_CENTIMETRES:    memcpy((void *)unitsField, (void const *)unitsPattern_cm, OFFSET_UNITS_FIELD_WIDTH);    break;
        case HMI_WAVEFORM_PLOT_DISTANCE_MILLIMETRES:    memcpy((void *)unitsField, (void const *)unitsPattern_mm, OFFSET_UNITS_FIELD_WIDTH);    break;
        default:                                        memset((void *)unitsField, 0x00,OFFSET_UNITS_FIELD_WIDTH);                              break;
        }

        if (WaveformCursorPos == WAVEFORM_CURSOR_H_WIDTH)
        {
            TUSIGN8 i;
            for (i = 0; i < H_WIDTH_UNITS1_FIELD_WIDTH; i ++)
            {
                unitsField[i] = ~unitsField[i];
            }
        }
        packetsBuilt += BuildWriteArray(unitsField, H_WIDTH_UNITS1_FIELD_WIDTH, H_WIDTH_UNITS1_FIELD_XPOS, 7, 0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_H_WIDTH_UNITS_2,             // Horizontal Width units (/DIV)           |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_H_WIDTH_UNITS_2)
    {
        TUSIGN8 unitsField[H_WIDTH_UNITS2_FIELD_WIDTH];

        memcpy((void *)unitsField, (void const *)unitsPattern_PerDiv, H_WIDTH_UNITS2_FIELD_WIDTH);

        if (WaveformCursorPos == WAVEFORM_CURSOR_H_WIDTH)
        {
            TUSIGN8 i;
            for (i = 0; i < H_WIDTH_UNITS2_FIELD_WIDTH; i ++)
            {
                unitsField[i] = ~unitsField[i];
            }
        }
        packetsBuilt += BuildWriteArray(unitsField, H_WIDTH_UNITS2_FIELD_WIDTH, H_WIDTH_UNITS2_FIELD_XPOS, 7, 0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_PRV_ID_LEFT_HIGHLIGHT,       // Highlight to left of PRV_ID             |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_PRV_ID_LEFT_HIGHLIGHT)
    {
        TUSIGN8 highlight = WaveformCursorPos == WAVEFORM_CURSOR_PRC_REL_VAL ? 0xFF : 0x00;
        packetsBuilt += BuildWriteArray(&highlight, 1, PRV_ID_XPOS - 1, 0, 0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_PRV_ID,                      // Process Related Value Identifier        |
//    WAVEFORM_FRAME_PRV,                         // Process Related Value                   |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= WAVEFORM_FRAME_PRV_ID)
     && (LOCAL_packetStage <= WAVEFORM_FRAME_PRV))
    {
        pPRVsignal = FrameTableGetSignal(FrameTable_GetWaveformPRVSignal(waveformIndex));
    }

//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_PRV_ID,                      // Process Related Value Identifier        |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_PRV_ID)
    {
        LOCAL_stringtable_text_id.attribIdx = pPRVsignal->short_identifier;

        TUSIGN8 text[SIGNAL_ID_BUFFER_SIZE+1];
        memset((void*)text,0x00,SIGNAL_ID_BUFFER_SIZE+1);

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            strncpy((char *)text,(const char *)FrameTableGetStringSpecificLanguage(LOCAL_stringtable_text_id,HMI_LANGUAGE_ENGLISH),SIGNAL_ID_BUFFER_SIZE);
        }
        else
        #endif
        {
            strncpy((char *)text,(const char *)FrameTableGetString(LOCAL_stringtable_text_id),SIGNAL_ID_BUFFER_SIZE);
        }

        TUSIGN8 invert = WaveformCursorPos == WAVEFORM_CURSOR_PRC_REL_VAL ? STRING_INVERT : NO_INVERT;

        LimitTextLength(text,3);
        packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,0,PRV_ID_JUSTIFICATION,FONT_0,invert,0,0,3,0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_PRV,                         // Process Related Value                   |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_PRV)
    {
        TUSIGN16 subsysIdx = (TUSIGN16)pPRVsignal->value.ssIdx;
        TUSIGN16 objIdx    = (TUSIGN16)pPRVsignal->value.objIdx;
        TUSIGN8 attribIdx  = pPRVsignal->value.attribIdx;

        ADJUST_DATA value;
        TUSIGN8 type;

        TUSIGN8 PRV_str[8];

        // Get Process Related Value
        if (AdjusterGetFloatValue(subsysIdx, objIdx, attribIdx, &value, &type) == (TUSIGN16)OK)
        {
            TUSIGN8 *pNumber;
            TUSIGN8 negNumber;
            TUSIGN8 within_over_under;

            #ifdef HMI_USES_DOUBLE
            if (type == ST_DOUBLE)
            {
                pNumber = AdjusterBuildNumberStringFromDouble(value.data_D, 6, pPRVsignal->dpPosn, &negNumber, &within_over_under);
            }
            else
            #endif
            {
                pNumber = AdjusterBuildNumberString(value.data_F, 6, pPRVsignal->dpPosn, &negNumber, &within_over_under);
            }

            if ((within_over_under == 1) || (within_over_under == 2))
            {
                // overrange or underrange
                PRV_str[0] = 0x20;
                PRV_str[1] = 0x05 + within_over_under;
                PRV_str[2] = 0x05 + within_over_under;
                PRV_str[3] = 0x05 + within_over_under;
                PRV_str[4] = 0x05 + within_over_under;
                PRV_str[5] = 0x05 + within_over_under;
                PRV_str[6] = 0x05 + within_over_under;
                PRV_str[7] = 0x00;
            }
            else
            {
                while (*pNumber == 0x20)
                {
                    #pragma diag_suppress=Pm088
                    pNumber ++;
                    #pragma diag_default=Pm088
                }

                PRV_str[0] = negNumber ? '-' : ' ';
                PRV_str[1] = 0x00;

                (void)strcat((char *)PRV_str,(char *)pNumber);
            }
        }
        else
        {
            PRV_str[0] = '?';
            PRV_str[1] = 0x00;
        }


        TUSIGN8 const *pPRVU_str = PacketManagerGetEngUnits((TUSIGN16)pPRVsignal->engUnits.ssIdx,
                                                                      pPRVsignal->engUnits.objIdx,
                                                                      pPRVsignal->engUnits.attribIdx,
                                                                      pPRVsignal->engUnitsType);
        TUSIGN8 PRVU_str[3];

        if (strlen((const char *)pPRVU_str) > 2)
        {
            strcpy((char *)PRVU_str, "");
        }
        else
        {
             strcpy((char *)PRVU_str, (const char *)pPRVU_str);
        }

        (void)strcat((char *)PRV_str,(const char *)PRVU_str);


        packetsBuilt += BuildWriteString(PRV_str,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,0,PRV_JUSTIFICATION,FONT_0,NO_INVERT,0,0,9,0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_CRV_ID_LEFT_HIGHLIGHT,       // Highlight to left of CRV_ID             |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_CRV_ID_LEFT_HIGHLIGHT)
    {
        TUSIGN8 highlight = WaveformCursorPos == WAVEFORM_CURSOR_CFG_REL_VAL ? 0xFF : 0x00;
        packetsBuilt += BuildWriteArray(&highlight, 1, CRV_ID_XPOS - 1, 0, 0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_CRV_ID,                      // Configuration Related Value Identifier  |
//    WAVEFORM_FRAME_CRV,                         // Configuration Related Value             |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= WAVEFORM_FRAME_CRV_ID)
     && (LOCAL_packetStage <= WAVEFORM_FRAME_CRV))
    {
        pCRVsignal = FrameTableGetSignal(FrameTable_GetWaveformCRVSignal(waveformIndex));
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_CRV_ID,                      // Configuration Related Value Identifier  |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_CRV_ID)
    {
        LOCAL_stringtable_text_id.attribIdx = pCRVsignal->short_identifier;

        TUSIGN8 text[SIGNAL_ID_BUFFER_SIZE+1];
        memset((void*)text,0x00,SIGNAL_ID_BUFFER_SIZE+1);

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            strncpy((char *)text,(const char *)FrameTableGetStringSpecificLanguage(LOCAL_stringtable_text_id,HMI_LANGUAGE_ENGLISH),SIGNAL_ID_BUFFER_SIZE);
        }
        else
        #endif
        {
            strncpy((char *)text,(const char *)FrameTableGetString(LOCAL_stringtable_text_id),SIGNAL_ID_BUFFER_SIZE);
        }

        TUSIGN8 invert = WaveformCursorPos == WAVEFORM_CURSOR_CFG_REL_VAL ? STRING_INVERT : NO_INVERT;

        LimitTextLength(text,3);
        packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,0,CRV_ID_JUSTIFICATION,FONT_0,invert,0,0,3,0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_CRV,                         // Configuration Related Value             |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_CRV)
    {
        TUSIGN16 subsysIdx = (TUSIGN16)pCRVsignal->value.ssIdx;
        TUSIGN16 objIdx    = (TUSIGN16)pCRVsignal->value.objIdx;
        TUSIGN8 attribIdx  = pCRVsignal->value.attribIdx;

        ADJUST_DATA value;
        TUSIGN8 type;

        TUSIGN8 CRV_str[6];

        // Get Process Related Value
        if (AdjusterGetFloatValue(subsysIdx, objIdx, attribIdx, &value, &type) == (TUSIGN16)OK)
        {
            TUSIGN8 *pNumber;
            TUSIGN8 negNumber;
            TUSIGN8 within_over_under;

            #ifdef HMI_USES_DOUBLE
            if (type == ST_DOUBLE)
            {
                pNumber = AdjusterBuildNumberStringFromDouble(value.data_D, 4, pCRVsignal->dpPosn, &negNumber, &within_over_under);
            }
            else
            #endif
            {
                pNumber = AdjusterBuildNumberString(value.data_F, 4, pCRVsignal->dpPosn, &negNumber, &within_over_under);
            }

            if ((within_over_under == 1) || (within_over_under == 2))
            {
                // overrange or underrange
                CRV_str[0] = 0x20;
                CRV_str[1] = 0x05 + within_over_under;
                CRV_str[2] = 0x05 + within_over_under;
                CRV_str[3] = 0x05 + within_over_under;
                CRV_str[4] = 0x05 + within_over_under;
                CRV_str[5] = 0x00;
            }
            else
            {
                while (*pNumber == 0x20)
                {
                    #pragma diag_suppress=Pm088
                    pNumber ++;
                    #pragma diag_default=Pm088
                }


                CRV_str[0] = negNumber ? '-' : ' ';
                CRV_str[1] = 0x00;

                (void)strcat((char *)CRV_str,(char *)pNumber);
            }
        }
        else
        {
            CRV_str[0] = '?';
            CRV_str[1] = 0x00;
        }

        packetsBuilt += BuildWriteString(CRV_str,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,0,CRV_JUSTIFICATION,FONT_0,NO_INVERT,0,0,5,0);
    }

//------------------------------------------------//-----------------------------------------|
//  if CRV edit not selected then skip CRV edit packets
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= WAVEFORM_FRAME_CRV_EDIT_ICON)
     && (LOCAL_packetStage <= WAVEFORM_FRAME_CRV_EDIT_VALUE)
     && (WaveformCursorPos != WAVEFORM_CURSOR_CFG_REL_VAL_EDIT))
     {
        LOCAL_packetStage = WAVEFORM_FRAME_CRV_EDIT_VALUE + 1;
     }

//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_CRV_EDIT_ICON,               // Title Bar Icon                          |
//    WAVEFORM_FRAME_CRV_EDIT_UNITS,              // Engineering Units                       |
//    WAVEFORM_FRAME_CRV_EDIT_MAX,                // High Limit                              |
//    WAVEFORM_FRAME_CRV_EDIT_MIN,                // Low Limit                               |
//    WAVEFORM_FRAME_CRV_EDIT_MAX_ICON,           // High Limit icon or text                 |
//    WAVEFORM_FRAME_CRV_EDIT_MIN_ICON,           // Low Limit icon or text                  |
//    WAVEFORM_FRAME_CRV_EDIT_VALUE,              // Parameter value                         |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= WAVEFORM_FRAME_CRV_EDIT_ICON)
     && (LOCAL_packetStage <= WAVEFORM_FRAME_CRV_EDIT_VALUE))
    {
        pCRVsignal = FrameTableGetSignal(FrameTable_GetWaveformCRVSignal(waveformIndex));
    }

//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_CRV_EDIT_ICON,               // Title Bar Icon                          |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_CRV_EDIT_ICON)
    {
        packetsBuilt += BuildWriteIcon(ICON_NUMBER_EDIT, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_CRV_EDIT_UNITS,              // Engineering Units                       |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_CRV_EDIT_UNITS)
    {
        TUSIGN8 text[22];

        strcpy((char *)text,
               (const char *)PacketManagerGetEngUnits((TUSIGN16)pCRVsignal->engUnits.ssIdx,
                                                      pCRVsignal->engUnits.objIdx,
                                                      pCRVsignal->engUnits.attribIdx,
                                                      pCRVsignal->engUnitsType)
              );

        #ifdef HMI_SUPPORTS_CUSTOM_UNITS
        PacketManagerRemoveCustomfromUnits(text);
        #endif

        LimitTextLength(text,8);
        packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,2,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,8,0);
    }

//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_CRV_EDIT_MAX,                // High Limit                              |
//    WAVEFORM_FRAME_CRV_EDIT_MIN,                // Low Limit                               |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= WAVEFORM_FRAME_CRV_EDIT_MAX)
     && (LOCAL_packetStage <= WAVEFORM_FRAME_CRV_EDIT_MIN))
    {
        (void)AdjusterGetFloatValueAndLimits((TUSIGN16)pCRVsignal->value.ssIdx,
                                             (TUSIGN16)pCRVsignal->value.objIdx,
                                             pCRVsignal->value.attribIdx,
                                             &tVal,
                                             &tHigh,
                                             &tLow,
                                             &tInc,
                                             &rulesAreActive,
                                             &tType);

        LimitError = AdjusterGetLimitError(&errorCode);
    }

//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_CRV_EDIT_MAX,                // High Limit                              |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_CRV_EDIT_MAX)
    {
        TUSIGN8 *pNumber;
        TUSIGN8 negNumber = 0;
        TUSIGN8 within_over_under = 0;
        TUSIGN8 i;
        TUSIGN8 text[22];

        text[0] = ' ';
        text[1] = 0x00;

        if (rulesAreActive)
        {
            #ifdef HMI_USES_DOUBLE
            if (tType == ST_DOUBLE)
            {
                pNumber = AdjusterBuildNumberStringFromDouble(tHigh.data_D,
                                                              CRV_EDIT_MAX_CHARS,
                                                              pCRVsignal->dpPosn,
                                                              &negNumber,
                                                              &within_over_under);
            }
            else
            #endif
            {
                pNumber = AdjusterBuildNumberString(tHigh.data_F,
                                                    CRV_EDIT_MAX_CHARS,
                                                    pCRVsignal->dpPosn,
                                                    &negNumber,
                                                    &within_over_under);
            }

            switch (within_over_under)
            {
            case 1: // overrange
                for (i = 0; i <= CRV_EDIT_MAX_CHARS; i ++)
                {
                    (void)strcat((char *)text,"\x06");
                }
                break;

            case 2: // underrange
                for (i = 0; i <= CRV_EDIT_MAX_CHARS; i ++)
                {
                    (void)strcat((char *)text,"\x07");
                }
                break;

            default:
                text[0] = negNumber? '-' : ' ';
                text[1] = 0x00;
                while (*pNumber == ' ')
                {
                    #pragma diag_suppress=Pm088
                    pNumber ++;
                    #pragma diag_default=Pm088
                }
                (void)strcat((char *)text,(char *)pNumber);
                break;
            }
        }
        else
        {
            for (i = 0; i <= CRV_EDIT_MAX_CHARS; i ++)
            {
                (void)strcat((char *)text,"9");
            }
        }

        TUSIGN8 justify = JUSTIFY_LEFT_WITH_INDENT_6;
        #if defined(HMI_SUPPORTS_ASIAN) && (defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION))
        if (LOCAL_Asian)
        {
            justify = JUSTIFY_LEFT_WITH_INDENT_35_PIXEL;
        }
        #endif

        packetsBuilt += BuildWriteString(text,
                                         HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                         4,
                                         justify,
                                         FONT_0,
                                         (TUSIGN8)((LimitError & 0x02) != 0 ? STRING_INVERT:NO_INVERT),
                                         0,
                                         0,
                                         FONT1_MAX_CHARS - 6,
                                         0);

    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_CRV_EDIT_MIN,                // Low Limit                               |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_CRV_EDIT_MIN)
    {
        TUSIGN8 *pNumber;
        TUSIGN8 negNumber = 0;
        TUSIGN8 within_over_under = 0;
        TUSIGN8 i;

        TUSIGN8 text[22];
        text[0] = ' ';
        text[1] = 0x00;

        if (rulesAreActive)
        {
            #ifdef HMI_USES_DOUBLE
            if (tType == ST_DOUBLE)
            {
                pNumber = AdjusterBuildNumberStringFromDouble(tLow.data_D,
                                                              CRV_EDIT_MAX_CHARS,
                                                              pCRVsignal->dpPosn,
                                                              &negNumber,
                                                              &within_over_under);
            }
            else
            #endif
            {
                pNumber = AdjusterBuildNumberString(tLow.data_F,
                                                    CRV_EDIT_MAX_CHARS,
                                                    pCRVsignal->dpPosn,
                                                    &negNumber,
                                                    &within_over_under);
            }

            switch (within_over_under)
            {
            case 1: // overrange
                for (i = 0; i <= CRV_EDIT_MAX_CHARS; i ++)
                {
                    (void)strcat((char *)text,"\x06");
                }
                break;

            case 2: // underrange
                for (i = 0; i <= CRV_EDIT_MAX_CHARS; i ++)
                {
                    (void)strcat((char *)text,"\x07");
                }
                break;

            default:
                text[0] = negNumber? '-' : ' ';
                text[1] = 0x00;
                while (*pNumber == ' ')
                {
                    #pragma diag_suppress=Pm088
                    pNumber ++;
                    #pragma diag_default=Pm088
                }
                (void)strcat((char *)text,(char *)pNumber);
                break;
            }
        }

        else
        {
            if ((tType == ST_U8) || (tType == ST_U16) || (tType == ST_U32) || (tType == ST_CHAR) || (tType == ST_WIDECHAR))
            {
                strcat((char *)text,"  0");
            }
            else
            {
                text[0] = negNumber? '-' : ' ';
                text[1] = 0x00;

                for (i = 0; i < CRV_EDIT_MAX_CHARS; i ++)
                {
                    (void)strcat((char *)text,"9");
                }
            }
        }

        TUSIGN8 justify = JUSTIFY_LEFT_WITH_INDENT_6;
        #if defined(HMI_SUPPORTS_ASIAN) && (defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION))
        if (LOCAL_Asian)
        {
            justify = JUSTIFY_LEFT_WITH_INDENT_35_PIXEL;
        }
        #endif

        packetsBuilt += BuildWriteString(text,
                                         HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                         5,
                                         justify,
                                         FONT_0,
                                         (TUSIGN8)((LimitError & 0x01) != 0 ? STRING_INVERT : NO_INVERT),
                                         0,
                                         0,
                                         FONT1_MAX_CHARS - 6,
                                         0);
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_CRV_EDIT_MAX_ICON,           // High Limit icon or text                 |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_CRV_EDIT_MAX_ICON)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_HIGH_LIMIT;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            #if defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION)
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),
                                                   4,
                                                   JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,
                                                   (TUSIGN8)((LimitError & 0x02) != 0 ? STRING_INVERT:NO_INVERT),
                                                   0,
                                                   3,
                                                   3,
                                                   0);
            #else
                TUSIGN8 customChar[11] = {0x00,0x00,0x00,0x09,0x0D,0x5F,0x0D,0x09,0x00,0x00,0x00,};
                packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 0, 4, 0, 0);
            #endif
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                             4,
                                             JUSTIFY_LEFT,
                                             FONT_0,
                                             (TUSIGN8)((LimitError & 0x02) != 0 ? STRING_INVERT:NO_INVERT),
                                             0,
                                             0,
                                             6,
                                             0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_CRV_EDIT_MIN_ICON,           // Low Limit icon or text                  |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_CRV_EDIT_MIN_ICON)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_LOW_LIMIT;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            #if defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION)
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),
                                                   5,
                                                   JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,
                                                   (TUSIGN8)((LimitError & 0x01) != 0 ? STRING_INVERT : NO_INVERT),
                                                   0,
                                                   3,
                                                   3,
                                                   0);
            #else
                TUSIGN8 customChar[11] = {0x00,0x00,0x00,0x48,0x58,0x7D,0x58,0x48,0x00,0x00,0x00};
                packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 0, 5, 0, 0);
            #endif
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                             5,
                                             JUSTIFY_LEFT,
                                             FONT_0,
                                             (TUSIGN8)((LimitError & 0x01) != 0 ? STRING_INVERT : NO_INVERT),
                                             0,
                                             0,
                                             6,
                                             0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_CRV_EDIT_VALUE,              // Parameter value                         |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_CRV_EDIT_VALUE)
    {
        TUSIGN8 text[22];
        TUSIGN8 lineNumber = 1;

        #if defined(HMI_SUPPORTS_ASIAN) && !defined(TYPE_4_IMPLEMENTATION) && !defined(TYPE_5_IMPLEMENTATION)
        if (LOCAL_Asian)
        {
            lineNumber = 2;
        }
        #endif

        TUSIGN8 negValue;
        TUSIGN8 *pValue;
        // get parameter value from Adjuster
        pValue = AdjusterGetVariableAsString(&negValue);

        text[0] = negValue ? '-' : ' ';
        text[1] = 0x00;
        (void)strcat((char *)text,(char*)pValue);

        if (FrameTableGetCursorPosition() == FrameTableGetCursorPositionLimit())
        {
            packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_RIGHT_WITH_INDENT_8,FONT_1,NO_INVERT,0,0,1,0);
        }
        else
        {
            packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,lineNumber,JUSTIFY_RIGHT_WITH_INDENT_8,FONT_1,CHAR_INVERT,FrameTableGetCursorPosition(),0,1,0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_RIGHT_KEY,                   //                                         |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_RIGHT_KEY)
    {
        if (WaveformCursorPos == WAVEFORM_CURSOR_CFG_REL_VAL_EDIT)
        {
            TUSIGN8 invert = NO_INVERT;
            LOCAL_stringtable_text_id.attribIdx = IDS_OK;

            if (FrameTableGetCursorPosition() == FrameTableGetCursorPositionLimit())
            {
                invert = STRING_INVERT;
                LOCAL_stringtable_text_id.attribIdx = IDS_CANCEL;
            }
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,invert,0,3,3,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,invert,0,0,9,0);
            }
        }
        else if ((WriteProtect_HMICanAccess(FrameTableGetSignal(FrameTable_GetWaveformCRVSignal(waveformIndex))->value, (TUSIGN8)0))
              && (WaveformCursorPos == WAVEFORM_CURSOR_CFG_REL_VAL))
        {
            packetsBuilt += BuildWriteArray(RightKey_Edit, KEY_FIELD_WIDTH, MAX_COMMON_HMI_WIDTH - KEY_FIELD_WIDTH, 7, 0);
        }
        else
        {
            packetsBuilt += BuildWriteArray(RightKey_Back, KEY_FIELD_WIDTH, MAX_COMMON_HMI_WIDTH - KEY_FIELD_WIDTH, 7, 0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_LEFT_KEY,                    //                                         |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == WAVEFORM_FRAME_LEFT_KEY)
    {
        if (WaveformCursorPos == WAVEFORM_CURSOR_CFG_REL_VAL_EDIT)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
            }
        }
        else
        {
            packetsBuilt += BuildWriteArray(LeftKey_Next, KEY_FIELD_WIDTH, 0, 7, 0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    WAVEFORM_FRAME_READ_SWITCHES,               //                                         |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage >= WAVEFORM_FRAME_READ_SWITCHES)
    {
      packetsBuilt += BuildReadSwitches(1);
    }
//------------------------------------------------//-----------------------------------------|
    return packetsBuilt;
}
#endif // end of #ifdef HMI_SUPPORTS_WAVEFORM_FRAMES


#ifdef HMI_SUPPORTS_LINEARIZER_FRAMES

#define LIN_CURRENTLY_EDITING   ((currLinearizerCursorPos == LINEARIZER_CURSOR_INPOINT_EDIT) || (currLinearizerCursorPos == LINEARIZER_CURSOR_OUTPOINT_EDIT))
#define LIN_PREVIOUSLY_EDITING  ((prvLinearizerCursorPos[LinearizerInstance] == LINEARIZER_CURSOR_INPOINT_EDIT) || (prvLinearizerCursorPos[LinearizerInstance] == LINEARIZER_CURSOR_OUTPOINT_EDIT))

#define LIN_CURRENTLY_VIEWING   ((currLinearizerCursorPos != LINEARIZER_CURSOR_INPOINT_EDIT) && (currLinearizerCursorPos != LINEARIZER_CURSOR_OUTPOINT_EDIT))
#define LIN_PREVIOUSLY_VIEWING  ((prvLinearizerCursorPos[LinearizerInstance] != LINEARIZER_CURSOR_INPOINT_EDIT) && (prvLinearizerCursorPos[LinearizerInstance] != LINEARIZER_CURSOR_OUTPOINT_EDIT))

#define LIN_ACKNOWLEDGE_CURSOR_CHANGE   prvLinearizerCursorPos[LinearizerInstance] = currLinearizerCursorPos



TUSIGN8 BuildLinearizerFrame(void)
{
    typedef enum
    {                                           // Packet                                  |
                                                //=========================================|
    LINEARIZER_FRAME_TITLE_BAR,                 // Title Bar (View or Edit)                | 0 - Start of Static Area (LINEARIZER EDIT) or (LINEARIZER VIEW)
                                                //-----------------------------------------|    Start from here if LINEARIZER EDIT / LINEARIZER VIEW changed
    LINEARIZER_FRAME_TITLE_ICON,                // Title Bar Icon (View or Edit)           | 1
                                                //-----------------------------------------|
    LINEARIZER_FRAME_LEFT_KEY,                  //                                         | 2
                                                //=========================================|
    LINEARIZER_VIEW_INPOINT_ID,                 // ID of Input point data                  | 3 - Start of Keypress Area (LINEARIZER VIEW)
                                                //-----------------------------------------|     Start from here if cursor changed (LINEARIZER VIEW)
    LINEARIZER_VIEW_INPOINT_ID_HIGHLIGHT,       //                                         |
                                                //-----------------------------------------|
    LINEARIZER_VIEW_OUTPOINT_ID,                // ID of Output point                      |
                                                //-----------------------------------------|
    LINEARIZER_VIEW_OUTPOINT_ID_HIGHLIGHT,      //                                         |
                                                //-----------------------------------------|
    LINEARIZER_VIEW_SELECTED_POINT,             //                                         |
                                                //-----------------------------------------|
    LINEARIZER_VIEW_SELECTED_POINT_HIGHLIGHT_4, // Add'l highlight on selected point       |
                                                //-----------------------------------------|
    LINEARIZER_VIEW_SELECTED_POINT_HIGHLIGHT_5, // Add'l highlight on selected point       |
                                                //-----------------------------------------|
    LINEARIZER_VIEW_PV_ID,                      // ID of Process value                     |
                                                //-----------------------------------------|
    LINEARIZER_VIEW_PV_VALUE,                   // value of Process value                  | 8 - Start of active Area (LINEARIZER VIEW)
                                                //-----------------------------------------|
    LINEARIZER_VIEW_PV_UNITS,                   // units for Process value                 |
                                                //-----------------------------------------|
    LINEARIZER_VIEW_INPOINT_VALUE,              // value of I/P point data                 | 9
                                                //-----------------------------------------|
    LINEARIZER_VIEW_OUPOINT_VALUE,              // value of O/P point data                 | 10
                                                //-----------------------------------------|
    LINEARIZER_VIEW_INPOINT_UNITS,              // units for I/P point data                |
                                                //-----------------------------------------|
    LINEARIZER_VIEW_OUPOINT_UNITS,              // units for O/P point data                |
                                                //-----------------------------------------|
    LINEARIZER_FRAME_CENTRE_KEY_ICON,           //                                         | 18
                                                //-----------------------------------------|
    LINEARIZER_FRAME_CENTRE_KEY_TEXT,           //                                         | 17
                                                //=========================================|
    LINEARIZER_EDIT_UNITS,                      // Engineering Units                       | 11
                                                //-----------------------------------------|
    LINEARIZER_EDIT_MAX,                        // High Limit                              | 12
                                                //-----------------------------------------|
    LINEARIZER_EDIT_MIN,                        // Low Limit                               | 13
                                                //-----------------------------------------|
    LINEARIZER_EDIT_MAX_ICON,                   // High Limit icon or text                 | 14
                                                //-----------------------------------------|
    LINEARIZER_EDIT_MIN_ICON,                   // Low Limit icon or text                  | 15
                                                //-----------------------------------------|
    LINEARIZER_EDIT_VALUE,                      // Parameter value                         | 16 - Start of Keypress Area (LINEARIZER EDIT)
                                                //=========================================|
    LINEARIZER_FRAME_RIGHT_KEY,                 //                                         | 19
                                                //=========================================|
    LINEARIZER_FRAME_READ_SWITCHES              //                                         | 20
                                                //-----------------------------------------| - There is no active area (LINEARIZER EDIT) or (LINEARIZER VIEW)
    }LINEARIZER_FRAME_PACKET;


    // Return data
    TUSIGN8 packetsBuilt = 0;

    // General data
    TUSIGN8 text[22];
    TUSIGN8 LinearizerInstance = 0;

    #ifdef HMI_SUPPORTS_SERVICEPORT
    LinearizerInstance = PacketManagerIsRemoteInstance() ? 1 : 0;
    #endif

    // LINEARIZER SUBSYSTEM DATA
    TUSIGN16 LinearizerSubsystem = (TUSIGN16)(LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.linearizer_subsystem_index);
    TUSIGN16 InPointObject       = (TUSIGN16)(LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.inpoint_object_index);
    TUSIGN16 OutPointObject      = (TUSIGN16)(LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.outpoint_object_index);
    TUSIGN16 PointEnableObject   = (TUSIGN16)(LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.pointEnable_objectIndex);
    const T_UNIT *pLinearizer    = GetSubsystemPtr(LinearizerSubsystem);


    // CURSOR DATA
    static LINEARIZER_CURSOR_POS prvLinearizerCursorPos[2] = {LINEARIZER_CURSOR_EXIT,LINEARIZER_CURSOR_EXIT};
    LINEARIZER_CURSOR_POS currLinearizerCursorPos = FrameTable_GetLinearizerCursor();
    TBOOL EditView_changed = ((LIN_CURRENTLY_EDITING && LIN_PREVIOUSLY_VIEWING) || (LIN_CURRENTLY_VIEWING && LIN_PREVIOUSLY_EDITING)) ? eTRUE : eFALSE;
    TBOOL Cursor_changed   = (currLinearizerCursorPos != prvLinearizerCursorPos[LinearizerInstance]) ? eTRUE : eFALSE;

    // LINEARIZER POINT
    TUSIGN8 LinPointSelected = FrameTable_GetLinearizerPoint();
    TUSIGN8 s_Point_selected[3] = {0x3F,0x3F,0x00};
    if (LinPointSelected <= 99)
    {
        s_Point_selected[0] = (LinPointSelected / 10) + 0x30;
        s_Point_selected[1] = (LinPointSelected % 10) + 0x30;
    }

    // DATA SPECIFIC TO EDIT OPERATION
    TFLOAT  maxValue,    minValue;
    TUSIGN8 min_max_DP;
    TBOOL   min_max_rules;
    TUSIGN8 LimitError;
    TUSIGN16 errorCode;

    TUSIGN8 inpointLine = 4;
    TUSIGN8 outpointLine = 5;

    if ((FrameTable_isLinearizerProcessValueDisplayEnabled() == eFALSE)
     || (LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.ProcessSignal == 0xFF))
    {
        inpointLine  --;
        outpointLine --;
    }

    if ((LOCAL_updateStaticArea) || (EditView_changed))
    {
        LOCAL_packetStage = LINEARIZER_FRAME_TITLE_BAR;
        LIN_ACKNOWLEDGE_CURSOR_CHANGE;
    }

    if (LIN_CURRENTLY_EDITING)
    {
        if ((LOCAL_keypressProcessed) && (LOCAL_packetStage > LINEARIZER_EDIT_VALUE))
        {
            LOCAL_packetStage = LINEARIZER_EDIT_VALUE;
            LIN_ACKNOWLEDGE_CURSOR_CHANGE;
        }
    }
    else
    {
        if (((LOCAL_keypressProcessed) || (Cursor_changed)) && (LOCAL_packetStage > LINEARIZER_VIEW_INPOINT_ID))
        {
            LOCAL_packetStage = LINEARIZER_VIEW_INPOINT_ID;
            LIN_ACKNOWLEDGE_CURSOR_CHANGE;
        }

        if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > LINEARIZER_VIEW_PV_VALUE))
        {
            LOCAL_packetStage = LINEARIZER_VIEW_PV_VALUE;
        }
    }

    if (LOCAL_packetStage >= LINEARIZER_FRAME_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = LINEARIZER_FRAME_READ_SWITCHES;
    }

//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_FRAME_TITLE_BAR,                 // Title Bar (View or Edit)                |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_FRAME_TITLE_BAR)
    {
        if (LIN_CURRENTLY_EDITING)
        {
            if (currLinearizerCursorPos == LINEARIZER_CURSOR_INPOINT_EDIT)
            {
                (void)strcpy((char *)text, "In ");
            }
            else
            {
                (void)strcpy((char *)text, "Out ");
            }
            (void)strcat((char *)text, (char *)s_Point_selected);
            packetsBuilt += BuildFrameTitle(text,0);
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.title_attribidx;

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),8,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
            }
        }
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_FRAME_TITLE_ICON,                // Title Bar Icon (View or Edit)           |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_FRAME_TITLE_ICON)
    {
        if (LIN_CURRENTLY_EDITING)
        {
            packetsBuilt += BuildWriteIcon(ICON_NUMBER_EDIT, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
        }
        else
        {
            TUSIGN8 linearizerIcon[13] = {0x00, 0xFF, 0xC0, 0xA0, 0x90, 0x88, 0x88, 0x88, 0x88, 0x88, 0x84, 0x82, 0x81};
            packetsBuilt += BuildWriteArray(linearizerIcon, 13, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_FRAME_LEFT_KEY,                  //                                         |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_FRAME_LEFT_KEY)
    {
        if (LIN_CURRENTLY_EDITING)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
            }
        }
        else
        {
            packetsBuilt += BuildWriteArray(LeftKey_Next, KEY_FIELD_WIDTH, 0, 7, 0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_VIEW_INPOINT_ID,                 // ID of Input point data                  |
//    LINEARIZER_VIEW_INPOINT_ID_HIGHLIGHT        //                                         |
//    LINEARIZER_VIEW_OUTPOINT_ID,                // ID of Output point                      |
//    LINEARIZER_VIEW_OUTPOINT_ID_HIGHLIGHT       //                                         |
//    LINEARIZER_VIEW_SELECTED_POINT,             //                                         |
//    LINEARIZER_VIEW_SELECTED_POINT_HIGHLIGHT_4, // Add'l highlight on selected point       |
//    LINEARIZER_VIEW_SELECTED_POINT_HIGHLIGHT_5, // Add'l highlight on selected point       |
//    LINEARIZER_VIEW_PV_ID,                      // ID of Process value                     |
//    LINEARIZER_VIEW_PV_VALUE,                   // value of Process value                  |
//    LINEARIZER_VIEW_PV_UNITS,                   // units for Process value                 |
//    LINEARIZER_VIEW_INPOINT_VALUE,              // value of I/P point data                 |
//    LINEARIZER_VIEW_OUPOINT_VALUE,              // value of O/P point data                 |
//    LINEARIZER_VIEW_INPOINT_UNITS,              // units for I/P point data                |
//    LINEARIZER_VIEW_OUPOINT_UNITS,              // units for O/P point data                |
//    LINEARIZER_FRAME_CENTRE_KEY_ICON,           //                                         |
//    LINEARIZER_FRAME_CENTRE_KEY_TEXT,           //                                         |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= LINEARIZER_VIEW_INPOINT_ID)
     && (LOCAL_packetStage <= LINEARIZER_FRAME_CENTRE_KEY_TEXT)
     && (LIN_CURRENTLY_EDITING == eTRUE))
    {
        LOCAL_packetStage = LINEARIZER_FRAME_CENTRE_KEY_TEXT + 1;
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_VIEW_INPOINT_ID,                 // ID of Input point data                  |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_VIEW_INPOINT_ID)
    {
        TUSIGN8 invert = currLinearizerCursorPos == LINEARIZER_CURSOR_INPOINT_VIEW ? STRING_INVERT : NO_INVERT;
        (void)strcpy((char *)text, "In ");
        packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,inpointLine,JUSTIFY_LEFT_WITH_INDENT_14_PIXEL,FONT_0,invert,0,0,3,0);
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_VIEW_INPOINT_ID_HIGHLIGHT        //                                         |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_VIEW_INPOINT_ID_HIGHLIGHT)
    {
        TUSIGN8 highlight = currLinearizerCursorPos == LINEARIZER_CURSOR_INPOINT_VIEW ? 0xFF : 0x00;
        packetsBuilt += BuildWriteArray(&highlight, 1, 13, inpointLine, 0);
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_VIEW_OUTPOINT_ID,                // ID of Output point                      |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_VIEW_OUTPOINT_ID)
    {
        TUSIGN8 invert = currLinearizerCursorPos == LINEARIZER_CURSOR_OUTPOINT_VIEW ? STRING_INVERT : NO_INVERT;
        (void)strcpy((char *)text, "Out");
        packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,outpointLine,JUSTIFY_LEFT_WITH_INDENT_14_PIXEL,FONT_0,invert,0,0,3,0);
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_VIEW_OUTPOINT_ID_HIGHLIGHT       //                                         |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_VIEW_OUTPOINT_ID_HIGHLIGHT)
    {
        TUSIGN8 highlight = currLinearizerCursorPos == LINEARIZER_CURSOR_OUTPOINT_VIEW ? 0xFF : 0x00;
        packetsBuilt += BuildWriteArray(&highlight, 1, 13, outpointLine, 0);
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_VIEW_SELECTED_POINT,             //                                         |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_VIEW_SELECTED_POINT)
    {
        TUSIGN8 invert = currLinearizerCursorPos == LINEARIZER_CURSOR_EXIT ? STRING_INVERT : NO_INVERT;
        (void)strcpy((char *)text, (char *)s_Point_selected);
        packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,inpointLine,JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,FONT_1,invert,0,0,2,0);
    }
//------------------------------------------------//-----------------------------------------|
//   LINEARIZER_VIEW_SELECTED_POINT_HIGHLIGHT_4,  // Add'l highlight on selected point       |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_VIEW_SELECTED_POINT_HIGHLIGHT_4)
    {
        TUSIGN8 highlight = currLinearizerCursorPos == LINEARIZER_CURSOR_EXIT ? 0xFF : 0x00;
        packetsBuilt += BuildWriteArray(&highlight, 1, 0, inpointLine, 0);
    }
//------------------------------------------------//-----------------------------------------|
//   LINEARIZER_VIEW_SELECTED_POINT_HIGHLIGHT_5,  // Add'l highlight on selected point       |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_VIEW_SELECTED_POINT_HIGHLIGHT_5)
    {
        TUSIGN8 highlight = currLinearizerCursorPos == LINEARIZER_CURSOR_EXIT ? 0xFF : 0x00;
        packetsBuilt += BuildWriteArray(&highlight, 1, 0, outpointLine, 0);
    }

//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_VIEW_PV_ID,                      // ID of Process value                     |
//    LINEARIZER_VIEW_PV_VALUE,                   // value of Process value                  |
//    LINEARIZER_VIEW_PV_UNITS,                   // units for Process value                 |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= LINEARIZER_VIEW_PV_ID)
     && (LOCAL_packetStage <= LINEARIZER_VIEW_PV_UNITS))
    {
        if ((FrameTable_isLinearizerProcessValueDisplayEnabled() == eFALSE)
         || (LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.ProcessSignal == 0xFF))
        {
            LOCAL_packetStage = LINEARIZER_VIEW_PV_UNITS + 1;
        }
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_VIEW_PV_ID,                      // ID of Process value                     |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_VIEW_PV_ID)
    {
        const SIGNAL_TABLE_TYPE *pSignal = FrameTableGetSignal(LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.ProcessSignal);

        LOCAL_stringtable_text_id.attribIdx = pSignal->short_identifier;

        TUSIGN8 SpecificLanguage      = SFD_SIMPLE.language;
        TUSIGN8 extendedCharacterPage = HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE;

        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            SpecificLanguage = HMI_LANGUAGE_ENGLISH;
            extendedCharacterPage = HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN;
        }
        #endif

        packetsBuilt += BuildWriteString(FrameTableGetStringSpecificLanguage(LOCAL_stringtable_text_id, SpecificLanguage),  // const TUSIGN8 *suppliedText,
                                         extendedCharacterPage,                                                             // TUSIGN8 extendedCharacterPage,
                                         2,                                                                                 // TUSIGN8 line,
                                         JUSTIFY_LEFT,                                                                      // TUSIGN8 justify,
                                         FONT_0,                                                                            // TUSIGN8 font,
                                         NO_INVERT,                                                                         // TUSIGN8 invert,
                                         0,                                                                                 // TUSIGN8 invchar,
                                         0,                                                                                 // TUSIGN8 blank,
                                         3,                                                                                 // TUSIGN8 minLength,
                                         0);                                                                                // TUSIGN8 lastPacket
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_VIEW_PV_VALUE,                   // value of Process value                  |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_VIEW_PV_VALUE)
    {
        const SIGNAL_TABLE_TYPE *pSignal = FrameTableGetSignal(LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.ProcessSignal);

        ADJUST_DATA dataValue;
        TUSIGN8 dataType;
        TUSIGN8 *pStart;
        TUSIGN8 resolution;
        TUSIGN8 within_over_under, negNumber;

        // -----------------------------------------------------------------------------------------
        // Get the resolution (dec point position) and recalculate resolution if resolution is based upon range
        resolution = pSignal->dpPosn;

        if (resolution == USE_RANGE)
        {
            if (pSignal->FixedUpperLower == 0)
            {
                #ifdef HMI_USES_DOUBLE
                TDOUBLE High, Low;
                #else
                TFLOAT High, Low;
                #endif
                PacketManagerBuilderServices_GetBarRange(pSignal, &High, &Low);

                if (Low < 0)    {Low *= -1;}
                if (High < 0)   {High *= -1;}
                if (Low > High) {High = Low;}

                if (High < 10)          {resolution = 4;}
                else if (High < 100)    {resolution = 3;}
                else if (High < 1000)   {resolution = 2;}
                else if (High < 10000)  {resolution = 1;}
                else                    {resolution = 0;}
            }
            else
            {
                resolution = 0;
            }
        }

        // -----------------------------------------------------------------------------------------
        // Get the value
        AdjusterGetFloatValue((TUSIGN16)pSignal->value.ssIdx,
                              (TUSIGN16)pSignal->value.objIdx,
                              pSignal->value.attribIdx,
                              &dataValue,
                              &dataType);

        // -----------------------------------------------------------------------------------------
        // Convert value to string
        #ifdef HMI_USES_DOUBLE
        if (dataType == ST_DOUBLE)
        {
            pStart = AdjusterBuildNumberStringFromDouble(dataValue.data_D,6, resolution, &negNumber, &within_over_under);
        }
        else
        #endif
        {
            pStart = AdjusterBuildNumberString(dataValue.data_F, 6, resolution, &negNumber, &within_over_under);
        }

        if ((within_over_under == 1) || (within_over_under == 2))
        {
            // overrange or underrange
            TUSIGN8 i;
            text[0] = 0x20;

            for (i = 1; i <= 6; )
            {
                text[i] = 0x05 + within_over_under;
                i++;
                text[i] = 0x00;
            }
        }
        else
        {
            text[0] = 0x00;

            // value within range or a normal numerical frame with an edit
            while (*pStart == 0x20)
            {
                #pragma diag_suppress=Pm088
                pStart ++;
                #pragma diag_default=Pm088
            }
            if (negNumber)
            {
                text[0] = '-';
                text[1] = 0x00;
            }
            (void)strcat((char *)text,(char *)pStart);
        }

        // -----------------------------------------------------------------------------------------
        // Write string
        packetsBuilt += BuildWriteString(text,                                  // const TUSIGN8 *suppliedText,
                                         HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,  // TUSIGN8 extendedCharacterPage,
                                         2,                                     // TUSIGN8 line,
                                         JUSTIFY_RIGHT_WITH_INDENT_9,           // TUSIGN8 justify,
                                         FONT_0,                                // TUSIGN8 font,
                                         NO_INVERT,                             // TUSIGN8 invert,
                                         0,                                     // TUSIGN8 invchar,
                                         0,                                     // TUSIGN8 blank,
                                         7,                                     // TUSIGN8 minLength,
                                         0);                                    // TUSIGN8 lastPacket
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_VIEW_PV_UNITS,                   // units for Process value                 |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_VIEW_PV_UNITS)
    {
        const SIGNAL_TABLE_TYPE *pSignal = FrameTableGetSignal(LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.ProcessSignal);

        strcpy((char *)text,
                   (const char *)PacketManagerGetEngUnits((TUSIGN16)pSignal->engUnits.ssIdx,
                                                          pSignal->engUnits.objIdx,
                                                          pSignal->engUnits.attribIdx,
                                                          pSignal->engUnitsType));
        #ifdef HMI_SUPPORTS_CUSTOM_UNITS
        PacketManagerRemoveCustomfromUnits(text);
        #endif

        LimitTextLength(text,8);

        packetsBuilt += BuildWriteString(text,                                  // const TUSIGN8 *suppliedText,
                                         HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,  // TUSIGN8 extendedCharacterPage,
                                         2,                                     // TUSIGN8 line,
                                         JUSTIFY_LEFT_WITH_INDENT_13,           // TUSIGN8 justify,
                                         FONT_0,                                // TUSIGN8 font,
                                         NO_INVERT,                             // TUSIGN8 invert,
                                         0,                                     // TUSIGN8 invchar,
                                         0,                                     // TUSIGN8 blank,
                                         8,                                     // TUSIGN8 minLength,
                                         0);                                    // TUSIGN8 lastPacket
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_VIEW_INPOINT_VALUE,              // value of I/P point data                 |
//    LINEARIZER_VIEW_OUPOINT_VALUE,              // value of O/P point data                 |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= LINEARIZER_VIEW_INPOINT_VALUE)
     && (LOCAL_packetStage <= LINEARIZER_VIEW_OUPOINT_VALUE))
    {
        TBOOL pointValid;
        TUSIGN8 startPacket,DataDecPt,lineNumber,valueObjectIndex;

        do
        {
            startPacket = LOCAL_packetStage;

            if (LOCAL_packetStage == LINEARIZER_VIEW_INPOINT_VALUE)
            {
                lineNumber = inpointLine;

                valueObjectIndex = InPointObject;
                DataDecPt = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.dpPosn_inpoint;
                pointValid = eTRUE;
            }
            else
            {
                lineNumber = outpointLine;

                if (FrameTable_GetLinearizerPointEnable(LinearizerSubsystem,PointEnableObject,LinPointSelected))
                {
                    valueObjectIndex = OutPointObject;
                    DataDecPt = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.dpPosn_outpoint;
                    pointValid = eTRUE;
                }
                else
                {
                    pointValid = eFALSE;
                }
            }

            if (!pointValid)
            {
                strcpy((char*)text, " ------");
            }
            else
            {
                TFLOAT  DataValue = 0;

                if (pLinearizer->Get(pLinearizer,valueObjectIndex,LinPointSelected,(void FAST *)&DataValue) < (TUSIGN16)ERROR_CODES)
                {
                    TUSIGN8 *pNumber;
                    TUSIGN8 negNumber;
                    TUSIGN8 within_over_under;

                    pNumber = AdjusterBuildNumberString(DataValue, 6, DataDecPt, &negNumber, &within_over_under);

                    if ((within_over_under == 1) || (within_over_under == 2))
                    {
                        // overrange or underrange
                        TUSIGN8 i;
                        text[0] = 0x20;

                        for (i = 1; i <= 6; )
                        {
                            text[i] = 0x05 + within_over_under;
                            i++;
                            text[i] = 0x00;
                        }
                    }
                    else
                    {
                        text[0] = 0x00;

                        // value within range or a normal numerical frame with an edit
                        while (*pNumber == 0x20)
                        {
                            #pragma diag_suppress=Pm088
                            pNumber ++;
                            #pragma diag_default=Pm088
                        }
                        if (negNumber)
                        {
                            text[0] = '-';
                            text[1] = 0x00;
                        }
                        (void)strcat((char *)text,(char *)pNumber);
                    }
                }
                else
                {
                    strcpy((char*)text, " ");
                }
            }
            packetsBuilt += BuildWriteString(text,                                  // const TUSIGN8 *suppliedText,
                                             HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,  // TUSIGN8 extendedCharacterPage,
                                             lineNumber,                            // TUSIGN8 line,
                                             JUSTIFY_RIGHT_WITH_INDENT_9,           // TUSIGN8 justify,
                                             FONT_0,                                // TUSIGN8 font,
                                             NO_INVERT,                             // TUSIGN8 invert,
                                             0,                                     // TUSIGN8 invchar,
                                             0,                                     // TUSIGN8 blank,
                                             7,                                     // TUSIGN8 minLength,
                                             0);                                    // TUSIGN8 lastPacket
        }
        while ((LOCAL_packetStage != startPacket) && (LOCAL_packetStage <= LINEARIZER_VIEW_OUPOINT_VALUE));
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_VIEW_INPOINT_UNITS,              // units for I/P point data                |
//    LINEARIZER_VIEW_OUPOINT_UNITS,              // units for O/P point data                |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= LINEARIZER_VIEW_INPOINT_UNITS)
     && (LOCAL_packetStage <= LINEARIZER_VIEW_OUPOINT_UNITS))
    {
        TBOOL pointValid;
        TUSIGN8 startPacket,unitsType,UOM_data_L,UOM_data_H,lineNumber;

        do
        {
            startPacket = LOCAL_packetStage;

            if (LOCAL_packetStage == LINEARIZER_VIEW_INPOINT_UNITS)
            {
                lineNumber = inpointLine;
                unitsType = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.UOM_type_inpoint;
                UOM_data_L = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.UOM_data_inpoint_L;
                UOM_data_H = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.UOM_data_inpoint_H;
                pointValid = eTRUE;
            }
            else
            {
                lineNumber = outpointLine;

                if (FrameTable_GetLinearizerPointEnable(LinearizerSubsystem,PointEnableObject,LinPointSelected) == eFALSE)
                {
                    pointValid = eFALSE;
                }
                else
                {
                    unitsType = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.UOM_type_outpoint;
                    UOM_data_L = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.UOM_data_outpoint_L;
                    UOM_data_H = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.UOM_data_outpoint_H;
                    pointValid = eTRUE;
                }
            }

            if (!pointValid)
            {
                strcpy((char*)text, " ");
            }
            else
            {
                // add units to "value_and_units"
                if (unitsType == FIXED_TEXT_UNITS)
                {
                    (void)strcpy((char*)text,(const char*)PacketManagerGetEngUnits(0, UOM_data_L, UOM_data_H, unitsType));
                }
                else if (unitsType <= USE_UOM_11)
                {
                    (void)strcpy((char*)text,(const char*)PacketManagerGetEngUnits((T_SUBSYSTEM_IDX)UOM_data_H, UOM_data_L, 0, unitsType));
                }
                else
                {
                    (void)strcpy((char*)text,(const char*)PacketManagerGetEngUnits(0, IDS_BLANK, 0, FIXED_TEXT_UNITS));
                }

                #ifdef HMI_SUPPORTS_CUSTOM_UNITS
                PacketManagerRemoveCustomfromUnits(text);
                #endif

                LimitTextLength(text,8);
            }
            packetsBuilt += BuildWriteString(text,                                  // const TUSIGN8 *suppliedText,
                                             HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,  // TUSIGN8 extendedCharacterPage,
                                             lineNumber,                            // TUSIGN8 line,
                                             JUSTIFY_LEFT_WITH_INDENT_13,           // TUSIGN8 justify,
                                             FONT_0,                                // TUSIGN8 font,
                                             NO_INVERT,                             // TUSIGN8 invert,
                                             0,                                     // TUSIGN8 invchar,
                                             0,                                     // TUSIGN8 blank,
                                             8,                                     // TUSIGN8 minLength,
                                             0);                                    // TUSIGN8 lastPacket
        }
        while ((LOCAL_packetStage != startPacket) && (LOCAL_packetStage <= LINEARIZER_VIEW_OUPOINT_UNITS));
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_FRAME_CENTRE_KEY_ICON,           //                                         |
//    LINEARIZER_FRAME_CENTRE_KEY_TEXT,           //                                         |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= LINEARIZER_FRAME_CENTRE_KEY_ICON)
     && (LOCAL_packetStage <= LINEARIZER_FRAME_CENTRE_KEY_TEXT))
    {
        const TUSIGN8 *pArray = Blank_Icon;
        LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;

        switch (currLinearizerCursorPos)
        {
        case LINEARIZER_CURSOR_INPOINT_VIEW:
            if (FrameTable_isLinearizerInpointCapture_Enabled())
            {
                if ((FrameTable_isLinearizerProcessValueDisplayEnabled())
                 && (LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.ProcessSignal != 0xFF))
                {
                    ATTRIB_IDENTIFIER_TYPE ARM_check_object = {LinearizerSubsystem,InPointObject,LinPointSelected};
                    if (WriteProtect_HMICanAccess(ARM_check_object, (TUSIGN8)0))
                    {
                        pArray = UpKey;
                        LOCAL_stringtable_text_id.attribIdx = IDS_CAPTURE;
                    }
                }
            }
            break;

        case LINEARIZER_CURSOR_OUTPOINT_VIEW:
            if (FrameTable_isLinearizerPointEnableDisable_Enabled())
            {
                ATTRIB_IDENTIFIER_TYPE ARM_check_object = {LinearizerSubsystem,PointEnableObject,LinPointSelected};
                if (WriteProtect_HMICanAccess(ARM_check_object, (TUSIGN8)0))
                {
                    if (FrameTable_GetLinearizerPointEnable(LinearizerSubsystem, PointEnableObject, LinPointSelected))
                    {
                        pArray = DownKey;
                        LOCAL_stringtable_text_id.attribIdx = IDS_DEACTIVATE;
                    }
                    else
                    {
                        pArray = UpKey;
                        LOCAL_stringtable_text_id.attribIdx = IDS_ACTIVATE;
                    }
                }
            }
            break;

        case LINEARIZER_CURSOR_EXIT:
        default:
            pArray = Blank_Icon;
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;
            break;
        }

        //------------------------------------------------//
        //    LINEARIZER_FRAME_CENTRE_KEY_ICON,           //
        //------------------------------------------------//
        if (LOCAL_packetStage == LINEARIZER_FRAME_CENTRE_KEY_ICON)
        {
            packetsBuilt += BuildWriteArray(pArray, UP_DOWN_ICON_FIELD_WIDTH, 43, 7, 0);
        }
        //------------------------------------------------//
        //    LINEARIZER_FRAME_CENTRE_KEY_TEXT,           //
        //------------------------------------------------//
        if (LOCAL_packetStage == LINEARIZER_FRAME_CENTRE_KEY_TEXT)
        {
            TUSIGN8 SpecificLanguage      = SFD_SIMPLE.language;
            TUSIGN8 extendedCharacterPage = HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE;

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                SpecificLanguage = HMI_LANGUAGE_ENGLISH;
                extendedCharacterPage = HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN;
            }
            #endif
            packetsBuilt += BuildWriteString(FrameTableGetStringSpecificLanguage(LOCAL_stringtable_text_id, SpecificLanguage),  // const TUSIGN8 *suppliedText,
                                             extendedCharacterPage,                                                             // TUSIGN8 extendedCharacterPage,
                                             7,                                                                                 // TUSIGN8 line,
                                             JUSTIFY_LEFT_WITH_INDENT_9,                                                        // TUSIGN8 justify,
                                             FONT_0,                                                                            // TUSIGN8 font,
                                             NO_INVERT,                                                                         // TUSIGN8 invert,
                                             0,                                                                                 // TUSIGN8 invchar,
                                             0,                                                                                 // TUSIGN8 blank,
                                             9,                                                                                 // TUSIGN8 minLength,
                                             0);                                                                                // TUSIGN8 lastPacket
        }
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_EDIT_UNITS,                      // Engineering Units                       |
//    LINEARIZER_EDIT_MAX,                        // High Limit                              |
//    LINEARIZER_EDIT_MIN,                        // Low Limit                               |
//    LINEARIZER_EDIT_MAX_ICON,                   // High Limit icon or text                 |
//    LINEARIZER_EDIT_MIN_ICON,                   // Low Limit icon or text                  |
//    LINEARIZER_EDIT_VALUE,                      // Parameter value                         |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= LINEARIZER_EDIT_UNITS)
     && (LOCAL_packetStage <= LINEARIZER_EDIT_VALUE)
     && (LIN_CURRENTLY_EDITING == eFALSE))
    {
        LOCAL_packetStage = LINEARIZER_EDIT_VALUE + 1;
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_EDIT_UNITS,                      // Engineering Units                       |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_EDIT_UNITS)
    {
        TUSIGN8 unitsType, UOM_data_L, UOM_data_H;

        TUSIGN8 const *pUnits;

        switch (currLinearizerCursorPos)
        {
        case LINEARIZER_CURSOR_INPOINT_EDIT:
            unitsType = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.UOM_type_inpoint;
            UOM_data_L = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.UOM_data_inpoint_L;
            UOM_data_H = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.UOM_data_inpoint_H;
            break;
        case LINEARIZER_CURSOR_OUTPOINT_EDIT:
            unitsType = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.UOM_type_outpoint;
            UOM_data_L = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.UOM_data_outpoint_L;
            UOM_data_H = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.UOM_data_outpoint_H;
            break;
        default:
            unitsType  = FIXED_TEXT_UNITS;
            UOM_data_L = IDS_BLANK;
            UOM_data_H = 0;
            break;
        }

        if (unitsType == FIXED_TEXT_UNITS)
        {
            pUnits = PacketManagerGetEngUnits(0, UOM_data_L, UOM_data_H, unitsType);
        }
        else if (unitsType <= USE_UOM_11)
        {
            pUnits = PacketManagerGetEngUnits((T_SUBSYSTEM_IDX)UOM_data_H, UOM_data_L, 0, unitsType);
        }
        else
        {
            pUnits = PacketManagerGetEngUnits(0, IDS_BLANK, 0, FIXED_TEXT_UNITS);
        }

        (void)strcpy((char *)text,(const char *)pUnits);

        #ifdef HMI_SUPPORTS_CUSTOM_UNITS
        PacketManagerRemoveCustomfromUnits(text);
        #endif

        LimitTextLength(text,8);
        packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,2,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,8,0);
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_EDIT_MAX,                        // High Limit                              |
//    LINEARIZER_EDIT_MIN,                        // Low Limit                               |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= LINEARIZER_EDIT_MAX)
     && (LOCAL_packetStage <= LINEARIZER_EDIT_MIN))
    {
        T_SUBSYSTEM_IDX DataSS = LinearizerSubsystem;
        TUSIGN16        DataObj;
        TINT16          DataAtt = LinPointSelected;

        TBOOL           DataValid;
        TUSIGN8         DataDecPt;

        switch (currLinearizerCursorPos)
        {
        case LINEARIZER_CURSOR_INPOINT_EDIT:
            DataObj   = InPointObject;
            DataDecPt = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.dpPosn_inpoint;
            DataValid = eTRUE;
            break;
        case LINEARIZER_CURSOR_OUTPOINT_EDIT:
            DataObj   = OutPointObject;
            DataDecPt = LOCAL_pCurrDisplayFrame->frameDefinition.linearizerFrame.dpPosn_outpoint;
            DataValid = eTRUE;
            break;
        default:
            DataValid = eFALSE;
            break;
        }
        if (DataValid)
        {
            T_DO_ATTRIB_RANGE Range;
            const T_UNIT SLOW *pSub = GetSubsystemPtr(DataSS);

            if (pLinearizer->GetAttributeDescription(pLinearizer,DataObj,DataAtt,(T_DO_ATTRIB_RANGE FAST*)&Range) < (TUSIGN16)ERROR_CODES)
            {
                maxValue = Range.range.flt.max;
                minValue = Range.range.flt.min;
                min_max_rules = Range.rulesAreActive;
                min_max_DP = DataDecPt;

                LimitError = AdjusterGetLimitError(&errorCode);
            }
            else
            {
                DataValid = eFALSE;
            }
        }

        if (!DataValid)
        {
            LOCAL_packetStage = LINEARIZER_EDIT_MIN + 1;
        }
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_EDIT_MAX,                        // High Limit                              |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_EDIT_MAX)
    {

        text[0] = ' ';
        text[1] = 0x00;

        if (min_max_rules)
        {
            TUSIGN8 *pNumber;
            TUSIGN8 negNumber = 0;
            TUSIGN8 within_over_under = 0;
            TUSIGN8 i;

            pNumber = AdjusterBuildNumberString(maxValue, 6, min_max_DP, &negNumber, &within_over_under);

            switch (within_over_under)
            {
            case 1: // overrange

                for (i = 0; i <= 6; i ++)
                {
                    (void)strcat((char *)text,"\x06");
                }
                break;

            case 2: // underrange
                for (i = 0; i <= 6; i ++)
                {
                    (void)strcat((char *)text,"\x07");
                }
                break;

            default:
                text[0] = negNumber? '-' : ' ';
                text[1] = 0x00;
                while (*pNumber == ' ')
                {
                    #pragma diag_suppress=Pm088
                    pNumber ++;
                    #pragma diag_default=Pm088
                }
                (void)strcat((char *)text,(char *)pNumber);
                break;
            }
        }
        else
        {
           (void)strcpy((char *)text, " 999999");
        }

        TUSIGN8 justify = JUSTIFY_LEFT_WITH_INDENT_6;
        #if defined(HMI_SUPPORTS_ASIAN) && (defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION))
        if (LOCAL_Asian)
        {
            justify = JUSTIFY_LEFT_WITH_INDENT_35_PIXEL;
        }
        #endif

        packetsBuilt += BuildWriteString(text,
                                         HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                         4,
                                         justify,
                                         FONT_0,
                                         (TUSIGN8)((LimitError & 0x02) != 0 ? STRING_INVERT:NO_INVERT),
                                         0,
                                         0,
                                         FONT1_MAX_CHARS - 6,
                                         0);
    }

//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_EDIT_MIN,                        // Low Limit                               |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_EDIT_MIN)
    {

        text[0] = ' ';
        text[1] = 0x00;

        if (min_max_rules)
        {
            TUSIGN8 *pNumber;
            TUSIGN8 negNumber = 0;
            TUSIGN8 within_over_under = 0;
            TUSIGN8 i;

            pNumber = AdjusterBuildNumberString(minValue, 6, min_max_DP, &negNumber, &within_over_under);

            switch (within_over_under)
            {
            case 1: // overrange
                for (i = 0; i <= 6; i ++)
                {
                    (void)strcat((char *)text,"\x06");
                }
                break;

            case 2: // underrange
                for (i = 0; i <= 6; i ++)
                {
                    (void)strcat((char *)text,"\x07");
                }
                break;

            default:
                text[0] = negNumber? '-' : ' ';
                text[1] = 0x00;
                while (*pNumber == ' ')
                {
                    #pragma diag_suppress=Pm088
                    pNumber ++;
                    #pragma diag_default=Pm088
                }
                (void)strcat((char *)text,(char *)pNumber);
                break;
            }
        }

        else
        {
           (void)strcpy((char *)text, "-999999");
        }

        TUSIGN8 justify = JUSTIFY_LEFT_WITH_INDENT_6;
        #if defined(HMI_SUPPORTS_ASIAN) && (defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION))
        if (LOCAL_Asian)
        {
            justify = JUSTIFY_LEFT_WITH_INDENT_35_PIXEL;
        }
        #endif

        packetsBuilt += BuildWriteString(text,
                                         HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                         5,
                                         justify,
                                         FONT_0,
                                         (TUSIGN8)((LimitError & 0x01) != 0 ? STRING_INVERT : NO_INVERT),
                                         0,
                                         0,
                                         FONT1_MAX_CHARS - 6,
                                         0);
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_EDIT_MAX_ICON,                   // High Limit icon or text                 |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_EDIT_MAX_ICON)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_HIGH_LIMIT;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            #if defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION)
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),
                                                   4,
                                                   JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,
                                                   (TUSIGN8)((LimitError & 0x02) != 0 ? STRING_INVERT:NO_INVERT),
                                                   0,
                                                   3,
                                                   3,
                                                   0);
            #else
                TUSIGN8 customChar[11] = {0x00,0x00,0x00,0x09,0x0D,0x5F,0x0D,0x09,0x00,0x00,0x00,};
                packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 0, 4, 0, 0);
            #endif
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                             4,
                                             JUSTIFY_LEFT,
                                             FONT_0,
                                             (TUSIGN8)((LimitError & 0x02) != 0 ? STRING_INVERT:NO_INVERT),
                                             0,
                                             0,
                                             6,
                                             0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_EDIT_MIN_ICON,                   // Low Limit icon or text                  |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_EDIT_MIN_ICON)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_LOW_LIMIT;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            #if defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION)
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),
                                                   5,
                                                   JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,
                                                   (TUSIGN8)((LimitError & 0x01) != 0 ? STRING_INVERT : NO_INVERT),
                                                   0,
                                                   3,
                                                   3,
                                                   0);
            #else
                TUSIGN8 customChar[11] = {0x00,0x00,0x00,0x48,0x58,0x7D,0x58,0x48,0x00,0x00,0x00};
                packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 0, 5, 0, 0);
            #endif
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                             5,
                                             JUSTIFY_LEFT,
                                             FONT_0,
                                             (TUSIGN8)((LimitError & 0x01) != 0 ? STRING_INVERT : NO_INVERT),
                                             0,
                                             0,
                                             6,
                                             0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_EDIT_VALUE,                      // Parameter value                         |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_EDIT_VALUE)
    {
        TUSIGN8 negValue;
        TUSIGN8 *pValue;
        // get parameter value from Adjuster
        pValue = AdjusterGetVariableAsString(&negValue);

        text[0] = negValue ? '-' : ' ';
        text[1] = 0x00;
        (void)strcat((char *)text,(char*)pValue);

        if (FrameTableGetCursorPosition() == FrameTableGetCursorPositionLimit())
        {
            packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,1,JUSTIFY_RIGHT_WITH_INDENT_8,FONT_1,NO_INVERT,0,0,1,0);
        }
        else
        {
            packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,1,JUSTIFY_RIGHT_WITH_INDENT_8,FONT_1,CHAR_INVERT,FrameTableGetCursorPosition(),0,1,0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_FRAME_RIGHT_KEY,                 //                                         |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == LINEARIZER_FRAME_RIGHT_KEY)
    {
        if ((currLinearizerCursorPos == LINEARIZER_CURSOR_INPOINT_EDIT) || (currLinearizerCursorPos == LINEARIZER_CURSOR_OUTPOINT_EDIT))
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_OK;
            TUSIGN8 invert = NO_INVERT;

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,invert,0,3,3,1);
            }
            else
            #endif
            {
                packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,invert,0,0,9,1);
            }
        }
        else
        {
            const TUSIGN8 *pArray = Blank_Icon;

            switch (currLinearizerCursorPos)
            {
            case LINEARIZER_CURSOR_INPOINT_VIEW:
                if (FrameTable_isLinearizerInpointEdit_Enabled())
                {
                    ATTRIB_IDENTIFIER_TYPE ARM_check_object = {LinearizerSubsystem,InPointObject,LinPointSelected};
                    if (WriteProtect_HMICanAccess(ARM_check_object, (TUSIGN8)0))
                    {
                        pArray = RightKey_Edit;
                    }
                }
                break;

            case LINEARIZER_CURSOR_OUTPOINT_VIEW:
                if (FrameTable_isLinearizerOutpointEdit_Enabled())
                {
                    if (FrameTable_GetLinearizerPointEnable(LinearizerSubsystem, PointEnableObject, LinPointSelected))
                    {
                        ATTRIB_IDENTIFIER_TYPE ARM_check_object = {LinearizerSubsystem,OutPointObject,LinPointSelected};
                        if (WriteProtect_HMICanAccess(ARM_check_object, (TUSIGN8)0))
                        {
                            pArray = RightKey_Edit;
                        }
                    }
                }
                break;

            case LINEARIZER_CURSOR_EXIT:
            default:
                pArray = RightKey_Back;
                break;
            }
            packetsBuilt += BuildWriteArray(pArray, KEY_FIELD_WIDTH, MAX_COMMON_HMI_WIDTH - KEY_FIELD_WIDTH, 7, 1);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    LINEARIZER_FRAME_READ_SWITCHES              //                                         |
//------------------------------------------------//-----------------------------------------|

//---------------------------------------------//-----------------------------------------|
    return packetsBuilt;
}
#endif


#ifdef HMI_SUPPORTS_MATRIX_FRAMES

#define CURRENTLY_EDITING   ((currMatrixCursorPos == MATRIX_CURSOR_COLUMN_EDIT) || (currMatrixCursorPos == MATRIX_CURSOR_ROW_EDIT) || (currMatrixCursorPos == MATRIX_CURSOR_ELEMENT_EDIT))
#define PREVIOUSLY_EDITING  ((prvMatrixCursorPos[MatrixInstance] == MATRIX_CURSOR_COLUMN_EDIT) || (prvMatrixCursorPos[MatrixInstance] == MATRIX_CURSOR_ROW_EDIT) || (prvMatrixCursorPos[MatrixInstance] == MATRIX_CURSOR_ELEMENT_EDIT))

#define CURRENTLY_VIEWING   ((currMatrixCursorPos != MATRIX_CURSOR_COLUMN_EDIT) && (currMatrixCursorPos != MATRIX_CURSOR_ROW_EDIT) && (currMatrixCursorPos != MATRIX_CURSOR_ELEMENT_EDIT))
#define PREVIOUSLY_VIEWING  ((prvMatrixCursorPos[MatrixInstance] != MATRIX_CURSOR_COLUMN_EDIT) && (prvMatrixCursorPos[MatrixInstance] != MATRIX_CURSOR_ROW_EDIT) && (prvMatrixCursorPos[MatrixInstance] != MATRIX_CURSOR_ELEMENT_EDIT))

#define ACKNOWLEDGE_CURSOR_CHANGE   prvMatrixCursorPos[MatrixInstance] = currMatrixCursorPos


TUSIGN8 BuildMatrixFrame(TBOOL T_C_D)
{
    typedef enum
    {                                           // Packet                                  |
                                                //=========================================|
    MATRIX_FRAME_TITLE_BAR,                     // Title Bar (View or Edit)                | 0 - Start of Static Area (MATRIX EDIT) or (MATRIX VIEW)
                                                //-----------------------------------------|    Start from here if MATRIX EDIT / MATRIX VIEW changed
    MATRIX_FRAME_TITLE_ICON,                    // Title Bar Icon (View or Edit)           | 1
                                                //-----------------------------------------|
    MATRIX_FRAME_LEFT_KEY,                      //                                         | 2
                                                //=========================================|
    MATRIX_VIEW_COLUMN_ID,                      // ID of column data                       | 3 - Start of Keypress Area (MATRIX VIEW)
                                                //-----------------------------------------|     Start from here if cursor changed (MATRIX VIEW)
    MATRIX_VIEW_ROW_ID,                         // ID of row data                          | 4
                                                //-----------------------------------------|
    MATRIX_VIEW_ELEMENT_ID,                     // ID of element data                      | 5
                                                //-----------------------------------------|
    MATRIX_VIEW_COLUMN_ID_HIGHLIGHT,            // Additional highlight on ID of col. data | 6
                                                //-----------------------------------------|
    MATRIX_VIEW_ROW_ID_HIGHLIGHT,               // Additional highlight on ID of row data  | 7
                                                //-----------------------------------------|
    MATRIX_VIEW_ELEMENT_ID_HIGHLIGHT,           // Additional highlight on ID of elm. data | 8
                                                //-----------------------------------------|
    MATRIX_VIEW_ELEMENT_EDIT_CALC,              // Element Edited/calculated indicator     | 9
                                                //-----------------------------------------|
    MATRIX_VIEW_COLUMN_VALUE_UNITS,             // value & units of column data            | 10 - Start of active Area (MATRIX VIEW)
                                                //-----------------------------------------|
    MATRIX_VIEW_ROW_VALUE_UNITS,                // value & units of row data               | 11
                                                //-----------------------------------------|
    MATRIX_VIEW_ELEMENT_VALUE_UNITS,            // value & units of element data           | 12
                                                //=========================================|
    MATRIX_EDIT_UNITS,                          // Engineering Units                       | 13
                                                //-----------------------------------------|
    MATRIX_EDIT_MAX,                            // High Limit                              | 14
                                                //-----------------------------------------|
    MATRIX_EDIT_MIN,                            // Low Limit                               | 15
                                                //-----------------------------------------|
    MATRIX_EDIT_MAX_ICON,                       // High Limit icon or text                 | 16
                                                //-----------------------------------------|
    MATRIX_EDIT_MIN_ICON,                       // Low Limit icon or text                  | 17
                                                //-----------------------------------------|
    MATRIX_EDIT_VALUE,                          // Parameter value                         | 18 - Start of Keypress Area (MATRIX EDIT)
                                                //=========================================|
    MATRIX_FRAME_RIGHT_KEY,                     //                                         | 19
                                                //-----------------------------------------|
    MATRIX_FRAME_READ_SWITCHES                  //                                         | 20
                                                //-----------------------------------------| - There is no active area (MATRIX EDIT) or (MATRIX VIEW)
    }MATRIX_FRAME_PACKET;

    // Return data
    TUSIGN8 packetsBuilt = 0;

    // General data
    TUSIGN8 text[22];
    TUSIGN8 MatrixInstance = 0;

    #ifdef HMI_SUPPORTS_SERVICEPORT
    MatrixInstance = PacketManagerIsRemoteInstance() ? 1 : 0;
    #endif


    // TITLE DATA
    TUSIGN8 colID[4] = {0x58,0x00,0x00,0x00};   // "X";
    TUSIGN8 rowID[4] = {0x59,0x00,0x00,0x00};   // "Y";
    TUSIGN8 elmID[4] = {0x58,0x2C,0x59,0x00};   // "X,Y";

    if (T_C_D)
    {
        colID[0] = 'T';
        rowID[0] = 'C';
        elmID[0] = 'D';
        elmID[1] = ' ';
        elmID[2] = ' ';
    }

    // MATRIX (SUBSYSTEM) DATA
    TUSIGN16 MatrixSubsystem = (TUSIGN16)(LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.matrix_subsystem_index);
    TUSIGN16 MatrixObject    = (TUSIGN16)LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.matrix_object_index;
    const T_MATRIX *pMatrix  = (T_MATRIX*)(GetSubsystemPtr(MatrixSubsystem));
    TUSIGN8 MatrixNumber;

    VIP_ASSERT(((T_UNIT*)pMatrix)->Get((T_UNIT*)pMatrix, MatrixObject, 0, (void FAST *)&MatrixNumber) == (TUSIGN16)OK);

    // CURSOR DATA
    static MATRIX_CURSOR_POS prvMatrixCursorPos[2] = {MATRIX_CURSOR_EXIT,MATRIX_CURSOR_EXIT};

    MATRIX_CURSOR_POS currMatrixCursorPos = FrameTable_GetMatrixCursor();

    TBOOL EditView_changed = ((CURRENTLY_EDITING && PREVIOUSLY_VIEWING) || (CURRENTLY_VIEWING && PREVIOUSLY_EDITING)) ? eTRUE : eFALSE;
    TBOOL Cursor_changed   = (currMatrixCursorPos != prvMatrixCursorPos[MatrixInstance]) ? eTRUE : eFALSE;

    TUSIGN8 i_col_selected = FrameTable_GetMatrixColumn();
    TUSIGN8 s_col_selected[3] = {0x3F,0x3F,0x00};
    if (i_col_selected <= 99)
    {
        s_col_selected[0] = (i_col_selected / 10) + 0x30;
        s_col_selected[1] = (i_col_selected % 10) + 0x30;
    }

    TUSIGN8 i_row_selected = FrameTable_GetMatrixRow();
    TUSIGN8 s_row_selected[3] = {0x3F,0x3F,0x00};
    if (i_row_selected <= 99)
    {
        s_row_selected[0] = (i_row_selected / 10) + 0x30;
        s_row_selected[1] = (i_row_selected % 10) + 0x30;
    }

    // DATA SPECIFIC TO EDIT OPERATION
    TFLOAT  maxValue,    minValue;
    TUSIGN8 min_max_DP;
    TBOOL   min_max_rules;
    TUSIGN8 LimitError;
    TUSIGN16 errorCode;

    if ((LOCAL_updateStaticArea) || (EditView_changed))
    {
        LOCAL_packetStage = MATRIX_FRAME_TITLE_BAR;
        ACKNOWLEDGE_CURSOR_CHANGE;
    }

    if (CURRENTLY_EDITING)
    {
        if ((LOCAL_keypressProcessed) && (LOCAL_packetStage > MATRIX_EDIT_VALUE))
        {
            LOCAL_packetStage = MATRIX_EDIT_VALUE;
            ACKNOWLEDGE_CURSOR_CHANGE;
        }
    }
    else
    {
        if (((LOCAL_keypressProcessed) || (Cursor_changed)) && (LOCAL_packetStage > MATRIX_VIEW_COLUMN_ID))
        {
            LOCAL_packetStage = MATRIX_VIEW_COLUMN_ID;
            ACKNOWLEDGE_CURSOR_CHANGE;
        }

        if ((LOCAL_updateActiveArea) && (LOCAL_packetStage > MATRIX_VIEW_COLUMN_VALUE_UNITS))
        {
            LOCAL_packetStage = MATRIX_VIEW_COLUMN_VALUE_UNITS;
        }
    }

    if (LOCAL_packetStage >= MATRIX_FRAME_READ_SWITCHES)
    {
        packetsBuilt += BuildReadSwitches(1);
        LOCAL_packetStage = MATRIX_FRAME_READ_SWITCHES;
    }

//------------------------------------------------//-----------------------------------------|
//    MATRIX_FRAME_TITLE_BAR,                      // Title Bar                               | - Start of Static Area (MATRIX VIEW)
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MATRIX_FRAME_TITLE_BAR)
    {
        if (CURRENTLY_EDITING)
        {
            text[0] = '?';
            text[0] = 0x00;

            if (currMatrixCursorPos == MATRIX_CURSOR_COLUMN_EDIT)
            {
                (void)strcpy((char *)text, (char *)colID);
                (void)strcat((char *)text, " ");
                (void)strcat((char *)text, (char *)s_col_selected);
            }
            else if (currMatrixCursorPos == MATRIX_CURSOR_ROW_EDIT)
            {
                (void)strcpy((char *)text, (char *)rowID);
                (void)strcat((char *)text, " ");
                (void)strcat((char *)text, (char *)s_row_selected);
            }
            else if (currMatrixCursorPos == MATRIX_CURSOR_ELEMENT_EDIT)
            {
                (void)strcpy((char *)text, (char *)elmID);
                (void)strcat((char *)text, " ");
                (void)strcat((char *)text, (char *)s_col_selected);
                (void)strcat((char *)text, ",");
                (void)strcat((char *)text, (char *)s_row_selected);
            }
            else
            {
                asm("nop");
            }
            packetsBuilt += BuildFrameTitle(text,0);
        }
        else
        {
            LOCAL_stringtable_text_id.attribIdx = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.title_attribidx;

            #ifdef HMI_SUPPORTS_ASIAN
            if (LOCAL_Asian)
            {
                packetsBuilt += BuildFrameTitle_w(FrameTableGetString(LOCAL_stringtable_text_id),8,0);
            }
            else
            #endif
            {
                packetsBuilt += BuildFrameTitle(FrameTableGetString(LOCAL_stringtable_text_id),0);
            }
        }
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_FRAME_TITLE_ICON,                    // Title Bar Icon (View or Edit)           |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MATRIX_FRAME_TITLE_ICON)
    {
        if (CURRENTLY_EDITING)
        {
            packetsBuilt += BuildWriteIcon(ICON_NUMBER_EDIT, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
        }
        else
        {
            TUSIGN8 matrixIcon[13] = {0x3E, 0x41, 0x00, 0x55, 0x22, 0x55, 0x00, 0x55, 0x22, 0x55, 0x00, 0x41, 0x3E};
            packetsBuilt += BuildWriteArray(matrixIcon, 13, MAX_COMMON_HMI_WIDTH-SMALL_ICON_WIDTH-1, 0, 0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_FRAME_LEFT_KEY,                      //                                         |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MATRIX_FRAME_LEFT_KEY)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_NEXT;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_LEFT,NO_INVERT,0,3,3,0);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_LEFT,FONT_0,NO_INVERT,0,0,9,0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_VIEW_COLUMN_ID,                      // ID of column data                       |
//    MATRIX_VIEW_ROW_ID,                         // ID of row data                          |
//    MATRIX_VIEW_ELEMENT_ID,                     // ID of element data                      |
//    MATRIX_VIEW_COLUMN_ID_HIGHLIGHT,            // Additional highlight on ID of col. data |
//    MATRIX_VIEW_ROW_ID_HIGHLIGHT,               // Additional highlight on ID of row data  |
//    MATRIX_VIEW_ELEMENT_ID_HIGHLIGHT,           // Additional highlight on ID of elm. data |
//    MATRIX_VIEW_ELEMENT_EDIT_CALC,              // Element Edited/calculated indicator     |
//    MATRIX_VIEW_COLUMN_VALUE_UNITS,             // value & units of column data            |
//    MATRIX_VIEW_ROW_VALUE_UNITS,                // value & units of row data               |
//    MATRIX_VIEW_ELEMENT_VALUE_UNITS,            // value & units of element data           |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= MATRIX_VIEW_COLUMN_ID)
     && (LOCAL_packetStage <= MATRIX_VIEW_ELEMENT_VALUE_UNITS)
     && (CURRENTLY_EDITING == eTRUE))
    {
        LOCAL_packetStage = MATRIX_VIEW_ELEMENT_VALUE_UNITS + 1;
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_VIEW_COLUMN_ID,                      // ID of column data                       |
//    MATRIX_VIEW_ROW_ID,                         // ID of row data                          |
//    MATRIX_VIEW_ELEMENT_ID,                     // ID of element data                      |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= MATRIX_VIEW_COLUMN_ID)
     && (LOCAL_packetStage <= MATRIX_VIEW_ELEMENT_ID))
    {
        TUSIGN8 startPacket, cursorCompare, lineNumber, invert;
        TUSIGN8 *p_ID;
        TUSIGN8 *p_Selection;

        do
        {
            startPacket = LOCAL_packetStage;

            if      (LOCAL_packetStage == MATRIX_VIEW_COLUMN_ID)    {cursorCompare = MATRIX_CURSOR_COLUMN;  lineNumber = 2; p_ID = colID;   p_Selection = s_col_selected;  }
            else if (LOCAL_packetStage == MATRIX_VIEW_ROW_ID)       {cursorCompare = MATRIX_CURSOR_ROW;     lineNumber = 3; p_ID = rowID;   p_Selection = s_row_selected;  }
            else                                                    {cursorCompare = MATRIX_CURSOR_ELEMENT; lineNumber = 4; p_ID = elmID;   p_Selection = NULL;            }

            invert = (currMatrixCursorPos == cursorCompare) ? STRING_INVERT : NO_INVERT;

            (void)strcpy((char *)text, (char *)p_ID);
            if (p_Selection)
            {
                (void)strcat((char *)text, (char *)p_Selection);
            }

            packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,lineNumber,JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,FONT_0,invert,0,0,3,0);
        }
        while ((LOCAL_packetStage != startPacket) && (LOCAL_packetStage <= MATRIX_VIEW_ELEMENT_ID));
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_VIEW_COLUMN_ID_HIGHLIGHT,            // Additional highlight on ID of col. data |
//    MATRIX_VIEW_ROW_ID_HIGHLIGHT,               // Additional highlight on ID of row data  |
//    MATRIX_VIEW_ELEMENT_ID_HIGHLIGHT,           // Additional highlight on ID of elm. data |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= MATRIX_VIEW_COLUMN_ID_HIGHLIGHT)
     && (LOCAL_packetStage <= MATRIX_VIEW_ELEMENT_ID_HIGHLIGHT))
    {
        TUSIGN8 startPacket, cursorCompare, lineNumber, highlight;

        do
        {
            startPacket = LOCAL_packetStage;

            if      (LOCAL_packetStage == MATRIX_VIEW_COLUMN_ID_HIGHLIGHT)  {cursorCompare = MATRIX_CURSOR_COLUMN;  lineNumber = 2; }
            else if (LOCAL_packetStage == MATRIX_VIEW_ROW_ID_HIGHLIGHT)     {cursorCompare = MATRIX_CURSOR_ROW;     lineNumber = 3; }
            else                                                            {cursorCompare = MATRIX_CURSOR_ELEMENT; lineNumber = 4; }

            highlight = (currMatrixCursorPos == cursorCompare) ? 0xFF : 0x00;

            packetsBuilt += BuildWriteArray(&highlight, 1, 0, lineNumber, 0);
        }
        while ((LOCAL_packetStage != startPacket) && (LOCAL_packetStage <= MATRIX_VIEW_ELEMENT_ID_HIGHLIGHT));
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_VIEW_ELEMENT_EDIT_CALC,              // Element Edited/calculated indicator     |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MATRIX_VIEW_ELEMENT_EDIT_CALC)
    {
        TUSIGN8 calcAvailable;

        if (pMatrix->GetMatrixData(MatrixNumber, HMI_MATRIX_CALCULATION, &calcAvailable) != eTRUE)
        {
            calcAvailable = 0;
        }
        if (calcAvailable)
        {
            TBOOL calculated;
            if (pMatrix->GetIsElementCalculated(MatrixNumber, i_col_selected, i_row_selected, &calculated))
            {
                TUSIGN8 edited[6]    = {0x00,0x3E,0x2A,0x2A,0x22,0x00};
                TUSIGN8 edited_HL[6] = {0x7F,0x41,0x55,0x55,0x5D,0x7F};
                TUSIGN8 calcd[6]     = {0x00,0x3E,0x2A,0x2A,0x14,0x00};
                TUSIGN8 calcd_HL[6]  = {0x7F,0x41,0x55,0x55,0x6B,0x7F};
                TUSIGN8 *pArray;

                if (currMatrixCursorPos == MATRIX_CURSOR_ELEMENT_RESET)
                {
                    pArray = calculated ? calcd_HL : edited_HL;
                }
                else
                {
                    pArray = calculated ? calcd : edited;
                }

                packetsBuilt += BuildWriteArray(pArray, 6, 120, 4, 0);
            }
            else
            {
            LOCAL_packetStage ++;
            }
        }
        else
        {
            LOCAL_packetStage ++;
        }
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_VIEW_COLUMN_VALUE_UNITS,             // value & units of column data            |
//    MATRIX_VIEW_ROW_VALUE_UNITS,                // value & units of row data               |
//    MATRIX_VIEW_ELEMENT_VALUE_UNITS,            // value & units of element data           |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= MATRIX_VIEW_COLUMN_VALUE_UNITS)
     && (LOCAL_packetStage <= MATRIX_VIEW_ELEMENT_VALUE_UNITS))
    {
        TUSIGN8 startPacket;

        T_SUBSYSTEM_IDX DataSS;
        TUSIGN16        DataObj;
        TINT16          DataAtt;

        do
        {
            startPacket = LOCAL_packetStage;

            TBOOL   DataValid = eFALSE;
            TFLOAT  DataValue = 0;
            TUSIGN8 DataDecPt;
            TUSIGN8 lineNumber;
            TUSIGN8 unitsType, UOM_data_L, UOM_data_H;
            TUSIGN8 const *pUnits;

//            TUSIGN8 value_and_units[17];
            TUSIGN8 units[17];

            // add value to "value_and_units"
            if (LOCAL_packetStage == MATRIX_VIEW_COLUMN_VALUE_UNITS)
            {
                DataValid  = pMatrix->GetColumnObjIndeces(MatrixNumber, i_col_selected, &DataSS, &DataObj, &DataAtt);
                DataDecPt  = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.dpPosn_Col;
                unitsType  = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_type_col;
                UOM_data_L = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_data_col_L;
                UOM_data_H = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_data_col_H;
                lineNumber = 2;
            }
            else if (LOCAL_packetStage == MATRIX_VIEW_ROW_VALUE_UNITS)
            {
                DataValid  = pMatrix->GetRowObjIndeces(MatrixNumber, i_row_selected, &DataSS, &DataObj, &DataAtt);
                DataDecPt  = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.dpPosn_Row;
                unitsType  = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_type_row;
                UOM_data_L = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_data_row_L;
                UOM_data_H = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_data_row_H;
                lineNumber = 3;
            }
            else
            {
                DataValid  = pMatrix->GetElementObjIndeces(MatrixNumber, i_col_selected, i_row_selected, &DataSS, &DataObj, &DataAtt);
                DataDecPt  = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.dpPosn_Elm;
                unitsType  = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_type_elm;
                UOM_data_L = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_data_elm_L;
                UOM_data_H = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_data_elm_H;
                lineNumber = 4;
            }

            if (DataValid)
            {
                // successfully found ss, obj, & att indeces of data
                T_UNIT const SLOW *pSub = GetSubsystemPtr(DataSS);
                if (pSub->Get(pSub,DataObj,DataAtt,(void FAST *)&DataValue) >= (TUSIGN16)ERROR_CODES)
                {
                    DataValid = eFALSE;
                }
            }

            if (DataValid)
            {
                TUSIGN8 *pNumber;
                TUSIGN8 negNumber;
                TUSIGN8 within_over_under;

                pNumber = AdjusterBuildNumberString(DataValue, 6, DataDecPt, &negNumber, &within_over_under);




                if ((within_over_under == 1) || (within_over_under == 2))
                {
                    // overrange or underrange
                    TUSIGN8 i;
                    text[0] = 0x20;

                    for (i = 1; i <= 6; )
                    {
                        text[i] = 0x05 + within_over_under;
                        i++;
                        text[i] = 0x00;
                    }
                }
                else
                {
                    text[0] = 0x00;

                    // value within range or a normal numerical frame with an edit
                    while (*pNumber == 0x20)
                    {
                        #pragma diag_suppress=Pm088
                        pNumber ++;
                        #pragma diag_default=Pm088
                    }

                    if (negNumber)
                    {
                        text[0] = '-';
                        text[1] = 0x00;
                    }
                    (void)strcat((char *)text,(char *)pNumber);
                }
                (void)strcat((char *)text," ");
            }
            else
            {
                text[0] = 0x00;
            }

            // add a space to "value_and_units"
            strcat((char*)text, " ");

            // add units to "value_and_units"
            if (unitsType == FIXED_TEXT_UNITS)
            {
                pUnits = PacketManagerGetEngUnits(0, UOM_data_L, UOM_data_H, unitsType);
            }
            else if (unitsType <= USE_UOM_11)
            {
                pUnits = PacketManagerGetEngUnits((T_SUBSYSTEM_IDX)UOM_data_H, UOM_data_L, 0, unitsType);
            }
            else
            {
                pUnits = PacketManagerGetEngUnits(0, IDS_BLANK, 0, FIXED_TEXT_UNITS);
            }


            (void)strcpy((char*)units,(const char*)pUnits);

            #ifdef HMI_SUPPORTS_CUSTOM_UNITS
            PacketManagerRemoveCustomfromUnits(units);
            #endif

            LimitTextLength(units,8);

            TUSIGN8 len = strlen((char*)units);
            strcat((char*)text, (char*)units);

            while (len < 8)
            {
                strcat((char*)text, " ");
                len++;
            }

            packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,lineNumber,JUSTIFY_RIGHT_WITH_INDENT_2,FONT_0,NO_INVERT,0,0,16,0);
        }
        while ((LOCAL_packetStage != startPacket) && (LOCAL_packetStage <= MATRIX_VIEW_ELEMENT_VALUE_UNITS));
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_EDIT_UNITS,                          // Engineering Units                       |
//    MATRIX_EDIT_MAX,                            // High Limit                              |
//    MATRIX_EDIT_MIN,                            // Low Limit                               |
//    MATRIX_EDIT_MAX_ICON,                       // High Limit icon or text                 |
//    MATRIX_EDIT_MIN_ICON,                       // Low Limit icon or text                  |
//    MATRIX_EDIT_VALUE,                          // Parameter value                         |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= MATRIX_EDIT_UNITS)
     && (LOCAL_packetStage <= MATRIX_EDIT_VALUE)
     && (CURRENTLY_EDITING == eFALSE))
    {
        LOCAL_packetStage = MATRIX_EDIT_VALUE + 1;
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_EDIT_UNITS,                          // Engineering Units                       |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MATRIX_EDIT_UNITS)
    {
        TUSIGN8 unitsType, UOM_data_L, UOM_data_H;

        TUSIGN8 const *pUnits;

        switch (currMatrixCursorPos)
        {
        case MATRIX_CURSOR_COLUMN_EDIT:
            unitsType  = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_type_col;
            UOM_data_L = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_data_col_L;
            UOM_data_H = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_data_col_H;
            break;
        case MATRIX_CURSOR_ROW_EDIT:
            unitsType  = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_type_row;
            UOM_data_L = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_data_row_L;
            UOM_data_H = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_data_row_H;
            break;
        case MATRIX_CURSOR_ELEMENT_EDIT:
            unitsType  = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_type_elm;
            UOM_data_L = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_data_elm_L;
            UOM_data_H = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.UOM_data_elm_H;
            break;
        default:
            unitsType  = FIXED_TEXT_UNITS;
            UOM_data_L = IDS_BLANK;
            UOM_data_H = 0;
            break;
        }

        if (unitsType == FIXED_TEXT_UNITS)
        {
            pUnits = PacketManagerGetEngUnits(0, UOM_data_L, UOM_data_H, unitsType);
        }
        else if (unitsType <= USE_UOM_11)
        {
            pUnits = PacketManagerGetEngUnits((T_SUBSYSTEM_IDX)UOM_data_H, UOM_data_L, 0, unitsType);
        }
        else
        {
            pUnits = PacketManagerGetEngUnits(0, IDS_BLANK, 0, FIXED_TEXT_UNITS);
        }

        (void)strcpy((char *)text,(const char *)pUnits);

        #ifdef HMI_SUPPORTS_CUSTOM_UNITS
        PacketManagerRemoveCustomfromUnits(text);
        #endif

        LimitTextLength(text,8);
        packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_EUROPEAN,2,JUSTIFY_RIGHT,FONT_0,NO_INVERT,0,0,8,0);
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_EDIT_MAX,                            // High Limit                              |
//    MATRIX_EDIT_MIN,                            // Low Limit                               |
//------------------------------------------------//-----------------------------------------|
    if ((LOCAL_packetStage >= MATRIX_EDIT_MAX)
     && (LOCAL_packetStage <= MATRIX_EDIT_MIN))
    {
        T_SUBSYSTEM_IDX DataSS;
        TUSIGN16        DataObj;
        TINT16          DataAtt;

        TBOOL           DataValid;
        TUSIGN8         DataDecPt;

        switch (currMatrixCursorPos)
        {
        case MATRIX_CURSOR_COLUMN_EDIT:
            DataValid  = pMatrix->GetColumnObjIndeces(MatrixNumber, i_col_selected, &DataSS, &DataObj, &DataAtt);
            DataDecPt  = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.dpPosn_Col;
            break;
        case MATRIX_CURSOR_ROW_EDIT:
            DataValid  = pMatrix->GetRowObjIndeces(MatrixNumber, i_row_selected, &DataSS, &DataObj, &DataAtt);
            DataDecPt  = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.dpPosn_Row;
            break;
        case MATRIX_CURSOR_ELEMENT_EDIT:
            DataValid  = pMatrix->GetElementObjIndeces(MatrixNumber, i_col_selected, i_row_selected, &DataSS, &DataObj, &DataAtt);
            DataDecPt  = LOCAL_pCurrDisplayFrame->frameDefinition.matrixFrame.dpPosn_Elm;
            break;
        default:
            DataValid  = eFALSE;
            DataDecPt  = 0;
            break;
        }

        if (DataValid)
        {
            T_DO_ATTRIB_RANGE Range;
            const T_UNIT SLOW *pSub = GetSubsystemPtr(DataSS);
            if (pSub->GetAttributeDescription(pSub,DataObj,(TUSIGN16)DataAtt,(T_DO_ATTRIB_RANGE FAST*)&Range) < (TUSIGN16)ERROR_CODES)
            {
                maxValue = Range.range.flt.max;
                minValue = Range.range.flt.min;
                min_max_rules = Range.rulesAreActive;
                min_max_DP = DataDecPt;

                LimitError = AdjusterGetLimitError(&errorCode);
            }
            else
            {
                DataValid = eFALSE;
            }
        }

        if (!DataValid)
        {
            LOCAL_packetStage = MATRIX_EDIT_MIN + 1;
        }
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_EDIT_MAX,                            // High Limit                              |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MATRIX_EDIT_MAX)
    {
        TUSIGN8 *pNumber;
        TUSIGN8 negNumber = 0;
        TUSIGN8 within_over_under = 0;
        TUSIGN8 i;

        text[0] = ' ';
        text[1] = 0x00;

        if (min_max_rules)
        {
            pNumber = AdjusterBuildNumberString(maxValue, 6, min_max_DP, &negNumber, &within_over_under);

            switch (within_over_under)
            {
            case 1: // overrange
                for (i = 0; i <= 6; i ++)
                {
                    (void)strcat((char *)text,"\x06");
                }
                break;

            case 2: // underrange
                for (i = 0; i <= 6; i ++)
                {
                    (void)strcat((char *)text,"\x07");
                }
                break;

            default:
                text[0] = negNumber? '-' : ' ';
                text[1] = 0x00;
                while (*pNumber == ' ')
                {
                    #pragma diag_suppress=Pm088
                    pNumber ++;
                    #pragma diag_default=Pm088
                }
                (void)strcat((char *)text,(char *)pNumber);
                break;
            }
        }
        else
        {
            for (i = 0; i <= 6; i ++)
            {
                (void)strcat((char *)text,"9");
            }
        }

        TUSIGN8 justify = JUSTIFY_LEFT_WITH_INDENT_6;
        #if defined(HMI_SUPPORTS_ASIAN) && (defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION))
        if (LOCAL_Asian)
        {
            justify = JUSTIFY_LEFT_WITH_INDENT_35_PIXEL;
        }
        #endif

        packetsBuilt += BuildWriteString(text,
                                         HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                         4,
                                         justify,
                                         FONT_0,
                                         (TUSIGN8)((LimitError & 0x02) != 0 ? STRING_INVERT:NO_INVERT),
                                         0,
                                         0,
                                         FONT1_MAX_CHARS - 6,
                                         0);
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_EDIT_MIN,                            // Low Limit                               |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MATRIX_EDIT_MIN)
    {
        TUSIGN8 *pNumber;
        TUSIGN8 negNumber = 0;
        TUSIGN8 within_over_under = 0;
        TUSIGN8 i;

        text[0] = ' ';
        text[1] = 0x00;

        if (min_max_rules)
        {
            pNumber = AdjusterBuildNumberString(minValue, 6, min_max_DP, &negNumber, &within_over_under);

            switch (within_over_under)
            {
            case 1: // overrange
                for (i = 0; i <= LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters; i ++)
                {
                    (void)strcat((char *)text,"\x06");
                }
                break;

            case 2: // underrange
                for (i = 0; i <= LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters; i ++)
                {
                    (void)strcat((char *)text,"\x07");
                }
                break;

            default:
                text[0] = negNumber? '-' : ' ';
                text[1] = 0x00;
                while (*pNumber == ' ')
                {
                    #pragma diag_suppress=Pm088
                    pNumber ++;
                    #pragma diag_default=Pm088
                }
                (void)strcat((char *)text,(char *)pNumber);
                break;
            }
        }

        else
        {
            text[0] = negNumber? '-' : ' ';
            text[1] = 0x00;

            for (i = 0; i < LOCAL_pCurrDisplayFrame->frameDefinition.numericalParamFrame.attributes.maxCharacters; i ++)
            {
                (void)strcat((char *)text,"9");
            }
        }

        TUSIGN8 justify = JUSTIFY_LEFT_WITH_INDENT_6;
        #if defined(HMI_SUPPORTS_ASIAN) && (defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION))
        if (LOCAL_Asian)
        {
            justify = JUSTIFY_LEFT_WITH_INDENT_35_PIXEL;
        }
        #endif

        packetsBuilt += BuildWriteString(text,
                                         HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                         5,
                                         justify,
                                         FONT_0,
                                         (TUSIGN8)((LimitError & 0x01) != 0 ? STRING_INVERT : NO_INVERT),
                                         0,
                                         0,
                                         FONT1_MAX_CHARS - 6,
                                         0);
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_EDIT_MAX_ICON,                       // High Limit icon or text                 |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MATRIX_EDIT_MAX_ICON)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_HIGH_LIMIT;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            #if defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION)
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),
                                                   4,
                                                   JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,
                                                   (TUSIGN8)((LimitError & 0x02) != 0 ? STRING_INVERT:NO_INVERT),
                                                   0,
                                                   3,
                                                   3,
                                                   0);
            #else
                TUSIGN8 customChar[11] = {0x00,0x00,0x00,0x09,0x0D,0x5F,0x0D,0x09,0x00,0x00,0x00,};
                packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 0, 4, 0, 0);
            #endif
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                             4,
                                             JUSTIFY_LEFT,
                                             FONT_0,
                                             (TUSIGN8)((LimitError & 0x02) != 0 ? STRING_INVERT:NO_INVERT),
                                             0,
                                             0,
                                             6,
                                             0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_EDIT_MIN_ICON,                       // Low Limit icon or text                  |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MATRIX_EDIT_MIN_ICON)
    {
        LOCAL_stringtable_text_id.attribIdx = IDS_LOW_LIMIT;
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            #if defined(TYPE_4_IMPLEMENTATION) || defined(TYPE_5_IMPLEMENTATION)
                packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),
                                                   5,
                                                   JUSTIFY_LEFT_WITH_INDENT_1_PIXEL,
                                                   (TUSIGN8)((LimitError & 0x01) != 0 ? STRING_INVERT : NO_INVERT),
                                                   0,
                                                   3,
                                                   3,
                                                   0);
            #else
                TUSIGN8 customChar[11] = {0x00,0x00,0x00,0x48,0x58,0x7D,0x58,0x48,0x00,0x00,0x00};
                packetsBuilt += BuildCustomCharacterString(&customChar[0], 11, 0, 5, 0, 0);
            #endif
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),
                                             HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,
                                             5,
                                             JUSTIFY_LEFT,
                                             FONT_0,
                                             (TUSIGN8)((LimitError & 0x01) != 0 ? STRING_INVERT : NO_INVERT),
                                             0,
                                             0,
                                             6,
                                             0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_EDIT_VALUE,                          // Parameter value                         | - Start of Keypress Area (MATRIX EDIT)
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MATRIX_EDIT_VALUE)
    {
        TUSIGN8 negValue;
        TUSIGN8 *pValue;
        // get parameter value from Adjuster
        pValue = AdjusterGetVariableAsString(&negValue);

        text[0] = negValue ? '-' : ' ';
        text[1] = 0x00;
        (void)strcat((char *)text,(char*)pValue);

        if (FrameTableGetCursorPosition() == FrameTableGetCursorPositionLimit())
        {
            packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,1,JUSTIFY_RIGHT_WITH_INDENT_8,FONT_1,NO_INVERT,0,0,1,0);
        }
        else
        {
            packetsBuilt += BuildWriteString(text,HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,1,JUSTIFY_RIGHT_WITH_INDENT_8,FONT_1,CHAR_INVERT,FrameTableGetCursorPosition(),0,1,0);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_FRAME_RIGHT_KEY,                     //                                         |
//------------------------------------------------//-----------------------------------------|
    if (LOCAL_packetStage == MATRIX_FRAME_RIGHT_KEY)
    {
        TUSIGN8 invert = NO_INVERT;

        T_SUBSYSTEM_IDX DataSS;
        TUSIGN16        DataObj;
        TINT16          DataAtt;

        TBOOL           DataValid;
        TBOOL           checkARM = eFALSE;

        switch (currMatrixCursorPos)
        {
        case MATRIX_CURSOR_COLUMN_EDIT:
        case MATRIX_CURSOR_ROW_EDIT:
        case MATRIX_CURSOR_ELEMENT_EDIT:
            LOCAL_stringtable_text_id.attribIdx = IDS_OK;

            if (FrameTableGetCursorPosition() == FrameTableGetCursorPositionLimit())
            {
                LOCAL_stringtable_text_id.attribIdx = IDS_CANCEL;
                invert = STRING_INVERT;
            }
            break;

        case MATRIX_CURSOR_COLUMN:
            DataValid  = pMatrix->GetColumnObjIndeces(MatrixNumber, i_col_selected, &DataSS, &DataObj, &DataAtt);
            checkARM   = eTRUE;
            break;

        case MATRIX_CURSOR_ROW:
            DataValid  = pMatrix->GetRowObjIndeces(MatrixNumber, i_row_selected, &DataSS, &DataObj, &DataAtt);
            checkARM   = eTRUE;
            break;

        case MATRIX_CURSOR_ELEMENT:
        case MATRIX_CURSOR_ELEMENT_RESET:
            DataValid  = pMatrix->GetElementObjIndeces(MatrixNumber, i_col_selected, i_row_selected, &DataSS, &DataObj, &DataAtt);
            checkARM   = eTRUE;
            break;

        case MATRIX_CURSOR_EXIT:
        default:
            LOCAL_stringtable_text_id.attribIdx = IDS_EXIT;
            invert = STRING_INVERT;
            break;
        }

        if (checkARM)
        {
            LOCAL_stringtable_text_id.attribIdx = IDS_BLANK;

            if (DataValid)
            {
                ATTRIB_IDENTIFIER_TYPE valueID;

                valueID.ssIdx = DataSS;
                valueID.objIdx = DataObj;
                valueID.attribIdx = DataAtt;

               if (WriteProtect_HMICanAccess(valueID, (TUSIGN8)0))
               {
                    LOCAL_stringtable_text_id.attribIdx = IDS_EDIT;
               }
            }
        }
        #ifdef HMI_SUPPORTS_ASIAN
        if (LOCAL_Asian)
        {
            packetsBuilt += BuildWriteString_w(FrameTableGetString(LOCAL_stringtable_text_id),ASIAN_SOFTKEY_LINE,JUSTIFY_RIGHT,invert,0,3,3,1);
        }
        else
        #endif
        {
            packetsBuilt += BuildWriteString(FrameTableGetString(LOCAL_stringtable_text_id),HMI_EXTENDED_CHARACTER_PAGE_USE_LANGUAGE,7,JUSTIFY_RIGHT,FONT_0,invert,0,0,9,1);
        }
    }
//------------------------------------------------//-----------------------------------------|
//    MATRIX_FRAME_READ_SWITCHES                  //                                         |
//------------------------------------------------//-----------------------------------------|

//---------------------------------------------//-----------------------------------------|
    return packetsBuilt;
}
#endif // end of #ifdef HMI_SUPPORTS_MATRIX_FRAMES


